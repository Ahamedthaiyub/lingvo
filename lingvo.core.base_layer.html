

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>lingvo.core.base_layer module &mdash; Lingvo  documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="lingvo.core.base_model module" href="lingvo.core.base_model.html" />
    <link rel="prev" title="lingvo.core.base_input_generator module" href="lingvo.core.base_input_generator.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> Lingvo
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="lingvo.html">lingvo package</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="lingvo.html#subpackages">Subpackages</a><ul class="current">
<li class="toctree-l3 current"><a class="reference internal" href="lingvo.core.html">lingvo.core package</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="lingvo.core.html#subpackages">Subpackages</a></li>
<li class="toctree-l4 current"><a class="reference internal" href="lingvo.core.html#submodules">Submodules</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="lingvo.tasks.html">lingvo.tasks package</a></li>
<li class="toctree-l3"><a class="reference internal" href="lingvo.tools.html">lingvo.tools package</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="lingvo.html#submodules">Submodules</a></li>
</ul>
</li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Lingvo</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="lingvo.html">lingvo package</a> &raquo;</li>
        
          <li><a href="lingvo.core.html">lingvo.core package</a> &raquo;</li>
        
      <li>lingvo.core.base_layer module</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/lingvo.core.base_layer.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="module-lingvo.core.base_layer">
<span id="lingvo-core-base-layer-module"></span><h1>lingvo.core.base_layer module<a class="headerlink" href="#module-lingvo.core.base_layer" title="Permalink to this headline">¶</a></h1>
<p>Base class for all layers.</p>
<dl class="py class">
<dt id="lingvo.core.base_layer.Accumulator">
<em class="property">class </em><code class="sig-prename descclassname">lingvo.core.base_layer.</code><code class="sig-name descname">Accumulator</code><a class="reference internal" href="_modules/lingvo/core/base_layer.html#Accumulator"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.base_layer.Accumulator" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference external" href="https://docs.python.org/3.7/library/functions.html#object" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></a></p>
<p>Layers can register accumulators to persist step-level state.</p>
<p>Accumulators must be represented by a Tensor of a fixed shape. The default
value must be supplied by overriding DefaultValue(). It is important that
the default tensor value is created on each call in order to avoid
accumulators leaking to different graphs.</p>
<p>Accumulators can be enabled (default) or disabled by pairing
Disable()/Enable() calls. When disabled, the accumulator will only return
the default value and will silently drop calls to SetValue(). When computing
gradients that may touch accumulators, calls should be bracketed with
Disable()/Enable().</p>
<p>Care must be taken when manipulating accumulators across Defun boundaries.
Typically, values for all accumulators in a layer must be explicitly
retrieved and passed in to the Defun scope by calling
layer.GetAccumulatorValues(), marshalling into the Defun and setting them
via layer.SetAccumulatorValues(). The reverse must be done on return.</p>
<dl class="py method">
<dt id="lingvo.core.base_layer.Accumulator.is_disabled">
<em class="property">property </em><code class="sig-name descname">is_disabled</code><a class="headerlink" href="#lingvo.core.base_layer.Accumulator.is_disabled" title="Permalink to this definition">¶</a></dt>
<dd><p>Whether the accumulator is disabled.</p>
</dd></dl>

<dl class="py method">
<dt id="lingvo.core.base_layer.Accumulator.Disable">
<code class="sig-name descname">Disable</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/base_layer.html#Accumulator.Disable"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.base_layer.Accumulator.Disable" title="Permalink to this definition">¶</a></dt>
<dd><p>Disables the accumulator (must be balanced with Enable).</p>
</dd></dl>

<dl class="py method">
<dt id="lingvo.core.base_layer.Accumulator.Enable">
<code class="sig-name descname">Enable</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/base_layer.html#Accumulator.Enable"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.base_layer.Accumulator.Enable" title="Permalink to this definition">¶</a></dt>
<dd><p>Enables the accumulator (must balance a Disable).</p>
</dd></dl>

<dl class="py method">
<dt id="lingvo.core.base_layer.Accumulator.GetValue">
<code class="sig-name descname">GetValue</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/base_layer.html#Accumulator.GetValue"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.base_layer.Accumulator.GetValue" title="Permalink to this definition">¶</a></dt>
<dd><p>Gets the current value of the accumulator Tensor.</p>
</dd></dl>

<dl class="py method">
<dt id="lingvo.core.base_layer.Accumulator.SetValue">
<code class="sig-name descname">SetValue</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">value</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/base_layer.html#Accumulator.SetValue"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.base_layer.Accumulator.SetValue" title="Permalink to this definition">¶</a></dt>
<dd><p>Sets the current value of the accumulator Tensor.</p>
</dd></dl>

<dl class="py method">
<dt id="lingvo.core.base_layer.Accumulator.Reset">
<code class="sig-name descname">Reset</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/base_layer.html#Accumulator.Reset"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.base_layer.Accumulator.Reset" title="Permalink to this definition">¶</a></dt>
<dd><p>Resets the accumulator to its default value.</p>
</dd></dl>

<dl class="py method">
<dt id="lingvo.core.base_layer.Accumulator.DefaultValue">
<code class="sig-name descname">DefaultValue</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/base_layer.html#Accumulator.DefaultValue"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.base_layer.Accumulator.DefaultValue" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py function">
<dt id="lingvo.core.base_layer._BaseLayerInitWrapper">
<code class="sig-prename descclassname">lingvo.core.base_layer.</code><code class="sig-name descname">_BaseLayerInitWrapper</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">func</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/base_layer.html#_BaseLayerInitWrapper"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.base_layer._BaseLayerInitWrapper" title="Permalink to this definition">¶</a></dt>
<dd><p>A decorator for layer’s __init__.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>func</strong> – The __init__ method of <a class="reference internal" href="#lingvo.core.base_layer.BaseLayer" title="lingvo.core.base_layer.BaseLayer"><code class="xref py py-obj docutils literal notranslate"><span class="pre">BaseLayer</span></code></a>’s subclasses.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A decorator wrapper for layer’s initializer. Note that this wrapper can
be called multiple times for the same layer instance, once for each
__init__() for classes on the class hierarchy.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="lingvo.core.base_layer.RecursiveFindLayerParams">
<code class="sig-prename descclassname">lingvo.core.base_layer.</code><code class="sig-name descname">RecursiveFindLayerParams</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">params</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/base_layer.html#RecursiveFindLayerParams"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.base_layer.RecursiveFindLayerParams" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns all params that define a layer.</p>
</dd></dl>

<dl class="py class">
<dt id="lingvo.core.base_layer.BaseLayerMeta">
<em class="property">class </em><code class="sig-prename descclassname">lingvo.core.base_layer.</code><code class="sig-name descname">BaseLayerMeta</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">name</span></em>, <em class="sig-param"><span class="n">bases</span></em>, <em class="sig-param"><span class="n">dct</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/base_layer.html#BaseLayerMeta"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.base_layer.BaseLayerMeta" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference external" href="https://docs.python.org/3.7/library/functions.html#type" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">type</span></code></a></p>
<p>Metaclass tracking child layers and variable initialization.</p>
</dd></dl>

<dl class="py class">
<dt id="lingvo.core.base_layer.ABCLayerMeta">
<em class="property">class </em><code class="sig-prename descclassname">lingvo.core.base_layer.</code><code class="sig-name descname">ABCLayerMeta</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">name</span></em>, <em class="sig-param"><span class="n">bases</span></em>, <em class="sig-param"><span class="n">dct</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/base_layer.html#ABCLayerMeta"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.base_layer.ABCLayerMeta" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#lingvo.core.base_layer.BaseLayerMeta" title="lingvo.core.base_layer.BaseLayerMeta"><code class="xref py py-class docutils literal notranslate"><span class="pre">lingvo.core.base_layer.BaseLayerMeta</span></code></a>, <a class="reference external" href="https://docs.python.org/3.7/library/abc.html#abc.ABCMeta" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">abc.ABCMeta</span></code></a></p>
</dd></dl>

<dl class="py class">
<dt id="lingvo.core.base_layer.CreateVariableMeta">
<em class="property">class </em><code class="sig-prename descclassname">lingvo.core.base_layer.</code><code class="sig-name descname">CreateVariableMeta</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">var_params</span></em>, <em class="sig-param"><span class="n">theta_fn</span></em>, <em class="sig-param"><span class="n">kwargs</span></em><span class="sig-paren">)</span><a class="headerlink" href="#lingvo.core.base_layer.CreateVariableMeta" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference external" href="https://docs.python.org/3.7/library/stdtypes.html#tuple" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">tuple</span></code></a></p>
<dl class="py method">
<dt id="lingvo.core.base_layer.CreateVariableMeta._asdict">
<code class="sig-name descname">_asdict</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#lingvo.core.base_layer.CreateVariableMeta._asdict" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a new dict which maps field names to their values.</p>
</dd></dl>

<dl class="py attribute">
<dt id="lingvo.core.base_layer.CreateVariableMeta._field_defaults">
<code class="sig-name descname">_field_defaults</code><em class="property"> = {}</em><a class="headerlink" href="#lingvo.core.base_layer.CreateVariableMeta._field_defaults" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt id="lingvo.core.base_layer.CreateVariableMeta._fields">
<code class="sig-name descname">_fields</code><em class="property"> = ('var_params', 'theta_fn', 'kwargs')</em><a class="headerlink" href="#lingvo.core.base_layer.CreateVariableMeta._fields" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt id="lingvo.core.base_layer.CreateVariableMeta._fields_defaults">
<code class="sig-name descname">_fields_defaults</code><em class="property"> = {}</em><a class="headerlink" href="#lingvo.core.base_layer.CreateVariableMeta._fields_defaults" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt id="lingvo.core.base_layer.CreateVariableMeta._make">
<em class="property">classmethod </em><code class="sig-name descname">_make</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">iterable</span></em><span class="sig-paren">)</span><a class="headerlink" href="#lingvo.core.base_layer.CreateVariableMeta._make" title="Permalink to this definition">¶</a></dt>
<dd><p>Make a new CreateVariableMeta object from a sequence or iterable</p>
</dd></dl>

<dl class="py method">
<dt id="lingvo.core.base_layer.CreateVariableMeta._replace">
<code class="sig-name descname">_replace</code><span class="sig-paren">(</span><em class="sig-param"><span class="o">**</span><span class="n">kwds</span></em><span class="sig-paren">)</span><a class="headerlink" href="#lingvo.core.base_layer.CreateVariableMeta._replace" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a new CreateVariableMeta object replacing specified fields with new values</p>
</dd></dl>

<dl class="py attribute">
<dt id="lingvo.core.base_layer.CreateVariableMeta.kwargs">
<code class="sig-name descname">kwargs</code><a class="headerlink" href="#lingvo.core.base_layer.CreateVariableMeta.kwargs" title="Permalink to this definition">¶</a></dt>
<dd><p>Alias for field number 2</p>
</dd></dl>

<dl class="py attribute">
<dt id="lingvo.core.base_layer.CreateVariableMeta.theta_fn">
<code class="sig-name descname">theta_fn</code><a class="headerlink" href="#lingvo.core.base_layer.CreateVariableMeta.theta_fn" title="Permalink to this definition">¶</a></dt>
<dd><p>Alias for field number 1</p>
</dd></dl>

<dl class="py attribute">
<dt id="lingvo.core.base_layer.CreateVariableMeta.var_params">
<code class="sig-name descname">var_params</code><a class="headerlink" href="#lingvo.core.base_layer.CreateVariableMeta.var_params" title="Permalink to this definition">¶</a></dt>
<dd><p>Alias for field number 0</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt id="lingvo.core.base_layer._CreateLayerVariablesStatus">
<em class="property">class </em><code class="sig-prename descclassname">lingvo.core.base_layer.</code><code class="sig-name descname">_CreateLayerVariablesStatus</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">value</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/base_layer.html#_CreateLayerVariablesStatus"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.base_layer._CreateLayerVariablesStatus" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference external" href="https://docs.python.org/3.7/library/enum.html#enum.Enum" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">enum.Enum</span></code></a></p>
<p>An enumeration.</p>
<dl class="py attribute">
<dt id="lingvo.core.base_layer._CreateLayerVariablesStatus.NOT_CALLED">
<code class="sig-name descname">NOT_CALLED</code><em class="property"> = 1</em><a class="headerlink" href="#lingvo.core.base_layer._CreateLayerVariablesStatus.NOT_CALLED" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt id="lingvo.core.base_layer._CreateLayerVariablesStatus.IN_PROGRESS">
<code class="sig-name descname">IN_PROGRESS</code><em class="property"> = 2</em><a class="headerlink" href="#lingvo.core.base_layer._CreateLayerVariablesStatus.IN_PROGRESS" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt id="lingvo.core.base_layer._CreateLayerVariablesStatus.COMPLETED">
<code class="sig-name descname">COMPLETED</code><em class="property"> = 3</em><a class="headerlink" href="#lingvo.core.base_layer._CreateLayerVariablesStatus.COMPLETED" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt id="lingvo.core.base_layer._CreateLayerVariablesStatus.PER_SPLIT_COMPLETED">
<code class="sig-name descname">PER_SPLIT_COMPLETED</code><em class="property"> = 4</em><a class="headerlink" href="#lingvo.core.base_layer._CreateLayerVariablesStatus.PER_SPLIT_COMPLETED" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py class">
<dt id="lingvo.core.base_layer.BaseLayer">
<em class="property">class </em><code class="sig-prename descclassname">lingvo.core.base_layer.</code><code class="sig-name descname">BaseLayer</code><span class="sig-paren">(</span><em class="sig-param"><span class="o">*</span><span class="n">args</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/base_layer.html#BaseLayer"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.base_layer.BaseLayer" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">tensorflow.python.module.module.Module</span></code></p>
<p>Base class for all the layer object.</p>
<p>As this BaseLayer is a proper sub-class of tf.Module, it supports proper
tracking and reflection of key constituents such as variables and submodules.</p>
<p>self.submodules returns a list of submodules that are reachable through
recursive member access from self.</p>
<p>self.variables returns a list of Variables that are reachable through
recursive member access from self.</p>
<p>self(*args, **kwargs) carries out computation on the input args and kwargs.</p>
<dl class="py attribute">
<dt id="lingvo.core.base_layer.BaseLayer._INFERENCE_DRIVER_NAME">
<code class="sig-name descname">_INFERENCE_DRIVER_NAME</code><em class="property"> = None</em><a class="headerlink" href="#lingvo.core.base_layer.BaseLayer._INFERENCE_DRIVER_NAME" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt id="lingvo.core.base_layer.BaseLayer.Params">
<em class="property">classmethod </em><code class="sig-name descname">Params</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/base_layer.html#BaseLayer.Params"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.base_layer.BaseLayer.Params" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the layer params.</p>
</dd></dl>

<dl class="py method">
<dt id="lingvo.core.base_layer.BaseLayer.CopyBaseParams">
<em class="property">static </em><code class="sig-name descname">CopyBaseParams</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">from_params</span></em>, <em class="sig-param"><span class="n">to_params</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/base_layer.html#BaseLayer.CopyBaseParams"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.base_layer.BaseLayer.CopyBaseParams" title="Permalink to this definition">¶</a></dt>
<dd><p>Copies BaseLayer params from <code class="xref py py-obj docutils literal notranslate"><span class="pre">from_params</span></code> to <code class="xref py py-obj docutils literal notranslate"><span class="pre">to_params</span></code>.</p>
</dd></dl>

<dl class="py method">
<dt id="lingvo.core.base_layer.BaseLayer.SetVariableFree">
<code class="sig-name descname">SetVariableFree</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">value</span><span class="o">=</span><span class="default_value">True</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/base_layer.html#BaseLayer.SetVariableFree"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.base_layer.BaseLayer.SetVariableFree" title="Permalink to this definition">¶</a></dt>
<dd><p>Marks this layer as having no variables.</p>
<p>Note that this status affects sublayers and child layers too.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>value</strong> – True to set layer as variable free.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="lingvo.core.base_layer.BaseLayer.FPropDefaultTheta">
<code class="sig-name descname">FPropDefaultTheta</code><span class="sig-paren">(</span><em class="sig-param"><span class="o">*</span><span class="n">args</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/base_layer.html#BaseLayer.FPropDefaultTheta"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.base_layer.BaseLayer.FPropDefaultTheta" title="Permalink to this definition">¶</a></dt>
<dd><p>Calls <a class="reference internal" href="#lingvo.core.base_layer.BaseLayer.FProp" title="lingvo.core.base_layer.BaseLayer.FProp"><code class="xref py py-obj docutils literal notranslate"><span class="pre">FProp</span></code></a>.</p>
</dd></dl>

<dl class="py method">
<dt id="lingvo.core.base_layer.BaseLayer.FProp">
<code class="sig-name descname">FProp</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">theta</span></em>, <em class="sig-param"><span class="o">*</span><span class="n">args</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/base_layer.html#BaseLayer.FProp"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.base_layer.BaseLayer.FProp" title="Permalink to this definition">¶</a></dt>
<dd><p>Forward propagation.</p>
<p>The central interface that subclasses should implement. The caller
calls <a class="reference internal" href="#lingvo.core.base_layer.BaseLayer.FProp" title="lingvo.core.base_layer.BaseLayer.FProp"><code class="xref py py-obj docutils literal notranslate"><span class="pre">FProp</span></code></a> with a <a class="reference internal" href="#lingvo.core.base_layer.BaseLayer.theta" title="lingvo.core.base_layer.BaseLayer.theta"><code class="xref py py-obj docutils literal notranslate"><span class="pre">theta</span></code></a> dictionary. E.g.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">foo</span> <span class="o">=</span> <span class="n">InstanceOfASubClassOfFoo</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">foo</span><span class="o">.</span><span class="n">FProp</span><span class="p">(</span><span class="n">foo</span><span class="o">.</span><span class="n">theta</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
</pre></div>
</div>
<p>The implementation of <a class="reference internal" href="#lingvo.core.base_layer.BaseLayer.FProp" title="lingvo.core.base_layer.BaseLayer.FProp"><code class="xref py py-obj docutils literal notranslate"><span class="pre">FProp()</span></code></a> computes a function given
the theta and the inputs. E.g.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">subs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">children</span>
<span class="n">inputs</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">a0</span> <span class="o">=</span> <span class="n">subs</span><span class="o">.</span><span class="n">linear</span><span class="o">.</span><span class="n">FProp</span><span class="p">(</span><span class="n">theta</span><span class="o">.</span><span class="n">linear</span><span class="p">,</span> <span class="n">inputs</span><span class="p">)</span>
<span class="n">a1</span> <span class="o">=</span> <span class="n">subs</span><span class="o">.</span><span class="n">softmax</span><span class="o">.</span><span class="n">FProp</span><span class="p">(</span><span class="n">theta</span><span class="o">.</span><span class="n">softmax</span><span class="p">,</span> <span class="n">a0</span><span class="p">)</span>
<span class="c1"># The same layer applied twice.</span>
<span class="n">a2</span> <span class="o">=</span> <span class="n">subs</span><span class="o">.</span><span class="n">linear</span><span class="o">.</span><span class="n">FProp</span><span class="p">(</span><span class="n">theta</span><span class="o">.</span><span class="n">linear</span><span class="p">,</span> <span class="n">a1</span><span class="p">)</span>
<span class="k">return</span> <span class="n">a2</span>
</pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>theta</strong> – A <a class="reference internal" href="lingvo.core.py_utils.html#lingvo.core.py_utils.NestedMap" title="lingvo.core.py_utils.NestedMap"><code class="xref py py-obj docutils literal notranslate"><span class="pre">NestedMap</span></code></a> object containing weights’ values of this
layer and its children layers.</p></li>
<li><p><strong>*args</strong> – List args.</p></li>
<li><p><strong>**kwargs</strong> – Keyward args.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="lingvo.core.base_layer.BaseLayer.FPropMeta">
<em class="property">classmethod </em><code class="sig-name descname">FPropMeta</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">params</span></em>, <em class="sig-param"><span class="o">*</span><span class="n">args</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/base_layer.html#BaseLayer.FPropMeta"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.base_layer.BaseLayer.FPropMeta" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns metadata about the <a class="reference internal" href="#lingvo.core.base_layer.BaseLayer.FProp" title="lingvo.core.base_layer.BaseLayer.FProp"><code class="xref py py-obj docutils literal notranslate"><span class="pre">FProp</span></code></a> computation for this layer.</p>
<p><strong>Experimental feature.</strong>
Don’t use or depend on it without consulting Lingvo authors.</p>
<p>E.g.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">p</span> <span class="o">=</span> <span class="n">SomeComplexLayer</span><span class="o">.</span><span class="n">Params</span><span class="p">()</span>
<span class="n">meta</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">cls</span><span class="o">.</span><span class="n">FPropMeta</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">tshape</span><span class="o">.</span><span class="n">Shape</span><span class="p">([</span><span class="mi">128</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="s1">&#39;channels&#39;</span><span class="p">]))</span>
</pre></div>
</div>
<p><code class="xref py py-obj docutils literal notranslate"><span class="pre">meta.flops</span></code> gives an estimate count of floating point operations done by
one <a class="reference internal" href="#lingvo.core.base_layer.BaseLayer.FProp" title="lingvo.core.base_layer.BaseLayer.FProp"><code class="xref py py-obj docutils literal notranslate"><span class="pre">FProp</span></code></a> given an input tensor of shape [128, 20, 50, channels].
<code class="xref py py-obj docutils literal notranslate"><span class="pre">meta.out_shapes</span></code> is a tuple of TShape, which tells you what shape
of tensors this layer will return.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>params</strong> – The param of a layer of this layer type.</p></li>
<li><p><strong>*args</strong> – Corresponds to FProp with Tensors replaced by <code class="xref py py-obj docutils literal notranslate"><span class="pre">TensorShape</span></code>.</p></li>
<li><p><strong>**kwargs</strong> – Corresponds to FProp with Tensors replaced by <code class="xref py py-obj docutils literal notranslate"><span class="pre">TensorShape</span></code>.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><p>A <a class="reference internal" href="lingvo.core.py_utils.html#lingvo.core.py_utils.NestedMap" title="lingvo.core.py_utils.NestedMap"><code class="xref py py-obj docutils literal notranslate"><span class="pre">NestedMap</span></code></a> with</p>
<ul class="simple">
<li><p>flops - The estimated number of floating point operations incurred by
this fprop.</p></li>
<li><p>out_shapes - A tuple of <code class="xref py py-obj docutils literal notranslate"><span class="pre">TShape</span></code>. I.e., <code class="xref py py-obj docutils literal notranslate"><span class="pre">out_shapes[i]</span></code>
represents the shape of the <code class="xref py py-obj docutils literal notranslate"><span class="pre">i</span></code>-th returned tensor of the fprop.</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="lingvo.core.base_layer.BaseLayer.params">
<em class="property">property </em><code class="sig-name descname">params</code><a class="headerlink" href="#lingvo.core.base_layer.BaseLayer.params" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the params upon which this layer is built.</p>
</dd></dl>

<dl class="py method">
<dt id="lingvo.core.base_layer.BaseLayer.cluster">
<em class="property">property </em><code class="sig-name descname">cluster</code><a class="headerlink" href="#lingvo.core.base_layer.BaseLayer.cluster" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the current cluster configuration.</p>
</dd></dl>

<dl class="py method">
<dt id="lingvo.core.base_layer.BaseLayer.do_eval">
<em class="property">property </em><code class="sig-name descname">do_eval</code><a class="headerlink" href="#lingvo.core.base_layer.BaseLayer.do_eval" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt id="lingvo.core.base_layer.BaseLayer.parent">
<em class="property">property </em><code class="sig-name descname">parent</code><a class="headerlink" href="#lingvo.core.base_layer.BaseLayer.parent" title="Permalink to this definition">¶</a></dt>
<dd><p>None if self is the root layer, otherwise the parent layer of self.</p>
</dd></dl>

<dl class="py method">
<dt id="lingvo.core.base_layer.BaseLayer.path">
<em class="property">property </em><code class="sig-name descname">path</code><a class="headerlink" href="#lingvo.core.base_layer.BaseLayer.path" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a ‘.’-separated string with all layer names from the root.</p>
</dd></dl>

<dl class="py method">
<dt id="lingvo.core.base_layer.BaseLayer.layer_type">
<em class="property">property </em><code class="sig-name descname">layer_type</code><a class="headerlink" href="#lingvo.core.base_layer.BaseLayer.layer_type" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns layer type prefixed with ‘lingvo.’.</p>
</dd></dl>

<dl class="py method">
<dt id="lingvo.core.base_layer.BaseLayer.children">
<em class="property">property </em><code class="sig-name descname">children</code><a class="headerlink" href="#lingvo.core.base_layer.BaseLayer.children" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns children layers of this layer in a <a class="reference internal" href="lingvo.core.py_utils.html#lingvo.core.py_utils.NestedMap" title="lingvo.core.py_utils.NestedMap"><code class="xref py py-obj docutils literal notranslate"><span class="pre">NestedMap</span></code></a>.</p>
</dd></dl>

<dl class="py method">
<dt id="lingvo.core.base_layer.BaseLayer.GetDescendant">
<code class="sig-name descname">GetDescendant</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">path</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/base_layer.html#BaseLayer.GetDescendant"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.base_layer.BaseLayer.GetDescendant" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a descendant layer given the path.</p>
<p>NOTE(yonghui): This GetDescendant is not complete. It is not able to descent
into list/tuple substructures.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>path</strong> – a comma separated string denoting a descendant of this layer.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>The descendant layer.</p>
</dd>
<dt class="field-odd">Raises</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3.7/library/exceptions.html#KeyError" title="(in Python v3.7)"><strong>KeyError</strong></a> – if the descendant is not found.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="lingvo.core.base_layer.BaseLayer.vars">
<em class="property">property </em><code class="sig-name descname">vars</code><a class="headerlink" href="#lingvo.core.base_layer.BaseLayer.vars" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns variables of this layer and its children in a <a class="reference internal" href="lingvo.core.py_utils.html#lingvo.core.py_utils.NestedMap" title="lingvo.core.py_utils.NestedMap"><code class="xref py py-obj docutils literal notranslate"><span class="pre">NestedMap</span></code></a>.</p>
</dd></dl>

<dl class="py method">
<dt id="lingvo.core.base_layer.BaseLayer.theta">
<em class="property">property </em><code class="sig-name descname">theta</code><a class="headerlink" href="#lingvo.core.base_layer.BaseLayer.theta" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns theta of this layer and its children in a <a class="reference internal" href="lingvo.core.py_utils.html#lingvo.core.py_utils.NestedMap" title="lingvo.core.py_utils.NestedMap"><code class="xref py py-obj docutils literal notranslate"><span class="pre">NestedMap</span></code></a>.</p>
</dd></dl>

<dl class="py method">
<dt id="lingvo.core.base_layer.BaseLayer.accumulators">
<em class="property">property </em><code class="sig-name descname">accumulators</code><a class="headerlink" href="#lingvo.core.base_layer.BaseLayer.accumulators" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns <a class="reference internal" href="lingvo.core.py_utils.html#lingvo.core.py_utils.NestedMap" title="lingvo.core.py_utils.NestedMap"><code class="xref py py-obj docutils literal notranslate"><span class="pre">NestedMap</span></code></a> of <a class="reference internal" href="#lingvo.core.base_layer.Accumulator" title="lingvo.core.base_layer.Accumulator"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Accumulator</span></code></a> instances for this and children.</p>
</dd></dl>

<dl class="py method">
<dt id="lingvo.core.base_layer.BaseLayer.fns">
<em class="property">property </em><code class="sig-name descname">fns</code><a class="headerlink" href="#lingvo.core.base_layer.BaseLayer.fns" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a read-only view of layer local functions.</p>
<p>Functions can be accessed by index ([‘name’]) or attribute notation
(<code class="xref py py-obj docutils literal notranslate"><span class="pre">fns.foo</span></code>).</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>Read-only attribute accessible dict view of the layer’s function library.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="lingvo.core.base_layer.BaseLayer.AddFunction">
<code class="sig-name descname">AddFunction</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">name</span></em>, <em class="sig-param"><span class="n">f</span></em>, <em class="sig-param"><span class="n">replace</span><span class="o">=</span><span class="default_value">False</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/base_layer.html#BaseLayer.AddFunction"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.base_layer.BaseLayer.AddFunction" title="Permalink to this definition">¶</a></dt>
<dd><p>Adds a function to the layer’s <a class="reference internal" href="#lingvo.core.base_layer.BaseLayer.fns" title="lingvo.core.base_layer.BaseLayer.fns"><code class="xref py py-obj docutils literal notranslate"><span class="pre">fns</span></code></a> collection.</p>
<p>This should be used to add op-like functions specific to the operation
of the layer and its children. Such functions should be added in <code class="xref py py-obj docutils literal notranslate"><span class="pre">__init__</span></code>
and may either be raw python functions or TensorFlow Defuns. This
facility is just a mechanism for organizing them and having basic checks
on name collisions.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>name</strong> – The function name. It will be accessible as <code class="xref py py-obj docutils literal notranslate"><span class="pre">self.fns.{name}</span></code>.</p></li>
<li><p><strong>f</strong> – The function body.</p></li>
<li><p><strong>replace</strong> – Whether to replace an existing function (default False).</p></li>
</ul>
</dd>
<dt class="field-even">Raises</dt>
<dd class="field-even"><p><a class="reference external" href="https://docs.python.org/3.7/library/exceptions.html#AttributeError" title="(in Python v3.7)"><strong>AttributeError</strong></a> – If the function already exists and replace == False.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="lingvo.core.base_layer.BaseLayer._CheckName">
<code class="sig-name descname">_CheckName</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">name</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/base_layer.html#BaseLayer._CheckName"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.base_layer.BaseLayer._CheckName" title="Permalink to this definition">¶</a></dt>
<dd><p>Asserts name’s validity.</p>
</dd></dl>

<dl class="py method">
<dt id="lingvo.core.base_layer.BaseLayer._VariableCollections">
<code class="sig-name descname">_VariableCollections</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/base_layer.html#BaseLayer._VariableCollections"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.base_layer.BaseLayer._VariableCollections" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt id="lingvo.core.base_layer.BaseLayer.RegisterAccumulator">
<code class="sig-name descname">RegisterAccumulator</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">name</span></em>, <em class="sig-param"><span class="n">acc</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/base_layer.html#BaseLayer.RegisterAccumulator"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.base_layer.BaseLayer.RegisterAccumulator" title="Permalink to this definition">¶</a></dt>
<dd><p>Registers an accumulator for this layer.</p>
<p>An accumulator is used to propagate some state to a future point,
where it is acted on (typically as part of <a class="reference internal" href="#lingvo.core.base_layer.BaseLayer.PostTrainingStepUpdate" title="lingvo.core.base_layer.BaseLayer.PostTrainingStepUpdate"><code class="xref py py-obj docutils literal notranslate"><span class="pre">PostTrainingStepUpdate</span></code></a>). This
mechanism allows for arbitrarily nested parts of a model to export state
back to the global scope. Accumulators must be specially handled
when crossing into <code class="xref py py-obj docutils literal notranslate"><span class="pre">Defun</span></code> or recurrent scopes. By abstracting the
mechanism, it allows all such state to be handled uniformly and generically.</p>
<p>Example (typically from <code class="xref py py-obj docutils literal notranslate"><span class="pre">__init__</span></code>):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MyAccumulator</span><span class="p">(</span><span class="n">base_layer</span><span class="o">.</span><span class="n">Accumulator</span><span class="p">):</span>
  <span class="k">def</span> <span class="nf">DefaultValue</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="c1"># [count, min, max]</span>
    <span class="k">return</span> <span class="n">tf</span><span class="o">.</span><span class="n">convert_to_tensor</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">])</span>
  <span class="k">def</span> <span class="nf">Update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state1</span><span class="p">):</span>
    <span class="n">state0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetValue</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">SetValue</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">stack</span><span class="p">([</span>
        <span class="n">state0</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">state1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
        <span class="n">tf</span><span class="o">.</span><span class="n">minimum</span><span class="p">(</span><span class="n">state0</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">state1</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
        <span class="n">tf</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">state0</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">state1</span><span class="p">[</span><span class="mi">2</span><span class="p">])]))</span>

<span class="bp">self</span><span class="o">.</span><span class="n">RegisterAccumulator</span><span class="p">(</span><span class="s1">&#39;mytracker&#39;</span><span class="p">,</span> <span class="n">acc</span><span class="p">)</span>
</pre></div>
</div>
<p>Later, access the current value and update it:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">acc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">accumulators</span><span class="o">.</span><span class="n">mytracker</span>
<span class="n">acc</span><span class="o">.</span><span class="n">Update</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">convert_to_tensor</span><span class="p">([</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">batch_min</span><span class="p">,</span> <span class="n">batch_max</span><span class="p">]))</span>
</pre></div>
</div>
<p>Then, typically in <a class="reference internal" href="#lingvo.core.base_layer.BaseLayer.PostTrainingStepUpdate" title="lingvo.core.base_layer.BaseLayer.PostTrainingStepUpdate"><code class="xref py py-obj docutils literal notranslate"><span class="pre">PostTrainingStepUpdate</span></code></a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">acc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">accumulator</span><span class="o">.</span><span class="n">mytracker</span>
<span class="n">acc_value</span> <span class="o">=</span> <span class="n">acc</span><span class="o">.</span><span class="n">GetValue</span><span class="p">()</span>
<span class="c1"># Do something with the value.</span>
<span class="n">acc</span><span class="o">.</span><span class="n">Reset</span><span class="p">()</span>
</pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>name</strong> – The accumulator name. Shares a namespace with children, vars and
extra theta.</p></li>
<li><p><strong>acc</strong> – An <a class="reference internal" href="#lingvo.core.base_layer.Accumulator" title="lingvo.core.base_layer.Accumulator"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Accumulator</span></code></a> instance.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="lingvo.core.base_layer.BaseLayer.GetAccumulatorValues">
<code class="sig-name descname">GetAccumulatorValues</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/base_layer.html#BaseLayer.GetAccumulatorValues"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.base_layer.BaseLayer.GetAccumulatorValues" title="Permalink to this definition">¶</a></dt>
<dd><p>Recursively gets values of all accumulators.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p><a class="reference internal" href="lingvo.core.py_utils.html#lingvo.core.py_utils.NestedMap" title="lingvo.core.py_utils.NestedMap"><code class="xref py py-obj docutils literal notranslate"><span class="pre">NestedMap</span></code></a> of Tensors for each registered accumulator.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="lingvo.core.base_layer.BaseLayer.SetAccumulatorValues">
<code class="sig-name descname">SetAccumulatorValues</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">new_values_nmap</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/base_layer.html#BaseLayer.SetAccumulatorValues"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.base_layer.BaseLayer.SetAccumulatorValues" title="Permalink to this definition">¶</a></dt>
<dd><p>Recursively sets the values of all accumulators from a map.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>new_values_nmap</strong> – <a class="reference internal" href="lingvo.core.py_utils.html#lingvo.core.py_utils.NestedMap" title="lingvo.core.py_utils.NestedMap"><code class="xref py py-obj docutils literal notranslate"><span class="pre">NestedMap</span></code></a> of accumulator name:Tensor.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="lingvo.core.base_layer.BaseLayer.GetVariableSymbolicShape">
<code class="sig-name descname">GetVariableSymbolicShape</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">var_name</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/base_layer.html#BaseLayer.GetVariableSymbolicShape"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.base_layer.BaseLayer.GetVariableSymbolicShape" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the variable’s symbolic shape.</p>
</dd></dl>

<dl class="py method">
<dt id="lingvo.core.base_layer.BaseLayer.CreateVariable">
<code class="sig-name descname">CreateVariable</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">name</span></em>, <em class="sig-param"><span class="n">var_params</span></em>, <em class="sig-param"><span class="n">theta_fn</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/base_layer.html#BaseLayer.CreateVariable"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.base_layer.BaseLayer.CreateVariable" title="Permalink to this definition">¶</a></dt>
<dd><p>Create a variable of this layer according to the parameter <code class="xref py py-obj docutils literal notranslate"><span class="pre">var_params</span></code>.</p>
<p>E.g.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">...</span><span class="p">):</span>    <span class="c1"># A layer&#39;s constructor</span>
  <span class="bp">self</span><span class="o">.</span><span class="n">CreateVariable</span><span class="p">(</span>
      <span class="s1">&#39;weight&#39;</span><span class="p">,</span> <span class="n">py_utils</span><span class="o">.</span><span class="n">WeightParams</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">[</span><span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">]))</span>
</pre></div>
</div>
<p><code class="xref py py-obj docutils literal notranslate"><span class="pre">theta_fn</span></code> is used to apply a simple transformation on the created
variable’s value before used by the forward computation. E.g., to
add the global variational noise according to this layer’s
parameter, one can do:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">...</span><span class="p">):</span>    <span class="c1"># A layer&#39;s constructor</span>
  <span class="bp">self</span><span class="o">.</span><span class="n">CreateVariable</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s1">&#39;weight&#39;</span><span class="p">,</span>
    <span class="n">var_params</span><span class="o">=</span><span class="n">py_utils</span><span class="o">.</span><span class="n">WeightParams</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">[</span><span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">]),</span>
    <span class="n">theta_fn</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">AddVN</span><span class="p">)</span>
</pre></div>
</div>
<p>In some contexts, eg. TPU training, variables may not be created immediately
but rather the creation request will be cached and created later via a call
to layer.InstantiateVariables().</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>name</strong> – Variable name which is used as the key into vars/theta.</p></li>
<li><p><strong>var_params</strong> – <a class="reference internal" href="#lingvo.core.base_layer.BaseLayer.Params" title="lingvo.core.base_layer.BaseLayer.Params"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Params</span></code></a> used to create the variable.</p></li>
<li><p><strong>theta_fn</strong> – A python function that takes a variable’s value and returns a
new value to be used later for computation. Its signature must be
(tf.Tensor) -&gt; (tf.Tensor).</p></li>
<li><p><strong>**kwargs</strong> – Keyword args passed to <a class="reference internal" href="lingvo.core.py_utils.html#lingvo.core.py_utils.CreateVariable" title="lingvo.core.py_utils.CreateVariable"><code class="xref py py-obj docutils literal notranslate"><span class="pre">py_utils.CreateVariable</span></code></a>.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="lingvo.core.base_layer.BaseLayer._CreateVariableInternal">
<code class="sig-name descname">_CreateVariableInternal</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">name</span></em>, <em class="sig-param"><span class="n">meta</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/base_layer.html#BaseLayer._CreateVariableInternal"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.base_layer.BaseLayer._CreateVariableInternal" title="Permalink to this definition">¶</a></dt>
<dd><p>Immediately creates the variable described by <code class="xref py py-obj docutils literal notranslate"><span class="pre">meta</span></code>.</p>
<p>DO NOT OVERRIDE. For internal use only. Subclasses of BaseLayer should use
self.CreateVariable() to create variables.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>name</strong> – The variable name.</p></li>
<li><p><strong>meta</strong> – A CreateVariableMeta describing the variable to be created.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="lingvo.core.base_layer.BaseLayer._SelfVariableScope">
<code class="sig-name descname">_SelfVariableScope</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/base_layer.html#BaseLayer._SelfVariableScope"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.base_layer.BaseLayer._SelfVariableScope" title="Permalink to this definition">¶</a></dt>
<dd><p>Internal. Used to ensure the same variable &amp; name scopes are used.</p>
</dd></dl>

<dl class="py method">
<dt id="lingvo.core.base_layer.BaseLayer.InstantiateVariables">
<code class="sig-name descname">InstantiateVariables</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/base_layer.html#BaseLayer.InstantiateVariables"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.base_layer.BaseLayer.InstantiateVariables" title="Permalink to this definition">¶</a></dt>
<dd><p>Create variables for this layer and child layers.</p>
<p>DO NOT OVERRIDE. Override self._CreateLayerVariables instead.</p>
</dd></dl>

<dl class="py method">
<dt id="lingvo.core.base_layer.BaseLayer._CreateChildrenVariables">
<code class="sig-name descname">_CreateChildrenVariables</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/base_layer.html#BaseLayer._CreateChildrenVariables"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.base_layer.BaseLayer._CreateChildrenVariables" title="Permalink to this definition">¶</a></dt>
<dd><p>Create variables for child layers.</p>
<p>Should be rarely overridden, only in cases when control over the context of
children InstantiateVariables calls are needed. eg, if children variables
need to be created inside of a specific context manager.</p>
<p>There are a few cases of this in the codebase marked as for backwards
compability. This is only to ensure that variable scopes remain compatible
through the code migration. New layers should not copy that pattern, and
instead follow the standard pattern of self.CreateChild() in __init__() and
self.CreateVariable() in _CreateLayerVariables(). If you are okay with
breaking old checkpoints, you can go ahead and delete those functions.</p>
</dd></dl>

<dl class="py method">
<dt id="lingvo.core.base_layer.BaseLayer._CreateLayerVariables">
<code class="sig-name descname">_CreateLayerVariables</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/base_layer.html#BaseLayer._CreateLayerVariables"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.base_layer.BaseLayer._CreateLayerVariables" title="Permalink to this definition">¶</a></dt>
<dd><p>Actually create variables for this layer.</p>
<p>Subclasses should override this function.</p>
<p>Variables are created inside of tf.variable_scope(self.params.name).</p>
</dd></dl>

<dl class="py method">
<dt id="lingvo.core.base_layer.BaseLayer.AddExtraTheta">
<code class="sig-name descname">AddExtraTheta</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">theta_name</span></em>, <em class="sig-param"><span class="n">theta_value</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/base_layer.html#BaseLayer.AddExtraTheta"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.base_layer.BaseLayer.AddExtraTheta" title="Permalink to this definition">¶</a></dt>
<dd><p>Add extra <a class="reference internal" href="#lingvo.core.base_layer.BaseLayer.theta" title="lingvo.core.base_layer.BaseLayer.theta"><code class="xref py py-obj docutils literal notranslate"><span class="pre">theta</span></code></a> that doesn’t directly correspond to <a class="reference internal" href="#lingvo.core.base_layer.BaseLayer.vars" title="lingvo.core.base_layer.BaseLayer.vars"><code class="xref py py-obj docutils literal notranslate"><span class="pre">vars</span></code></a>.</p>
</dd></dl>

<dl class="py method">
<dt id="lingvo.core.base_layer.BaseLayer.AddVN">
<code class="sig-name descname">AddVN</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">value</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/base_layer.html#BaseLayer.AddVN"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.base_layer.BaseLayer.AddVN" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt id="lingvo.core.base_layer.BaseLayer.CreateChild">
<code class="sig-name descname">CreateChild</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">name</span></em>, <em class="sig-param"><span class="n">params</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/base_layer.html#BaseLayer.CreateChild"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.base_layer.BaseLayer.CreateChild" title="Permalink to this definition">¶</a></dt>
<dd><p>Create a sub layer.</p>
<p>The created sub layer can be accessed by <code class="xref py py-obj docutils literal notranslate"><span class="pre">name</span></code>. E.g.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="bp">self</span><span class="o">.</span><span class="n">CreateChild</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span>
<span class="bp">self</span><span class="o">.</span><span class="n">foo</span><span class="o">.</span><span class="n">FProp</span><span class="o">...</span>
</pre></div>
</div>
<p>or:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="bp">self</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="s1">&#39;foo&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">Fprop</span><span class="o">...</span>
<span class="bp">self</span><span class="o">.</span><span class="n">children</span><span class="o">.</span><span class="n">foo</span><span class="o">.</span><span class="n">Fprop</span><span class="o">...</span>
</pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>name</strong> – Sub layer name which is used as the key into vars/theta.</p></li>
<li><p><strong>params</strong> – <code class="xref py py-obj docutils literal notranslate"><span class="pre">Hyperparams</span></code> object to instantiate a layer.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="lingvo.core.base_layer.BaseLayer.CreateChildren">
<code class="sig-name descname">CreateChildren</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">name</span></em>, <em class="sig-param"><span class="n">params</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/base_layer.html#BaseLayer.CreateChildren"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.base_layer.BaseLayer.CreateChildren" title="Permalink to this definition">¶</a></dt>
<dd><p>Create a list or dict of sub layers.</p>
<p>The created sub layer list can be accessed by <code class="xref py py-obj docutils literal notranslate"><span class="pre">name</span></code>. E.g.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="bp">self</span><span class="o">.</span><span class="n">CreateChildren</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span>
<span class="bp">self</span><span class="o">.</span><span class="n">foo</span><span class="p">[</span><span class="mi">10</span><span class="p">]</span><span class="o">.</span><span class="n">FProp</span><span class="o">...</span>
</pre></div>
</div>
<p>or:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="bp">self</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="s1">&#39;foo&#39;</span><span class="p">][</span><span class="mi">10</span><span class="p">]</span><span class="o">.</span><span class="n">Fprop</span><span class="o">...</span>
<span class="bp">self</span><span class="o">.</span><span class="n">children</span><span class="o">.</span><span class="n">foo</span><span class="p">[</span><span class="mi">10</span><span class="p">]</span><span class="o">.</span><span class="n">Fprop</span><span class="o">...</span>
</pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>name</strong> – The name for the sub layers, which is used as the key into
vars/theta.</p></li>
<li><p><strong>params</strong> – a list or dict of <code class="xref py py-obj docutils literal notranslate"><span class="pre">Hyperparams</span></code> objects to create.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="lingvo.core.base_layer.BaseLayer.AddChild">
<code class="sig-name descname">AddChild</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">name</span></em>, <em class="sig-param"><span class="n">children</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/base_layer.html#BaseLayer.AddChild"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.base_layer.BaseLayer.AddChild" title="Permalink to this definition">¶</a></dt>
<dd><p>Add existing layer or layers as sublayer.</p>
</dd></dl>

<dl class="py method">
<dt id="lingvo.core.base_layer.BaseLayer._AutoAddChild">
<code class="sig-name descname">_AutoAddChild</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">child</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/base_layer.html#BaseLayer._AutoAddChild"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.base_layer.BaseLayer._AutoAddChild" title="Permalink to this definition">¶</a></dt>
<dd><p>Record that a layer <code class="xref py py-obj docutils literal notranslate"><span class="pre">child</span></code> is instantiated by this layer.</p>
<p>This method should only be called internally by BaseLayerMeta.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>child</strong> – A sub-layer of this layer.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="lingvo.core.base_layer.BaseLayer._VerifyChildren">
<code class="sig-name descname">_VerifyChildren</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/base_layer.html#BaseLayer._VerifyChildren"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.base_layer.BaseLayer._VerifyChildren" title="Permalink to this definition">¶</a></dt>
<dd><p>Verify all children created by this layer are via <code class="xref py py-obj docutils literal notranslate"><span class="pre">CreateChild(ren)</span></code>.</p>
</dd></dl>

<dl class="py method">
<dt id="lingvo.core.base_layer.BaseLayer._VerifyVarsAndTheta">
<code class="sig-name descname">_VerifyVarsAndTheta</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/base_layer.html#BaseLayer._VerifyVarsAndTheta"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.base_layer.BaseLayer._VerifyVarsAndTheta" title="Permalink to this definition">¶</a></dt>
<dd><p>Verify that vars and theta have the same nested structure.</p>
</dd></dl>

<dl class="py method">
<dt id="lingvo.core.base_layer.BaseLayer.PostTrainingStepUpdate">
<code class="sig-name descname">PostTrainingStepUpdate</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/base_layer.html#BaseLayer.PostTrainingStepUpdate"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.base_layer.BaseLayer.PostTrainingStepUpdate" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a TF op which will be invoked at each training step.</p>
<p>Subclasses of <a class="reference internal" href="#lingvo.core.base_layer.BaseLayer" title="lingvo.core.base_layer.BaseLayer"><code class="xref py py-obj docutils literal notranslate"><span class="pre">BaseLayer</span></code></a> can implement this method. The method should
return a TF op to be invoked during training after gradients are applied.</p>
</dd></dl>

</dd></dl>

<dl class="py function">
<dt id="lingvo.core.base_layer.IsLayerParams">
<code class="sig-prename descclassname">lingvo.core.base_layer.</code><code class="sig-name descname">IsLayerParams</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">x</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/base_layer.html#IsLayerParams"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.base_layer.IsLayerParams" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="lingvo.core.base_model.html" class="btn btn-neutral float-right" title="lingvo.core.base_model module" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="lingvo.core.base_input_generator.html" class="btn btn-neutral float-left" title="lingvo.core.base_input_generator module" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2018.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>