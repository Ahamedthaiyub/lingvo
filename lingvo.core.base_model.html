

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>lingvo.core.base_model module &mdash; Lingvo  documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="lingvo.core.base_model_params module" href="lingvo.core.base_model_params.html" />
    <link rel="prev" title="lingvo.core.base_layer module" href="lingvo.core.base_layer.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> Lingvo
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="lingvo.html">lingvo package</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="lingvo.html#subpackages">Subpackages</a><ul class="current">
<li class="toctree-l3 current"><a class="reference internal" href="lingvo.core.html">lingvo.core package</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="lingvo.core.html#subpackages">Subpackages</a></li>
<li class="toctree-l4 current"><a class="reference internal" href="lingvo.core.html#submodules">Submodules</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="lingvo.tasks.html">lingvo.tasks package</a></li>
<li class="toctree-l3"><a class="reference internal" href="lingvo.tools.html">lingvo.tools package</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="lingvo.html#submodules">Submodules</a></li>
</ul>
</li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Lingvo</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="lingvo.html">lingvo package</a> &raquo;</li>
        
          <li><a href="lingvo.core.html">lingvo.core package</a> &raquo;</li>
        
      <li>lingvo.core.base_model module</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/lingvo.core.base_model.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="module-lingvo.core.base_model">
<span id="lingvo-core-base-model-module"></span><h1>lingvo.core.base_model module<a class="headerlink" href="#module-lingvo.core.base_model" title="Permalink to this headline">¶</a></h1>
<p>Base model.</p>
<dl class="py class">
<dt id="lingvo.core.base_model.DecodeFinalizeArgs">
<em class="property">class </em><code class="sig-prename descclassname">lingvo.core.base_model.</code><code class="sig-name descname">DecodeFinalizeArgs</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">decode_out_path</span></em>, <em class="sig-param"><span class="n">decode_out</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/base_model.html#DecodeFinalizeArgs"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.base_model.DecodeFinalizeArgs" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#lingvo.core.base_model.DecodeFinalizeArgs" title="lingvo.core.base_model.DecodeFinalizeArgs"><code class="xref py py-class docutils literal notranslate"><span class="pre">lingvo.core.base_model.DecodeFinalizeArgs</span></code></a></p>
<p>Arguments to BaseTask.DecodeFinalize().</p>
<dl class="py attribute">
<dt id="lingvo.core.base_model.DecodeFinalizeArgs.decode_out_path">
<code class="sig-name descname">decode_out_path</code><a class="headerlink" href="#lingvo.core.base_model.DecodeFinalizeArgs.decode_out_path" title="Permalink to this definition">¶</a></dt>
<dd><p>Path to where decoder outputs can be written.</p>
</dd></dl>

<dl class="py attribute">
<dt id="lingvo.core.base_model.DecodeFinalizeArgs.decode_out">
<code class="sig-name descname">decode_out</code><a class="headerlink" href="#lingvo.core.base_model.DecodeFinalizeArgs.decode_out" title="Permalink to this definition">¶</a></dt>
<dd><p>A list of key value pairs aggregated from return values of.
PostProcessDecodeOut().</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt id="lingvo.core.base_model.BaseTask">
<em class="property">class </em><code class="sig-prename descclassname">lingvo.core.base_model.</code><code class="sig-name descname">BaseTask</code><span class="sig-paren">(</span><em class="sig-param"><span class="o">*</span><span class="n">args</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/base_model.html#BaseTask"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.base_model.BaseTask" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="lingvo.core.base_layer.html#lingvo.core.base_layer.BaseLayer" title="lingvo.core.base_layer.BaseLayer"><code class="xref py py-class docutils literal notranslate"><span class="pre">lingvo.core.base_layer.BaseLayer</span></code></a></p>
<p>A single encoder/decoder task.</p>
<p>One task usually consists of one InputGenerator, one train_op,
a list of eval_metrics, etc.</p>
<dl class="py method">
<dt id="lingvo.core.base_model.BaseTask.Params">
<em class="property">classmethod </em><code class="sig-name descname">Params</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/base_model.html#BaseTask.Params"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.base_model.BaseTask.Params" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the layer params.</p>
</dd></dl>

<dl class="py method">
<dt id="lingvo.core.base_model.BaseTask.UpdateTargetVocabSize">
<em class="property">classmethod </em><code class="sig-name descname">UpdateTargetVocabSize</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">p</span></em>, <em class="sig-param"><span class="n">vocab_size</span></em>, <em class="sig-param"><span class="n">wpm_model</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/base_model.html#BaseTask.UpdateTargetVocabSize"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.base_model.BaseTask.UpdateTargetVocabSize" title="Permalink to this definition">¶</a></dt>
<dd><p>Updates params with the vocab size and wpm model.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>p</strong> – model params.</p></li>
<li><p><strong>vocab_size</strong> – size of the vocabulary.</p></li>
<li><p><strong>wpm_model</strong> – file name prefix pointing to a wordpiece model.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>Model params updated with the vocab size and wpm model.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="lingvo.core.base_model.BaseTask.InstantiateVariables">
<code class="sig-name descname">InstantiateVariables</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/base_model.html#BaseTask.InstantiateVariables"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.base_model.BaseTask.InstantiateVariables" title="Permalink to this definition">¶</a></dt>
<dd><p>Create variables for this layer and child layers.</p>
<p>DO NOT OVERRIDE. Override self._CreateLayerVariables instead.</p>
</dd></dl>

<dl class="py method">
<dt id="lingvo.core.base_model.BaseTask._SetLearnerFromLegacyParams">
<code class="sig-name descname">_SetLearnerFromLegacyParams</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">tp</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/base_model.html#BaseTask._SetLearnerFromLegacyParams"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.base_model.BaseTask._SetLearnerFromLegacyParams" title="Permalink to this definition">¶</a></dt>
<dd><p>Sets tp.learner based on legacy params.</p>
</dd></dl>

<dl class="py method">
<dt id="lingvo.core.base_model.BaseTask.ComputePredictions">
<code class="sig-name descname">ComputePredictions</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">theta</span></em>, <em class="sig-param"><span class="n">input_batch</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/base_model.html#BaseTask.ComputePredictions"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.base_model.BaseTask.ComputePredictions" title="Permalink to this definition">¶</a></dt>
<dd><p>Computes predictions for <code class="xref py py-obj docutils literal notranslate"><span class="pre">input_batch</span></code>.</p>
<p>The output can be in the form of probablistic distributions, e.g., softmax
logits for discrete outputs, mixture of logistics for continuous values, or
regression values.</p>
<p>For training/evaluation, the output will be used for computing loss and
gradient updates, including comparing predicted distributions between
teacher and student for distillation. During inference the output can be
used to compute final outputs, perhaps with sampling.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>theta</strong> – A <a class="reference internal" href="lingvo.core.nested_map.html#lingvo.core.nested_map.NestedMap" title="lingvo.core.nested_map.NestedMap"><code class="xref py py-obj docutils literal notranslate"><span class="pre">NestedMap</span></code></a> object containing variable values of this task.</p></li>
<li><p><strong>input_batch</strong> – A <a class="reference internal" href="lingvo.core.nested_map.html#lingvo.core.nested_map.NestedMap" title="lingvo.core.nested_map.NestedMap"><code class="xref py py-obj docutils literal notranslate"><span class="pre">NestedMap</span></code></a> object containing input tensors to this tower.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>Predictions, either a single Tensor, a <a class="reference internal" href="lingvo.core.nested_map.html#lingvo.core.nested_map.NestedMap" title="lingvo.core.nested_map.NestedMap"><code class="xref py py-obj docutils literal notranslate"><span class="pre">NestedMap</span></code></a>, or a namedtuple.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="lingvo.core.base_model.BaseTask.ComputeLoss">
<code class="sig-name descname">ComputeLoss</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">theta</span></em>, <em class="sig-param"><span class="n">predictions</span></em>, <em class="sig-param"><span class="n">input_batch</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/base_model.html#BaseTask.ComputeLoss"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.base_model.BaseTask.ComputeLoss" title="Permalink to this definition">¶</a></dt>
<dd><p>Computes loss and other metrics for the given predictions.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>theta</strong> – A <a class="reference internal" href="lingvo.core.nested_map.html#lingvo.core.nested_map.NestedMap" title="lingvo.core.nested_map.NestedMap"><code class="xref py py-obj docutils literal notranslate"><span class="pre">NestedMap</span></code></a> object containing variable values of this task.</p></li>
<li><p><strong>predictions</strong> – The output of <a class="reference internal" href="#lingvo.core.base_model.BaseTask.ComputePredictions" title="lingvo.core.base_model.BaseTask.ComputePredictions"><code class="xref py py-obj docutils literal notranslate"><span class="pre">ComputePredictions</span></code></a>.</p></li>
<li><p><strong>input_batch</strong> – A <a class="reference internal" href="lingvo.core.nested_map.html#lingvo.core.nested_map.NestedMap" title="lingvo.core.nested_map.NestedMap"><code class="xref py py-obj docutils literal notranslate"><span class="pre">NestedMap</span></code></a> object containing input tensors to this tower.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><ul class="simple">
<li><p>A dict containing str keys and (metric, weight) pairs as values, where
one of the keys is expected to be ‘loss’.</p></li>
<li><p>A dict containing arbitrary tensors describing something about each
training example, where the first dimension of each tensor is the batch
index.</p></li>
</ul>
</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>(<a class="reference external" href="https://docs.python.org/3.7/library/stdtypes.html#dict" title="(in Python v3.7)">dict</a>, <a class="reference external" href="https://docs.python.org/3.7/library/stdtypes.html#dict" title="(in Python v3.7)">dict</a>)</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="lingvo.core.base_model.BaseTask.FilterPerExampleTensors">
<code class="sig-name descname">FilterPerExampleTensors</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">per_example</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/base_model.html#BaseTask.FilterPerExampleTensors"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.base_model.BaseTask.FilterPerExampleTensors" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the per-example tensors ProcessFPropResults needs.</p>
<p>By default we don’t send any per-example tensors to ProcessFPropResults
because some may be expensive to compute. Implement this method to let
some of them pass through.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>per_example</strong> – A dict of tensors returned as per-example tensors from FProp.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A dict containing a subset of the key/value pairs in per_example.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="lingvo.core.base_model.BaseTask.ProcessFPropResults">
<code class="sig-name descname">ProcessFPropResults</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">sess</span></em>, <em class="sig-param"><span class="n">global_step</span></em>, <em class="sig-param"><span class="n">metrics</span></em>, <em class="sig-param"><span class="n">per_example</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/base_model.html#BaseTask.ProcessFPropResults"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.base_model.BaseTask.ProcessFPropResults" title="Permalink to this definition">¶</a></dt>
<dd><p>Called once for each train loop.</p>
<p>BaseModel.ProcessFPropResults is also called on each loop, so you
can put your implementation wherever it is most convenient for you.</p>
<p>Be sure to implement BaseTask.FilterPerExampleTensors if you plan to use any
per-example tensors in this method.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>sess</strong> – a session.</p></li>
<li><p><strong>global_step</strong> – task global step. Since ProcessFPropResults is called after
sess.run(train_op), this value will be p.train.tpu_steps_per_loop higher
than the value in FProp.</p></li>
<li><p><strong>metrics</strong> – the metrics dict returned by FPropTower.</p></li>
<li><p><strong>per_example</strong> – the per_example dict returned by FPropTower.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="lingvo.core.base_model.BaseTask.FPropTower">
<code class="sig-name descname">FPropTower</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">theta</span></em>, <em class="sig-param"><span class="n">input_batch</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/base_model.html#BaseTask.FPropTower"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.base_model.BaseTask.FPropTower" title="Permalink to this definition">¶</a></dt>
<dd><p>Forward propagation through one tower of the model.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>theta</strong> – A <a class="reference internal" href="lingvo.core.nested_map.html#lingvo.core.nested_map.NestedMap" title="lingvo.core.nested_map.NestedMap"><code class="xref py py-obj docutils literal notranslate"><span class="pre">NestedMap</span></code></a> object containing variable values of this task
copied to this tower’s devices.</p></li>
<li><p><strong>input_batch</strong> – A <a class="reference internal" href="lingvo.core.nested_map.html#lingvo.core.nested_map.NestedMap" title="lingvo.core.nested_map.NestedMap"><code class="xref py py-obj docutils literal notranslate"><span class="pre">NestedMap</span></code></a> object containing input tensors to this tower.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><ul class="simple">
<li><p>A dict containing str keys and (metric, weight) pairs as values, where
one of the keys is expected to be ‘loss’.</p></li>
<li><p>A dict containing arbitrary tensors describing something about each
training example, where the first dimension of each tensor is the batch
index.</p></li>
</ul>
</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>(<a class="reference external" href="https://docs.python.org/3.7/library/stdtypes.html#dict" title="(in Python v3.7)">dict</a>, <a class="reference external" href="https://docs.python.org/3.7/library/stdtypes.html#dict" title="(in Python v3.7)">dict</a>)</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="lingvo.core.base_model.BaseTask.FProp">
<code class="sig-name descname">FProp</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">theta</span></em>, <em class="sig-param"><span class="n">input_batch</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/base_model.html#BaseTask.FProp"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.base_model.BaseTask.FProp" title="Permalink to this definition">¶</a></dt>
<dd><p>Forward propagation.</p>
<p>This default <a class="reference internal" href="#lingvo.core.base_model.BaseTask.FProp" title="lingvo.core.base_model.BaseTask.FProp"><code class="xref py py-obj docutils literal notranslate"><span class="pre">FProp</span></code></a> implementation here supports batch splitting in
synchronous and asynchronous training when sub-classes implement
<a class="reference internal" href="#lingvo.core.base_model.BaseTask.FPropTower" title="lingvo.core.base_model.BaseTask.FPropTower"><code class="xref py py-obj docutils literal notranslate"><span class="pre">FPropTower</span></code></a>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>theta</strong> – A <a class="reference internal" href="lingvo.core.nested_map.html#lingvo.core.nested_map.NestedMap" title="lingvo.core.nested_map.NestedMap"><code class="xref py py-obj docutils literal notranslate"><span class="pre">NestedMap</span></code></a> object containing weights’ values of this layer and
its children layers.</p></li>
<li><p><strong>input_batch</strong> – The input batch. A <code class="xref py py-obj docutils literal notranslate"><span class="pre">NestedMap</span></code> of tensors. Or, if input batch
spiltting is used, a list of <code class="xref py py-obj docutils literal notranslate"><span class="pre">NestedMap</span></code>, one for each split.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><ul class="simple">
<li><p>A dict containing str keys and (metric, weight) pairs as values, where
one of the keys is expected to be ‘loss’.</p></li>
<li><p>A dict containing arbitrary tensors describing something about each
training example, where the first dimension of each tensor is the batch
index.</p></li>
</ul>
</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>(<a class="reference external" href="https://docs.python.org/3.7/library/stdtypes.html#dict" title="(in Python v3.7)">dict</a>, <a class="reference external" href="https://docs.python.org/3.7/library/stdtypes.html#dict" title="(in Python v3.7)">dict</a>)</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="lingvo.core.base_model.BaseTask._FPropTpu">
<code class="sig-name descname">_FPropTpu</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">theta</span></em>, <em class="sig-param"><span class="n">input_batch</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/base_model.html#BaseTask._FPropTpu"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.base_model.BaseTask._FPropTpu" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt id="lingvo.core.base_model.BaseTask._FPropSplitInputBatch">
<code class="sig-name descname">_FPropSplitInputBatch</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">theta</span></em>, <em class="sig-param"><span class="n">input_batch</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/base_model.html#BaseTask._FPropSplitInputBatch"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.base_model.BaseTask._FPropSplitInputBatch" title="Permalink to this definition">¶</a></dt>
<dd><p>Splits the input batch on the input device.</p>
</dd></dl>

<dl class="py method">
<dt id="lingvo.core.base_model.BaseTask._FPropResult">
<code class="sig-name descname">_FPropResult</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">metrics</span></em>, <em class="sig-param"><span class="n">per_example</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/base_model.html#BaseTask._FPropResult"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.base_model.BaseTask._FPropResult" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt id="lingvo.core.base_model.BaseTask.GetInputBatch">
<code class="sig-name descname">GetInputBatch</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/base_model.html#BaseTask.GetInputBatch"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.base_model.BaseTask.GetInputBatch" title="Permalink to this definition">¶</a></dt>
<dd><p>Gets an input batch.</p>
</dd></dl>

<dl class="py method">
<dt id="lingvo.core.base_model.BaseTask.FPropDefaultTheta">
<code class="sig-name descname">FPropDefaultTheta</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">input_batch</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/base_model.html#BaseTask.FPropDefaultTheta"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.base_model.BaseTask.FPropDefaultTheta" title="Permalink to this definition">¶</a></dt>
<dd><p>Calls <a class="reference internal" href="#lingvo.core.base_model.BaseTask.FProp" title="lingvo.core.base_model.BaseTask.FProp"><code class="xref py py-obj docutils literal notranslate"><span class="pre">FProp</span></code></a> with this layer’s parameters.</p>
</dd></dl>

<dl class="py method">
<dt id="lingvo.core.base_model.BaseTask.AdjustGradients">
<code class="sig-name descname">AdjustGradients</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">vars_gradients</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/base_model.html#BaseTask.AdjustGradients"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.base_model.BaseTask.AdjustGradients" title="Permalink to this definition">¶</a></dt>
<dd><p>Allow for custom gradient manipulation prior to clipping.</p>
</dd></dl>

<dl class="py method">
<dt id="lingvo.core.base_model.BaseTask.PostTrainingLoop">
<code class="sig-name descname">PostTrainingLoop</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">outfeed</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/base_model.html#BaseTask.PostTrainingLoop"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.base_model.BaseTask.PostTrainingLoop" title="Permalink to this definition">¶</a></dt>
<dd><p>Construct the post training loop op.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>outfeed</strong> – a dict of tensors dequeued from TPU outfeed queue.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="lingvo.core.base_model.BaseTask.BProp">
<code class="sig-name descname">BProp</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/base_model.html#BaseTask.BProp"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.base_model.BaseTask.BProp" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt id="lingvo.core.base_model.BaseTask._BPropGenTrainOps">
<code class="sig-name descname">_BPropGenTrainOps</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">vmap</span></em>, <em class="sig-param"><span class="n">metrics</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">add_summary</span><span class="o">=</span><span class="default_value">True</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/base_model.html#BaseTask._BPropGenTrainOps"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.base_model.BaseTask._BPropGenTrainOps" title="Permalink to this definition">¶</a></dt>
<dd><p>Populates the train_ops dictionary in a backwards pass.</p>
</dd></dl>

<dl class="py method">
<dt id="lingvo.core.base_model.BaseTask._BPropForVariables">
<code class="sig-name descname">_BPropForVariables</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">vmap</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/base_model.html#BaseTask._BPropForVariables"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.base_model.BaseTask._BPropForVariables" title="Permalink to this definition">¶</a></dt>
<dd><p>Constructs the backward graph.</p>
</dd></dl>

<dl class="py method">
<dt id="lingvo.core.base_model.BaseTask._ComputeGradientMask">
<code class="sig-name descname">_ComputeGradientMask</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">bprop_variable_filters</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/base_model.html#BaseTask._ComputeGradientMask"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.base_model.BaseTask._ComputeGradientMask" title="Permalink to this definition">¶</a></dt>
<dd><p>Compute gradient mask for each variable and bprop_variable_filters.</p>
<p>Note that per_input_gradient_mask[var][i] will be 1 if var matches
bprop_variable_filter[i], 0 otherwise.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>bprop_variable_filters</strong> – A list of regex bprop_variable_filters for each
file pattern.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="lingvo.core.base_model.BaseTask.ApplyExponentialMovingAverage">
<code class="sig-name descname">ApplyExponentialMovingAverage</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">ema</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/base_model.html#BaseTask.ApplyExponentialMovingAverage"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.base_model.BaseTask.ApplyExponentialMovingAverage" title="Permalink to this definition">¶</a></dt>
<dd><p>Wraps <code class="xref py py-obj docutils literal notranslate"><span class="pre">self.train_op</span></code> with an op updating exponential moving average.</p>
</dd></dl>

<dl class="py method">
<dt id="lingvo.core.base_model.BaseTask.Decode">
<code class="sig-name descname">Decode</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">input_batch</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/base_model.html#BaseTask.Decode"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.base_model.BaseTask.Decode" title="Permalink to this definition">¶</a></dt>
<dd><p>Constructs the inference graph for eval decoding.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>input_batch</strong> – The input batch. A <code class="xref py py-obj docutils literal notranslate"><span class="pre">NestedMap</span></code> of tensors. Or, if input batch
spiltting is used, a list of <code class="xref py py-obj docutils literal notranslate"><span class="pre">NestedMap</span></code>, one for each split.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>a dict of Tensors as decoder output.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="lingvo.core.base_model.BaseTask.DecodeWithTheta">
<code class="sig-name descname">DecodeWithTheta</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">theta</span></em>, <em class="sig-param"><span class="n">input_batch</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/base_model.html#BaseTask.DecodeWithTheta"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.base_model.BaseTask.DecodeWithTheta" title="Permalink to this definition">¶</a></dt>
<dd><p>Constructs the inference graph for eval decoding with theta.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>theta</strong> – A <a class="reference internal" href="lingvo.core.nested_map.html#lingvo.core.nested_map.NestedMap" title="lingvo.core.nested_map.NestedMap"><code class="xref py py-obj docutils literal notranslate"><span class="pre">NestedMap</span></code></a> object containing variable values of this task.</p></li>
<li><p><strong>input_batch</strong> – The input batch. A <code class="xref py py-obj docutils literal notranslate"><span class="pre">NestedMap</span></code> of tensors. Or, if input batch
spiltting is used, a list of <code class="xref py py-obj docutils literal notranslate"><span class="pre">NestedMap</span></code>, one for each split.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>a dict of Tensors as decoder output.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="lingvo.core.base_model.BaseTask.Inference">
<code class="sig-name descname">Inference</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/base_model.html#BaseTask.Inference"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.base_model.BaseTask.Inference" title="Permalink to this definition">¶</a></dt>
<dd><p>Constructs the inference graph.</p>
<p>Each subgraph represents a public API for a part of the graph which can
be operated independently. By convention, the subgraph named ‘default’
should perform end to end inference via the input generator.</p>
<p>Note that having distinct subgraphs (e.g. ‘encoder’, ‘decoder’) is
not just a space optimization: when driving the graph externally in an
online fashion, evaluation often needs to be broken into pieces. In this
case, the graph will be constructed with only those pieces.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>An <code class="xref py py-obj docutils literal notranslate"><span class="pre">inference_graph_pb2.InferenceGraph</span></code> message.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="lingvo.core.base_model.BaseTask.CreateDecoderMetrics">
<code class="sig-name descname">CreateDecoderMetrics</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/base_model.html#BaseTask.CreateDecoderMetrics"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.base_model.BaseTask.CreateDecoderMetrics" title="Permalink to this definition">¶</a></dt>
<dd><p>Creates a dict of decoder metrics for <a class="reference internal" href="#lingvo.core.base_model.BaseTask.PostProcessDecodeOut" title="lingvo.core.base_model.BaseTask.PostProcessDecodeOut"><code class="xref py py-obj docutils literal notranslate"><span class="pre">PostProcessDecodeOut</span></code></a> to update.</p>
<p>Returns a dict mapping from string keys to <a class="reference internal" href="lingvo.core.metrics.html#lingvo.core.metrics.BaseMetric" title="lingvo.core.metrics.BaseMetric"><code class="xref py py-obj docutils literal notranslate"><span class="pre">BaseMetric</span></code></a> objects.</p>
</dd></dl>

<dl class="py method">
<dt id="lingvo.core.base_model.BaseTask.PostProcessDecodeOut">
<code class="sig-name descname">PostProcessDecodeOut</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">decode_out_dict</span></em>, <em class="sig-param"><span class="n">decode_metrics_dict</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/base_model.html#BaseTask.PostProcessDecodeOut"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.base_model.BaseTask.PostProcessDecodeOut" title="Permalink to this definition">¶</a></dt>
<dd><p>Post-processes decoder out and updates contents of <code class="xref py py-obj docutils literal notranslate"><span class="pre">decode_metrics_dict</span></code>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>decode_out_dict</strong> – A dictionary of Tensors fetched.</p></li>
<li><p><strong>decode_metrics_dict</strong> – A dict mapping from string key to <a class="reference internal" href="lingvo.core.metrics.html#lingvo.core.metrics.BaseMetric" title="lingvo.core.metrics.BaseMetric"><code class="xref py py-obj docutils literal notranslate"><span class="pre">BaseMetric</span></code></a>
object as created by <a class="reference internal" href="#lingvo.core.base_model.BaseTask.CreateDecoderMetrics" title="lingvo.core.base_model.BaseTask.CreateDecoderMetrics"><code class="xref py py-obj docutils literal notranslate"><span class="pre">CreateDecoderMetrics</span></code></a>.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>output_key_value_pairs - a list of (key, value) pairs that can be saved
(i.e. of type str, bytes, or unicode).</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="lingvo.core.base_model.BaseTask.DecodeFinalize">
<code class="sig-name descname">DecodeFinalize</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">decode_finalize_args</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/base_model.html#BaseTask.DecodeFinalize"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.base_model.BaseTask.DecodeFinalize" title="Permalink to this definition">¶</a></dt>
<dd><p>Finalize any work for decoding.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>decode_finalize_args</strong> – A DecodeFinalizeArgs namedtuple.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="lingvo.core.base_model.BaseTask.loss">
<em class="property">property </em><code class="sig-name descname">loss</code><a class="headerlink" href="#lingvo.core.base_model.BaseTask.loss" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt id="lingvo.core.base_model.BaseTask.train_op">
<em class="property">property </em><code class="sig-name descname">train_op</code><a class="headerlink" href="#lingvo.core.base_model.BaseTask.train_op" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt id="lingvo.core.base_model.BaseTask.post_training_loop_op">
<em class="property">property </em><code class="sig-name descname">post_training_loop_op</code><a class="headerlink" href="#lingvo.core.base_model.BaseTask.post_training_loop_op" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt id="lingvo.core.base_model.BaseTask.global_step">
<em class="property">property </em><code class="sig-name descname">global_step</code><a class="headerlink" href="#lingvo.core.base_model.BaseTask.global_step" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt id="lingvo.core.base_model.BaseTask.input_generator">
<em class="property">property </em><code class="sig-name descname">input_generator</code><a class="headerlink" href="#lingvo.core.base_model.BaseTask.input_generator" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt id="lingvo.core.base_model.BaseTask.eval_metrics">
<em class="property">property </em><code class="sig-name descname">eval_metrics</code><a class="headerlink" href="#lingvo.core.base_model.BaseTask.eval_metrics" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the evaluation metrics.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>A map from metric name (a python string) to a tuple (value, weight).
Both value and weight are scalar Tensors.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="lingvo.core.base_model.BaseTask.per_example_tensors">
<em class="property">property </em><code class="sig-name descname">per_example_tensors</code><a class="headerlink" href="#lingvo.core.base_model.BaseTask.per_example_tensors" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns per-example outputs.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>A map from tensor name (a python string) to a tensor, where the
first dimension is the batch index of the training example corresponding
to this output.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="lingvo.core.base_model.BaseTask.AddEvalMetric">
<code class="sig-name descname">AddEvalMetric</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">name</span></em>, <em class="sig-param"><span class="n">value</span></em>, <em class="sig-param"><span class="n">weight</span></em>, <em class="sig-param"><span class="n">raise_if_already_added</span><span class="o">=</span><span class="default_value">True</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/base_model.html#BaseTask.AddEvalMetric"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.base_model.BaseTask.AddEvalMetric" title="Permalink to this definition">¶</a></dt>
<dd><p>Adds a metric to the eval metrics.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>name</strong> – A python string. The name of the metric.</p></li>
<li><p><strong>value</strong> – A scalar Tensor.</p></li>
<li><p><strong>weight</strong> – A scalar Tensor.</p></li>
<li><p><strong>raise_if_already_added</strong> – If the metric already exists, raise a ValueError.</p></li>
</ul>
</dd>
<dt class="field-even">Raises</dt>
<dd class="field-even"><p><a class="reference external" href="https://docs.python.org/3.7/library/exceptions.html#ValueError" title="(in Python v3.7)"><strong>ValueError</strong></a> – if <code class="xref py py-obj docutils literal notranslate"><span class="pre">name</span></code> is already defined.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="lingvo.core.base_model.BaseTask.AddPerExampleTensor">
<code class="sig-name descname">AddPerExampleTensor</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">name</span></em>, <em class="sig-param"><span class="n">value</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/base_model.html#BaseTask.AddPerExampleTensor"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.base_model.BaseTask.AddPerExampleTensor" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt id="lingvo.core.base_model.BaseTask._UpdateVnConfig">
<code class="sig-name descname">_UpdateVnConfig</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/base_model.html#BaseTask._UpdateVnConfig"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.base_model.BaseTask._UpdateVnConfig" title="Permalink to this definition">¶</a></dt>
<dd><p>Update vn config from the various vn flags.</p>
</dd></dl>

<dl class="py method">
<dt id="lingvo.core.base_model.BaseTask._GetMaskUpdateOp">
<code class="sig-name descname">_GetMaskUpdateOp</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/base_model.html#BaseTask._GetMaskUpdateOp"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.base_model.BaseTask._GetMaskUpdateOp" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns op to update masks and threshold variables for model pruning.</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt id="lingvo.core.base_model.BaseModel">
<em class="property">class </em><code class="sig-prename descclassname">lingvo.core.base_model.</code><code class="sig-name descname">BaseModel</code><span class="sig-paren">(</span><em class="sig-param"><span class="o">*</span><span class="n">args</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/base_model.html#BaseModel"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.base_model.BaseModel" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="lingvo.core.base_layer.html#lingvo.core.base_layer.BaseLayer" title="lingvo.core.base_layer.BaseLayer"><code class="xref py py-class docutils literal notranslate"><span class="pre">lingvo.core.base_layer.BaseLayer</span></code></a></p>
<p>The abstract model class. All models are sub-class of this class.</p>
<dl class="py method">
<dt id="lingvo.core.base_model.BaseModel.Params">
<em class="property">classmethod </em><code class="sig-name descname">Params</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/base_model.html#BaseModel.Params"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.base_model.BaseModel.Params" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the layer params.</p>
</dd></dl>

<dl class="py method">
<dt id="lingvo.core.base_model.BaseModel.global_step">
<em class="property">property </em><code class="sig-name descname">global_step</code><a class="headerlink" href="#lingvo.core.base_model.BaseModel.global_step" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt id="lingvo.core.base_model.BaseModel.ema">
<em class="property">property </em><code class="sig-name descname">ema</code><a class="headerlink" href="#lingvo.core.base_model.BaseModel.ema" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt id="lingvo.core.base_model.BaseModel.variables_for_ema">
<em class="property">property </em><code class="sig-name descname">variables_for_ema</code><a class="headerlink" href="#lingvo.core.base_model.BaseModel.variables_for_ema" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt id="lingvo.core.base_model.BaseModel.ConstructFPropBPropGraph">
<code class="sig-name descname">ConstructFPropBPropGraph</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/base_model.html#BaseModel.ConstructFPropBPropGraph"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.base_model.BaseModel.ConstructFPropBPropGraph" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt id="lingvo.core.base_model.BaseModel.ConstructFPropGraph">
<code class="sig-name descname">ConstructFPropGraph</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/base_model.html#BaseModel.ConstructFPropGraph"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.base_model.BaseModel.ConstructFPropGraph" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt id="lingvo.core.base_model.BaseModel.ConstructPostTrainingLoop">
<code class="sig-name descname">ConstructPostTrainingLoop</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">outfeed</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/base_model.html#BaseModel.ConstructPostTrainingLoop"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.base_model.BaseModel.ConstructPostTrainingLoop" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt id="lingvo.core.base_model.BaseModel.tasks">
<em class="property">property </em><code class="sig-name descname">tasks</code><a class="headerlink" href="#lingvo.core.base_model.BaseModel.tasks" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a list of all tasks.</p>
</dd></dl>

<dl class="py method">
<dt id="lingvo.core.base_model.BaseModel.GetTask">
<code class="sig-name descname">GetTask</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">task_name</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/base_model.html#BaseModel.GetTask"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.base_model.BaseModel.GetTask" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the task associated with ‘task_name’.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>task_name</strong> – string, the name of the model task to be returned.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>An instance of <a class="reference internal" href="#lingvo.core.base_model.BaseTask" title="lingvo.core.base_model.BaseTask"><code class="xref py py-obj docutils literal notranslate"><span class="pre">BaseTask</span></code></a>.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="lingvo.core.base_model.BaseModel.ProcessFPropResults">
<code class="sig-name descname">ProcessFPropResults</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">sess</span></em>, <em class="sig-param"><span class="n">global_step</span></em>, <em class="sig-param"><span class="n">metrics</span></em>, <em class="sig-param"><span class="n">per_example</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/base_model.html#BaseModel.ProcessFPropResults"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.base_model.BaseModel.ProcessFPropResults" title="Permalink to this definition">¶</a></dt>
<dd><p>Called once for each train loop.</p>
<p>BaseTask.ProcessFPropResults is also called on each loop, so you
can put your implementation wherever it is most convenient for you.</p>
<p>Be sure to implement BaseTask.FilterPerExampleTensors if you plan to use any
per-example tensors in this method.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>sess</strong> – a session.</p></li>
<li><p><strong>global_step</strong> – model global step. Since ProcessFPropResults is called after
sess.run(train_op), this value will be p.train.tpu_steps_per_loop higher
than the value in FProp.</p></li>
<li><p><strong>metrics</strong> – the metrics dict returned by FPropTower.</p></li>
<li><p><strong>per_example</strong> – the per_example dict returned by FPropTower.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="lingvo.core.base_model.BaseModel.Export">
<code class="sig-name descname">Export</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">train_dir</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/base_model.html#BaseModel.Export"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.base_model.BaseModel.Export" title="Permalink to this definition">¶</a></dt>
<dd><p>Called by the checkpointer when a checkpoint is written.</p>
<p>This is entirely optional and is intended for models that have additional
information to save.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>train_dir</strong> – Directory in which any additional files should be saved. This
is also the same directory where checkpoints will be written.</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt id="lingvo.core.base_model.SingleTaskBase">
<em class="property">class </em><code class="sig-prename descclassname">lingvo.core.base_model.</code><code class="sig-name descname">SingleTaskBase</code><span class="sig-paren">(</span><em class="sig-param"><span class="o">*</span><span class="n">args</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/base_model.html#SingleTaskBase"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.base_model.SingleTaskBase" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#lingvo.core.base_model.BaseModel" title="lingvo.core.base_model.BaseModel"><code class="xref py py-class docutils literal notranslate"><span class="pre">lingvo.core.base_model.BaseModel</span></code></a></p>
<p>Represents a single task from a model.</p>
<p>Subclasses must create a Task in self._task by the end of __init__.</p>
<dl class="py method">
<dt id="lingvo.core.base_model.SingleTaskBase.tasks">
<em class="property">property </em><code class="sig-name descname">tasks</code><a class="headerlink" href="#lingvo.core.base_model.SingleTaskBase.tasks" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a list of all tasks.</p>
</dd></dl>

<dl class="py method">
<dt id="lingvo.core.base_model.SingleTaskBase.GetTask">
<code class="sig-name descname">GetTask</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">task_name</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/base_model.html#SingleTaskBase.GetTask"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.base_model.SingleTaskBase.GetTask" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the task associated with ‘task_name’.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>task_name</strong> – string, the name of the model task to be returned.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>An instance of <a class="reference internal" href="#lingvo.core.base_model.BaseTask" title="lingvo.core.base_model.BaseTask"><code class="xref py py-obj docutils literal notranslate"><span class="pre">BaseTask</span></code></a>.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="lingvo.core.base_model.SingleTaskBase.SampleTask">
<code class="sig-name descname">SampleTask</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">global_step</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/base_model.html#SingleTaskBase.SampleTask"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.base_model.SingleTaskBase.SampleTask" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt id="lingvo.core.base_model.SingleTaskBase.ConstructFPropBPropGraph">
<code class="sig-name descname">ConstructFPropBPropGraph</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/base_model.html#SingleTaskBase.ConstructFPropBPropGraph"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.base_model.SingleTaskBase.ConstructFPropBPropGraph" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt id="lingvo.core.base_model.SingleTaskBase.ConstructFPropGraph">
<code class="sig-name descname">ConstructFPropGraph</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/base_model.html#SingleTaskBase.ConstructFPropGraph"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.base_model.SingleTaskBase.ConstructFPropGraph" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt id="lingvo.core.base_model.SingleTaskBase.ConstructPostTrainingLoop">
<code class="sig-name descname">ConstructPostTrainingLoop</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">outfeed</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/base_model.html#SingleTaskBase.ConstructPostTrainingLoop"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.base_model.SingleTaskBase.ConstructPostTrainingLoop" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py class">
<dt id="lingvo.core.base_model.SingleTaskModel">
<em class="property">class </em><code class="sig-prename descclassname">lingvo.core.base_model.</code><code class="sig-name descname">SingleTaskModel</code><span class="sig-paren">(</span><em class="sig-param"><span class="o">*</span><span class="n">args</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/base_model.html#SingleTaskModel"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.base_model.SingleTaskModel" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#lingvo.core.base_model.SingleTaskBase" title="lingvo.core.base_model.SingleTaskBase"><code class="xref py py-class docutils literal notranslate"><span class="pre">lingvo.core.base_model.SingleTaskBase</span></code></a></p>
<p>Model that consists of a single task.</p>
<dl class="py method">
<dt id="lingvo.core.base_model.SingleTaskModel.Params">
<em class="property">classmethod </em><code class="sig-name descname">Params</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">task_params</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/base_model.html#SingleTaskModel.Params"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.base_model.SingleTaskModel.Params" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the layer params.</p>
</dd></dl>

<dl class="py method">
<dt id="lingvo.core.base_model.SingleTaskModel._CreateChildrenVariables">
<code class="sig-name descname">_CreateChildrenVariables</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/base_model.html#SingleTaskModel._CreateChildrenVariables"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.base_model.SingleTaskModel._CreateChildrenVariables" title="Permalink to this definition">¶</a></dt>
<dd><p>Create variables for child layers.</p>
<p>Should be rarely overridden, only in cases when control over the context of
children InstantiateVariables calls are needed. eg, if children variables
need to be created inside of a specific context manager.</p>
<p>There are a few cases of this in the codebase marked as for backwards
compability. This is only to ensure that variable scopes remain compatible
through the code migration. New layers should not copy that pattern, and
instead follow the standard pattern of self.CreateChild() in __init__() and
self.CreateVariable() in _CreateLayerVariables(). If you are okay with
breaking old checkpoints, you can go ahead and delete those functions.</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt id="lingvo.core.base_model.MultiTaskSubModel">
<em class="property">class </em><code class="sig-prename descclassname">lingvo.core.base_model.</code><code class="sig-name descname">MultiTaskSubModel</code><span class="sig-paren">(</span><em class="sig-param"><span class="o">*</span><span class="n">args</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/base_model.html#MultiTaskSubModel"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.base_model.MultiTaskSubModel" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#lingvo.core.base_model.SingleTaskBase" title="lingvo.core.base_model.SingleTaskBase"><code class="xref py py-class docutils literal notranslate"><span class="pre">lingvo.core.base_model.SingleTaskBase</span></code></a></p>
<p>‘Model’ consisting of a task from a multi-task model.</p>
<p>The entire multi-task model is constructed, but otherwise this model
appears to be a SingleTaskModel consisting of just one of the multi-task
model’s tasks.</p>
<dl class="py method">
<dt id="lingvo.core.base_model.MultiTaskSubModel.Params">
<em class="property">classmethod </em><code class="sig-name descname">Params</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/base_model.html#MultiTaskSubModel.Params"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.base_model.MultiTaskSubModel.Params" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the layer params.</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt id="lingvo.core.base_model.MultiTaskModel">
<em class="property">class </em><code class="sig-prename descclassname">lingvo.core.base_model.</code><code class="sig-name descname">MultiTaskModel</code><span class="sig-paren">(</span><em class="sig-param"><span class="o">*</span><span class="n">args</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/base_model.html#MultiTaskModel"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.base_model.MultiTaskModel" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#lingvo.core.base_model.BaseModel" title="lingvo.core.base_model.BaseModel"><code class="xref py py-class docutils literal notranslate"><span class="pre">lingvo.core.base_model.BaseModel</span></code></a></p>
<p>Model that consists of multiple tasks.</p>
<dl class="py method">
<dt id="lingvo.core.base_model.MultiTaskModel.Params">
<em class="property">classmethod </em><code class="sig-name descname">Params</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/base_model.html#MultiTaskModel.Params"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.base_model.MultiTaskModel.Params" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the layer params.</p>
</dd></dl>

<dl class="py method">
<dt id="lingvo.core.base_model.MultiTaskModel.TaskNames">
<em class="property">static </em><code class="sig-name descname">TaskNames</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">params</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/base_model.html#MultiTaskModel.TaskNames"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.base_model.MultiTaskModel.TaskNames" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt id="lingvo.core.base_model.MultiTaskModel._CreateChildrenVariables">
<code class="sig-name descname">_CreateChildrenVariables</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/base_model.html#MultiTaskModel._CreateChildrenVariables"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.base_model.MultiTaskModel._CreateChildrenVariables" title="Permalink to this definition">¶</a></dt>
<dd><p>Create variables for child layers.</p>
<p>Should be rarely overridden, only in cases when control over the context of
children InstantiateVariables calls are needed. eg, if children variables
need to be created inside of a specific context manager.</p>
<p>There are a few cases of this in the codebase marked as for backwards
compability. This is only to ensure that variable scopes remain compatible
through the code migration. New layers should not copy that pattern, and
instead follow the standard pattern of self.CreateChild() in __init__() and
self.CreateVariable() in _CreateLayerVariables(). If you are okay with
breaking old checkpoints, you can go ahead and delete those functions.</p>
</dd></dl>

<dl class="py method">
<dt id="lingvo.core.base_model.MultiTaskModel.task_names">
<em class="property">property </em><code class="sig-name descname">task_names</code><a class="headerlink" href="#lingvo.core.base_model.MultiTaskModel.task_names" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt id="lingvo.core.base_model.MultiTaskModel.tasks">
<em class="property">property </em><code class="sig-name descname">tasks</code><a class="headerlink" href="#lingvo.core.base_model.MultiTaskModel.tasks" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a list of all tasks.</p>
</dd></dl>

<dl class="py method">
<dt id="lingvo.core.base_model.MultiTaskModel.GetTask">
<code class="sig-name descname">GetTask</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">task_name</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/base_model.html#MultiTaskModel.GetTask"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.base_model.MultiTaskModel.GetTask" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the task associated with ‘task_name’.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>task_name</strong> – string, the name of the model task to be returned.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>An instance of <a class="reference internal" href="#lingvo.core.base_model.BaseTask" title="lingvo.core.base_model.BaseTask"><code class="xref py py-obj docutils literal notranslate"><span class="pre">BaseTask</span></code></a>.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="lingvo.core.base_model.MultiTaskModel.SampleTask">
<code class="sig-name descname">SampleTask</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">global_step</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/base_model.html#MultiTaskModel.SampleTask"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.base_model.MultiTaskModel.SampleTask" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a sampled task according to self.task_schedule.</p>
<p><code class="xref py py-obj docutils literal notranslate"><span class="pre">self.task_schedule.cur_probs</span></code> will also be updated.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>global_step</strong> – int. Current time step.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="lingvo.core.base_model.MultiTaskModel.ConstructFPropBPropGraph">
<code class="sig-name descname">ConstructFPropBPropGraph</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/base_model.html#MultiTaskModel.ConstructFPropBPropGraph"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.base_model.MultiTaskModel.ConstructFPropBPropGraph" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt id="lingvo.core.base_model.MultiTaskModel.ConstructFPropGraph">
<code class="sig-name descname">ConstructFPropGraph</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/base_model.html#MultiTaskModel.ConstructFPropGraph"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.base_model.MultiTaskModel.ConstructFPropGraph" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="lingvo.core.base_model_params.html" class="btn btn-neutral float-right" title="lingvo.core.base_model_params module" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="lingvo.core.base_layer.html" class="btn btn-neutral float-left" title="lingvo.core.base_layer module" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2018.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>