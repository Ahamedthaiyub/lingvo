<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>lingvo.core.program module &mdash; Lingvo  documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="lingvo.core.pruning_utils module" href="lingvo.core.pruning_utils.html" />
    <link rel="prev" title="lingvo.core.predictor_runner_base module" href="lingvo.core.predictor_runner_base.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html" class="icon icon-home"> Lingvo
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="lingvo.html">lingvo package</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="lingvo.html#subpackages">Subpackages</a><ul class="current">
<li class="toctree-l3 current"><a class="reference internal" href="lingvo.core.html">lingvo.core package</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="lingvo.core.html#subpackages">Subpackages</a></li>
<li class="toctree-l4 current"><a class="reference internal" href="lingvo.core.html#submodules">Submodules</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="lingvo.tasks.html">lingvo.tasks package</a></li>
<li class="toctree-l3"><a class="reference internal" href="lingvo.tools.html">lingvo.tools package</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="lingvo.html#submodules">Submodules</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Lingvo</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="lingvo.html">lingvo package</a> &raquo;</li>
          <li><a href="lingvo.core.html">lingvo.core package</a> &raquo;</li>
      <li>lingvo.core.program module</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/lingvo.core.program.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="module-lingvo.core.program">
<span id="lingvo-core-program-module"></span><h1>lingvo.core.program module<a class="headerlink" href="#module-lingvo.core.program" title="Permalink to this headline"></a></h1>
<p>Programs for interleaving execution on TPU.</p>
<dl class="py class">
<dt class="sig sig-object py" id="lingvo.core.program.BaseProgram">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">lingvo.core.program.</span></span><span class="sig-name descname"><span class="pre">BaseProgram</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">params</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">shared_model=None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">trial=&lt;lingvo.base_trial.NoOpTrial</span> <span class="pre">object&gt;</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">**kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/program.html#BaseProgram"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.core.program.BaseProgram" title="Permalink to this definition"></a></dt>
<dd><p>Bases: <a class="reference external" href="https://docs.python.org/3.7/library/functions.html#object" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></a></p>
<p>A Program associated with a Task.</p>
<p>This is inspired by the “program” multi-tenancy that TPUs
support. Essentially, each program corresponds with a
sub-graph can exist in the same Graph/Session.</p>
<p>Upon first execution, it is XLA/JIT compiled and is subsequently
available to be executed on demand without significant delay.</p>
<p>Program’s provides the following functionality:</p>
<blockquote>
<div><ul class="simple">
<li><p>Builds a sub-graph</p></li>
<li><p>Writes summaries</p></li>
<li><p>Runs for pre-determined <code class="xref py py-obj docutils literal notranslate"><span class="pre">steps_per_loop</span></code> steps with appropriate infeeds</p></li>
</ul>
</div></blockquote>
<dl class="py method">
<dt class="sig sig-object py" id="lingvo.core.program.BaseProgram.Params">
<em class="property"><span class="pre">classmethod</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">Params</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/program.html#BaseProgram.Params"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.core.program.BaseProgram.Params" title="Permalink to this definition"></a></dt>
<dd><p>“Defaults parameters for Programs.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="lingvo.core.program.BaseProgram._InitializeVizier">
<span class="sig-name descname"><span class="pre">_InitializeVizier</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/program.html#BaseProgram._InitializeVizier"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.core.program.BaseProgram._InitializeVizier" title="Permalink to this definition"></a></dt>
<dd><p>Checks if this program should report metrics to vizier.</p>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="lingvo.core.program.BaseProgram._summary_writer">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">_summary_writer</span></span><a class="headerlink" href="#lingvo.core.program.BaseProgram._summary_writer" title="Permalink to this definition"></a></dt>
<dd><p>Returns the FileWriter object to use for summaries.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="lingvo.core.program.BaseProgram._SummarizeValue">
<span class="sig-name descname"><span class="pre">_SummarizeValue</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">steps</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tag</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">value</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/program.html#BaseProgram._SummarizeValue"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.core.program.BaseProgram._SummarizeValue" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="lingvo.core.program.BaseProgram._WriteSummaries">
<span class="sig-name descname"><span class="pre">_WriteSummaries</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">job_name</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">global_step</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">summaries</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/program.html#BaseProgram._WriteSummaries"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.core.program.BaseProgram._WriteSummaries" title="Permalink to this definition"></a></dt>
<dd><p>Write summaries to be viewed by TensorBoard.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>job_name</strong> – The name of this job (‘trainer’, ‘evaler’, etc.)</p></li>
<li><p><strong>global_step</strong> – Integer number of trainer steps (not a tensor).</p></li>
<li><p><strong>summaries</strong> – Dict of {summary_name: tf.Summary()}.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="lingvo.core.program.BaseProgram._WriteInputDataStats">
<span class="sig-name descname"><span class="pre">_WriteInputDataStats</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">sess</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/program.html#BaseProgram._WriteInputDataStats"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.core.program.BaseProgram._WriteInputDataStats" title="Permalink to this definition"></a></dt>
<dd><p>Write input data stats for model training as TF summaries.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>sess</strong> – The Tensorflow session.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="lingvo.core.program.BaseProgram._InfeedLoop">
<span class="sig-name descname"><span class="pre">_InfeedLoop</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">sess</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/program.html#BaseProgram._InfeedLoop"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.core.program.BaseProgram._InfeedLoop" title="Permalink to this definition"></a></dt>
<dd><p>Infeed loop for input generator for batched data and input data stats.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="lingvo.core.program.BaseProgram._ReportVizierMetrics">
<span class="sig-name descname"><span class="pre">_ReportVizierMetrics</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">global_step</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">metrics_dict</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/program.html#BaseProgram._ReportVizierMetrics"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.core.program.BaseProgram._ReportVizierMetrics" title="Permalink to this definition"></a></dt>
<dd><p>Report metrics to vizier service.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>global_step</strong> – Int.</p></li>
<li><p><strong>metrics_dict</strong> – A dict of metric name -&gt; metric values.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><dl class="simple">
<dt>Boolean, indicates if early stopping has bee requested</dt><dd><p>by vizier.</p>
</dd>
</dl>
</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>vizier_early_stop</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="lingvo.core.program.BaseProgram.BuildTpuSubgraph">
<span class="sig-name descname"><span class="pre">BuildTpuSubgraph</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/program.html#BaseProgram.BuildTpuSubgraph"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.core.program.BaseProgram.BuildTpuSubgraph" title="Permalink to this definition"></a></dt>
<dd><p>Sub classes should construct a model/graph to be executed by Run.</p>
<p>Specific to TPU execution, this may involve a
&#64;tpu_function.on_device_training_loop etc.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="lingvo.core.program.BaseProgram.SetStatusMessageFn">
<span class="sig-name descname"><span class="pre">SetStatusMessageFn</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">fn</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/program.html#BaseProgram.SetStatusMessageFn"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.core.program.BaseProgram.SetStatusMessageFn" title="Permalink to this definition"></a></dt>
<dd><p>Workaround since we instantiate programs via Params.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="lingvo.core.program.BaseProgram.SetStatusMessage">
<span class="sig-name descname"><span class="pre">SetStatusMessage</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">msg</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/program.html#BaseProgram.SetStatusMessage"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.core.program.BaseProgram.SetStatusMessage" title="Permalink to this definition"></a></dt>
<dd><p>Write to borglet status.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="lingvo.core.program.BaseProgram.Compile">
<span class="sig-name descname"><span class="pre">Compile</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">sess</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/program.html#BaseProgram.Compile"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.core.program.BaseProgram.Compile" title="Permalink to this definition"></a></dt>
<dd><p>Compile the program using the given session handle.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="lingvo.core.program.BaseProgram.Run">
<span class="sig-name descname"><span class="pre">Run</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">sess</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">threadpool</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/program.html#BaseProgram.Run"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.core.program.BaseProgram.Run" title="Permalink to this definition"></a></dt>
<dd><p>Execute the program using the given session handle.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>sess</strong> – TF Session.</p></li>
<li><p><strong>threadpool</strong> – A ThreadPool on the executor for running async functions.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>Whether to end all execution.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>done</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="lingvo.core.program.BaseProgram.Shutdown">
<span class="sig-name descname"><span class="pre">Shutdown</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/program.html#BaseProgram.Shutdown"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.core.program.BaseProgram.Shutdown" title="Permalink to this definition"></a></dt>
<dd><p>Runs any necessary cleanup (potentially blocking).</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="lingvo.core.program.BaseProgram.CreateCheckpointer">
<span class="sig-name descname"><span class="pre">CreateCheckpointer</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">init_op</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/program.html#BaseProgram.CreateCheckpointer"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.core.program.BaseProgram.CreateCheckpointer" title="Permalink to this definition"></a></dt>
<dd><p>Creates a checkpointer, whose version depends on the mode and config.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>init_op</strong> – The initialize variables op. If unset, it will call
tf.global_variables_initializer().</p>
</dd>
<dt class="field-even">Raises</dt>
<dd class="field-even"><p><a class="reference external" href="https://docs.python.org/3.7/library/exceptions.html#TypeError" title="(in Python v3.7)"><strong>TypeError</strong></a> – When the function is called in Eager mode.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="lingvo.core.program.BaseProgram.RestoreIfNeeded">
<span class="sig-name descname"><span class="pre">RestoreIfNeeded</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">sess</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/program.html#BaseProgram.RestoreIfNeeded"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.core.program.BaseProgram.RestoreIfNeeded" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="lingvo.core.program.BaseProgram.SaveProgramState">
<span class="sig-name descname"><span class="pre">SaveProgramState</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">sess</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">global_step</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/program.html#BaseProgram.SaveProgramState"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.core.program.BaseProgram.SaveProgramState" title="Permalink to this definition"></a></dt>
<dd><p>Saves program state information that need to be loaded during restore.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="lingvo.core.program.BaseProgram._InstantiateTaskModel">
<span class="sig-name descname"><span class="pre">_InstantiateTaskModel</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">task_params</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/program.html#BaseProgram._InstantiateTaskModel"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.core.program.BaseProgram._InstantiateTaskModel" title="Permalink to this definition"></a></dt>
<dd><p>Instantiates a model object for a particular task.</p>
<p>MultiTaskModels can accept a shared_model parameter, but SingleTaskModels
cannot, so we handle them separately here.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>task_params</strong> – An params instance that constructs either a SingleTaskModel
or a MultiTaskSubModel.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>An instantiated object based on task_params.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="lingvo.core.program.BaseProgram._OutfeedEnqueue">
<span class="sig-name descname"><span class="pre">_OutfeedEnqueue</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">per_example_tensors</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/program.html#BaseProgram._OutfeedEnqueue"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.core.program.BaseProgram._OutfeedEnqueue" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="lingvo.core.program.BaseProgram.GetModel">
<span class="sig-name descname"><span class="pre">GetModel</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/program.html#BaseProgram.GetModel"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.core.program.BaseProgram.GetModel" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="lingvo.core.program.InputBenchmark">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">lingvo.core.program.</span></span><span class="sig-name descname"><span class="pre">InputBenchmark</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">params</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">shared_model</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/program.html#InputBenchmark"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.core.program.InputBenchmark" title="Permalink to this definition"></a></dt>
<dd><p>Bases: <a class="reference internal" href="#lingvo.core.program.BaseProgram" title="lingvo.core.program.BaseProgram"><code class="xref py py-class docutils literal notranslate"><span class="pre">lingvo.core.program.BaseProgram</span></code></a></p>
<p>Measures input generation steps/sec depending on the params below.</p>
<dl class="py method">
<dt class="sig sig-object py" id="lingvo.core.program.InputBenchmark.Params">
<em class="property"><span class="pre">classmethod</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">Params</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/program.html#InputBenchmark.Params"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.core.program.InputBenchmark.Params" title="Permalink to this definition"></a></dt>
<dd><p>“Defaults parameters for Programs.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="lingvo.core.program.InputBenchmark.BuildTpuSubgraph">
<span class="sig-name descname"><span class="pre">BuildTpuSubgraph</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/program.html#InputBenchmark.BuildTpuSubgraph"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.core.program.InputBenchmark.BuildTpuSubgraph" title="Permalink to this definition"></a></dt>
<dd><p>Sub classes should construct a model/graph to be executed by Run.</p>
<p>Specific to TPU execution, this may involve a
&#64;tpu_function.on_device_training_loop etc.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="lingvo.core.program.InputBenchmark.Run">
<span class="sig-name descname"><span class="pre">Run</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">sess</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/program.html#InputBenchmark.Run"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.core.program.InputBenchmark.Run" title="Permalink to this definition"></a></dt>
<dd><p>Execute the program using the given session handle.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>sess</strong> – TF Session.</p></li>
<li><p><strong>threadpool</strong> – A ThreadPool on the executor for running async functions.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>Whether to end all execution.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>done</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="lingvo.core.program.TrainProgram">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">lingvo.core.program.</span></span><span class="sig-name descname"><span class="pre">TrainProgram</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">params</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">shared_model</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/program.html#TrainProgram"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.core.program.TrainProgram" title="Permalink to this definition"></a></dt>
<dd><p>Bases: <a class="reference internal" href="#lingvo.core.program.BaseProgram" title="lingvo.core.program.BaseProgram"><code class="xref py py-class docutils literal notranslate"><span class="pre">lingvo.core.program.BaseProgram</span></code></a></p>
<p>TrainProgram trains a single task and handles checkpoints.</p>
<dl class="py method">
<dt class="sig sig-object py" id="lingvo.core.program.TrainProgram._OutfeedDequeueLoop">
<span class="sig-name descname"><span class="pre">_OutfeedDequeueLoop</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">per_example_tensors</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">num_loops</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">num_devices</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/program.html#TrainProgram._OutfeedDequeueLoop"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.core.program.TrainProgram._OutfeedDequeueLoop" title="Permalink to this definition"></a></dt>
<dd><p>Process all per-example tensor outfeed data for a TPU sess.run.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>per_example_tensors</strong> – dict of key -&gt; tensor as generated by TpuTrainStep.</p></li>
<li><p><strong>num_loops</strong> – number of times that TpuTrainStep will be executed by TpuTrain.</p></li>
<li><p><strong>num_devices</strong> – number of TPU cores assigned to this process.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A dict of per-example tensors from the latest TpuTrainStep.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="lingvo.core.program.TrainProgram.TpuTrainStep">
<span class="sig-name descname"><span class="pre">TpuTrainStep</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/program.html#TrainProgram.TpuTrainStep"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.core.program.TrainProgram.TpuTrainStep" title="Permalink to this definition"></a></dt>
<dd><p>Train a shard of a batch on a single TPU core.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>*args</strong> – metrics values from previous steps.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>New summed metrics values and a train_op.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="lingvo.core.program.TrainProgram.BuildTpuSubgraph">
<span class="sig-name descname"><span class="pre">BuildTpuSubgraph</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/program.html#TrainProgram.BuildTpuSubgraph"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.core.program.TrainProgram.BuildTpuSubgraph" title="Permalink to this definition"></a></dt>
<dd><p>Sub classes should construct a model/graph to be executed by Run.</p>
<p>Specific to TPU execution, this may involve a
&#64;tpu_function.on_device_training_loop etc.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="lingvo.core.program.TrainProgram.Run">
<span class="sig-name descname"><span class="pre">Run</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">sess</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/program.html#TrainProgram.Run"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.core.program.TrainProgram.Run" title="Permalink to this definition"></a></dt>
<dd><p>Execute the program using the given session handle.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>sess</strong> – TF Session.</p></li>
<li><p><strong>threadpool</strong> – A ThreadPool on the executor for running async functions.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>Whether to end all execution.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>done</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="lingvo.core.program.TrainProgram._ShouldStop">
<span class="sig-name descname"><span class="pre">_ShouldStop</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">task_global_step</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/program.html#TrainProgram._ShouldStop"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.core.program.TrainProgram._ShouldStop" title="Permalink to this definition"></a></dt>
<dd><p>Simpler version of _ShouldStop without early stopping.</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="lingvo.core.program.EvalProgram">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">lingvo.core.program.</span></span><span class="sig-name descname"><span class="pre">EvalProgram</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">params</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">shared_model</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/program.html#EvalProgram"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.core.program.EvalProgram" title="Permalink to this definition"></a></dt>
<dd><p>Bases: <a class="reference internal" href="#lingvo.core.program.BaseProgram" title="lingvo.core.program.BaseProgram"><code class="xref py py-class docutils literal notranslate"><span class="pre">lingvo.core.program.BaseProgram</span></code></a></p>
<p>Evaluation program.</p>
<dl class="py method">
<dt class="sig sig-object py" id="lingvo.core.program.EvalProgram.TpuEvalStep">
<span class="sig-name descname"><span class="pre">TpuEvalStep</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/program.html#EvalProgram.TpuEvalStep"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.core.program.EvalProgram.TpuEvalStep" title="Permalink to this definition"></a></dt>
<dd><p>Eval a shard of a batch on a single TPU core.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>*args</strong> – metrics values from previous steps.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>Summed eval metrics.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="lingvo.core.program.EvalProgram.EvalFunc">
<span class="sig-name descname"><span class="pre">EvalFunc</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/program.html#EvalProgram.EvalFunc"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.core.program.EvalProgram.EvalFunc" title="Permalink to this definition"></a></dt>
<dd><p>Eval function.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="lingvo.core.program.EvalProgram.BuildTpuSubgraph">
<span class="sig-name descname"><span class="pre">BuildTpuSubgraph</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/program.html#EvalProgram.BuildTpuSubgraph"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.core.program.EvalProgram.BuildTpuSubgraph" title="Permalink to this definition"></a></dt>
<dd><p>Sub classes should construct a model/graph to be executed by Run.</p>
<p>Specific to TPU execution, this may involve a
&#64;tpu_function.on_device_training_loop etc.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="lingvo.core.program.EvalProgram.Run">
<span class="sig-name descname"><span class="pre">Run</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">sess</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/program.html#EvalProgram.Run"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.core.program.EvalProgram.Run" title="Permalink to this definition"></a></dt>
<dd><p>Execute the program using the given session handle.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>sess</strong> – TF Session.</p></li>
<li><p><strong>threadpool</strong> – A ThreadPool on the executor for running async functions.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>Whether to end all execution.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>done</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="lingvo.core.program._FetchDecodeOut">
<span class="sig-prename descclassname"><span class="pre">lingvo.core.program.</span></span><span class="sig-name descname"><span class="pre">_FetchDecodeOut</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">tpu_outs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sess</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/program.html#_FetchDecodeOut"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.core.program._FetchDecodeOut" title="Permalink to this definition"></a></dt>
<dd><p>Fetch decoder outputs, combining with CPU passthrough tensors if needed.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>tpu_outs</strong> – A list of decoded tensors and list of cpu passthrough tensors in
graph mode, or a callable returning such in eager mode.</p></li>
<li><p><strong>sess</strong> – A session to use in graph mode.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A dict containing merged decoded outputs.</p>
</dd>
</dl>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="lingvo.core.program.DecodeProgram">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">lingvo.core.program.</span></span><span class="sig-name descname"><span class="pre">DecodeProgram</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">params</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">shared_model</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/program.html#DecodeProgram"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.core.program.DecodeProgram" title="Permalink to this definition"></a></dt>
<dd><p>Bases: <a class="reference internal" href="#lingvo.core.program.BaseProgram" title="lingvo.core.program.BaseProgram"><code class="xref py py-class docutils literal notranslate"><span class="pre">lingvo.core.program.BaseProgram</span></code></a></p>
<p>DecodeProgram.</p>
<dl class="py method">
<dt class="sig sig-object py" id="lingvo.core.program.DecodeProgram.Params">
<em class="property"><span class="pre">classmethod</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">Params</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/program.html#DecodeProgram.Params"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.core.program.DecodeProgram.Params" title="Permalink to this definition"></a></dt>
<dd><p>“Defaults parameters for Programs.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="lingvo.core.program.DecodeProgram.DecodeFunc">
<span class="sig-name descname"><span class="pre">DecodeFunc</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/program.html#DecodeProgram.DecodeFunc"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.core.program.DecodeProgram.DecodeFunc" title="Permalink to this definition"></a></dt>
<dd><p>Wrap the DecodeFn with split_compile_and_shard.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="lingvo.core.program.DecodeProgram._DecodeUntilOutOfRangeInfeedLoop">
<span class="sig-name descname"><span class="pre">_DecodeUntilOutOfRangeInfeedLoop</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">sess</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">infeed_step_queue</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/program.html#DecodeProgram._DecodeUntilOutOfRangeInfeedLoop"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.core.program.DecodeProgram._DecodeUntilOutOfRangeInfeedLoop" title="Permalink to this definition"></a></dt>
<dd><p>Infeed loop that stops when it runs out of data (OutOfRange error).</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="lingvo.core.program.DecodeProgram.BuildTpuSubgraph">
<span class="sig-name descname"><span class="pre">BuildTpuSubgraph</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/program.html#DecodeProgram.BuildTpuSubgraph"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.core.program.DecodeProgram.BuildTpuSubgraph" title="Permalink to this definition"></a></dt>
<dd><p>Sub classes should construct a model/graph to be executed by Run.</p>
<p>Specific to TPU execution, this may involve a
&#64;tpu_function.on_device_training_loop etc.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="lingvo.core.program.DecodeProgram._DecodeStep">
<span class="sig-name descname"><span class="pre">_DecodeStep</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">sess</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">step</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dec_metrics</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">global_step</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">buffered_decode_out</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">postprocess_futures</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">threadpool</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/program.html#DecodeProgram._DecodeStep"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.core.program.DecodeProgram._DecodeStep" title="Permalink to this definition"></a></dt>
<dd><p>Run one iteration of decode.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="lingvo.core.program.DecodeProgram._RunPostProcess">
<span class="sig-name descname"><span class="pre">_RunPostProcess</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">threadpool</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">step</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">decode_out_obj</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dec_metrics</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">global_step</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">buffered_decode_out</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">postprocess_futures</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/program.html#DecodeProgram._RunPostProcess"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.core.program.DecodeProgram._RunPostProcess" title="Permalink to this definition"></a></dt>
<dd><p>Run postprocess in sync or async if a threadpool is provided.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="lingvo.core.program.DecodeProgram._PostProcessStep">
<span class="sig-name descname"><span class="pre">_PostProcessStep</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">idx</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">decode_out_obj</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dec_metrics</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">global_step</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">buffered_decode_out</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/program.html#DecodeProgram._PostProcessStep"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.core.program.DecodeProgram._PostProcessStep" title="Permalink to this definition"></a></dt>
<dd><p>Run postprocess for a single decode step.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="lingvo.core.program.DecodeProgram._FinalizeDecode">
<span class="sig-name descname"><span class="pre">_FinalizeDecode</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">dec_metrics</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">start_time</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">global_step</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">buffered_decode_out</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">futures</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/program.html#DecodeProgram._FinalizeDecode"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.core.program.DecodeProgram._FinalizeDecode" title="Permalink to this definition"></a></dt>
<dd><p>Finalize and summarize the results of this Decode program run.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="lingvo.core.program.DecodeProgram.Run">
<span class="sig-name descname"><span class="pre">Run</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">sess</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">threadpool</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/program.html#DecodeProgram.Run"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.core.program.DecodeProgram.Run" title="Permalink to this definition"></a></dt>
<dd><p>Setup and execute Decode program.</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="lingvo.core.program.ExperimentalDecodeProgram">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">lingvo.core.program.</span></span><span class="sig-name descname"><span class="pre">ExperimentalDecodeProgram</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">params</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">shared_model</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/program.html#ExperimentalDecodeProgram"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.core.program.ExperimentalDecodeProgram" title="Permalink to this definition"></a></dt>
<dd><p>Bases: <a class="reference internal" href="#lingvo.core.program.DecodeProgram" title="lingvo.core.program.DecodeProgram"><code class="xref py py-class docutils literal notranslate"><span class="pre">lingvo.core.program.DecodeProgram</span></code></a></p>
<p>DecodeProgram in a tpu loop.</p>
<p>Note that decoder outputs across cores are concatenated along the first
dimension. The first dimension usually corresponds to batch size and as long
as post process decode outputs have the same expectations, this will work.</p>
<p>TODO(huangyp) test this for beam search decoders and replace the
default DecodeProgram.</p>
<dl class="py method">
<dt class="sig sig-object py" id="lingvo.core.program.ExperimentalDecodeProgram.Params">
<em class="property"><span class="pre">classmethod</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">Params</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/program.html#ExperimentalDecodeProgram.Params"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.core.program.ExperimentalDecodeProgram.Params" title="Permalink to this definition"></a></dt>
<dd><p>“Defaults parameters for Programs.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="lingvo.core.program.ExperimentalDecodeProgram.DecodeFunc">
<span class="sig-name descname"><span class="pre">DecodeFunc</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/program.html#ExperimentalDecodeProgram.DecodeFunc"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.core.program.ExperimentalDecodeProgram.DecodeFunc" title="Permalink to this definition"></a></dt>
<dd><p>Wrap the DecodeLoop with split_compile_and_shard.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="lingvo.core.program.ExperimentalDecodeProgram.BuildTpuSubgraph">
<span class="sig-name descname"><span class="pre">BuildTpuSubgraph</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/program.html#ExperimentalDecodeProgram.BuildTpuSubgraph"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.core.program.ExperimentalDecodeProgram.BuildTpuSubgraph" title="Permalink to this definition"></a></dt>
<dd><p>Sub classes should construct a model/graph to be executed by Run.</p>
<p>Specific to TPU execution, this may involve a
&#64;tpu_function.on_device_training_loop etc.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="lingvo.core.program.ExperimentalDecodeProgram._OutfeedDequeue">
<span class="sig-name descname"><span class="pre">_OutfeedDequeue</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">decode_nm</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/program.html#ExperimentalDecodeProgram._OutfeedDequeue"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.core.program.ExperimentalDecodeProgram._OutfeedDequeue" title="Permalink to this definition"></a></dt>
<dd><p>Collect outfeed dequeue from all devices.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>decode_nm</strong> – A NestedMap containing decoded tensors.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A list of tensors corresponding to stacked decoded outputs. The decoder
outputs are stacked on the first dimension (usually corresponds to
batch size).</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="lingvo.core.program.ExperimentalDecodeProgram._DecodeLoop">
<span class="sig-name descname"><span class="pre">_DecodeLoop</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">sess</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/program.html#ExperimentalDecodeProgram._DecodeLoop"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.core.program.ExperimentalDecodeProgram._DecodeLoop" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="lingvo.core.program.ExperimentalDecodeProgram.Run">
<span class="sig-name descname"><span class="pre">Run</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">sess</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">threadpool</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/program.html#ExperimentalDecodeProgram.Run"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.core.program.ExperimentalDecodeProgram.Run" title="Permalink to this definition"></a></dt>
<dd><p>Setup and execute Decode program.</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="lingvo.core.program.MLPerfTrainDecodeProgram">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">lingvo.core.program.</span></span><span class="sig-name descname"><span class="pre">MLPerfTrainDecodeProgram</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">params</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">shared_model</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/program.html#MLPerfTrainDecodeProgram"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.core.program.MLPerfTrainDecodeProgram" title="Permalink to this definition"></a></dt>
<dd><p>Bases: <a class="reference internal" href="#lingvo.core.program.BaseProgram" title="lingvo.core.program.BaseProgram"><code class="xref py py-class docutils literal notranslate"><span class="pre">lingvo.core.program.BaseProgram</span></code></a></p>
<p>Run train/decode in a single session run.</p>
<dl class="py method">
<dt class="sig sig-object py" id="lingvo.core.program.MLPerfTrainDecodeProgram.Params">
<em class="property"><span class="pre">classmethod</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">Params</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/program.html#MLPerfTrainDecodeProgram.Params"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.core.program.MLPerfTrainDecodeProgram.Params" title="Permalink to this definition"></a></dt>
<dd><p>“Defaults parameters for Programs.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="lingvo.core.program.MLPerfTrainDecodeProgram._InitializeVizier">
<span class="sig-name descname"><span class="pre">_InitializeVizier</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/program.html#MLPerfTrainDecodeProgram._InitializeVizier"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.core.program.MLPerfTrainDecodeProgram._InitializeVizier" title="Permalink to this definition"></a></dt>
<dd><p>We never use vizier with MLPerfPrograms.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="lingvo.core.program.MLPerfTrainDecodeProgram.BuildTpuSubgraph">
<span class="sig-name descname"><span class="pre">BuildTpuSubgraph</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/program.html#MLPerfTrainDecodeProgram.BuildTpuSubgraph"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.core.program.MLPerfTrainDecodeProgram.BuildTpuSubgraph" title="Permalink to this definition"></a></dt>
<dd><p>Sub classes should construct a model/graph to be executed by Run.</p>
<p>Specific to TPU execution, this may involve a
&#64;tpu_function.on_device_training_loop etc.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="lingvo.core.program.MLPerfTrainDecodeProgram._InfeedLoop">
<span class="sig-name descname"><span class="pre">_InfeedLoop</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">sess</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/program.html#MLPerfTrainDecodeProgram._InfeedLoop"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.core.program.MLPerfTrainDecodeProgram._InfeedLoop" title="Permalink to this definition"></a></dt>
<dd><p>Infeed loop for input generator for batched data and input data stats.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="lingvo.core.program.MLPerfTrainDecodeProgram._TrainAndDecode">
<span class="sig-name descname"><span class="pre">_TrainAndDecode</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">sess</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/program.html#MLPerfTrainDecodeProgram._TrainAndDecode"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.core.program.MLPerfTrainDecodeProgram._TrainAndDecode" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="lingvo.core.program.MLPerfTrainDecodeProgram.Run">
<span class="sig-name descname"><span class="pre">Run</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">sess</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/program.html#MLPerfTrainDecodeProgram.Run"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.core.program.MLPerfTrainDecodeProgram.Run" title="Permalink to this definition"></a></dt>
<dd><p>Execute the program using the given session handle.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>sess</strong> – TF Session.</p></li>
<li><p><strong>threadpool</strong> – A ThreadPool on the executor for running async functions.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>Whether to end all execution.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>done</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="lingvo.core.program.MultiTaskProgramSchedule">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">lingvo.core.program.</span></span><span class="sig-name descname"><span class="pre">MultiTaskProgramSchedule</span></span><a class="reference internal" href="_modules/lingvo/core/program.html#MultiTaskProgramSchedule"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.core.program.MultiTaskProgramSchedule" title="Permalink to this definition"></a></dt>
<dd><p>Bases: <a class="reference external" href="https://docs.python.org/3.7/library/functions.html#object" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></a></p>
<p>Container for ProgramSchedules for a MultiTask model.</p>
<dl class="py method">
<dt class="sig sig-object py" id="lingvo.core.program.MultiTaskProgramSchedule.Params">
<em class="property"><span class="pre">classmethod</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">Params</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/program.html#MultiTaskProgramSchedule.Params"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.core.program.MultiTaskProgramSchedule.Params" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="lingvo.core.program.SimpleProgramSchedule">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">lingvo.core.program.</span></span><span class="sig-name descname"><span class="pre">SimpleProgramSchedule</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">params</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">shared_model=None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">trial=&lt;lingvo.base_trial.NoOpTrial</span> <span class="pre">object&gt;</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">**kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/program.html#SimpleProgramSchedule"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.core.program.SimpleProgramSchedule" title="Permalink to this definition"></a></dt>
<dd><p>Bases: <a class="reference external" href="https://docs.python.org/3.7/library/functions.html#object" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></a></p>
<p>A schedule of programs associated with a single task.</p>
<p>Simple sequence is:
Run train_executions_per_eval * train_program
Run all the eval_programs</p>
<dl class="py method">
<dt class="sig sig-object py" id="lingvo.core.program.SimpleProgramSchedule.Params">
<em class="property"><span class="pre">classmethod</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">Params</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/program.html#SimpleProgramSchedule.Params"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.core.program.SimpleProgramSchedule.Params" title="Permalink to this definition"></a></dt>
<dd><p>Params for a SimpleProgramSchedule.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="lingvo.core.program.SimpleProgramSchedule.Programs">
<span class="sig-name descname"><span class="pre">Programs</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/program.html#SimpleProgramSchedule.Programs"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.core.program.SimpleProgramSchedule.Programs" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="lingvo.core.program.SimpleProgramSchedule.Run">
<span class="sig-name descname"><span class="pre">Run</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">sess</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">threadpool</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/program.html#SimpleProgramSchedule.Run"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.core.program.SimpleProgramSchedule.Run" title="Permalink to this definition"></a></dt>
<dd><p>Execute the program schedule.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="lingvo.core.program.SimpleProgramSchedule.Shutdown">
<span class="sig-name descname"><span class="pre">Shutdown</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/program.html#SimpleProgramSchedule.Shutdown"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.core.program.SimpleProgramSchedule.Shutdown" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="lingvo.core.program._CreateProgramParams">
<span class="sig-prename descclassname"><span class="pre">lingvo.core.program.</span></span><span class="sig-name descname"><span class="pre">_CreateProgramParams</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">cls</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">program_name</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dataset_name</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">steps_per_loop</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/program.html#_CreateProgramParams"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.core.program._CreateProgramParams" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="lingvo.core.program.SimpleProgramScheduleForTask">
<span class="sig-prename descclassname"><span class="pre">lingvo.core.program.</span></span><span class="sig-name descname"><span class="pre">SimpleProgramScheduleForTask</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">train_dataset_name</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">train_steps_per_loop</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">eval_dataset_names</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">eval_steps_per_loop</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">decode_steps_per_loop=None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">experimental_decoder=False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">train_program_cls=&lt;class</span> <span class="pre">'lingvo.core.program.TrainProgram'&gt;</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">eval_program_cls=&lt;class</span> <span class="pre">'lingvo.core.program.EvalProgram'&gt;</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">async_postprocess=True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">decode_until_out_of_range=False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">postprocess_all_at_once=False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">emails=None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/program.html#SimpleProgramScheduleForTask"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.core.program.SimpleProgramScheduleForTask" title="Permalink to this definition"></a></dt>
<dd><p>Convenient helper method for common case.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>train_dataset_name</strong> – Name of the training dataset, eg: ‘Train’</p></li>
<li><p><strong>train_steps_per_loop</strong> – Number of steps to execute the training program.</p></li>
<li><p><strong>eval_dataset_names</strong> – List of eval dataset_name strings, eg: [‘Train’].</p></li>
<li><p><strong>eval_steps_per_loop</strong> – Number of steps to execute the eval program. Can be a
single value or a list of values corresponding to the entries in
eval_dataset_names.</p></li>
<li><p><strong>decode_steps_per_loop</strong> – Number of steps to execute the decode program. Can be
a single value or a list of values corresponding to the entries in
eval_dataset_names. If it is None, then decode_until_out_of_range must be
True.</p></li>
<li><p><strong>experimental_decoder</strong> – bool. Whether to use experimental deocder which is
placed in a tpu loop.</p></li>
<li><p><strong>train_program_cls</strong> – The class to use for training programs.  Defaults to
TrainProgram.</p></li>
<li><p><strong>eval_program_cls</strong> – The class to use for eval programs.  Defaults to
EvalProgram.</p></li>
<li><p><strong>async_postprocess</strong> – bool. Whether to run CPU postprocessing for Decode in a
separate thread to save time (i.e. concurrent with train). This avoids
blocking training. But if the CPU postprocessing takes more time compared
to Train, then multiple Train loops could complete before Decode finishes
for an older global step. Then the latest Decode results do not correspond
to the latest trained model.</p></li>
<li><p><strong>decode_until_out_of_range</strong> – bool. Whether to run Decode (and its Infeed loop)
until there is no more data (OutOfRange error is thrown). If this is True,
decode_steps_per_loop is ignored (and not required). Currently do not
support ExperimentalDecodeProgram, which uses loop on TPU. So keep
experimental_decoder=False</p></li>
<li><p><strong>postprocess_all_at_once</strong> – bool/List. Whether to postprocess the (combined)
batches at once at the end of Decode program, instead of once per step.
This is needed if one needs to reference/combine data across different
batches/steps during postprocess. The PostProcess(DecodeOut) function
should define the logic of aggregating across steps/batches. Can be a
single value or a list of values corresponding to the entries in
eval_dataset_names.</p></li>
<li><p><strong>emails</strong> – list. List of emails to email decode/scoring summaries.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A populated SimpleProgramSchedule.Params()</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="lingvo.core.program._GetDecodeStepsPerLoop">
<span class="sig-prename descclassname"><span class="pre">lingvo.core.program.</span></span><span class="sig-name descname"><span class="pre">_GetDecodeStepsPerLoop</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">decode_program</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/program.html#_GetDecodeStepsPerLoop"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.core.program._GetDecodeStepsPerLoop" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="lingvo.core.program._SetDecodeStepsPerLoop">
<span class="sig-prename descclassname"><span class="pre">lingvo.core.program.</span></span><span class="sig-name descname"><span class="pre">_SetDecodeStepsPerLoop</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">decode_program</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">steps_per_loop</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/program.html#_SetDecodeStepsPerLoop"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.core.program._SetDecodeStepsPerLoop" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="lingvo.core.program._ClearSpecifiedProgram">
<span class="sig-prename descclassname"><span class="pre">lingvo.core.program.</span></span><span class="sig-name descname"><span class="pre">_ClearSpecifiedProgram</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">program_list</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">program_cls_to_clear</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/program.html#_ClearSpecifiedProgram"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.core.program._ClearSpecifiedProgram" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="lingvo.core.program.UpdateProgramSchedule">
<span class="sig-prename descclassname"><span class="pre">lingvo.core.program.</span></span><span class="sig-name descname"><span class="pre">UpdateProgramSchedule</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ps_params</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dataset_list</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">train_executions_per_eval</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">train_steps_per_loop</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">eval_steps_per_loop</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">decode_steps_per_loop</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">decode_summary_emails</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">oneoff_checkpoint_to_load</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/program.html#UpdateProgramSchedule"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.core.program.UpdateProgramSchedule" title="Permalink to this definition"></a></dt>
<dd><p>Update ProgramSchedule params with the given new configs.</p>
<p>Currently this override only support EvalProgram and DecodeProgram.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ps_params</strong> – SimpleProgramSchedule.Params(), to be overriden.</p></li>
<li><p><strong>dataset_list</strong> – Optional[List[str]], if not None, it will override eval
datasets in ps_params.</p></li>
<li><p><strong>train_executions_per_eval</strong> – Optional[int], if not None, it will override
train_executions_per_eval in ps_params.</p></li>
<li><p><strong>train_steps_per_loop</strong> – Optional[int], if not None, it will override
train program’s steps_per_loop.</p></li>
<li><p><strong>eval_steps_per_loop</strong> – Optional[int], if not None, it will override all the
eval programs steps_per_loop. Currently list not supported.</p></li>
<li><p><strong>decode_steps_per_loop</strong> – Optional[int], if not None, it will override all the
decode programs steps_per_loop. If set to -1, it will set
decode_until_out_of_range=True. Currently list not supported.</p></li>
<li><p><strong>decode_summary_emails</strong> – List of emails to send Decode summary to.</p></li>
<li><p><strong>oneoff_checkpoint_to_load</strong> – Optional[str], if not None, it will override
eval/decode program checkpoint_to_load.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>ps_params after overriden.</p>
</dd>
</dl>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="lingvo.core.program.MLPerfProgramSchedule">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">lingvo.core.program.</span></span><span class="sig-name descname"><span class="pre">MLPerfProgramSchedule</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">params</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">shared_model</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/program.html#MLPerfProgramSchedule"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.core.program.MLPerfProgramSchedule" title="Permalink to this definition"></a></dt>
<dd><p>Bases: <a class="reference external" href="https://docs.python.org/3.7/library/functions.html#object" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></a></p>
<p>Program schedule for ML Perf benchmark.</p>
<dl class="py method">
<dt class="sig sig-object py" id="lingvo.core.program.MLPerfProgramSchedule.Params">
<em class="property"><span class="pre">classmethod</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">Params</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/program.html#MLPerfProgramSchedule.Params"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.core.program.MLPerfProgramSchedule.Params" title="Permalink to this definition"></a></dt>
<dd><p>Params for a MLPerfProgramSchedule.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="lingvo.core.program.MLPerfProgramSchedule.Programs">
<span class="sig-name descname"><span class="pre">Programs</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/program.html#MLPerfProgramSchedule.Programs"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.core.program.MLPerfProgramSchedule.Programs" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="lingvo.core.program.MLPerfProgramSchedule.Run">
<span class="sig-name descname"><span class="pre">Run</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">sess</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">threadpool</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/program.html#MLPerfProgramSchedule.Run"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.core.program.MLPerfProgramSchedule.Run" title="Permalink to this definition"></a></dt>
<dd><p>Execute the program schedule.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="lingvo.core.program.MLPerfProgramSchedule.Shutdown">
<span class="sig-name descname"><span class="pre">Shutdown</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/program.html#MLPerfProgramSchedule.Shutdown"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.core.program.MLPerfProgramSchedule.Shutdown" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="lingvo.core.program.MLPerfProgramScheduleForTask">
<span class="sig-prename descclassname"><span class="pre">lingvo.core.program.</span></span><span class="sig-name descname"><span class="pre">MLPerfProgramScheduleForTask</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">train_dataset_name</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">train_steps_per_loop</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">decode_dataset_name</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">decode_steps_per_loop</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/program.html#MLPerfProgramScheduleForTask"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.core.program.MLPerfProgramScheduleForTask" title="Permalink to this definition"></a></dt>
<dd><p>Populate MLPerfProgramSchedule params.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>train_dataset_name</strong> – Name of the training dataset, eg: ‘Train’.</p></li>
<li><p><strong>train_steps_per_loop</strong> – Number of steps to execute the training program.</p></li>
<li><p><strong>decode_dataset_name</strong> – Eg: ‘Test’.</p></li>
<li><p><strong>decode_steps_per_loop</strong> – Number of steps to execute the decode program.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A populated MLPerfProgramSchedule.Params()</p>
</dd>
</dl>
</dd></dl>

</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="lingvo.core.predictor_runner_base.html" class="btn btn-neutral float-left" title="lingvo.core.predictor_runner_base module" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="lingvo.core.pruning_utils.html" class="btn btn-neutral float-right" title="lingvo.core.pruning_utils module" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2018.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>