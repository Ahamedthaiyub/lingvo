

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>lingvo.core.py_utils module &mdash; Lingvo  documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="lingvo.core.py_utils_flags module" href="lingvo.core.py_utils_flags.html" />
    <link rel="prev" title="lingvo.core.pruning_utils module" href="lingvo.core.pruning_utils.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home" alt="Documentation Home"> Lingvo
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="lingvo.html">lingvo package</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="lingvo.html#subpackages">Subpackages</a><ul class="current">
<li class="toctree-l3 current"><a class="reference internal" href="lingvo.core.html">lingvo.core package</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="lingvo.core.html#subpackages">Subpackages</a></li>
<li class="toctree-l4 current"><a class="reference internal" href="lingvo.core.html#submodules">Submodules</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="lingvo.tasks.html">lingvo.tasks package</a></li>
<li class="toctree-l3"><a class="reference internal" href="lingvo.tools.html">lingvo.tools package</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="lingvo.html#submodules">Submodules</a></li>
</ul>
</li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Lingvo</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="lingvo.html">lingvo package</a> &raquo;</li>
        
          <li><a href="lingvo.core.html">lingvo.core package</a> &raquo;</li>
        
      <li>lingvo.core.py_utils module</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/lingvo.core.py_utils.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="module-lingvo.core.py_utils">
<span id="lingvo-core-py-utils-module"></span><h1>lingvo.core.py_utils module<a class="headerlink" href="#module-lingvo.core.py_utils" title="Permalink to this headline">¶</a></h1>
<p>Common utilities.</p>
<dl class="py class">
<dt id="lingvo.core.py_utils.ThreadLocalStack">
<em class="property">class </em><code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">ThreadLocalStack</code><a class="reference internal" href="_modules/lingvo/core/py_utils.html#ThreadLocalStack"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.ThreadLocalStack" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">_thread._local</span></code></p>
</dd></dl>

<dl class="py class">
<dt id="lingvo.core.py_utils.ThreadLocalDict">
<em class="property">class </em><code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">ThreadLocalDict</code><a class="reference internal" href="_modules/lingvo/core/py_utils.html#ThreadLocalDict"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.ThreadLocalDict" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">_thread._local</span></code></p>
</dd></dl>

<dl class="py function">
<dt id="lingvo.core.py_utils.Assert">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">Assert</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">condition</span></em>, <em class="sig-param"><span class="n">data</span></em>, <em class="sig-param"><span class="o">*</span><span class="n">args</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#Assert"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.Assert" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt id="lingvo.core.py_utils.assert_equal">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">assert_equal</code><span class="sig-paren">(</span><em class="sig-param"><span class="o">*</span><span class="n">args</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#assert_equal"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.assert_equal" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt id="lingvo.core.py_utils.assert_greater_equal">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">assert_greater_equal</code><span class="sig-paren">(</span><em class="sig-param"><span class="o">*</span><span class="n">args</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#assert_greater_equal"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.assert_greater_equal" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt id="lingvo.core.py_utils.assert_greater">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">assert_greater</code><span class="sig-paren">(</span><em class="sig-param"><span class="o">*</span><span class="n">args</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#assert_greater"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.assert_greater" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt id="lingvo.core.py_utils.assert_less_equal">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">assert_less_equal</code><span class="sig-paren">(</span><em class="sig-param"><span class="o">*</span><span class="n">args</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#assert_less_equal"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.assert_less_equal" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt id="lingvo.core.py_utils.assert_less">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">assert_less</code><span class="sig-paren">(</span><em class="sig-param"><span class="o">*</span><span class="n">args</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#assert_less"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.assert_less" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt id="lingvo.core.py_utils.assert_between">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">assert_between</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">x</span></em>, <em class="sig-param"><span class="n">l</span></em>, <em class="sig-param"><span class="n">r</span></em>, <em class="sig-param"><span class="o">*</span><span class="n">args</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#assert_between"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.assert_between" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt id="lingvo.core.py_utils.assert_shape_match">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">assert_shape_match</code><span class="sig-paren">(</span><em class="sig-param"><span class="o">*</span><span class="n">args</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#assert_shape_match"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.assert_shape_match" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt id="lingvo.core.py_utils.assert_same_dim0">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">assert_same_dim0</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">xs</span></em>, <em class="sig-param"><span class="o">*</span><span class="n">args</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#assert_same_dim0"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.assert_same_dim0" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt id="lingvo.core.py_utils.assert_even_divide">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">assert_even_divide</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">denorm</span></em>, <em class="sig-param"><span class="n">num</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#assert_even_divide"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.assert_even_divide" title="Permalink to this definition">¶</a></dt>
<dd><p>Asserts that denorm is evenly divided by num.</p>
</dd></dl>

<dl class="py function">
<dt id="lingvo.core.py_utils.AssertIdShape">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">AssertIdShape</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">expected_ids_shape_pattern</span></em>, <em class="sig-param"><span class="n">ids_shape</span></em>, <em class="sig-param"><span class="o">*</span><span class="n">args</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#AssertIdShape"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.AssertIdShape" title="Permalink to this definition">¶</a></dt>
<dd><p>Asserts shape expected_ids_shape_pattern matches all other input shapes.</p>
</dd></dl>

<dl class="py function">
<dt id="lingvo.core.py_utils._CheckNumerics">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">_CheckNumerics</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">x</span></em>, <em class="sig-param"><span class="n">message</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="o">*</span><span class="n">args</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#_CheckNumerics"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils._CheckNumerics" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt id="lingvo.core.py_utils.CheckNumerics">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">CheckNumerics</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">inp</span></em>, <em class="sig-param"><span class="n">message</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="o">*</span><span class="n">args</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#CheckNumerics"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.CheckNumerics" title="Permalink to this definition">¶</a></dt>
<dd><p>Check numerics for tensors in inp.</p>
</dd></dl>

<dl class="py function">
<dt id="lingvo.core.py_utils.with_dependencies">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">with_dependencies</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">dependencies</span></em>, <em class="sig-param"><span class="n">output_tensor</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#with_dependencies"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.with_dependencies" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt id="lingvo.core.py_utils._PrintOptions">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">_PrintOptions</code><span class="sig-paren">(</span><em class="sig-param"><span class="o">*</span><span class="n">args</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#_PrintOptions"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils._PrintOptions" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt id="lingvo.core.py_utils._Print">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">_Print</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">name</span></em>, <em class="sig-param"><span class="n">x</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#_Print"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils._Print" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt id="lingvo.core.py_utils.Log">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">Log</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">value</span></em>, <em class="sig-param"><span class="n">prefix</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#Log"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.Log" title="Permalink to this definition">¶</a></dt>
<dd><p>Prints out values of tensors.</p>
<dl class="simple">
<dt>Useful for debugging. E.g.,</dt><dd><p>x = … a tf.Tensor …
y = … a tf.Tensor …
z = compute(x, y)
z = Log(z, ‘debug compute()’, x=x, y=y)</p>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>value</strong> – A Tensor. Log happens after this tensor’s computed.</p></li>
<li><p><strong>prefix</strong> – Every tensor is logged with this prefix.</p></li>
<li><p><strong>**kwargs</strong> – keywords and tensors. Tensors are logged in the sort order of
these keywards.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>value is returned.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="lingvo.core.py_utils.Debug">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">Debug</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">tensor</span></em>, <em class="sig-param"><span class="n">message</span><span class="o">=</span><span class="default_value">''</span></em>, <em class="sig-param"><span class="n">enabled</span><span class="o">=</span><span class="default_value">True</span></em>, <em class="sig-param"><span class="n">summarize</span><span class="o">=</span><span class="default_value">100</span></em>, <em class="sig-param"><span class="n">more</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#Debug"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.Debug" title="Permalink to this definition">¶</a></dt>
<dd><p>Wrapper around tf.Print() and tf.logging.info() to simplify debug printing.</p>
<p>x = py_utils.Debug(x)</p>
<p>When the graph is built a regular log info line will be printed:
-DBG- py_utils_test.py:429 x=Tensor(…</p>
<p>Then when the tensor node is evaluated it will print lines like:
-DBG- py_utils_test.py:429 x Const:0[x.shape=][2 2][x=][[1 2][3 4]]</p>
<p>WARNING: The code that parses local variable names can fail. E.g. don’t write
two Debug() calls on one line or a Debug() call that spans more than one line.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>tensor</strong> – A tensor to print.</p></li>
<li><p><strong>message</strong> – A message to print.</p></li>
<li><p><strong>enabled</strong> – To enable the debugging.</p></li>
<li><p><strong>summarize</strong> – Integer with number of tensor values to print.</p></li>
<li><p><strong>more</strong> – An optional list of additional tensors.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>The tensor.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="lingvo.core.py_utils._Save">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">_Save</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">steps</span></em>, <em class="sig-param"><span class="n">prefix</span></em>, <em class="sig-param"><span class="n">key</span></em>, <em class="sig-param"><span class="n">val</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#_Save"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils._Save" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt id="lingvo.core.py_utils.Save">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">Save</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">value</span></em>, <em class="sig-param"><span class="n">filename_prefix</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#Save"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.Save" title="Permalink to this definition">¶</a></dt>
<dd><p>Saves values of tensors into files.</p>
<dl class="simple">
<dt>Useful for debugging. E.g.,</dt><dd><p>x = … a tf.Tensor …
y = … a tf.Tensor …
z = compute(x, y)
z = Save(z, ‘/path/tmp’, x=x, y=y, z=z)</p>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>value</strong> – A Tensor. Saving happens after this tensor is computed.</p></li>
<li><p><strong>filename_prefix</strong> – Every tensor is saved with this filename prefix.</p></li>
<li><p><strong>**kwargs</strong> – keywords and tensors. Tensors are logged in the sort order of
these keywards.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>value is returned.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="lingvo.core.py_utils.HasRank">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">HasRank</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">tensor</span></em>, <em class="sig-param"><span class="n">expected_rank</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#HasRank"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.HasRank" title="Permalink to this definition">¶</a></dt>
<dd><p>Syntactic sugar for asserting that tensor has the expected rank.</p>
</dd></dl>

<dl class="py function">
<dt id="lingvo.core.py_utils.HasAtLeastRank">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">HasAtLeastRank</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">tensor</span></em>, <em class="sig-param"><span class="n">expected_rank</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#HasAtLeastRank"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.HasAtLeastRank" title="Permalink to this definition">¶</a></dt>
<dd><p>Syntactic sugar for asserting that tensor has rank &gt;= expected_rank.</p>
</dd></dl>

<dl class="py function">
<dt id="lingvo.core.py_utils.GetRank">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">GetRank</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">tensor</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#GetRank"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.GetRank" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns tensor’s rank as an int if it’s available, otherwise a Tensor.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>tensor</strong> – The input tensor.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>Either an int or a Tensor for the rank of the input tensor.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="lingvo.core.py_utils.GetShape">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">GetShape</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">tensor</span></em>, <em class="sig-param"><span class="n">ndims</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#GetShape"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.GetShape" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns tensor’s shape as a list which can be unpacked, unlike tf.shape.</p>
<p>Tries to return static shape if it’s available. Note that this means
some of the outputs will be ints while the rest will be Tensors.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>tensor</strong> – The input tensor.</p></li>
<li><p><strong>ndims</strong> – If not None, returns the shapes for the first <code class="xref py py-obj docutils literal notranslate"><span class="pre">ndims</span></code> dimensions.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="lingvo.core.py_utils.HasShape">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">HasShape</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">tensor</span></em>, <em class="sig-param"><span class="n">expected_shape</span></em>, <em class="sig-param"><span class="n">ndims</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#HasShape"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.HasShape" title="Permalink to this definition">¶</a></dt>
<dd><p>Syntactic sugar for asserting that tensor has the expected shape.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>tensor</strong> – A Tensor.</p></li>
<li><p><strong>expected_shape</strong> – A Python list or a 1D tensor. Elements of expected_shape can
be -1 which indicate that any size is valid for that dimension.</p></li>
<li><p><strong>ndims</strong> – If not None, check only the first <code class="xref py py-obj docutils literal notranslate"><span class="pre">ndims</span></code> dimensions of <code class="xref py py-obj docutils literal notranslate"><span class="pre">tensor</span></code>.
Must be equal to the length of <code class="xref py py-obj docutils literal notranslate"><span class="pre">expected_shape</span></code> if not None.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>The input <code class="xref py py-obj docutils literal notranslate"><span class="pre">tensor</span></code> with control dependencies that will raise a runtime
error if dynamic shape checks fail.</p>
</dd>
<dt class="field-odd">Raises</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3.7/library/exceptions.html#ValueError" title="(in Python v3.7)"><strong>ValueError</strong></a> – A value error if the assertion fails at static shape checks.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="lingvo.core.py_utils.GetSize">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">GetSize</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">tensor</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#GetSize"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.GetSize" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt id="lingvo.core.py_utils.CausalSelfAttenPadding">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">CausalSelfAttenPadding</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">seqlen</span></em>, <em class="sig-param"><span class="n">dtype</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#CausalSelfAttenPadding"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.CausalSelfAttenPadding" title="Permalink to this definition">¶</a></dt>
<dd><p>Wraps tf.linalg.band_part() for tflite compatibility.</p>
</dd></dl>

<dl class="py function">
<dt id="lingvo.core.py_utils.outside_all_rewrites">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">outside_all_rewrites</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#outside_all_rewrites"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.outside_all_rewrites" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt id="lingvo.core.py_utils.RunOnTpuHost">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">RunOnTpuHost</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">func</span></em>, <em class="sig-param"><span class="o">*</span><span class="n">args</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#RunOnTpuHost"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.RunOnTpuHost" title="Permalink to this definition">¶</a></dt>
<dd><p>Runs the given function call on TPU host.</p>
<p>Invokes func(*args, **kwargs) directly if not running on tpu.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>func</strong> – the function to invoke.</p></li>
<li><p><strong>*args</strong> – args of func</p></li>
<li><p><strong>**kwargs</strong> – kwargs of func</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>The function return value.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="lingvo.core.py_utils.tpu_host">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">tpu_host</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">func</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#tpu_host"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.tpu_host" title="Permalink to this definition">¶</a></dt>
<dd><p>Decorates a python function to only run on TPU hosts.</p>
<p>This function has no effect when running on CPU/GPU.</p>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@py_utils</span><span class="o">.</span><span class="n">tpu_host</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">ComputeWER</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
  <span class="c1"># Call a custom op computing WER.</span>
</pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>func</strong> – the function to invoke</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A TPU-host only function</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="lingvo.core.py_utils.SetTpuDeviceAssignment">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">SetTpuDeviceAssignment</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">tpu_device_assignment</span></em>, <em class="sig-param"><span class="n">job</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#SetTpuDeviceAssignment"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.SetTpuDeviceAssignment" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt id="lingvo.core.py_utils.ClearTpuDevice">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">ClearTpuDevice</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#ClearTpuDevice"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.ClearTpuDevice" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt id="lingvo.core.py_utils.GetTpuDeviceAssignment">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">GetTpuDeviceAssignment</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">job</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#GetTpuDeviceAssignment"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.GetTpuDeviceAssignment" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt id="lingvo.core.py_utils.SessionConfig">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">SessionConfig</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">soft_placement</span><span class="o">=</span><span class="default_value">True</span></em>, <em class="sig-param"><span class="n">inline</span><span class="o">=</span><span class="default_value">True</span></em>, <em class="sig-param"><span class="n">cluster_def</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">disable_meta_optimizer</span><span class="o">=</span><span class="default_value">False</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#SessionConfig"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.SessionConfig" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a session config proto.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>soft_placement</strong> – Turns allow_soft_placement on iff True.</p></li>
<li><p><strong>inline</strong> – Turns do_function_inlining on iff True.</p></li>
<li><p><strong>cluster_def</strong> – A tf.train.ClusterDef describing the cluster.</p></li>
<li><p><strong>disable_meta_optimizer</strong> – Turns off grappler/metagraph optimizer.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A TF session config proto.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="lingvo.core.py_utils.AssertIsCompatible">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">AssertIsCompatible</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">a</span></em>, <em class="sig-param"><span class="n">b</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#AssertIsCompatible"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.AssertIsCompatible" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt id="lingvo.core.py_utils.SetShapes">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">SetShapes</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">dst_nmap</span></em>, <em class="sig-param"><span class="n">src_nmap</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#SetShapes"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.SetShapes" title="Permalink to this definition">¶</a></dt>
<dd><p>Set shapes in dst_nmap using those in src_nmap.</p>
</dd></dl>

<dl class="py function">
<dt id="lingvo.core.py_utils.Dtypes">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">Dtypes</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">nmap_list</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#Dtypes"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.Dtypes" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns all tensors’ data types in a list.</p>
</dd></dl>

<dl class="py function">
<dt id="lingvo.core.py_utils.Flatten">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">Flatten</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">x</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#Flatten"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.Flatten" title="Permalink to this definition">¶</a></dt>
<dd><p>Flattens ‘x’ by extracting tensors from nested structures to a list.</p>
</dd></dl>

<dl class="py function">
<dt id="lingvo.core.py_utils.Pack">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">Pack</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">tmpl</span></em>, <em class="sig-param"><span class="n">values</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#Pack"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.Pack" title="Permalink to this definition">¶</a></dt>
<dd><p>Packs ‘values’ according to ‘tmpl’.</p>
</dd></dl>

<dl class="py function">
<dt id="lingvo.core.py_utils.Transform">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">Transform</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">fn</span></em>, <em class="sig-param"><span class="o">*</span><span class="n">v</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#Transform"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.Transform" title="Permalink to this definition">¶</a></dt>
<dd><p>Replaces every nested value x in ‘v’ with fn(x) and returns the result.</p>
</dd></dl>

<dl class="py function">
<dt id="lingvo.core.py_utils.ConvertNoneGradientToZeros">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">ConvertNoneGradientToZeros</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">xs</span></em>, <em class="sig-param"><span class="n">dxs</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#ConvertNoneGradientToZeros"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.ConvertNoneGradientToZeros" title="Permalink to this definition">¶</a></dt>
<dd><p>Sanitize dxs so that None becomes zeros appropriately.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>xs</strong> – A list of tensors.</p></li>
<li><p><strong>dxs</strong> – A list of tensors. dxs[i] corresponds to xs[i]’s gradient.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A <a class="reference internal" href="#lingvo.core.py_utils.NestedMap" title="lingvo.core.py_utils.NestedMap"><code class="xref py py-obj docutils literal notranslate"><span class="pre">NestedMap</span></code></a> same as dxs with None replaced by a zero tensor.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="lingvo.core.py_utils.IsCompatible">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">IsCompatible</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">lhs</span></em>, <em class="sig-param"><span class="n">rhs</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#IsCompatible"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.IsCompatible" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns true if lhs and rhs are compatible.</p>
</dd></dl>

<dl class="py class">
<dt id="lingvo.core.py_utils.NestedMap">
<em class="property">class </em><code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">NestedMap</code><span class="sig-paren">(</span><em class="sig-param"><span class="o">*</span><span class="n">args</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#NestedMap"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.NestedMap" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference external" href="https://docs.python.org/3.7/library/stdtypes.html#dict" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">dict</span></code></a></p>
<p>A simple helper to maintain a dict.</p>
<dl class="simple">
<dt>It is a sub-class of dict with the following extensions/restrictions:</dt><dd><ul class="simple">
<li><p>It supports attr access to its members (see examples below).</p></li>
<li><p>Member keys have to be valid identifiers.</p></li>
</ul>
</dd>
</dl>
<p>E.g.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">foo</span> <span class="o">=</span> <span class="n">NestedMap</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">foo</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">foo</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="mi">20</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">foo</span><span class="o">.</span><span class="n">x</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">==</span> <span class="n">foo</span><span class="o">.</span><span class="n">y</span>
</pre></div>
</div>
<dl class="py attribute">
<dt id="lingvo.core.py_utils.NestedMap._HAS_DYNAMIC_ATTRIBUTES">
<code class="sig-name descname">_HAS_DYNAMIC_ATTRIBUTES</code><em class="property"> = True</em><a class="headerlink" href="#lingvo.core.py_utils.NestedMap._HAS_DYNAMIC_ATTRIBUTES" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt id="lingvo.core.py_utils.NestedMap._RESERVED_KEYS">
<code class="sig-name descname">_RESERVED_KEYS</code><em class="property"> = frozenset({'__class__', '__contains__', '__delattr__', '__delitem__', '__dir__', '__doc__', '__eq__', '__format__', '__ge__', '__getattribute__', '__getitem__', '__gt__', '__hash__', '__init__', '__init_subclass__', '__iter__', '__le__', '__len__', '__lt__', '__ne__', '__new__', '__reduce__', '__reduce_ex__', '__repr__', '__reversed__', '__setattr__', '__setitem__', '__sizeof__', '__str__', '__subclasshook__', 'clear', 'copy', 'fromkeys', 'get', 'items', 'keys', 'pop', 'popitem', 'setdefault', 'update', 'values'})</em><a class="headerlink" href="#lingvo.core.py_utils.NestedMap._RESERVED_KEYS" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt id="lingvo.core.py_utils.NestedMap._DELETE">
<code class="sig-name descname">_DELETE</code><em class="property"> = &lt;object object&gt;</em><a class="headerlink" href="#lingvo.core.py_utils.NestedMap._DELETE" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt id="lingvo.core.py_utils.NestedMap.copy">
<code class="sig-name descname">copy</code><span class="sig-paren">(</span><span class="sig-paren">)</span> &#x2192; a shallow copy of D<a class="reference internal" href="_modules/lingvo/core/py_utils.html#NestedMap.copy"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.NestedMap.copy" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt id="lingvo.core.py_utils.NestedMap.DeepCopy">
<code class="sig-name descname">DeepCopy</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#NestedMap.DeepCopy"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.NestedMap.DeepCopy" title="Permalink to this definition">¶</a></dt>
<dd><p>Deep-copies the structure but not the leaf objects.</p>
</dd></dl>

<dl class="py method">
<dt id="lingvo.core.py_utils.NestedMap.FromNestedDict">
<em class="property">static </em><code class="sig-name descname">FromNestedDict</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">x</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#NestedMap.FromNestedDict"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.NestedMap.FromNestedDict" title="Permalink to this definition">¶</a></dt>
<dd><p>Converts every dict in nested structure ‘x’ to a NestedMap.</p>
</dd></dl>

<dl class="py method">
<dt id="lingvo.core.py_utils.NestedMap.CheckKey">
<em class="property">static </em><code class="sig-name descname">CheckKey</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">key</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#NestedMap.CheckKey"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.NestedMap.CheckKey" title="Permalink to this definition">¶</a></dt>
<dd><p>Asserts that key is valid NestedMap key.</p>
</dd></dl>

<dl class="py method">
<dt id="lingvo.core.py_utils.NestedMap.SquareBracketIndex">
<em class="property">static </em><code class="sig-name descname">SquareBracketIndex</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">key</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#NestedMap.SquareBracketIndex"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.NestedMap.SquareBracketIndex" title="Permalink to this definition">¶</a></dt>
<dd><p>Extracts the name and the index from the indexed key (e.g., k[0]).</p>
</dd></dl>

<dl class="py method">
<dt id="lingvo.core.py_utils.NestedMap.GetItem">
<code class="sig-name descname">GetItem</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">key</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#NestedMap.GetItem"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.NestedMap.GetItem" title="Permalink to this definition">¶</a></dt>
<dd><p>Gets the value for the nested <code class="xref py py-obj docutils literal notranslate"><span class="pre">key</span></code>.</p>
<p>Note that indexing lists is not supported, names with underscores will be
considered as one key.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>key</strong> – str of the form
<code class="xref py py-obj docutils literal notranslate"><span class="pre">([A-Za-z_][A-Za-z0-9_]*)(.[A-Za-z_][A-Za-z0-9_]*)*.</span></code>.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>The value for the given nested key.</p>
</dd>
<dt class="field-odd">Raises</dt>
<dd class="field-odd"><ul class="simple">
<li><p><a class="reference external" href="https://docs.python.org/3.7/library/exceptions.html#KeyError" title="(in Python v3.7)"><strong>KeyError</strong></a> – if a key is not present.</p></li>
<li><p><a class="reference external" href="https://docs.python.org/3.7/library/exceptions.html#IndexError" title="(in Python v3.7)"><strong>IndexError</strong></a> – when an intermediate item is a list and we try to access
    an element which is out of range.</p></li>
<li><p><a class="reference external" href="https://docs.python.org/3.7/library/exceptions.html#TypeError" title="(in Python v3.7)"><strong>TypeError</strong></a> – when an intermediate item is a list and we try to access
    an element of it with a string.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="lingvo.core.py_utils.NestedMap.Get">
<code class="sig-name descname">Get</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">key</span></em>, <em class="sig-param"><span class="n">default</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#NestedMap.Get"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.NestedMap.Get" title="Permalink to this definition">¶</a></dt>
<dd><p>Gets the value for nested <code class="xref py py-obj docutils literal notranslate"><span class="pre">key</span></code>, returns <code class="xref py py-obj docutils literal notranslate"><span class="pre">default</span></code> if key does not exist.</p>
<p>Note that indexing lists is not supported, names with underscores will be
considered as one key.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>key</strong> – str of the form
<code class="xref py py-obj docutils literal notranslate"><span class="pre">([A-Za-z_][A-Za-z0-9_]*)(.[A-Za-z_][A-Za-z0-9_]*)*.</span></code>.</p></li>
<li><p><strong>default</strong> – Optional default value, defaults to None.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>The value for the given nested key or <code class="xref py py-obj docutils literal notranslate"><span class="pre">default</span></code> if the key does not exist.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="lingvo.core.py_utils.NestedMap.Set">
<code class="sig-name descname">Set</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">key</span></em>, <em class="sig-param"><span class="n">value</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#NestedMap.Set"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.NestedMap.Set" title="Permalink to this definition">¶</a></dt>
<dd><p>Sets the value for a nested key.</p>
<p>There is limited support for indexing lists when square bracket indexing is
used, e.g., key[0], key[1], etc. Names with underscores will be considered
as one key. When key[idx] is set, all of the values with indices before idx
must be already set. E.g., setting key=’a[2]’ to value=42 when
key=’a’ wasn’t referenced before will throw a ValueError. Setting key=’a[0]’
will not.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>key</strong> – str of the form key_part1.key_part2…key_partN where each key_part
is of the form <code class="xref py py-obj docutils literal notranslate"><span class="pre">[A-Za-z_][A-Za-z0-9_]*</span></code> or
<code class="xref py py-obj docutils literal notranslate"><span class="pre">[A-Za-z_][A-Za-z0-9_]*[d+]</span></code></p></li>
<li><p><strong>value</strong> – The value to insert.</p></li>
</ul>
</dd>
<dt class="field-even">Raises</dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>ValueError if a sub key is not a NestedMap</strong><strong> or </strong><a class="reference external" href="https://docs.python.org/3.7/library/stdtypes.html#dict" title="(in Python v3.7)"><strong>dict</strong></a><strong> or </strong><strong>idx &gt; list length</strong> – </p></li>
<li><p><strong>for key='key</strong><strong>[</strong><strong>idx</strong><strong>]</strong><strong>'.</strong> – </p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="lingvo.core.py_utils.NestedMap._RecursiveMap">
<code class="sig-name descname">_RecursiveMap</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">fn</span></em>, <em class="sig-param"><span class="n">flatten</span><span class="o">=</span><span class="default_value">False</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#NestedMap._RecursiveMap"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.NestedMap._RecursiveMap" title="Permalink to this definition">¶</a></dt>
<dd><p>Traverse recursively into lists, dicts, and NestedMaps applying <code class="xref py py-obj docutils literal notranslate"><span class="pre">fn</span></code>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>fn</strong> – The function to apply to each item (leaf node).</p></li>
<li><p><strong>flatten</strong> – If true, the result should be a single flat list. Otherwise the
result will have the same structure as this NestedMap.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>The result of applying fn.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="lingvo.core.py_utils.NestedMap.Flatten">
<code class="sig-name descname">Flatten</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#NestedMap.Flatten"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.NestedMap.Flatten" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a list containing the flattened values in the <a class="reference internal" href="#lingvo.core.py_utils.NestedMap" title="lingvo.core.py_utils.NestedMap"><code class="xref py py-obj docutils literal notranslate"><span class="pre">NestedMap</span></code></a>.</p>
<p>Unlike py_utils.Flatten(), this will only descend into lists, dicts, and
NestedMaps and not tuples, or namedtuples.</p>
</dd></dl>

<dl class="py method">
<dt id="lingvo.core.py_utils.NestedMap.FlattenItems">
<code class="sig-name descname">FlattenItems</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#NestedMap.FlattenItems"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.NestedMap.FlattenItems" title="Permalink to this definition">¶</a></dt>
<dd><p>Flatten the <a class="reference internal" href="#lingvo.core.py_utils.NestedMap" title="lingvo.core.py_utils.NestedMap"><code class="xref py py-obj docutils literal notranslate"><span class="pre">NestedMap</span></code></a> and returns &lt;key, value&gt; pairs in a list.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>A list of &lt;key, value&gt; pairs, where keys for nested entries will be
represented in the form of <code class="xref py py-obj docutils literal notranslate"><span class="pre">foo.bar[10].baz</span></code>.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="lingvo.core.py_utils.NestedMap.Pack">
<code class="sig-name descname">Pack</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">lst</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#NestedMap.Pack"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.NestedMap.Pack" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a copy of this with each value replaced by a value in lst.</p>
</dd></dl>

<dl class="py method">
<dt id="lingvo.core.py_utils.NestedMap.Transform">
<code class="sig-name descname">Transform</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">fn</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#NestedMap.Transform"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.NestedMap.Transform" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a copy of this <a class="reference internal" href="#lingvo.core.py_utils.NestedMap" title="lingvo.core.py_utils.NestedMap"><code class="xref py py-obj docutils literal notranslate"><span class="pre">NestedMap</span></code></a> with fn applied on each value.</p>
</dd></dl>

<dl class="py method">
<dt id="lingvo.core.py_utils.NestedMap.TransformWithKey">
<code class="sig-name descname">TransformWithKey</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">fn</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#NestedMap.TransformWithKey"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.NestedMap.TransformWithKey" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a copy of this <a class="reference internal" href="#lingvo.core.py_utils.NestedMap" title="lingvo.core.py_utils.NestedMap"><code class="xref py py-obj docutils literal notranslate"><span class="pre">NestedMap</span></code></a> with fn applied on each key/value.</p>
</dd></dl>

<dl class="py method">
<dt id="lingvo.core.py_utils.NestedMap.IsCompatible">
<code class="sig-name descname">IsCompatible</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">other</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#NestedMap.IsCompatible"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.NestedMap.IsCompatible" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns true if self and other are compatible.</p>
<p>If x and y are two compatible <a class="reference internal" href="#lingvo.core.py_utils.NestedMap" title="lingvo.core.py_utils.NestedMap"><code class="xref py py-obj docutils literal notranslate"><span class="pre">NestedMap</span></code></a>, <code class="xref py py-obj docutils literal notranslate"><span class="pre">x.Pack(y.Flatten())</span></code> produces y
and vice versa.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>other</strong> – Another <a class="reference internal" href="#lingvo.core.py_utils.NestedMap" title="lingvo.core.py_utils.NestedMap"><code class="xref py py-obj docutils literal notranslate"><span class="pre">NestedMap</span></code></a>.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="lingvo.core.py_utils.NestedMap.Filter">
<code class="sig-name descname">Filter</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">fn</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#NestedMap.Filter"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.NestedMap.Filter" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a copy with entries where fn(entry) is True.</p>
</dd></dl>

<dl class="py method">
<dt id="lingvo.core.py_utils.NestedMap.FilterKeyVal">
<code class="sig-name descname">FilterKeyVal</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">fn</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#NestedMap.FilterKeyVal"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.NestedMap.FilterKeyVal" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a copy of this <a class="reference internal" href="#lingvo.core.py_utils.NestedMap" title="lingvo.core.py_utils.NestedMap"><code class="xref py py-obj docutils literal notranslate"><span class="pre">NestedMap</span></code></a> filtered by fn.</p>
<p>If fn(key, entry) is True, the entry is copied into the returned NestedMap.
Otherwise, it is not copied.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>fn</strong> – a callable of (string, entry)-&gt;boolean.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A <a class="reference internal" href="#lingvo.core.py_utils.NestedMap" title="lingvo.core.py_utils.NestedMap"><code class="xref py py-obj docutils literal notranslate"><span class="pre">NestedMap</span></code></a> contains copied entries from this <code class="xref py py-obj docutils literal notranslate"><span class="pre">'.NestedMap</span></code>.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="lingvo.core.py_utils.NestedMap._ToStrings">
<code class="sig-name descname">_ToStrings</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#NestedMap._ToStrings"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.NestedMap._ToStrings" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns debug strings in a list for this <a class="reference internal" href="#lingvo.core.py_utils.NestedMap" title="lingvo.core.py_utils.NestedMap"><code class="xref py py-obj docutils literal notranslate"><span class="pre">NestedMap</span></code></a>.</p>
</dd></dl>

<dl class="py method">
<dt id="lingvo.core.py_utils.NestedMap.DebugString">
<code class="sig-name descname">DebugString</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#NestedMap.DebugString"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.NestedMap.DebugString" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a debug string for this <a class="reference internal" href="#lingvo.core.py_utils.NestedMap" title="lingvo.core.py_utils.NestedMap"><code class="xref py py-obj docutils literal notranslate"><span class="pre">NestedMap</span></code></a>.</p>
</dd></dl>

<dl class="py method">
<dt id="lingvo.core.py_utils.NestedMap.VLog">
<code class="sig-name descname">VLog</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">level</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">prefix</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#NestedMap.VLog"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.NestedMap.VLog" title="Permalink to this definition">¶</a></dt>
<dd><p>Logs the debug string at the level.</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt id="lingvo.core.py_utils._Unique">
<em class="property">class </em><code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">_Unique</code><a class="reference internal" href="_modules/lingvo/core/py_utils.html#_Unique"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils._Unique" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference external" href="https://docs.python.org/3.7/library/functions.html#object" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></a></p>
<p>A helper to uniqify variables in a NestedMap.</p>
</dd></dl>

<dl class="py function">
<dt id="lingvo.core.py_utils.ToUniqueList">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">ToUniqueList</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">nmap</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#ToUniqueList"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.ToUniqueList" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the flattened <code class="xref py py-obj docutils literal notranslate"><span class="pre">nmap</span></code> with duplicates removed.</p>
</dd></dl>

<dl class="py function">
<dt id="lingvo.core.py_utils.ReadOnlyAttrDictView">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">ReadOnlyAttrDictView</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">backing</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#ReadOnlyAttrDictView"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.ReadOnlyAttrDictView" title="Permalink to this definition">¶</a></dt>
<dd><p>Wraps a dict to provide a read-only view of its contents.</p>
<p>Dict keys can also be accessed by attribute.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>backing</strong> – Dict-like object to wrap.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>Read-only Mapping that can be accessed by index ([‘foo’]) or attr (d.foo).</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="lingvo.core.py_utils.ToStaticShape">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">ToStaticShape</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">shape</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#ToStaticShape"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.ToStaticShape" title="Permalink to this definition">¶</a></dt>
<dd><p>Converts ‘shape’ to a static shape.</p>
</dd></dl>

<dl class="py function">
<dt id="lingvo.core.py_utils.Zeros">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">Zeros</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">shape</span></em>, <em class="sig-param"><span class="o">*</span><span class="n">args</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#Zeros"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.Zeros" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py class">
<dt id="lingvo.core.py_utils.UniformSampler">
<em class="property">class </em><code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">UniformSampler</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">num_samples</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#UniformSampler"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.UniformSampler" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference external" href="https://docs.python.org/3.7/library/functions.html#object" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></a></p>
<p>A reservoir sampler.</p>
<p>This class implements reservoir sampling: Given a limit of <code class="xref py py-obj docutils literal notranslate"><span class="pre">num_samples</span></code> total
samples, this class maintains a uniform probability (1 / <code class="xref py py-obj docutils literal notranslate"><span class="pre">num_samples</span></code>) of
keeping any item dynamically added to the sampler.</p>
<p>See <a class="reference external" href="https://en.wikipedia.org/wiki/Reservoir_sampling">https://en.wikipedia.org/wiki/Reservoir_sampling</a> for details.</p>
<dl class="py method">
<dt id="lingvo.core.py_utils.UniformSampler.Add">
<code class="sig-name descname">Add</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">item</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#UniformSampler.Add"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.UniformSampler.Add" title="Permalink to this definition">¶</a></dt>
<dd><p>Add item to sampler.</p>
</dd></dl>

<dl class="py method">
<dt id="lingvo.core.py_utils.UniformSampler.samples">
<em class="property">property </em><code class="sig-name descname">samples</code><a class="headerlink" href="#lingvo.core.py_utils.UniformSampler.samples" title="Permalink to this definition">¶</a></dt>
<dd><p>Fetch the current samples from the sampler.</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt id="lingvo.core.py_utils.RNNCellStateInit">
<em class="property">class </em><code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">RNNCellStateInit</code><a class="reference internal" href="_modules/lingvo/core/py_utils.html#RNNCellStateInit"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.RNNCellStateInit" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference external" href="https://docs.python.org/3.7/library/functions.html#object" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></a></p>
<p>State initialization functions for RNN cell init state.</p>
<dl class="py method">
<dt id="lingvo.core.py_utils.RNNCellStateInit._Params">
<em class="property">static </em><code class="sig-name descname">_Params</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">method</span></em>, <em class="sig-param"><span class="n">seed</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#RNNCellStateInit._Params"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.RNNCellStateInit._Params" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt id="lingvo.core.py_utils.RNNCellStateInit.Zeros">
<em class="property">static </em><code class="sig-name descname">Zeros</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#RNNCellStateInit.Zeros"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.RNNCellStateInit.Zeros" title="Permalink to this definition">¶</a></dt>
<dd><p>tf.zeros().</p>
</dd></dl>

<dl class="py method">
<dt id="lingvo.core.py_utils.RNNCellStateInit.RandomNormal">
<em class="property">static </em><code class="sig-name descname">RandomNormal</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">seed</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#RNNCellStateInit.RandomNormal"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.RNNCellStateInit.RandomNormal" title="Permalink to this definition">¶</a></dt>
<dd><p>tf.random.normal().</p>
</dd></dl>

</dd></dl>

<dl class="py function">
<dt id="lingvo.core.py_utils.DefaultRNNCellStateInit">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">DefaultRNNCellStateInit</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#DefaultRNNCellStateInit"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.DefaultRNNCellStateInit" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt id="lingvo.core.py_utils.InitRNNCellState">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">InitRNNCellState</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">shape</span></em>, <em class="sig-param"><span class="n">init</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">dtype</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">name</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">is_eval</span><span class="o">=</span><span class="default_value">False</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#InitRNNCellState"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.InitRNNCellState" title="Permalink to this definition">¶</a></dt>
<dd><p>Initial state definitions for RNN cell implementations.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>shape</strong> – A array of ints/symbols for specifying the shape of the state.</p></li>
<li><p><strong>init</strong> – Hyperparameters as returned by one of the static implemetaitons in
RNNCellStateInit.</p></li>
<li><p><strong>dtype</strong> – The dype of the states. Defaults to tf.float32.</p></li>
<li><p><strong>name</strong> – A name for the operation. If –stateless_vars_init is set, this name
is used to generate a seed on a per-variable basis. Otherwise, this name
is optional.</p></li>
<li><p><strong>is_eval</strong> – Bool, set to True if we need special behavior in eval mode.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A Tensor of the specified shape, and sampled from the distribution as
defined by the init parameters.</p>
</dd>
</dl>
</dd></dl>

<dl class="py class">
<dt id="lingvo.core.py_utils.WeightInit">
<em class="property">class </em><code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">WeightInit</code><a class="reference internal" href="_modules/lingvo/core/py_utils.html#WeightInit"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.WeightInit" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference external" href="https://docs.python.org/3.7/library/functions.html#object" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></a></p>
<p>Static class providing weight initialization config params.</p>
<dl class="py method">
<dt id="lingvo.core.py_utils.WeightInit._Params">
<em class="property">static </em><code class="sig-name descname">_Params</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">method</span></em>, <em class="sig-param"><span class="n">scale</span></em>, <em class="sig-param"><span class="n">seed</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#WeightInit._Params"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.WeightInit._Params" title="Permalink to this definition">¶</a></dt>
<dd><p>Parameters of this class.</p>
</dd></dl>

<dl class="py method">
<dt id="lingvo.core.py_utils.WeightInit.Gaussian">
<em class="property">static </em><code class="sig-name descname">Gaussian</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">scale</span><span class="o">=</span><span class="default_value">1.0</span></em>, <em class="sig-param"><span class="n">seed</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#WeightInit.Gaussian"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.WeightInit.Gaussian" title="Permalink to this definition">¶</a></dt>
<dd><p>scale * tf.random.normal(0, 1.0).</p>
</dd></dl>

<dl class="py method">
<dt id="lingvo.core.py_utils.WeightInit.Uniform">
<em class="property">static </em><code class="sig-name descname">Uniform</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">scale</span><span class="o">=</span><span class="default_value">1.0</span></em>, <em class="sig-param"><span class="n">seed</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#WeightInit.Uniform"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.WeightInit.Uniform" title="Permalink to this definition">¶</a></dt>
<dd><p>scale * tf.random.uniform(-1.0, 1.0).</p>
</dd></dl>

<dl class="py method">
<dt id="lingvo.core.py_utils.WeightInit.UniformPositive">
<em class="property">static </em><code class="sig-name descname">UniformPositive</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">scale</span><span class="o">=</span><span class="default_value">1.0</span></em>, <em class="sig-param"><span class="n">seed</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#WeightInit.UniformPositive"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.WeightInit.UniformPositive" title="Permalink to this definition">¶</a></dt>
<dd><p>scale * tf.random.uniform(0., 1.0).</p>
</dd></dl>

<dl class="py method">
<dt id="lingvo.core.py_utils.WeightInit.Category">
<em class="property">static </em><code class="sig-name descname">Category</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">scale</span><span class="o">=</span><span class="default_value">2</span></em>, <em class="sig-param"><span class="n">seed</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#WeightInit.Category"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.WeightInit.Category" title="Permalink to this definition">¶</a></dt>
<dd><p>tf.floor(scale * tf.random.uniform(0., 1.0)).</p>
</dd></dl>

<dl class="py method">
<dt id="lingvo.core.py_utils.WeightInit.Xavier">
<em class="property">static </em><code class="sig-name descname">Xavier</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">scale</span><span class="o">=</span><span class="default_value">1.0</span></em>, <em class="sig-param"><span class="n">seed</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#WeightInit.Xavier"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.WeightInit.Xavier" title="Permalink to this definition">¶</a></dt>
<dd><p>Xavier initialization (x = sqrt(6. / (in + out)); [-x, x]).</p>
</dd></dl>

<dl class="py method">
<dt id="lingvo.core.py_utils.WeightInit.XavierWithFixupParams">
<em class="property">static </em><code class="sig-name descname">XavierWithFixupParams</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">scale</span><span class="o">=</span><span class="default_value">1.0</span></em>, <em class="sig-param"><span class="n">depth</span><span class="o">=</span><span class="default_value">1.0</span></em>, <em class="sig-param"><span class="n">layers_per_residual_block</span><span class="o">=</span><span class="default_value">1.0</span></em>, <em class="sig-param"><span class="n">seed</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#WeightInit.XavierWithFixupParams"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.WeightInit.XavierWithFixupParams" title="Permalink to this definition">¶</a></dt>
<dd><p>Xavier initialization with Fixup.</p>
</dd></dl>

<dl class="py method">
<dt id="lingvo.core.py_utils.WeightInit.GeoMeanXavier">
<em class="property">static </em><code class="sig-name descname">GeoMeanXavier</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">scale</span><span class="o">=</span><span class="default_value">1.0</span></em>, <em class="sig-param"><span class="n">seed</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#WeightInit.GeoMeanXavier"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.WeightInit.GeoMeanXavier" title="Permalink to this definition">¶</a></dt>
<dd><p>A variant of Xavier (x = sqrt(3. / sqrt(in * out)); [-x, x]).</p>
</dd></dl>

<dl class="py method">
<dt id="lingvo.core.py_utils.WeightInit.Constant">
<em class="property">static </em><code class="sig-name descname">Constant</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">scale</span><span class="o">=</span><span class="default_value">1.0</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#WeightInit.Constant"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.WeightInit.Constant" title="Permalink to this definition">¶</a></dt>
<dd><p>scale.</p>
</dd></dl>

<dl class="py method">
<dt id="lingvo.core.py_utils.WeightInit.TruncatedGaussian">
<em class="property">static </em><code class="sig-name descname">TruncatedGaussian</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">scale</span><span class="o">=</span><span class="default_value">1.0</span></em>, <em class="sig-param"><span class="n">seed</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#WeightInit.TruncatedGaussian"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.WeightInit.TruncatedGaussian" title="Permalink to this definition">¶</a></dt>
<dd><p>scale * tf.random.truncated_normal(0, 1.0).</p>
</dd></dl>

<dl class="py method">
<dt id="lingvo.core.py_utils.WeightInit.GaussianSqrtDim">
<em class="property">static </em><code class="sig-name descname">GaussianSqrtDim</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">scale</span><span class="o">=</span><span class="default_value">1.0</span></em>, <em class="sig-param"><span class="n">seed</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#WeightInit.GaussianSqrtDim"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.WeightInit.GaussianSqrtDim" title="Permalink to this definition">¶</a></dt>
<dd><p>scale * tf.random.normal(0, 1 / sqrt(dim0)).</p>
</dd></dl>

<dl class="py method">
<dt id="lingvo.core.py_utils.WeightInit.GaussianSqrtFanIn">
<em class="property">static </em><code class="sig-name descname">GaussianSqrtFanIn</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">scale</span><span class="o">=</span><span class="default_value">1.0</span></em>, <em class="sig-param"><span class="n">seed</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#WeightInit.GaussianSqrtFanIn"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.WeightInit.GaussianSqrtFanIn" title="Permalink to this definition">¶</a></dt>
<dd><p>scale * tf.random.normal(0, 1 / sqrt(fan_in)).</p>
</dd></dl>

<dl class="py method">
<dt id="lingvo.core.py_utils.WeightInit.GaussianSqrtFanOut">
<em class="property">static </em><code class="sig-name descname">GaussianSqrtFanOut</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">scale</span><span class="o">=</span><span class="default_value">1.0</span></em>, <em class="sig-param"><span class="n">seed</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#WeightInit.GaussianSqrtFanOut"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.WeightInit.GaussianSqrtFanOut" title="Permalink to this definition">¶</a></dt>
<dd><p>scale * tf.random.normal(0, 1 / sqrt(fan_out)).</p>
</dd></dl>

<dl class="py method">
<dt id="lingvo.core.py_utils.WeightInit.GaussianSqrtFanAvg">
<em class="property">static </em><code class="sig-name descname">GaussianSqrtFanAvg</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">scale</span><span class="o">=</span><span class="default_value">1.0</span></em>, <em class="sig-param"><span class="n">seed</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#WeightInit.GaussianSqrtFanAvg"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.WeightInit.GaussianSqrtFanAvg" title="Permalink to this definition">¶</a></dt>
<dd><p>tf.random.normal(0, sqrt(2.0 / (in + out))).</p>
</dd></dl>

<dl class="py method">
<dt id="lingvo.core.py_utils.WeightInit.UniformSqrtDim">
<em class="property">static </em><code class="sig-name descname">UniformSqrtDim</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">scale</span><span class="o">=</span><span class="default_value">1.0</span></em>, <em class="sig-param"><span class="n">seed</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#WeightInit.UniformSqrtDim"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.WeightInit.UniformSqrtDim" title="Permalink to this definition">¶</a></dt>
<dd><p>scale * tf.uniform(-1 / sqrt(dim0), 1 / sqrt(dim0)).</p>
</dd></dl>

<dl class="py method">
<dt id="lingvo.core.py_utils.WeightInit.UniformUnitScaling">
<em class="property">static </em><code class="sig-name descname">UniformUnitScaling</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">scale</span><span class="o">=</span><span class="default_value">1.0</span></em>, <em class="sig-param"><span class="n">seed</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#WeightInit.UniformUnitScaling"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.WeightInit.UniformUnitScaling" title="Permalink to this definition">¶</a></dt>
<dd><p>scale * sqrt(3) / sqrt(dim0) * tf.uniform(-1, 1).</p>
</dd></dl>

<dl class="py method">
<dt id="lingvo.core.py_utils.WeightInit.UniformUnitScalingFanAvg">
<em class="property">static </em><code class="sig-name descname">UniformUnitScalingFanAvg</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">scale</span><span class="o">=</span><span class="default_value">1.0</span></em>, <em class="sig-param"><span class="n">seed</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#WeightInit.UniformUnitScalingFanAvg"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.WeightInit.UniformUnitScalingFanAvg" title="Permalink to this definition">¶</a></dt>
<dd><p>Same as tf.variance_scaling_initializer() …</p>
<p>Samples are drawn from a uniform distribution within [-limit, limit], with
limit = sqrt(3 * scale / n)</p>
<p>where
n = max(1., (fan_in + fan_out) / 2).
See tf.keras.initializers.VarianceScaling for details.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>scale</strong> – A Python float.</p></li>
<li><p><strong>seed</strong> – A Python int or None.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A WeightInit param.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="lingvo.core.py_utils.WeightInit.TruncatedGaussianSqrtDim">
<em class="property">static </em><code class="sig-name descname">TruncatedGaussianSqrtDim</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">scale</span><span class="o">=</span><span class="default_value">1.0</span></em>, <em class="sig-param"><span class="n">seed</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#WeightInit.TruncatedGaussianSqrtDim"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.WeightInit.TruncatedGaussianSqrtDim" title="Permalink to this definition">¶</a></dt>
<dd><p>scale * tf.random.truncated_normal(0, 1 / sqrt(dim0)).</p>
</dd></dl>

<dl class="py method">
<dt id="lingvo.core.py_utils.WeightInit.TruncatedGaussianSqrtFanIn">
<em class="property">static </em><code class="sig-name descname">TruncatedGaussianSqrtFanIn</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">scale</span><span class="o">=</span><span class="default_value">1.0</span></em>, <em class="sig-param"><span class="n">seed</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#WeightInit.TruncatedGaussianSqrtFanIn"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.WeightInit.TruncatedGaussianSqrtFanIn" title="Permalink to this definition">¶</a></dt>
<dd><p>scale * tf.random.truncated_normal(0, 1 / sqrt(fan_in)).</p>
</dd></dl>

<dl class="py method">
<dt id="lingvo.core.py_utils.WeightInit.TruncatedGaussianSqrtFanOut">
<em class="property">static </em><code class="sig-name descname">TruncatedGaussianSqrtFanOut</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">scale</span><span class="o">=</span><span class="default_value">1.0</span></em>, <em class="sig-param"><span class="n">seed</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#WeightInit.TruncatedGaussianSqrtFanOut"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.WeightInit.TruncatedGaussianSqrtFanOut" title="Permalink to this definition">¶</a></dt>
<dd><p>scale * tf.random.truncated_normal(0, 1 / sqrt(fan_out)).</p>
</dd></dl>

<dl class="py method">
<dt id="lingvo.core.py_utils.WeightInit.KaimingUniformFanInRelu">
<em class="property">static </em><code class="sig-name descname">KaimingUniformFanInRelu</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">scale</span><span class="o">=</span><span class="default_value">1.0</span></em>, <em class="sig-param"><span class="n">seed</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#WeightInit.KaimingUniformFanInRelu"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.WeightInit.KaimingUniformFanInRelu" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt id="lingvo.core.py_utils.WeightInit.KaimingUniformFanInLeakyRelu">
<em class="property">static </em><code class="sig-name descname">KaimingUniformFanInLeakyRelu</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">scale</span><span class="o">=</span><span class="default_value">2.23606797749979</span></em>, <em class="sig-param"><span class="n">seed</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#WeightInit.KaimingUniformFanInLeakyRelu"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.WeightInit.KaimingUniformFanInLeakyRelu" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py function">
<dt id="lingvo.core.py_utils.DefaultParamInit">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">DefaultParamInit</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#DefaultParamInit"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.DefaultParamInit" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt id="lingvo.core.py_utils.IsDefaultParamInit">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">IsDefaultParamInit</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">p</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#IsDefaultParamInit"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.IsDefaultParamInit" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt id="lingvo.core.py_utils.WeightParams">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">WeightParams</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">shape</span></em>, <em class="sig-param"><span class="n">init</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">dtype</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">collections</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">device_mesh</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">tensor_split_dims_mapping</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#WeightParams"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.WeightParams" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a hyperparams for a weight variable given the shape/init/dtype.</p>
</dd></dl>

<dl class="py function">
<dt id="lingvo.core.py_utils.FindNeeded">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">FindNeeded</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">endpoints</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#FindNeeded"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.FindNeeded" title="Permalink to this definition">¶</a></dt>
<dd><p>List names of tensors and operations required to compute endpoints.</p>
</dd></dl>

<dl class="py function">
<dt id="lingvo.core.py_utils.FindNeededInList">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">FindNeededInList</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">tensor_list</span></em>, <em class="sig-param"><span class="n">endpoints</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#FindNeededInList"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.FindNeededInList" title="Permalink to this definition">¶</a></dt>
<dd><p>Return tensors from tensor_list needed to compute any of endpoints.</p>
</dd></dl>

<dl class="py class">
<dt id="lingvo.core.py_utils._CollectionGetter">
<em class="property">class </em><code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">_CollectionGetter</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">key</span></em>, <em class="sig-param"><span class="n">default_factory</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#_CollectionGetter"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils._CollectionGetter" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference external" href="https://docs.python.org/3.7/library/functions.html#object" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></a></p>
<p>Get graph local value from a defined collection.</p>
</dd></dl>

<dl class="py function">
<dt id="lingvo.core.py_utils.SanitizeScopeKey">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">SanitizeScopeKey</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">key</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#SanitizeScopeKey"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.SanitizeScopeKey" title="Permalink to this definition">¶</a></dt>
<dd><p>Removes invalid symbols from name_scope keys.</p>
</dd></dl>

<dl class="py function">
<dt id="lingvo.core.py_utils.OpportunisticVariableReuseScope">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">OpportunisticVariableReuseScope</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">enable_opportunistic_reuse</span><span class="o">=</span><span class="default_value">True</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#OpportunisticVariableReuseScope"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.OpportunisticVariableReuseScope" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt id="lingvo.core.py_utils.GetOpportunisticVariableReuse">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">GetOpportunisticVariableReuse</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#GetOpportunisticVariableReuse"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.GetOpportunisticVariableReuse" title="Permalink to this definition">¶</a></dt>
<dd><p>Get the current variable reuse setting.</p>
</dd></dl>

<dl class="py function">
<dt id="lingvo.core.py_utils.VariableRenameScope">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">VariableRenameScope</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">renames</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#VariableRenameScope"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.VariableRenameScope" title="Permalink to this definition">¶</a></dt>
<dd><p>Append the renaming rules to the stack of renames.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>renames</strong> – pairs of (regexp, new_name_format). If the regexp matches, the
new_name_format will be interpolated using the matched groups.</p>
</dd>
<dt class="field-even">Yields</dt>
<dd class="field-even"><p>scope in which the renaming rules are applied</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="lingvo.core.py_utils.GetVariableName">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">GetVariableName</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">name</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#GetVariableName"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.GetVariableName" title="Permalink to this definition">¶</a></dt>
<dd><p>Get variable name after application of all renaming rules.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>name</strong> – untransformed variable name with scope_name prepended</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>name possibly modified using renaming rules</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="lingvo.core.py_utils.GenerateSeedFromName">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">GenerateSeedFromName</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">name</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#GenerateSeedFromName"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.GenerateSeedFromName" title="Permalink to this definition">¶</a></dt>
<dd><p>Generate a random seed from a name string.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>name</strong> – A string.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>An integer seed in the range [0, 2**31 - 1).</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="lingvo.core.py_utils.MaybeGenerateSeedFromScope">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">MaybeGenerateSeedFromScope</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#MaybeGenerateSeedFromScope"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.MaybeGenerateSeedFromScope" title="Permalink to this definition">¶</a></dt>
<dd><p>Generate a random seed from the current name of the scope.</p>
<p>If running in eager mode, this returns 0.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>An integer seed in the range [0, 2**31 - 1).</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="lingvo.core.py_utils.GenerateSeedFromId">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">GenerateSeedFromId</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">obj_id</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#GenerateSeedFromId"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.GenerateSeedFromId" title="Permalink to this definition">¶</a></dt>
<dd><p>Generate a random seed from the id of an object.</p>
<p>If deterministic execution (i.e. unit test), generate the seed from a fixed
unique name instead.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>obj_id</strong> – id(object).</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>An integer seed in the range [0, 2**31 - 1).</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="lingvo.core.py_utils.VariableShapePrefixContext">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">VariableShapePrefixContext</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">shape_prefix</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#VariableShapePrefixContext"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.VariableShapePrefixContext" title="Permalink to this definition">¶</a></dt>
<dd><p>Add a shape prefix to variable created by CreateVariable().</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>shape_prefix</strong> – a positive integer of shape prefix.</p>
</dd>
<dt class="field-even">Yields</dt>
<dd class="field-even"><p>None.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="lingvo.core.py_utils.GetVariableShapePrefixes">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">GetVariableShapePrefixes</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#GetVariableShapePrefixes"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.GetVariableShapePrefixes" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the list of shape prefixes for CreateVariable().</p>
</dd></dl>

<dl class="py function">
<dt id="lingvo.core.py_utils.GetFanInFanOut">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">GetFanInFanOut</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">shape</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#GetFanInFanOut"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.GetFanInFanOut" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns (fan_in, fan_out) of a weight variable of the give shape.</p>
</dd></dl>

<dl class="py function">
<dt id="lingvo.core.py_utils._DefaultVariableCreator">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">_DefaultVariableCreator</code><span class="sig-paren">(</span><em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#_DefaultVariableCreator"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils._DefaultVariableCreator" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt id="lingvo.core.py_utils._GetVariableCreator">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">_GetVariableCreator</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#_GetVariableCreator"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils._GetVariableCreator" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt id="lingvo.core.py_utils.VariableCreatorScope">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">VariableCreatorScope</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">variable_creator</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#VariableCreatorScope"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.VariableCreatorScope" title="Permalink to this definition">¶</a></dt>
<dd><p>Yields a context around a variable_creator, used by <a class="reference internal" href="#lingvo.core.py_utils.CreateVariable" title="lingvo.core.py_utils.CreateVariable"><code class="xref py py-obj docutils literal notranslate"><span class="pre">CreateVariable()</span></code></a>.</p>
<p>The function must have the following signature:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">variable_creator</span><span class="p">(</span><span class="n">next_creator</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</pre></div>
</div>
<p>The function may delegate variable creation to the next variable creator, or
return its own tf.Variable.</p>
<p>This differs from tf.variable_creator_scope in that tf.variable_creator_scope
modifies a tf.Variable() call while this modifies a tf.get_variable() call. As
the code is migrated to TF2 and tf.get_variable() is deprecated, this may be
upgraded to using tf.variable_creator_scope instead.</p>
<p>This differs from tf.variable_scope(custom_getter=variable_creator) in that
the kwargs passed can be manipulated.</p>
<p>Variable creators are resolved from the outermost towards the innermost.</p>
<p>The innermost variable creator function is tf.get_variable.</p>
<p>The passed in kwargs must conform to what tf.get_variable accepts, with the
addition of <code class="xref py py-obj docutils literal notranslate"><span class="pre">var_name</span></code> and <code class="xref py py-obj docutils literal notranslate"><span class="pre">var_params</span></code>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>variable_creator</strong> – A variable creator function.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="lingvo.core.py_utils.CreateVariable">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">CreateVariable</code><span class="sig-paren">(</span><em class="sig-param">name</em>, <em class="sig-param">params</em>, <em class="sig-param">reuse=None</em>, <em class="sig-param">trainable=True</em>, <em class="sig-param">collections=None</em>, <em class="sig-param">default_seed=None</em>, <em class="sig-param">synchronization=&lt;VariableSynchronization.AUTO: 0&gt;</em>, <em class="sig-param">aggregation=&lt;VariableAggregationV2.NONE: 0&gt;</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#CreateVariable"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.CreateVariable" title="Permalink to this definition">¶</a></dt>
<dd><p>Creates tf.Variable according to param_config.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>name</strong> – A string, name of the variable.</p></li>
<li><p><strong>params</strong> – A WeightParams specifying the details of how this variable should be
constructed and initialized.</p></li>
<li><p><strong>reuse</strong> – Whether or not to reuse an existing variable. It has the same
semantics as the reuse arg in tf.variable_scope.</p></li>
<li><p><strong>trainable</strong> – Whether or not the variable is trainable.</p></li>
<li><p><strong>collections</strong> – Override the default variable collection (
tf.GraphKeys.GLOBAL_VARIABLES).</p></li>
<li><p><strong>default_seed</strong> – Seed to use for initialization if not specified in params.
Used for deterministic initialization in tests.</p></li>
<li><p><strong>synchronization</strong> – Indicates when a distributed a variable will be aggregated.
Accepted values are constants defined in the class
tf.VariableSynchronization. By default the synchronization is set to AUTO
and the current DistributionStrategy chooses when to synchronize.</p></li>
<li><p><strong>aggregation</strong> – Indicates how a distributed variable will be aggregated.
Accepted values are constants defined in the class tf.VariableAggregation.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>The created variable.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="lingvo.core.py_utils._CreateVariableStateful">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">_CreateVariableStateful</code><span class="sig-paren">(</span><em class="sig-param">name</em>, <em class="sig-param">params</em>, <em class="sig-param">reuse=None</em>, <em class="sig-param">trainable=True</em>, <em class="sig-param">collections=None</em>, <em class="sig-param">default_seed=None</em>, <em class="sig-param">synchronization=&lt;VariableSynchronization.AUTO: 0&gt;</em>, <em class="sig-param">aggregation=&lt;VariableAggregationV2.NONE: 0&gt;</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#_CreateVariableStateful"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils._CreateVariableStateful" title="Permalink to this definition">¶</a></dt>
<dd><p>Creates tf.Variable using TF stateful RNGs according to param_config.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>name</strong> – A string, name of the variable.</p></li>
<li><p><strong>params</strong> – A WeightParams specifying the details of how this variable should be
constructed and initialized.</p></li>
<li><p><strong>reuse</strong> – Whether or not to reuse an existing variable. It has the same
semantics as the reuse arg in tf.variable_scope.</p></li>
<li><p><strong>trainable</strong> – Whether or not the variable is trainable.</p></li>
<li><p><strong>collections</strong> – Override the default variable collection (
tf.GraphKeys.GLOBAL_VARIABLES).</p></li>
<li><p><strong>default_seed</strong> – Seed to use for initialization if not specified in params.
Used for deterministic initialization in tests.</p></li>
<li><p><strong>synchronization</strong> – Indicates when a distributed a variable will be aggregated.
Accepted values are constants defined in the class
tf.VariableSynchronization. By default the synchronization is set to AUTO
and the current DistributionStrategy chooses when to synchronize.</p></li>
<li><p><strong>aggregation</strong> – Indicates how a distributed variable will be aggregated.
Accepted values are constants defined in the class tf.VariableAggregation.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>The created variable.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="lingvo.core.py_utils._CreateVariableStateless">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">_CreateVariableStateless</code><span class="sig-paren">(</span><em class="sig-param">name</em>, <em class="sig-param">params</em>, <em class="sig-param">reuse=None</em>, <em class="sig-param">trainable=True</em>, <em class="sig-param">collections=None</em>, <em class="sig-param">default_seed=None</em>, <em class="sig-param">synchronization=&lt;VariableSynchronization.AUTO: 0&gt;</em>, <em class="sig-param">aggregation=&lt;VariableAggregationV2.NONE: 0&gt;</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#_CreateVariableStateless"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils._CreateVariableStateless" title="Permalink to this definition">¶</a></dt>
<dd><p>Creates tf.Variable using TF stateless RNGs according to <code class="xref py py-obj docutils literal notranslate"><span class="pre">params</span></code>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>name</strong> – A string, name of the variable.</p></li>
<li><p><strong>params</strong> – A WeightParams specifying the details of how this variable should be
constructed and initialized.</p></li>
<li><p><strong>reuse</strong> – Whether or not to reuse an existing variable. It has the same
semantics as the reuse arg in tf.variable_scope.</p></li>
<li><p><strong>trainable</strong> – Whether or not the variable is trainable.</p></li>
<li><p><strong>collections</strong> – Override the default variable collection (
tf.GraphKeys.GLOBAL_VARIABLES).</p></li>
<li><p><strong>default_seed</strong> – Seed to use for initialization if not specified in params.
Used for deterministic initialization in tests.</p></li>
<li><p><strong>synchronization</strong> – Indicates when a distributed a variable will be aggregated.
Accepted values are constants defined in the class
tf.VariableSynchronization. By default the synchronization is set to AUTO
and the current DistributionStrategy chooses when to synchronize.</p></li>
<li><p><strong>aggregation</strong> – Indicates how a distributed variable will be aggregated.
Accepted values are constants defined in the class tf.VariableAggregation.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>The created variable.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="lingvo.core.py_utils._RandomXavierUniformInitializer">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">_RandomXavierUniformInitializer</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">method</span></em>, <em class="sig-param"><span class="n">scale</span></em>, <em class="sig-param"><span class="n">seed</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#_RandomXavierUniformInitializer"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils._RandomXavierUniformInitializer" title="Permalink to this definition">¶</a></dt>
<dd><p>Creates a random Xavier uniform initializer.</p>
</dd></dl>

<dl class="py function">
<dt id="lingvo.core.py_utils._CreateVarInitStateful">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">_CreateVarInitStateful</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">name</span></em>, <em class="sig-param"><span class="n">method</span></em>, <em class="sig-param"><span class="n">shape</span></em>, <em class="sig-param"><span class="n">dim0</span></em>, <em class="sig-param"><span class="n">seed</span></em>, <em class="sig-param"><span class="n">scale</span></em>, <em class="sig-param"><span class="n">init_dtype</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#_CreateVarInitStateful"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils._CreateVarInitStateful" title="Permalink to this definition">¶</a></dt>
<dd><p>Creates variable initialization function for a stateful RNG.</p>
</dd></dl>

<dl class="py function">
<dt id="lingvo.core.py_utils._GenerateStatelessRngSeed">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">_GenerateStatelessRngSeed</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">name</span></em>, <em class="sig-param"><span class="n">seed</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#_GenerateStatelessRngSeed"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils._GenerateStatelessRngSeed" title="Permalink to this definition">¶</a></dt>
<dd><p>Generates a 2-tuple seed for a stateless variable initializer.</p>
<p>We want to ensure that different variables end up with different random values
even when they are passed the same seed and shape. To this aim, this function
generates a pseudo-unique seed by hashing the variable name and mapping it
into a scalar seed. More specifically, the returned value is a 2-tuple of
tf.int32 scalar, where the first element is the user-provided seed and the
second element is obtained by hashing the variable name.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>name</strong> – The variable name for which to generate a stateless-like seed.</p></li>
<li><p><strong>seed</strong> – The user-specified scalar seed.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A 2-tuple seed of tf.int32 values (for TPU compatibility).</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="lingvo.core.py_utils._DeterministicRandomNormalInitializer">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">_DeterministicRandomNormalInitializer</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">seed</span></em>, <em class="sig-param"><span class="n">mean</span></em>, <em class="sig-param"><span class="n">stddev</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#_DeterministicRandomNormalInitializer"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils._DeterministicRandomNormalInitializer" title="Permalink to this definition">¶</a></dt>
<dd><p>Creates a random normal initializer.</p>
</dd></dl>

<dl class="py function">
<dt id="lingvo.core.py_utils._DeterministicRandomUniformInitializer">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">_DeterministicRandomUniformInitializer</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">seed</span></em>, <em class="sig-param"><span class="n">minval</span></em>, <em class="sig-param"><span class="n">maxval</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#_DeterministicRandomUniformInitializer"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils._DeterministicRandomUniformInitializer" title="Permalink to this definition">¶</a></dt>
<dd><p>Creates a random uniform initializer.</p>
</dd></dl>

<dl class="py function">
<dt id="lingvo.core.py_utils._DeterministicRandomTruncatedNormalInitializer">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">_DeterministicRandomTruncatedNormalInitializer</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">seed</span></em>, <em class="sig-param"><span class="n">mean</span></em>, <em class="sig-param"><span class="n">stddev</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#_DeterministicRandomTruncatedNormalInitializer"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils._DeterministicRandomTruncatedNormalInitializer" title="Permalink to this definition">¶</a></dt>
<dd><p>Creates a random truncated normal initializer.</p>
</dd></dl>

<dl class="py function">
<dt id="lingvo.core.py_utils._DeterministicRandomUniformUnitScalingInitializer">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">_DeterministicRandomUniformUnitScalingInitializer</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">seed</span></em>, <em class="sig-param"><span class="n">factor</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#_DeterministicRandomUniformUnitScalingInitializer"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils._DeterministicRandomUniformUnitScalingInitializer" title="Permalink to this definition">¶</a></dt>
<dd><p>Creates a random uniform unit scaling initializer.</p>
</dd></dl>

<dl class="py function">
<dt id="lingvo.core.py_utils._DeterministicRandomVarianceScalingInitializer">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">_DeterministicRandomVarianceScalingInitializer</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">scale</span></em>, <em class="sig-param"><span class="n">mode</span></em>, <em class="sig-param"><span class="n">distribution</span></em>, <em class="sig-param"><span class="n">seed</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#_DeterministicRandomVarianceScalingInitializer"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils._DeterministicRandomVarianceScalingInitializer" title="Permalink to this definition">¶</a></dt>
<dd><p>Creates a variance scaling initializer.</p>
</dd></dl>

<dl class="py function">
<dt id="lingvo.core.py_utils._DeterministicRandomXavierUniformInitializer">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">_DeterministicRandomXavierUniformInitializer</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">method</span></em>, <em class="sig-param"><span class="n">scale</span></em>, <em class="sig-param"><span class="n">seed</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#_DeterministicRandomXavierUniformInitializer"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils._DeterministicRandomXavierUniformInitializer" title="Permalink to this definition">¶</a></dt>
<dd><p>Creates a variance scaling initializer.</p>
</dd></dl>

<dl class="py function">
<dt id="lingvo.core.py_utils._CreateVarInitStateless">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">_CreateVarInitStateless</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">name</span></em>, <em class="sig-param"><span class="n">method</span></em>, <em class="sig-param"><span class="n">shape</span></em>, <em class="sig-param"><span class="n">dim0</span></em>, <em class="sig-param"><span class="n">seed</span></em>, <em class="sig-param"><span class="n">scale</span></em>, <em class="sig-param"><span class="n">init_dtype</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#_CreateVarInitStateless"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils._CreateVarInitStateless" title="Permalink to this definition">¶</a></dt>
<dd><p>Creates variable initialization function for a stateless RNG.</p>
</dd></dl>

<dl class="py function">
<dt id="lingvo.core.py_utils.GetGlobalVariableScope">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">GetGlobalVariableScope</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#GetGlobalVariableScope"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.GetGlobalVariableScope" title="Permalink to this definition">¶</a></dt>
<dd><p>Gets the global variable scope (as if no variable_scope has been set).</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>The VariableScope corresponding to as if no tf.variable_scope is in effect.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="lingvo.core.py_utils.GlobalStepContext">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">GlobalStepContext</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">global_step_tensor</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#GlobalStepContext"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.GlobalStepContext" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt id="lingvo.core.py_utils.GetGlobalStep">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">GetGlobalStep</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#GetGlobalStep"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.GetGlobalStep" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the global_step.</p>
</dd></dl>

<dl class="py function">
<dt id="lingvo.core.py_utils.GetOrCreateGlobalStepVar">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">GetOrCreateGlobalStepVar</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#GetOrCreateGlobalStepVar"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.GetOrCreateGlobalStepVar" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the global_step variable, creating it if it does not exist.</p>
<p>Prefer GetGlobalStep if a tensor rather than a tf.Variable is sufficient.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>The global_step variable, or a new created one if it does not exist.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="lingvo.core.py_utils.LogMultiLines">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">LogMultiLines</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">label</span></em>, <em class="sig-param"><span class="n">lines</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#LogMultiLines"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.LogMultiLines" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt id="lingvo.core.py_utils._LogPlacement">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">_LogPlacement</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">label</span></em>, <em class="sig-param"><span class="n">theta</span></em>, <em class="sig-param"><span class="n">copy</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#_LogPlacement"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils._LogPlacement" title="Permalink to this definition">¶</a></dt>
<dd><p>Logs theta and its copy’s device placement.</p>
</dd></dl>

<dl class="py function">
<dt id="lingvo.core.py_utils.CreateLocalTheta">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">CreateLocalTheta</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">theta</span></em>, <em class="sig-param"><span class="n">device_list</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">label</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#CreateLocalTheta"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.CreateLocalTheta" title="Permalink to this definition">¶</a></dt>
<dd><p>Creates local copy of theta and shards across devices device list.</p>
<p>Leaves variables intact.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>theta</strong> – a <a class="reference internal" href="#lingvo.core.py_utils.NestedMap" title="lingvo.core.py_utils.NestedMap"><code class="xref py py-obj docutils literal notranslate"><span class="pre">NestedMap</span></code></a> of variables.</p></li>
<li><p><strong>device_list</strong> – list of devices to shard across. If None, defaults to a list
[‘’].</p></li>
<li><p><strong>label</strong> – Logging label.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A <a class="reference internal" href="#lingvo.core.py_utils.NestedMap" title="lingvo.core.py_utils.NestedMap"><code class="xref py py-obj docutils literal notranslate"><span class="pre">NestedMap</span></code></a> of identity() wrapped theta</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="lingvo.core.py_utils._GetVarsToLoad">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">_GetVarsToLoad</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">all_vars</span></em>, <em class="sig-param"><span class="n">variable_loading_rules</span></em>, <em class="sig-param"><span class="n">var_ignore_rules</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#_GetVarsToLoad"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils._GetVarsToLoad" title="Permalink to this definition">¶</a></dt>
<dd><p>Determines variables to load and their names in checkpoint.</p>
</dd></dl>

<dl class="py function">
<dt id="lingvo.core.py_utils.OverrideVarsFromCheckpoint">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">OverrideVarsFromCheckpoint</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">all_vars</span></em>, <em class="sig-param"><span class="n">checkpoint_path</span></em>, <em class="sig-param"><span class="n">variable_loading_rules</span></em>, <em class="sig-param"><span class="n">var_ignore_rules</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#OverrideVarsFromCheckpoint"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.OverrideVarsFromCheckpoint" title="Permalink to this definition">¶</a></dt>
<dd><p>Add TF graph ops to override variables from a provided checkpoint.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>all_vars</strong> – List of all the parameters in the model.</p></li>
<li><p><strong>checkpoint_path</strong> – A path to the checkpoints of a pretrained model.</p></li>
<li><p><strong>variable_loading_rules</strong> – A list of tuples of strings defining (regex to match
parameter names in the model to override, format string to determine the
corresponding var in the checkpoint).</p></li>
<li><p><strong>var_ignore_rules</strong> – A list consisting of a list of regexes to match parameter
names in the model which should not be overridden, even if they match
those in the loading rules.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A callable that, when called with a tf.Session, will restore the variables
from the provided checkpoint.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="lingvo.core.py_utils.OverrideVarsFromCheckpoints">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">OverrideVarsFromCheckpoints</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">all_vars</span></em>, <em class="sig-param"><span class="n">ckpts_loading_rules</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#OverrideVarsFromCheckpoints"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.OverrideVarsFromCheckpoints" title="Permalink to this definition">¶</a></dt>
<dd><p>Add TF graph ops to override model variables from checkpoints.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>all_vars</strong> – List of all the parameters in the model.</p></li>
<li><p><strong>ckpts_loading_rules</strong> – A dictionary of checkpoint path: loading rules.
Checkpoint path must be a path to a pretrained model, and loading rules is
expected to be a tuple of two lists. The first consisting of tuples of
strings defining (regex to match parameter names in the model to override,
format string to determine the corresponding var in the checkpoint), and
the second list consisting of a list of regexes to match parameter names
in the model which should not be overridden, even if they match those in
the loading rules.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A callable that, when called with a tf.Session, will restore the variables
from checkpoint and return a list of overwritten variables.</p>
</dd>
<dt class="field-odd">Raises</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3.7/library/exceptions.html#ValueError" title="(in Python v3.7)"><strong>ValueError</strong></a> – if colliding vars exist or loading rules is not a list.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="lingvo.core.py_utils.ComputeGradientsSimple">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">ComputeGradientsSimple</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">loss_or_activations</span></em>, <em class="sig-param"><span class="n">all_vars</span></em>, <em class="sig-param"><span class="n">grad_aggregation_method</span></em>, <em class="sig-param"><span class="n">colocate_gradients_with_ops</span></em>, <em class="sig-param"><span class="n">gate_gradients</span></em>, <em class="sig-param"><span class="n">activations_grad</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#ComputeGradientsSimple"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.ComputeGradientsSimple" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt id="lingvo.core.py_utils.ComputeTpuEmbeddingGradients">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">ComputeTpuEmbeddingGradients</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">loss</span></em>, <em class="sig-param"><span class="n">activation_dict</span></em>, <em class="sig-param"><span class="n">tpu_embedding</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#ComputeTpuEmbeddingGradients"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.ComputeTpuEmbeddingGradients" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a TpuEmbedding SendGradient op.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>loss</strong> – The loss to backprop from.</p></li>
<li><p><strong>activation_dict</strong> – String feature -&gt; embedding activations dict.</p></li>
<li><p><strong>tpu_embedding</strong> – TPUEmbedding instance.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="lingvo.core.py_utils._ComputeGradientsTpu">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">_ComputeGradientsTpu</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">loss_or_activations</span></em>, <em class="sig-param"><span class="n">all_vars</span></em>, <em class="sig-param"><span class="n">grad_aggregation_method</span></em>, <em class="sig-param"><span class="n">colocate_gradients_with_ops</span></em>, <em class="sig-param"><span class="n">gate_gradients</span></em>, <em class="sig-param"><span class="n">skip_zero_gradients</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">use_bf16_gradients_ar</span><span class="o">=</span><span class="default_value">False</span></em>, <em class="sig-param"><span class="n">defer_crs_to_apply_grad</span><span class="o">=</span><span class="default_value">False</span></em>, <em class="sig-param"><span class="n">activations_grad</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">is_activations</span><span class="o">=</span><span class="default_value">False</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#_ComputeGradientsTpu"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils._ComputeGradientsTpu" title="Permalink to this definition">¶</a></dt>
<dd><p>Computes gradients for local loss across whole TPU cluster.</p>
<p>This implementation specializes for the case where weight params maybe used
for different number of times in the forward computation, so that gradients
should be normalized by the actual number of times they are being computed.</p>
<p>TODO(yonghui): Maybe merge this implementation with the _ComputeGradientsTpu
one.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>loss_or_activations</strong> – The loss or activations to backprop from.</p></li>
<li><p><strong>all_vars</strong> – Vars with respect to which gradients are to be computed.</p></li>
<li><p><strong>grad_aggregation_method</strong> – aggregation method to use when calling
tf.gradients.</p></li>
<li><p><strong>colocate_gradients_with_ops</strong> – boolean, whether or not to colocate gradient op
with the original op.</p></li>
<li><p><strong>gate_gradients</strong> – boolean, flag to be passed to tf.gradients.</p></li>
<li><p><strong>skip_zero_gradients</strong> – whether to skip zero gradients during aggregation.</p></li>
<li><p><strong>use_bf16_gradients_ar</strong> – Whether to use bfloat16 dtype for gradients
all-reduce.</p></li>
<li><p><strong>defer_crs_to_apply_grad</strong> – Whether to defer gradient cross replica sum to
apply_gradient. This helps reducing the number of gradient all-reduces
when doing gradient accumulation, which does gradient cross replica sum
only every k steps in a tf.cond. Currently this works only when
skip_zero_gradients is None.</p></li>
<li><p><strong>activations_grad</strong> – The gradients computed for activations.</p></li>
<li><p><strong>is_activations</strong> – A boolean, whether the input is loss or activations.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>Gradients to be passed back.</p>
</dd>
<dt class="field-odd">Raises</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3.7/library/exceptions.html#ValueError" title="(in Python v3.7)"><strong>ValueError</strong></a> – upon invalid arguments.</p>
</dd>
</dl>
</dd></dl>

<dl class="py class">
<dt id="lingvo.core.py_utils.VarGrad">
<em class="property">class </em><code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">VarGrad</code><span class="sig-paren">(</span><em class="sig-param"><span class="o">*</span><span class="n">args</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#VarGrad"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.VarGrad" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference external" href="https://docs.python.org/3.7/library/functions.html#object" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></a></p>
<p>A class that holds a variable and a gradient.</p>
<dl class="py attribute">
<dt id="lingvo.core.py_utils.VarGrad._VAR_GRAD">
<code class="sig-name descname">_VAR_GRAD</code><a class="headerlink" href="#lingvo.core.py_utils.VarGrad._VAR_GRAD" title="Permalink to this definition">¶</a></dt>
<dd><p>alias of <code class="xref py py-class docutils literal notranslate"><span class="pre">VarGradNamedTuple</span></code></p>
</dd></dl>

</dd></dl>

<dl class="py function">
<dt id="lingvo.core.py_utils.SkipNoneGradients">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">SkipNoneGradients</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">var_grads</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#SkipNoneGradients"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.SkipNoneGradients" title="Permalink to this definition">¶</a></dt>
<dd><p>Removes pairs whose grad is None.</p>
</dd></dl>

<dl class="py function">
<dt id="lingvo.core.py_utils.ComputeGradients">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">ComputeGradients</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">loss_or_activations</span></em>, <em class="sig-param"><span class="n">vmap</span></em>, <em class="sig-param"><span class="n">grad_aggregation_method</span><span class="o">=</span><span class="default_value">1</span></em>, <em class="sig-param"><span class="n">colocate_gradients_with_ops</span><span class="o">=</span><span class="default_value">True</span></em>, <em class="sig-param"><span class="n">gate_gradients</span><span class="o">=</span><span class="default_value">False</span></em>, <em class="sig-param"><span class="n">compute_gradients_fn</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">skip_zero_gradients</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">use_bf16_gradients_ar</span><span class="o">=</span><span class="default_value">False</span></em>, <em class="sig-param"><span class="n">skip_none_gradients</span><span class="o">=</span><span class="default_value">True</span></em>, <em class="sig-param"><span class="n">defer_crs_to_apply_grad</span><span class="o">=</span><span class="default_value">False</span></em>, <em class="sig-param"><span class="n">activations_grad</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">is_activations</span><span class="o">=</span><span class="default_value">False</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#ComputeGradients"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.ComputeGradients" title="Permalink to this definition">¶</a></dt>
<dd><p>Computes gradients of variables in vmap w.r.t loss.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>loss_or_activations</strong> – either the loss, which is a scalar tensor, or
activations, which could be a tensor or a list of tensors.</p></li>
<li><p><strong>vmap</strong> – A <a class="reference internal" href="#lingvo.core.py_utils.NestedMap" title="lingvo.core.py_utils.NestedMap"><code class="xref py py-obj docutils literal notranslate"><span class="pre">NestedMap</span></code></a> of variables.</p></li>
<li><p><strong>grad_aggregation_method</strong> – Specifies the method used to combine gradient
terms. Accepted values are constants defined in the class
AggregationMethod.</p></li>
<li><p><strong>colocate_gradients_with_ops</strong> – If True, try colocating gradients with the
corresponding op.</p></li>
<li><p><strong>gate_gradients</strong> – If True, add a tuple around the gradients returned for an
operations. This avoids some race conditions.</p></li>
<li><p><strong>compute_gradients_fn</strong> – Function to use to compute gradients. If None, use
default. compute_gradients_fn should have the same signature as this
function, but without the last argument.</p></li>
<li><p><strong>skip_zero_gradients</strong> – <p>Whether to skip aggregating zero gradients. This helps
in case where some weights may not be used in forward computation, e.g.,
sparsely activated networks or switchable layers in neural architectural
search. Only applicable on TPU.
Possible values are:</p>
<blockquote>
<div><ul>
<li><p>None: do not skip zero gradients;</p></li>
<li><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">variable</span></code>: skip if the entire variable’s gradients are almost zero;
reduce_sum(abs(grads)) &lt; 1e-8.</p></li>
<li><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">weight</span></code>: skip if the individual weight’s gradients are almost zero:
abs(grad) &lt; 1e-8.</p></li>
</ul>
</div></blockquote>
</p></li>
<li><p><strong>use_bf16_gradients_ar</strong> – Whether to use bfloat16 dtype for gradients
all-reduce. This applies to TPU only.</p></li>
<li><p><strong>skip_none_gradients</strong> – Whether to skip gradients that are None.</p></li>
<li><p><strong>defer_crs_to_apply_grad</strong> – Whether to defer gradient cross replica sum to
apply_gradient. This applies to TPU only.</p></li>
<li><p><strong>activations_grad</strong> – The gradients computed for activations.</p></li>
<li><p><strong>is_activations</strong> – A boolean, whether the input is loss or activations.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>var_grad - a <a class="reference internal" href="#lingvo.core.py_utils.NestedMap" title="lingvo.core.py_utils.NestedMap"><code class="xref py py-obj docutils literal notranslate"><span class="pre">NestedMap</span></code></a> of VarGrad. You can view
var_grad as an ordered list of (key, (var, grad)) tuples. Every
key of var_grad exists in vmap. Every variable in vmap that
contributes to loss must exist in var_grad. Every var of var_grad
must exist in vmap.  grad is the corresponding gradient computed
for var. grad is guaranteed to be not None.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="lingvo.core.py_utils.MaskGradients">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">MaskGradients</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">var_grad</span></em>, <em class="sig-param"><span class="n">grad_mask</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#MaskGradients"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.MaskGradients" title="Permalink to this definition">¶</a></dt>
<dd><p>Computes gradients of non-masked variables in vmap w.r.t loss.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>var_grad</strong> – A <a class="reference internal" href="#lingvo.core.py_utils.NestedMap" title="lingvo.core.py_utils.NestedMap"><code class="xref py py-obj docutils literal notranslate"><span class="pre">NestedMap</span></code></a> of (variable, gradient)</p></li>
<li><p><strong>grad_mask</strong> – A dict of (variable name, mask).</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>var_grad - a <a class="reference internal" href="#lingvo.core.py_utils.NestedMap" title="lingvo.core.py_utils.NestedMap"><code class="xref py py-obj docutils literal notranslate"><span class="pre">NestedMap</span></code></a> of (variable, mask * gradient).</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="lingvo.core.py_utils.ApplyGradMultiplier">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">ApplyGradMultiplier</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">vs_gs</span></em>, <em class="sig-param"><span class="n">grad_scale</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#ApplyGradMultiplier"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.ApplyGradMultiplier" title="Permalink to this definition">¶</a></dt>
<dd><p>Scale gradients by grad_scale on same device as corresponding variables.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>vs_gs</strong> – A <a class="reference internal" href="#lingvo.core.py_utils.NestedMap" title="lingvo.core.py_utils.NestedMap"><code class="xref py py-obj docutils literal notranslate"><span class="pre">NestedMap</span></code></a> of VarGrad.</p></li>
<li><p><strong>grad_scale</strong> – If None, each vs_gs entry has the scale. Otherwise, grad_scale
applies to every entry.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A <a class="reference internal" href="#lingvo.core.py_utils.NestedMap" title="lingvo.core.py_utils.NestedMap"><code class="xref py py-obj docutils literal notranslate"><span class="pre">NestedMap</span></code></a> of (variable, gradient * grad_scale). In particular, if
grad_scale is 0, the result gradient is always 0, even if the input
gradient is inf or nan.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="lingvo.core.py_utils.HasNanOrInfGradient">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">HasNanOrInfGradient</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">var_grads</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#HasNanOrInfGradient"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.HasNanOrInfGradient" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a bool tensor to indicate if <code class="xref py py-obj docutils literal notranslate"><span class="pre">var_grads</span></code> contains NaNs or Infs.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>var_grads</strong> – A <a class="reference internal" href="#lingvo.core.py_utils.NestedMap" title="lingvo.core.py_utils.NestedMap"><code class="xref py py-obj docutils literal notranslate"><span class="pre">NestedMap</span></code></a> with (var, grad) tuple as the map value.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A bool scalar tensor to indicate if the <code class="xref py py-obj docutils literal notranslate"><span class="pre">var_grads</span></code> contains NaNs or Infs.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="lingvo.core.py_utils.ApplyGradNormClipping">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">ApplyGradNormClipping</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">vs_gs</span></em>, <em class="sig-param"><span class="n">norm</span><span class="o">=</span><span class="default_value">1.0</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#ApplyGradNormClipping"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.ApplyGradNormClipping" title="Permalink to this definition">¶</a></dt>
<dd><p>Clip gradients to norm on same device as corresponding variables.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>vs_gs</strong> – A <a class="reference internal" href="#lingvo.core.py_utils.NestedMap" title="lingvo.core.py_utils.NestedMap"><code class="xref py py-obj docutils literal notranslate"><span class="pre">NestedMap</span></code></a> of VarGrad.</p></li>
<li><p><strong>norm</strong> – Each tensor’s gradient will be scaled down to have a maximum L2-norm
value of <code class="xref py py-obj docutils literal notranslate"><span class="pre">norm</span></code>.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A <a class="reference internal" href="#lingvo.core.py_utils.NestedMap" title="lingvo.core.py_utils.NestedMap"><code class="xref py py-obj docutils literal notranslate"><span class="pre">NestedMap</span></code></a> of VarGrad(variable, scaled_gradient). In particular, if
grad_scale is 0, the result gradient is always 0, even if the input
gradient is inf or nan.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="lingvo.core.py_utils.AdjustGradientsWithLpLoss">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">AdjustGradientsWithLpLoss</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">var_grads</span></em>, <em class="sig-param"><span class="n">lp_regularizer_weight</span></em>, <em class="sig-param"><span class="n">p</span><span class="o">=</span><span class="default_value">2.0</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#AdjustGradientsWithLpLoss"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.AdjustGradientsWithLpLoss" title="Permalink to this definition">¶</a></dt>
<dd><p>Adjusts the map of (var, grad) with Lp regularization, where p=1.0 or 2.0.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>var_grads</strong> – a <a class="reference internal" href="#lingvo.core.py_utils.NestedMap" title="lingvo.core.py_utils.NestedMap"><code class="xref py py-obj docutils literal notranslate"><span class="pre">NestedMap</span></code></a> or list of (variable, gradient).</p></li>
<li><p><strong>lp_regularizer_weight</strong> – Lp regularization weight.</p></li>
<li><p><strong>p</strong> – For now we support 1.0 or 2.0.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><p>A tuple (lp_loss, var_grads).</p>
<ul class="simple">
<li><p>lp_loss: A scalar. The lp loss.</p></li>
<li><p>var_grads: a <a class="reference internal" href="#lingvo.core.py_utils.NestedMap" title="lingvo.core.py_utils.NestedMap"><code class="xref py py-obj docutils literal notranslate"><span class="pre">NestedMap</span></code></a> or list of (variable, gradient) regulated by Lp.</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="lingvo.core.py_utils.SplitRecursively">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">SplitRecursively</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">x</span></em>, <em class="sig-param"><span class="n">num_splits</span></em>, <em class="sig-param"><span class="n">axis</span><span class="o">=</span><span class="default_value">- 1</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#SplitRecursively"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.SplitRecursively" title="Permalink to this definition">¶</a></dt>
<dd><p>Splits Tensors in ‘x’ recursively.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>x</strong> – a Tensor, or a list or NestMap containing Tensors to split.</p></li>
<li><p><strong>num_splits</strong> – number of splits per Tensor.</p></li>
<li><p><strong>axis</strong> – the split axis.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><p>A list of split values of length ‘num_splits’.</p>
<ul class="simple">
<li><p>If ‘x’ is a Tensor, a list of split Tensors.</p></li>
<li><p>If ‘x’ is a list, a list of lists, where each sublist has the same length
as ‘x’ and the k’th element in each sublist corresponds to a split of the
k’th element from ‘x’.</p></li>
<li><p>If ‘x’ is a <a class="reference internal" href="#lingvo.core.py_utils.NestedMap" title="lingvo.core.py_utils.NestedMap"><code class="xref py py-obj docutils literal notranslate"><span class="pre">NestedMap</span></code></a>, a list of <a class="reference internal" href="#lingvo.core.py_utils.NestedMap" title="lingvo.core.py_utils.NestedMap"><code class="xref py py-obj docutils literal notranslate"><span class="pre">NestedMap</span></code></a>, where each field
corresponds to a split from the same field of ‘x’.</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="lingvo.core.py_utils.ConcatRecursively">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">ConcatRecursively</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">splits</span></em>, <em class="sig-param"><span class="n">axis</span><span class="o">=</span><span class="default_value">- 1</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#ConcatRecursively"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.ConcatRecursively" title="Permalink to this definition">¶</a></dt>
<dd><p>Concatenates tensors from ‘splits’.</p>
<p>This is the inverse function of SplitRecursively.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>splits</strong> – a list of splits to concatenate, where elements can be Tensors,
lists, or <a class="reference internal" href="#lingvo.core.py_utils.NestedMap" title="lingvo.core.py_utils.NestedMap"><code class="xref py py-obj docutils literal notranslate"><span class="pre">NestedMap</span></code></a>. The elements must share the same type and
structure.  For example, list elements must have the same length;
<a class="reference internal" href="#lingvo.core.py_utils.NestedMap" title="lingvo.core.py_utils.NestedMap"><code class="xref py py-obj docutils literal notranslate"><span class="pre">NestedMap</span></code></a> must have the same set of fields.</p></li>
<li><p><strong>axis</strong> – the concatenation axis.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><p>Concatenated data.</p>
<ul class="simple">
<li><p>If input ‘splits’ are Tensors, returns a concatenated Tensor.</p></li>
<li><p>If input ‘splits’ are lists, returns a list of the same length where the
k’th element represents concatenated data of the k’th element from each
split.</p></li>
<li><p>If input ‘splits’ are <a class="reference internal" href="#lingvo.core.py_utils.NestedMap" title="lingvo.core.py_utils.NestedMap"><code class="xref py py-obj docutils literal notranslate"><span class="pre">NestedMap</span></code></a>, returns a <a class="reference internal" href="#lingvo.core.py_utils.NestedMap" title="lingvo.core.py_utils.NestedMap"><code class="xref py py-obj docutils literal notranslate"><span class="pre">NestedMap</span></code></a> with each field
concatenated from corresponding fields of input splits.</p></li>
</ul>
</p>
</dd>
<dt class="field-odd">Raises</dt>
<dd class="field-odd"><ul class="simple">
<li><p><a class="reference external" href="https://docs.python.org/3.7/library/exceptions.html#TypeError" title="(in Python v3.7)"><strong>TypeError</strong></a> – if ‘splits’ is not a list or elements of ‘splits’ do not have
    known or matching types.</p></li>
<li><p><a class="reference external" href="https://docs.python.org/3.7/library/exceptions.html#ValueError" title="(in Python v3.7)"><strong>ValueError</strong></a> – if ‘splits’ is empty or elements of ‘splits’ do not have
    matching structures.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="lingvo.core.py_utils.WeightedAvg">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">WeightedAvg</code><span class="sig-paren">(</span><em class="sig-param">values</em>, <em class="sig-param">weights</em>, <em class="sig-param">sum_reduction_fn=&lt;function reduce_sum&gt;</em>, <em class="sig-param">name=''</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#WeightedAvg"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.WeightedAvg" title="Permalink to this definition">¶</a></dt>
<dd><p>Computes weighted average of values from a tensor.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>values</strong> – a tensor of values</p></li>
<li><p><strong>weights</strong> – a tensor of weights</p></li>
<li><p><strong>sum_reduction_fn</strong> – called to reduce the values and weights to single value</p></li>
<li><p><strong>name</strong> – name of metric.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><p>A tuple (avg, total_weight).</p>
<ul class="simple">
<li><p>avg: weighted average value</p></li>
<li><p>total_weight: sum of all weights</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="lingvo.core.py_utils.WeightedAvgOfMetrics">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">WeightedAvgOfMetrics</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">metrics</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#WeightedAvgOfMetrics"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.WeightedAvgOfMetrics" title="Permalink to this definition">¶</a></dt>
<dd><p>Computes the weighted average of metrics in the list.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>metrics</strong> – list of dictionaries of metrics</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>ret_dict - dictionary of weighted averages of each metrics.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="lingvo.core.py_utils.ConcatPerExampleTensors">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">ConcatPerExampleTensors</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">per_example</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#ConcatPerExampleTensors"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.ConcatPerExampleTensors" title="Permalink to this definition">¶</a></dt>
<dd><p>Concatenate per-example tensors from many hosts into one large block.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>per_example</strong> – list of dictionaries of per-example tensors.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>ret_dict - string -&gt; concatenated tensors.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="lingvo.core.py_utils.CombineMetrics">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">CombineMetrics</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">loss_metric_weight_pairs</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#CombineMetrics"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.CombineMetrics" title="Permalink to this definition">¶</a></dt>
<dd><p>Combines metrics from <code class="xref py py-obj docutils literal notranslate"><span class="pre">loss_metric_weight_pairs</span></code> according to weights.</p>
<p>Keys must either exist in all metrics, in which it will be processed as a
weighted sum, or exist in only one metrics, in which case it will be copied.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>loss_metric_weight_pairs</strong> – a list of (metrics, weight) pairs, where each
weight is a float and each metrics is a dict with str keys and
(metric_value, target_weight) values.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A dict with the same set of keys as input metrics and values of
(weighted_sum(metric_value), weighted_sum(target_weight)).</p>
</dd>
<dt class="field-odd">Raises</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3.7/library/exceptions.html#ValueError" title="(in Python v3.7)"><strong>ValueError</strong></a> – if there exists a metric that exists in more than one element
    of <code class="xref py py-obj docutils literal notranslate"><span class="pre">loss_metric_weight_pairs</span></code> but not in all of them.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="lingvo.core.py_utils.AddVN">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">AddVN</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">p</span></em>, <em class="sig-param"><span class="n">x</span></em>, <em class="sig-param"><span class="n">per_step</span><span class="o">=</span><span class="default_value">False</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#AddVN"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.AddVN" title="Permalink to this definition">¶</a></dt>
<dd><p>Add variational noise to x.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>p</strong> – Layer params, with a <code class="xref py py-obj docutils literal notranslate"><span class="pre">vn</span></code> subparam containing <a class="reference internal" href="#lingvo.core.py_utils.VariationalNoiseParams" title="lingvo.core.py_utils.VariationalNoiseParams"><code class="xref py py-obj docutils literal notranslate"><span class="pre">VariationalNoiseParams</span></code></a>.</p></li>
<li><p><strong>x</strong> – Input to add variational noise to.</p></li>
<li><p><strong>per_step</strong> – Whether to add per_step noise.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>The input with variational noise added according to params.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="lingvo.core.py_utils.VariationalNoiseParams">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">VariationalNoiseParams</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">scale</span></em>, <em class="sig-param"><span class="n">global_vn</span><span class="o">=</span><span class="default_value">False</span></em>, <em class="sig-param"><span class="n">per_step_vn</span><span class="o">=</span><span class="default_value">False</span></em>, <em class="sig-param"><span class="n">seed</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">deterministic</span><span class="o">=</span><span class="default_value">False</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#VariationalNoiseParams"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.VariationalNoiseParams" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a hyperparams for variational noise.</p>
</dd></dl>

<dl class="py function">
<dt id="lingvo.core.py_utils.DefaultVN">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">DefaultVN</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#DefaultVN"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.DefaultVN" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt id="lingvo.core.py_utils.DisableVN">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">DisableVN</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#DisableVN"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.DisableVN" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt id="lingvo.core.py_utils.GetStepSeed">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">GetStepSeed</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#GetStepSeed"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.GetStepSeed" title="Permalink to this definition">¶</a></dt>
<dd><p>Gets step_seed.</p>
</dd></dl>

<dl class="py function">
<dt id="lingvo.core.py_utils.ResetStepSeed">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">ResetStepSeed</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">seed</span><span class="o">=</span><span class="default_value">0</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#ResetStepSeed"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.ResetStepSeed" title="Permalink to this definition">¶</a></dt>
<dd><p>Resets step_seed to specified value.</p>
</dd></dl>

<dl class="py function">
<dt id="lingvo.core.py_utils.MaybeResetStepSeedFromScope">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">MaybeResetStepSeedFromScope</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#MaybeResetStepSeedFromScope"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.MaybeResetStepSeedFromScope" title="Permalink to this definition">¶</a></dt>
<dd><p>In graph mode, resets step_seed according to the current named scope.</p>
<p>This is used in graph mode to avoid “tensor is from a different graph”
errors that happen when we share random seend tensors too much.
See b/129159299 for more context.</p>
<p>Eager mode does not have this problem, so in eager mode we do nothing.</p>
</dd></dl>

<dl class="py function">
<dt id="lingvo.core.py_utils.MaybeResetStepSeed">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">MaybeResetStepSeed</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">seed</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#MaybeResetStepSeed"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.MaybeResetStepSeed" title="Permalink to this definition">¶</a></dt>
<dd><p>If we’re in graph mode, reset the step seed.</p>
</dd></dl>

<dl class="py function">
<dt id="lingvo.core.py_utils.GetIncStepSeed">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">GetIncStepSeed</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#GetIncStepSeed"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.GetIncStepSeed" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns and increments the step_seed.</p>
</dd></dl>

<dl class="py function">
<dt id="lingvo.core.py_utils.GenerateStepSeedPair">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">GenerateStepSeedPair</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">p</span></em>, <em class="sig-param"><span class="n">op_seed</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#GenerateStepSeedPair"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.GenerateStepSeedPair" title="Permalink to this definition">¶</a></dt>
<dd><p>Generates a seed pair for deterministic random operations in …</p>
<p>functional loops.</p>
<p>This function retrieves a unique seed pair on each call, based off the current
global step and step seed. The step seed ensures this function returns a
unique seed pair on each call: calling this function automatically increments
the step seed. The step seed is automatically reset at the beginning of each
global step in the model’s FProp and works transparently through recurrent.py.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>p</strong> – A hyperparams.Params object, containing keys ‘random_seed’ and
‘is_inference’.</p></li>
<li><p><strong>op_seed</strong> – An additional operation-level seed to apply.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A size 2 tensor of op seeds to use for stateless_random ops.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="lingvo.core.py_utils.DeterministicDropout">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">DeterministicDropout</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">x</span></em>, <em class="sig-param"><span class="n">keep_prob</span></em>, <em class="sig-param"><span class="n">seeds</span></em>, <em class="sig-param"><span class="n">noise_shape</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">name</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#DeterministicDropout"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.DeterministicDropout" title="Permalink to this definition">¶</a></dt>
<dd><p>Similar to <code class="xref py py-obj docutils literal notranslate"><span class="pre">tf.nn.dropout()</span></code>, but fully deterministic.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>x</strong> – A float Tensor on which to apply dropout.</p></li>
<li><p><strong>keep_prob</strong> – A scalar <code class="xref py py-obj docutils literal notranslate"><span class="pre">Tensor</span></code> of keep probability.</p></li>
<li><p><strong>seeds</strong> – A Tensor of shape [2]. 2 seeds for deterministic random number
generator.</p></li>
<li><p><strong>noise_shape</strong> – A 1-D <code class="xref py py-obj docutils literal notranslate"><span class="pre">Tensor</span></code> of type <code class="xref py py-obj docutils literal notranslate"><span class="pre">int32</span></code>, representing the shape for
randomly generated keep/drop flags.</p></li>
<li><p><strong>name</strong> – An optional name for this operation.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A Tensor with the same shape as <code class="xref py py-obj docutils literal notranslate"><span class="pre">x</span></code>.</p>
</dd>
<dt class="field-odd">Raises</dt>
<dd class="field-odd"><p><strong>InvalidArgumentError</strong> – if keep_prob is invalid.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="lingvo.core.py_utils.DeterministicVN">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">DeterministicVN</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">params</span></em>, <em class="sig-param"><span class="n">seeds</span></em>, <em class="sig-param"><span class="n">noise_shape</span></em>, <em class="sig-param"><span class="n">mean</span><span class="o">=</span><span class="default_value">0.0</span></em>, <em class="sig-param"><span class="n">std</span><span class="o">=</span><span class="default_value">1.0</span></em>, <em class="sig-param"><span class="n">name</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#DeterministicVN"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.DeterministicVN" title="Permalink to this definition">¶</a></dt>
<dd><p>Produces Fully deterministic Gaussian noise from shape, mean and std.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>params</strong> – Nested map of params.</p></li>
<li><p><strong>seeds</strong> – A Tensor of shape [2]. 2 seeds for deterministic random number
generator.</p></li>
<li><p><strong>noise_shape</strong> – A 1-D <code class="xref py py-obj docutils literal notranslate"><span class="pre">Tensor</span></code> of type <code class="xref py py-obj docutils literal notranslate"><span class="pre">int32</span></code>, representing the shape for
randomly generated Gaussian noise.</p></li>
<li><p><strong>mean</strong> – Mean for the Gaussian noise.</p></li>
<li><p><strong>std</strong> – Standard deviation for noise.</p></li>
<li><p><strong>name</strong> – An optional name for this operation.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A Tensor with the shape noise_shape and type fprop_dtype.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="lingvo.core.py_utils.UpdateBatchNormVars">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">UpdateBatchNormVars</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">batch_norm_var</span></em>, <em class="sig-param"><span class="n">batch_norm_stats</span></em>, <em class="sig-param"><span class="n">decay</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#UpdateBatchNormVars"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.UpdateBatchNormVars" title="Permalink to this definition">¶</a></dt>
<dd><p>Update batch normalization moving averages.</p>
</dd></dl>

<dl class="py function">
<dt id="lingvo.core.py_utils.FindRelevantBatchNormUpdates">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">FindRelevantBatchNormUpdates</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">loss</span></em>, <em class="sig-param"><span class="n">batch_norm_updates</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#FindRelevantBatchNormUpdates"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.FindRelevantBatchNormUpdates" title="Permalink to this definition">¶</a></dt>
<dd><p>Finds and returns a list of relevant batch-normalization updates.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>loss</strong> – The loss that is being optimized for. A tensor or a list of tensors.</p></li>
<li><p><strong>batch_norm_updates</strong> – A list of batch normalization updates.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A pair of lists. The first list contains all the batch normalization updates
that are relevant to the loss being optimized, and the second list contains
all in batch_norm_updates but not in the first list.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="lingvo.core.py_utils.SampleStep">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">SampleStep</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">step</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#SampleStep"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.SampleStep" title="Permalink to this definition">¶</a></dt>
<dd><p>A context for a sample step during decoding.</p>
<p>Example usage:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">py_utils</span><span class="o">.</span><span class="n">SampleStep</span><span class="p">(</span><span class="n">step</span><span class="p">):</span>
  <span class="n">sample</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">DecodeOneStep</span><span class="p">()</span>
</pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>step</strong> – the step tensor.</p>
</dd>
<dt class="field-even">Yields</dt>
<dd class="field-even"><p>a context manager for the step scope.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="lingvo.core.py_utils._GetSampleStep">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">_GetSampleStep</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#_GetSampleStep"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils._GetSampleStep" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt id="lingvo.core.py_utils.AddDebugTensor">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">AddDebugTensor</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">tensor</span></em>, <em class="sig-param"><span class="n">summarize</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">name</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#AddDebugTensor"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.AddDebugTensor" title="Permalink to this definition">¶</a></dt>
<dd><p>Adds <code class="xref py py-obj docutils literal notranslate"><span class="pre">tensor</span></code> to the debug collection.</p>
<p>Prints the tensor if <code class="xref py py-obj docutils literal notranslate"><span class="pre">--print_debug_tensors</span></code> is True.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>tensor</strong> – A tensor.</p></li>
<li><p><strong>summarize</strong> – Only print this many entries of each tensor. If None, then a
maximum of 3 elements are printed per input tensor.</p></li>
<li><p><strong>name</strong> – An optional name for the tensor.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A Tensor that evaluates to the same value as the input tensor.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="lingvo.core.py_utils.ArgMax">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">ArgMax</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">inputs</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#ArgMax"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.ArgMax" title="Permalink to this definition">¶</a></dt>
<dd><p>tf.argmax wrapper.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>inputs</strong> – A tensor, whose last dimension is being reduced on.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A tensor of rank tf.rank(logits)-1. If i == ret[indices],
logits[indices, i] is the maximum among logits[indices, :].</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="lingvo.core.py_utils._EnsureMatrixShape">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">_EnsureMatrixShape</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">x</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#_EnsureMatrixShape"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils._EnsureMatrixShape" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt id="lingvo.core.py_utils.Matmul">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">Matmul</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">x</span></em>, <em class="sig-param"><span class="n">y</span></em>, <em class="sig-param"><span class="o">*</span><span class="n">args</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#Matmul"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.Matmul" title="Permalink to this definition">¶</a></dt>
<dd><p>tf.matmul wrapper expecting x and y are actually matrices.</p>
</dd></dl>

<dl class="py function">
<dt id="lingvo.core.py_utils.clip_by_value">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">clip_by_value</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">t</span></em>, <em class="sig-param"><span class="n">clip_value_min</span></em>, <em class="sig-param"><span class="n">clip_value_max</span></em>, <em class="sig-param"><span class="n">name</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#clip_by_value"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.clip_by_value" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt id="lingvo.core.py_utils._TransformAndSum">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">_TransformAndSum</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">tensor_list</span></em>, <em class="sig-param"><span class="n">transform</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#_TransformAndSum"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils._TransformAndSum" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt id="lingvo.core.py_utils.SumSquared">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">SumSquared</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">tensor_list</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#SumSquared"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.SumSquared" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt id="lingvo.core.py_utils.SumAbs">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">SumAbs</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">tensor_list</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#SumAbs"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.SumAbs" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt id="lingvo.core.py_utils.PiecewiseConstant">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">PiecewiseConstant</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">x_in</span></em>, <em class="sig-param"><span class="n">boundaries</span></em>, <em class="sig-param"><span class="n">values</span></em>, <em class="sig-param"><span class="n">vdtype</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#PiecewiseConstant"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.PiecewiseConstant" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the piecewise value of x_in.</p>
</dd></dl>

<dl class="py function">
<dt id="lingvo.core.py_utils.PadSequenceDimension">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">PadSequenceDimension</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">x</span></em>, <em class="sig-param"><span class="n">length</span></em>, <em class="sig-param"><span class="n">pad_val</span></em>, <em class="sig-param"><span class="n">shape</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#PadSequenceDimension"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.PadSequenceDimension" title="Permalink to this definition">¶</a></dt>
<dd><p>Pads x to <code class="xref py py-obj docutils literal notranslate"><span class="pre">length</span></code> using <code class="xref py py-obj docutils literal notranslate"><span class="pre">pad_val</span></code> along the second dim.</p>
<p>Assumes <code class="xref py py-obj docutils literal notranslate"><span class="pre">x</span></code> is a tensor with rank &gt;= 2, and it only pads <code class="xref py py-obj docutils literal notranslate"><span class="pre">x</span></code> to <code class="xref py py-obj docutils literal notranslate"><span class="pre">length</span></code>
along the second dim. Explicitly sets the returned tensor shape to <code class="xref py py-obj docutils literal notranslate"><span class="pre">shape</span></code> if
given. Raises runtime errors if x.shape[1] &gt; length or x.shape[i] != shape[i]
where i != 1.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>x</strong> – the tensor to be padded with shape [batch, seq_len, …].</p></li>
<li><p><strong>length</strong> – an int to specify the length to pad x to.</p></li>
<li><p><strong>pad_val</strong> – an int or float used to pad x.</p></li>
<li><p><strong>shape</strong> – an int array specifying the shape of the padded tensor if specified.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>The padded tensor with shape [batch, seq_len, …], where
ret[:, :seq_len, …] == x.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="lingvo.core.py_utils.PadSequenceTo">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">PadSequenceTo</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">xs</span></em>, <em class="sig-param"><span class="n">padding</span></em>, <em class="sig-param"><span class="n">length</span></em>, <em class="sig-param"><span class="n">pad_val</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#PadSequenceTo"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.PadSequenceTo" title="Permalink to this definition">¶</a></dt>
<dd><p>Pads <code class="xref py py-obj docutils literal notranslate"><span class="pre">xs</span></code> and <code class="xref py py-obj docutils literal notranslate"><span class="pre">padding</span></code> to <code class="xref py py-obj docutils literal notranslate"><span class="pre">length</span></code> using <code class="xref py py-obj docutils literal notranslate"><span class="pre">pad_val</span></code> along the 2nd dim.</p>
<p>Pads <code class="xref py py-obj docutils literal notranslate"><span class="pre">xs</span></code> to <code class="xref py py-obj docutils literal notranslate"><span class="pre">length</span></code> using <code class="xref py py-obj docutils literal notranslate"><span class="pre">pad_val</span></code>, and <code class="xref py py-obj docutils literal notranslate"><span class="pre">padding</span></code> using 1.
Raise error if <code class="xref py py-obj docutils literal notranslate"><span class="pre">x.shape[:2]</span></code> and <code class="xref py py-obj docutils literal notranslate"><span class="pre">padding.shape</span></code> are not the same.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>xs</strong> – A Tensor or a list of Tensors of shape [batch, seqlen] or [batch,
seqlen, …].</p></li>
<li><p><strong>padding</strong> – A 0/1 Tensor of shape [batch, seqlen]. 1 is for padded locations.</p></li>
<li><p><strong>length</strong> – A Python int, the length to pad to.</p></li>
<li><p><strong>pad_val</strong> – A Python numeric, used for padding x.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A tuple of padded xs and padding.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="lingvo.core.py_utils.ApplyPadding">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">ApplyPadding</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">padding</span></em>, <em class="sig-param"><span class="n">x</span></em>, <em class="sig-param"><span class="n">padded</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">broadcast</span><span class="o">=</span><span class="default_value">True</span></em>, <em class="sig-param"><span class="n">use_select</span><span class="o">=</span><span class="default_value">True</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#ApplyPadding"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.ApplyPadding" title="Permalink to this definition">¶</a></dt>
<dd><p>Applies padding to a tensor.</p>
<p>This is preferable to using arithmetic means for masking out padded values
such as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Equiv to ApplyPadding(padding, x))</span>
<span class="n">x</span> <span class="o">*=</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="n">padding</span>
<span class="c1"># Equiv to ApplyPadding(padding, new, old)</span>
<span class="n">new</span> <span class="o">=</span> <span class="n">old</span> <span class="o">*</span> <span class="n">padding</span> <span class="o">+</span> <span class="n">new</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">padding</span><span class="p">)</span>
</pre></div>
</div>
<p>Aside from just being easier to read and reason about, using this function
is friendly to quantized representations because it does not mix arithmetic
on the padding values with the values in the tensor being padded (which can
have a very different range than the 0..1 padding tensor).</p>
<p>In addition, this works around issues in quantized schemes where we are
guaranteed to have an exact 0 but not necessarily any other number (i.e. 1).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>padding</strong> – Tensor of padding values where 0 == keep and 1 == pad.</p></li>
<li><p><strong>x</strong> – Tensor to apply padding to.</p></li>
<li><p><strong>padded</strong> – Optional. Values to include for padded elements. Defaults to zeros.
Must be the same shape as ‘x’ if specified.</p></li>
<li><p><strong>broadcast</strong> – Whether to broadcast the padding shape to the shape of ‘x’. You
almost certainly want this to be true as it matches how padding would be
expanded if applied arithmetically.</p></li>
<li><p><strong>use_select</strong> – Controls whether padding is applied with a select-mask
(True/default) or arithmetically (False). Some platforms have a
sensitivity to one or the other and this is used to work around such
issues.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A tensor with the same shape as x with padded values masked.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="lingvo.core.py_utils.LengthsFromPaddings">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">LengthsFromPaddings</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">paddings</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#LengthsFromPaddings"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.LengthsFromPaddings" title="Permalink to this definition">¶</a></dt>
<dd><p>Computes lengths of each sequence in a batch, ignoring trailing padding.</p>
<p>Note the following isn’t guaranteed due to leading paddings.
PaddingsFromLengths(LengthsFromPaddings(x)) == x</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>paddings</strong> – a tensor with shape [batch, length].</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>lengths tensor shaped [batch] containing the unpadded length of each
sequence in the batch.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="lingvo.core.py_utils.PaddingsFromLengths">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">PaddingsFromLengths</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">lengths</span></em>, <em class="sig-param"><span class="n">maxlen</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#PaddingsFromLengths"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.PaddingsFromLengths" title="Permalink to this definition">¶</a></dt>
<dd><p>Computes paddings Tensor from lengths.</p>
<p>Note the following isn’t guaranteed due to leading paddings.
PaddingsFromLengths(LengthsFromPaddings(x)) == x.</p>
<p>This method does not generate leading paddings.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>lengths</strong> – A int32 Tensor of shape [B].</p></li>
<li><p><strong>maxlen</strong> – None or a Python int or a scalar Tensor.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A 0/1 valued Tensor of shape [B, maxlen or ?] where 1s are padded positions.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="lingvo.core.py_utils.TrimTrailingPaddings">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">TrimTrailingPaddings</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">inputs</span></em>, <em class="sig-param"><span class="n">paddings</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#TrimTrailingPaddings"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.TrimTrailingPaddings" title="Permalink to this definition">¶</a></dt>
<dd><p>Trims trailing paddings from inputs.</p>
<p>Since the number of dimensions is not fixed, this will not work on TPU.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>inputs</strong> – a tensor with shape [batch, length, …].</p></li>
<li><p><strong>paddings</strong> – a tensor with shape [batch, length].</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>Trimmed inputs and paddings. For compatibility reasons, the trimmed tensors
will always have length at least 1.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="lingvo.core.py_utils.ReversePaddedSequence">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">ReversePaddedSequence</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">inputs</span></em>, <em class="sig-param"><span class="n">paddings</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#ReversePaddedSequence"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.ReversePaddedSequence" title="Permalink to this definition">¶</a></dt>
<dd><p>Reverse inputs based on paddings.</p>
<p>Only reverse the unpadded portion of <code class="xref py py-obj docutils literal notranslate"><span class="pre">inputs</span></code>. It assumes inputs are only
padded in the end.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>inputs</strong> – a tensor of [seq_length, batch_size, num_input_nodes].</p></li>
<li><p><strong>paddings</strong> – a tensor of float32/float64 zero or one of shape [seq_length,
batch_size, 1].</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A reversed tensor of the same shape as <code class="xref py py-obj docutils literal notranslate"><span class="pre">inputs</span></code>.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="lingvo.core.py_utils.ConcatenatePaddedSequences">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">ConcatenatePaddedSequences</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">input0</span></em>, <em class="sig-param"><span class="n">input1</span></em>, <em class="sig-param"><span class="n">padding0</span></em>, <em class="sig-param"><span class="n">padding1</span></em>, <em class="sig-param"><span class="n">seq_dim</span><span class="o">=</span><span class="default_value">1</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#ConcatenatePaddedSequences"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.ConcatenatePaddedSequences" title="Permalink to this definition">¶</a></dt>
<dd><p>Concatenates input sequences with varying lenghts as defined by paddings.</p>
<p>This is a helper function for concatenating 2 batches of input sequences,
where each example in the batch can have different lengths, as defined by
the corresponding paddings. To concatenate correctly, it makes use of
tf.reverse_sequence to partially reverse the sequences before
concatenating them together.</p>
<p>NOTE: We assume that the tensors have no leading paddings.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>input0</strong> – A tensor of size [batch, max_length, …] or [max_length, batch,
…] depending on the value set for axis.</p></li>
<li><p><strong>input1</strong> – A tensor of size [batch, max_length, …] or [max_length, batch,
…] depending on the value set for axis.</p></li>
<li><p><strong>padding0</strong> – A Tensor of size [batch, max_length] or [max_length, batch]
corresponding to the padding for input0.</p></li>
<li><p><strong>padding1</strong> – A Tensor of size [batch, max_length] or [max_length, batch]
corresponding to the padding for input1.</p></li>
<li><p><strong>seq_dim</strong> – int, the time axis along which the tensors will be concatenated.
Should be 0 or 1. Assumes that batch_dim is 1 - seq_dim.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>The concatenation of input0 and input1, and the corresponding padding.</p>
</dd>
<dt class="field-odd">Raises</dt>
<dd class="field-odd"><p><strong>tf.errors.InvalidArgumentError when seq_dim is not 0</strong><strong> or </strong><strong>1.</strong> – </p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="lingvo.core.py_utils.ShiftLeft">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">ShiftLeft</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">tensor</span></em>, <em class="sig-param"><span class="n">shift_size</span></em>, <em class="sig-param"><span class="n">pad_val</span><span class="o">=</span><span class="default_value">0</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#ShiftLeft"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.ShiftLeft" title="Permalink to this definition">¶</a></dt>
<dd><p>Shifts the values in a tensor to the left along the time dimension (dim 1).</p>
<p>The first shift_size values are dropped, and the tensor is padded on the
right with pad_val.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>tensor</strong> – the input tensor to modify shaped [batch, time, …].</p></li>
<li><p><strong>shift_size</strong> – the number of frames &gt;= 0 to shift.</p></li>
<li><p><strong>pad_val</strong> – the value to pad on the right of the tensor.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A left shifted tensor.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="lingvo.core.py_utils.Retry">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">Retry</code><span class="sig-paren">(</span><em class="sig-param"><span class="o">*</span><span class="n">args</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#Retry"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.Retry" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt id="lingvo.core.py_utils.RetryOnTransientTfError">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">RetryOnTransientTfError</code><span class="sig-paren">(</span><em class="sig-param"><span class="o">*</span><span class="n">args</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#RetryOnTransientTfError"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.RetryOnTransientTfError" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt id="lingvo.core.py_utils.PadOrTrimTo">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">PadOrTrimTo</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">x</span></em>, <em class="sig-param"><span class="n">shape</span></em>, <em class="sig-param"><span class="n">pad_val</span><span class="o">=</span><span class="default_value">0</span></em>, <em class="sig-param"><span class="n">pad_after_contents</span><span class="o">=</span><span class="default_value">True</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#PadOrTrimTo"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.PadOrTrimTo" title="Permalink to this definition">¶</a></dt>
<dd><p>Pad and slice x to the given shape.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>x</strong> – A tensor.</p></li>
<li><p><strong>shape</strong> – The shape of the returned tensor.</p></li>
<li><p><strong>pad_val</strong> – An int or float used to pad x.</p></li>
<li><p><strong>pad_after_contents</strong> – Whether to pad and trim after the original contents of
each dimension.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>‘x’ is padded with pad_val and sliced so that the result has the given
shape.</p>
</dd>
<dt class="field-odd">Raises</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3.7/library/exceptions.html#ValueError" title="(in Python v3.7)"><strong>ValueError</strong></a> – if shape is a tf.TensorShape and not fully defined.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="lingvo.core.py_utils.RepeatDim">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">RepeatDim</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">tensor</span></em>, <em class="sig-param"><span class="n">multiple</span></em>, <em class="sig-param"><span class="n">axis</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#RepeatDim"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.RepeatDim" title="Permalink to this definition">¶</a></dt>
<dd><p>Copies elements in tensor’s axis “multiple” times, like np.repeat.</p>
</dd></dl>

<dl class="py function">
<dt id="lingvo.core.py_utils.StackTensorsRecursively">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">StackTensorsRecursively</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">values</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#StackTensorsRecursively"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.StackTensorsRecursively" title="Permalink to this definition">¶</a></dt>
<dd><p>Recursively stacks Tensors in a list of <a class="reference internal" href="#lingvo.core.py_utils.NestedMap" title="lingvo.core.py_utils.NestedMap"><code class="xref py py-obj docutils literal notranslate"><span class="pre">NestedMap</span></code></a>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>values</strong> – a list of <a class="reference internal" href="#lingvo.core.py_utils.NestedMap" title="lingvo.core.py_utils.NestedMap"><code class="xref py py-obj docutils literal notranslate"><span class="pre">NestedMap</span></code></a> or Tensors to stacks.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A <a class="reference internal" href="#lingvo.core.py_utils.NestedMap" title="lingvo.core.py_utils.NestedMap"><code class="xref py py-obj docutils literal notranslate"><span class="pre">NestedMap</span></code></a> with stacked values or a stacked Tensor.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="lingvo.core.py_utils.MixByWeight">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">MixByWeight</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">inputs</span></em>, <em class="sig-param"><span class="n">weights</span></em>, <em class="sig-param"><span class="n">seed</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#MixByWeight"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.MixByWeight" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a weighted random choice and bprop type from the give inputs.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>inputs</strong> – a list of callables, where each callable returns a tf.Tensor or a
nested structure containing tf.Tensor. Function return types must be
consistent across elements. The tf.Operation to compute the result tensor
will only be invoked for one input at a time. For example, if each fn
represents an input record stream, a record will be drawn only from a
selected stream while the other streams will remain unchanged.</p></li>
<li><p><strong>weights</strong> – a 1D tensor of float &gt; 0 of the same length as inputs.</p></li>
<li><p><strong>seed</strong> – random seed.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A probablistic sample from the inputs proportional to the weights. The
return type will be the same as return type of individual ‘fn’ from the
inputs.
A one-hot vector of the source selected.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="lingvo.core.py_utils.CheckShapes">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">CheckShapes</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">shapes</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#CheckShapes"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.CheckShapes" title="Permalink to this definition">¶</a></dt>
<dd><p>Asserts that shapes is a tuple of NestedMap or tshape.Shape.</p>
</dd></dl>

<dl class="py function">
<dt id="lingvo.core.py_utils.FPropDtype">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">FPropDtype</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">params</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#FPropDtype"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.FPropDtype" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt id="lingvo.core.py_utils.UpdateFpropDtype">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">UpdateFpropDtype</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">params</span></em>, <em class="sig-param"><span class="n">fprop_dtype</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#UpdateFpropDtype"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.UpdateFpropDtype" title="Permalink to this definition">¶</a></dt>
<dd><p>Recursively update the fprop_dtype of the Params.</p>
</dd></dl>

<dl class="py function">
<dt id="lingvo.core.py_utils.UpdateDtype">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">UpdateDtype</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">params</span></em>, <em class="sig-param"><span class="n">dtype</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#UpdateDtype"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.UpdateDtype" title="Permalink to this definition">¶</a></dt>
<dd><p>Recursively update the dtype of the Params.</p>
</dd></dl>

<dl class="py function">
<dt id="lingvo.core.py_utils.NameScopeDecorator">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">NameScopeDecorator</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">name_scope</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#NameScopeDecorator"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.NameScopeDecorator" title="Permalink to this definition">¶</a></dt>
<dd><p>Decorates a python function to introduce a tf.name_scope.</p>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@py_utils</span><span class="o">.</span><span class="n">NameScopeDecorator</span><span class="p">(</span><span class="s1">&#39;foobar&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">MyFoobarMethod</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
  <span class="c1"># ... Do TF things</span>
</pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>name_scope</strong> – The name scope to introduce.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A function decorator.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="lingvo.core.py_utils.SequencesToDebugStrings">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">SequencesToDebugStrings</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">ids</span></em>, <em class="sig-param"><span class="n">lens</span></em>, <em class="sig-param"><span class="n">summarize</span><span class="o">=</span><span class="default_value">5</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#SequencesToDebugStrings"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.SequencesToDebugStrings" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns debug strings for the given sequences.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ids</strong> – int32 of [batch, len].</p></li>
<li><p><strong>lens</strong> – int32 of [batch].</p></li>
<li><p><strong>summarize</strong> – number of ids to summarize per sequence.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A string tensor of [batch].</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="lingvo.core.py_utils.RematerializeFn">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">RematerializeFn</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">fn</span></em>, <em class="sig-param"><span class="o">*</span><span class="n">xs</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#RematerializeFn"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.RematerializeFn" title="Permalink to this definition">¶</a></dt>
<dd><p>Calls fn and rematerializes fn in the backward pass.</p>
<p><code class="xref py py-obj docutils literal notranslate"><span class="pre">fn(*xs)</span> <span class="pre">-&gt;</span> <span class="pre">ys</span></code>, where xs and ys can be a single tensor or a tuple of tensors.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>fn</strong> – A python function to be rematerialized in the backprop pass.</p></li>
<li><p><strong>*xs</strong> – A single tensor or a list/tuple of tensors. <code class="xref py py-obj docutils literal notranslate"><span class="pre">xs</span></code> are input args to the
fn function.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">fn(*xs)</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="lingvo.core.py_utils.StatefulRandomOpsInDefun">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">StatefulRandomOpsInDefun</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">func</span></em>, <em class="sig-param"><span class="n">graph</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#StatefulRandomOpsInDefun"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.StatefulRandomOpsInDefun" title="Permalink to this definition">¶</a></dt>
<dd><p>Checks whether the Defun depends on stateful random number ops.</p>
<p>Stateful random number generator ops should be avoid in Recurrent() call.
Otherwise, these ops produce inconsistent values between FProp and BProp.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>func</strong> – a _DefinedFunction or ConcreteFunction to check.</p></li>
<li><p><strong>graph</strong> – a Graph. Set None to use the default graph.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A list of names of the stateful random ops.</p>
</dd>
<dt class="field-odd">Raises</dt>
<dd class="field-odd"><p><strong>InvalidArgumentError</strong> – if the input func/graph is invalid.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="lingvo.core.py_utils.ToPlaceholders">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">ToPlaceholders</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">nmap</span></em>, <em class="sig-param"><span class="n">dtype</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#ToPlaceholders"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.ToPlaceholders" title="Permalink to this definition">¶</a></dt>
<dd><p>Converts every Tensor in nmap to a placeholder.</p>
</dd></dl>

<dl class="py function">
<dt id="lingvo.core.py_utils.Softmax">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">Softmax</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">logits</span></em>, <em class="sig-param"><span class="n">axis</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">extra_logit</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">name</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#Softmax"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.Softmax" title="Permalink to this definition">¶</a></dt>
<dd><p>Softmax with extra_logits, might be useful for large xformer LM.</p>
</dd></dl>

<dl class="py function">
<dt id="lingvo.core.py_utils.SoftmaxCrossEntropyFocalLoss">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">SoftmaxCrossEntropyFocalLoss</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">logits</span></em>, <em class="sig-param"><span class="n">label_ids</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">label_probs</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">alpha</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">gamma</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">stop_gradient_on_focal_loss_coefficient</span><span class="o">=</span><span class="default_value">False</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#SoftmaxCrossEntropyFocalLoss"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.SoftmaxCrossEntropyFocalLoss" title="Permalink to this definition">¶</a></dt>
<dd><p>Focal loss for multinomial (softmax) logistic loss.</p>
<p>[1] Focal loss <a class="reference external" href="https://arxiv.org/abs/1708.02002">https://arxiv.org/abs/1708.02002</a></p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>logits</strong> – […, C]. Logits for the multinomial logistic regression. C is the
number of classes.</p></li>
<li><p><strong>label_ids</strong> – […]. Each entry in labels must be an index in [0, C).</p></li>
<li><p><strong>label_probs</strong> – […, C]. Each vector along last dimension must be a valid
probability distribution.</p></li>
<li><p><strong>alpha</strong> – [C]. The weighting factor alpha. Eq (3) in [1].</p></li>
<li><p><strong>gamma</strong> – []. Tunable focusing parameter. Eq (4) in [1].</p></li>
<li><p><strong>stop_gradient_on_focal_loss_coefficient</strong> – If true, stops gradient on the
focal loss coefficient (1-p)^gamma to stabilize the gradient.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>loss[i…, j] = FL(pₜ) = - αₜ(1-pₜ)ˠlog(pₜ) Eq (5) in [1].</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="lingvo.core.py_utils.SigmoidCrossEntropyFocalLoss">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">SigmoidCrossEntropyFocalLoss</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">logits</span></em>, <em class="sig-param"><span class="n">labels</span></em>, <em class="sig-param"><span class="n">alpha</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">gamma</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#SigmoidCrossEntropyFocalLoss"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.SigmoidCrossEntropyFocalLoss" title="Permalink to this definition">¶</a></dt>
<dd><p>Focal loss for binary (sigmoid) logistic loss.</p>
<p>[1] Focal loss <a class="reference external" href="https://arxiv.org/abs/1708.02002">https://arxiv.org/abs/1708.02002</a></p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>logits</strong> – […, C]. Logits for the sigmoid logistic regression.</p></li>
<li><p><strong>labels</strong> – […, C]. 0/1 labels.</p></li>
<li><p><strong>alpha</strong> – The weighting factor alpha. Eq (3) in [1].</p></li>
<li><p><strong>gamma</strong> – Tunable focusing parameter. Eq (4) in [1].</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>loss[i…, j] = FL(pₜ) = - αₜ(1-pₜ)ˠlog(pₜ) Eq (5) in [1].</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="lingvo.core.py_utils.RecordFormatFromFilePattern">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">RecordFormatFromFilePattern</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">file_pattern</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#RecordFormatFromFilePattern"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.RecordFormatFromFilePattern" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the record format string for a Lingvo file pattern.</p>
<dl class="simple">
<dt>Lingvo file patterns take the form of:</dt><dd><p>tfrecord:/path/to/bar -&gt; tfrecord is the record_format.</p>
</dd>
</dl>
<p>This function takes a file pattern and returns a string indicating
which format the filepattern implies.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>file_pattern</strong> – String file pattern.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><ul class="simple">
<li><p>record_format: String record format, e.g., “tfrecord”, etc.</p></li>
<li><p>file_pattern: The file pattern without any prefixes.</p></li>
</ul>
</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>Tuple (string, string)</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="lingvo.core.py_utils.ReadFileLines">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">ReadFileLines</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">file_path</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#ReadFileLines"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.ReadFileLines" title="Permalink to this definition">¶</a></dt>
<dd><p>Read a text file and return the lines.</p>
<p>If the file cannot be found at the given path, attempt to load it from the
Lingvo package (useful for data dependencies in par files).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>file_path</strong> – path to file, either absolute or relative to the bazel workspace.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A list of lines from the file.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="lingvo.core.py_utils.CumSum">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">CumSum</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">x</span></em>, <em class="sig-param"><span class="n">axis</span><span class="o">=</span><span class="default_value">0</span></em>, <em class="sig-param"><span class="n">exclusive</span><span class="o">=</span><span class="default_value">False</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#CumSum"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.CumSum" title="Permalink to this definition">¶</a></dt>
<dd><p>A TPU efficient implementation of tf.cumsum().</p>
<p>This is equivalent to tf.cumsum and is faster on TPU as of 08/2019 unless
the axis dimension is very large. The current Tensorflow implementation is
based on scanning and reducing which is not efficient on TPU.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>x</strong> – An input Tensor.</p></li>
<li><p><strong>axis</strong> – An int for the axis.</p></li>
<li><p><strong>exclusive</strong> – A bool for performing exclusive cumsum.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A Tensor of the same shape as x.</p>
</dd>
<dt class="field-odd">Raises</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3.7/library/exceptions.html#ValueError" title="(in Python v3.7)"><strong>ValueError</strong></a> – if the input axis is invalid.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="lingvo.core.py_utils.ProjectLastDim">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">ProjectLastDim</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">inputs</span></em>, <em class="sig-param"><span class="n">weight</span></em>, <em class="sig-param"><span class="n">input_dim</span></em>, <em class="sig-param"><span class="n">output_dim</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#ProjectLastDim"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.ProjectLastDim" title="Permalink to this definition">¶</a></dt>
<dd><p>Linear projection on the last dim of the input tensor.</p>
<p>This is a TPU efficient implementation to avoid reshaping inputs to Rank-2
tensor by using Einsum for the compute.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>inputs</strong> – An input Tensor, the last dimension of which is input_dim.</p></li>
<li><p><strong>weight</strong> – A weight matrix with shape [input_dim, output_dim].</p></li>
<li><p><strong>input_dim</strong> – An integer or a symbolic dim, the last dimension of the inputs.</p></li>
<li><p><strong>output_dim</strong> – An integer or a symbolic dim, the last dimension of the outputs.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>An output Tensor of the same rank as inputs, the last dimension is
output_dim.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="lingvo.core.py_utils.RemoveAssertContext">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">RemoveAssertContext</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">remove</span><span class="o">=</span><span class="default_value">True</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#RemoveAssertContext"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.RemoveAssertContext" title="Permalink to this definition">¶</a></dt>
<dd><p>Hacks to replace certain unwanted tensorflow ops.</p>
</dd></dl>

<dl class="py function">
<dt id="lingvo.core.py_utils._AssertInputsMatch">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">_AssertInputsMatch</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">op</span></em>, <em class="sig-param"><span class="n">args</span></em>, <em class="sig-param"><span class="n">implicit_captures</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#_AssertInputsMatch"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils._AssertInputsMatch" title="Permalink to this definition">¶</a></dt>
<dd><p>Assert that op’s inputs match with args and implicit_captures.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>op</strong> – The operation to check.</p></li>
<li><p><strong>args</strong> – A nested structure representing the explicit arguments of ‘op’.</p></li>
<li><p><strong>implicit_captures</strong> – A nested structure representing the implicitly captured
inputs of ‘op’.</p></li>
</ul>
</dd>
<dt class="field-even">Raises</dt>
<dd class="field-even"><p><a class="reference external" href="https://docs.python.org/3.7/library/exceptions.html#ValueError" title="(in Python v3.7)"><strong>ValueError</strong></a> – if the number of inputs mismatch.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="lingvo.core.py_utils.TensorSpecs">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">TensorSpecs</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">nmap</span></em>, <em class="sig-param"><span class="n">keep_shape</span><span class="o">=</span><span class="default_value">True</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#TensorSpecs"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.TensorSpecs" title="Permalink to this definition">¶</a></dt>
<dd><p>Transforms tensors in the input nested structure to TensorSpecs.</p>
</dd></dl>

<dl class="py function">
<dt id="lingvo.core.py_utils._DefineDefun">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">_DefineDefun</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">fwd</span></em>, <em class="sig-param"><span class="n">fwd_sig</span></em>, <em class="sig-param"><span class="n">bak</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">bak_as_function</span><span class="o">=</span><span class="default_value">False</span></em>, <em class="sig-param"><span class="n">device</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#_DefineDefun"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils._DefineDefun" title="Permalink to this definition">¶</a></dt>
<dd><p>Wraps fwd in a defun with custom gradient bak.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>fwd</strong> – A callable xs: Nested Structure -&gt; ys: Nested Structure.</p></li>
<li><p><strong>fwd_sig</strong> – A Nested Structure of tf.TensorSpec representing the input
signature of <code class="xref py py-obj docutils literal notranslate"><span class="pre">fwd</span></code>, or None (meaning that fwd takes no inputs).</p></li>
<li><p><strong>bak</strong> – A callable xs, ys, dys: Nested Structure -&gt; dxs[, dcapture]: Nested
Structure. The custom backprop function for <code class="xref py py-obj docutils literal notranslate"><span class="pre">fwd</span></code>. bak needs to return
dcapture if fwd uses any implicitly captured tensors, whose gradients are
dcapture.</p></li>
<li><p><strong>bak_as_function</strong> – Whether to create a TF graph function for <code class="xref py py-obj docutils literal notranslate"><span class="pre">bak</span></code>.</p></li>
<li><p><strong>device</strong> – the device on which to run <code class="xref py py-obj docutils literal notranslate"><span class="pre">fwd</span></code> and <code class="xref py py-obj docutils literal notranslate"><span class="pre">bak</span></code>.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><ul class="simple">
<li><p>call: A callable that will execute <code class="xref py py-obj docutils literal notranslate"><span class="pre">fwd</span></code>. It has the same input and output
signatures as <code class="xref py py-obj docutils literal notranslate"><span class="pre">fwd</span></code>.</p></li>
<li><p>func: The underlying TF function that <code class="xref py py-obj docutils literal notranslate"><span class="pre">call</span></code> calls. If not None, it will
be a _DefinedFunction or ConcreteFunction that takes flat inputs and
returns flat outputs, and can be used by routines that require a TF
function object (e.g. tf.If, tf.While, etc).
Always not None when <code class="xref py py-obj docutils literal notranslate"><span class="pre">bak</span></code> is None.</p></li>
<li><p>output_dtypes: A nested structure compatible with the outputs of <code class="xref py py-obj docutils literal notranslate"><span class="pre">fwd</span></code>
containing the corresponding output dtypes.</p></li>
<li><p>stateful_ops: A list of (op_name, op_type) tuples representing the
stateful ops used by <code class="xref py py-obj docutils literal notranslate"><span class="pre">fwd</span></code>.</p></li>
<li><p>captured_inputs: Implicit inputs captured by <code class="xref py py-obj docutils literal notranslate"><span class="pre">fwd</span></code>.</p></li>
</ul>
</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>A NestedMap containing</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="lingvo.core.py_utils._SharedRendezvousScope">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">_SharedRendezvousScope</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">shared_rendezvous</span><span class="o">=</span><span class="default_value">True</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#_SharedRendezvousScope"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils._SharedRendezvousScope" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt id="lingvo.core.py_utils._GetSharedRendezvous">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">_GetSharedRendezvous</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#_GetSharedRendezvous"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils._GetSharedRendezvous" title="Permalink to this definition">¶</a></dt>
<dd><p>Get the current rendezvous sharing setting.</p>
</dd></dl>

<dl class="py function">
<dt id="lingvo.core.py_utils._ApplySharedRendezvous">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">_ApplySharedRendezvous</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">func</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#_ApplySharedRendezvous"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils._ApplySharedRendezvous" title="Permalink to this definition">¶</a></dt>
<dd><p>Apply the rendezvous sharing setting on the given tf.function func.</p>
</dd></dl>

<dl class="py function">
<dt id="lingvo.core.py_utils._WrapFunction">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">_WrapFunction</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">func</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">input_signature</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#_WrapFunction"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils._WrapFunction" title="Permalink to this definition">¶</a></dt>
<dd><p>Wraps func as a tf.function.</p>
</dd></dl>

<dl class="py function">
<dt id="lingvo.core.py_utils._DefineFunction">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">_DefineFunction</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">fwd</span></em>, <em class="sig-param"><span class="n">fwd_sig</span></em>, <em class="sig-param"><span class="n">bak</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">bak_as_function</span><span class="o">=</span><span class="default_value">False</span></em>, <em class="sig-param"><span class="n">device</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#_DefineFunction"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils._DefineFunction" title="Permalink to this definition">¶</a></dt>
<dd><p>Wraps fwd in a defun with custom gradient bak.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>fwd</strong> – A callable xs: Nested Structure -&gt; ys: Nested Structure.</p></li>
<li><p><strong>fwd_sig</strong> – A Nested Structure of tf.TensorSpec representing the input
signature of <code class="xref py py-obj docutils literal notranslate"><span class="pre">fwd</span></code>, or None (meaning that fwd takes no inputs).</p></li>
<li><p><strong>bak</strong> – A callable xs, ys, dys: Nested Structure -&gt; dxs[, dcapture]: Nested
Structure. The custom backprop function for <code class="xref py py-obj docutils literal notranslate"><span class="pre">fwd</span></code>. bak needs to return
dcapture if fwd uses any implicitly captured tensors, whose gradients are
dcapture.</p></li>
<li><p><strong>bak_as_function</strong> – Whether to create a TF graph function for <code class="xref py py-obj docutils literal notranslate"><span class="pre">bak</span></code>.</p></li>
<li><p><strong>device</strong> – the device on which to run <code class="xref py py-obj docutils literal notranslate"><span class="pre">fwd</span></code> and <code class="xref py py-obj docutils literal notranslate"><span class="pre">bak</span></code>.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><ul class="simple">
<li><p>call: A callable that will execute <code class="xref py py-obj docutils literal notranslate"><span class="pre">fwd</span></code>. It has the same input and output
signatures as <code class="xref py py-obj docutils literal notranslate"><span class="pre">fwd</span></code>.</p></li>
<li><p>func: The underlying TF function that <code class="xref py py-obj docutils literal notranslate"><span class="pre">call</span></code> calls. If not None, it will
be a _DefinedFunction or ConcreteFunction that takes flat inputs and
returns flat outputs, and can be used by routines that require a TF
function object (e.g. tf.If, tf.While, etc).
Always not None when <code class="xref py py-obj docutils literal notranslate"><span class="pre">bak</span></code> is None.</p></li>
<li><p>outputs: The outputs of <code class="xref py py-obj docutils literal notranslate"><span class="pre">fwd</span></code>. Used for reflection only (e.g. to get the
output dtypes, shapes, etc).</p></li>
<li><p>stateful_ops: A list of (op_name, op_type) tuples representing the
stateful ops used by <code class="xref py py-obj docutils literal notranslate"><span class="pre">fwd</span></code>.</p></li>
<li><p>captured_inputs: Implicit inputs captured by <code class="xref py py-obj docutils literal notranslate"><span class="pre">fwd</span></code>.</p></li>
</ul>
</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>A NestedMap containing</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="lingvo.core.py_utils.TfFunctionScope">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">TfFunctionScope</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">use_tf_function</span><span class="o">=</span><span class="default_value">True</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#TfFunctionScope"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.TfFunctionScope" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt id="lingvo.core.py_utils._UseTfFunction">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">_UseTfFunction</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#_UseTfFunction"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils._UseTfFunction" title="Permalink to this definition">¶</a></dt>
<dd><p>Whether to use tf.function instead of tf.Defun.</p>
</dd></dl>

<dl class="py class">
<dt id="lingvo.core.py_utils.Function">
<em class="property">class </em><code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">Function</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">fwd_sig</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">bak</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">bak_as_function</span><span class="o">=</span><span class="default_value">False</span></em>, <em class="sig-param"><span class="n">device</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">use_tf_function</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#Function"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.Function" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference external" href="https://docs.python.org/3.7/library/functions.html#object" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></a></p>
<p>Function builds a TensorFlow graph function from a callable.</p>
<p>In the high level this is similar to tf.Defun and tf.function. In fact this
relies on those as underlying implementations, but with specific configuration
so it’s easier to use and can work well in some extreme cases in Lingvo.</p>
<p>Example usage:</p>
<ul>
<li><p>No inputs:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nd">@Function</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">foo</span><span class="p">():</span>
<span class="gp">... </span>  <span class="k">return</span> <span class="n">tf</span><span class="o">.</span><span class="n">constant</span><span class="p">(</span><span class="mf">1.0</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">y</span> <span class="o">=</span> <span class="n">foo</span><span class="p">()</span>
</pre></div>
</div>
</li>
<li><p>Scalar input:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nd">@Function</span><span class="p">(</span><span class="n">fwd_sig</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">TensorSpec</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">tf</span><span class="o">.</span><span class="n">float32</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">foo</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<span class="gp">... </span>  <span class="k">return</span> <span class="n">x</span> <span class="o">*</span> <span class="mi">2</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">y</span> <span class="o">=</span> <span class="n">foo</span><span class="p">(</span><span class="mf">1.0</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p>Nested input:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nd">@Function</span><span class="p">(</span><span class="n">fwd_sig</span><span class="o">=</span><span class="n">NestedMap</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">TensorSpec</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">tf</span><span class="o">.</span><span class="n">float32</span><span class="p">)))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">foo</span><span class="p">(</span><span class="n">nmap</span><span class="p">):</span>
<span class="gp">... </span>  <span class="k">return</span> <span class="n">nmap</span><span class="o">.</span><span class="n">x</span> <span class="o">*</span> <span class="mi">2</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">y</span> <span class="o">=</span> <span class="n">foo</span><span class="p">(</span><span class="n">NestedMap</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mf">1.0</span><span class="p">))</span>
</pre></div>
</div>
</li>
<li><p>With gradient function:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">bar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">dy</span><span class="p">):</span>
<span class="gp">... </span>  <span class="k">del</span> <span class="n">y</span><span class="p">,</span> <span class="n">dy</span>
<span class="gp">... </span>  <span class="k">return</span> <span class="mf">4.0</span> <span class="o">*</span> <span class="n">x</span> <span class="o">*</span> <span class="n">dy</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nd">@Function</span><span class="p">(</span><span class="n">fwd_sig</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">TensorSpec</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">tf</span><span class="o">.</span><span class="n">float32</span><span class="p">),</span> <span class="n">bak</span><span class="o">=</span><span class="n">bak</span><span class="p">)</span>
<span class="gp">... </span><span class="k">def</span> <span class="nf">foo</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<span class="gp">... </span>  <span class="k">return</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">x</span> <span class="o">*</span> <span class="n">x</span>
</pre></div>
</div>
</li>
<li><p>Used in control flow ops:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">then_branch</span> <span class="o">=</span> <span class="n">Function</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">TensorSpec</span><span class="p">([],</span> <span class="n">tf</span><span class="o">.</span><span class="n">int32</span><span class="p">))(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">else_branch</span> <span class="o">=</span> <span class="n">Function</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">TensorSpec</span><span class="p">([],</span> <span class="n">tf</span><span class="o">.</span><span class="n">int32</span><span class="p">))(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">y</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">If</span><span class="p">(</span><span class="n">cond</span><span class="p">,</span> <span class="n">inputs</span><span class="p">,</span> <span class="n">then_branch</span><span class="o">.</span><span class="n">func</span><span class="p">,</span> <span class="n">else_branch</span><span class="o">.</span><span class="n">func</span><span class="p">)</span>
</pre></div>
</div>
</li>
</ul>
</dd></dl>

<dl class="py class">
<dt id="lingvo.core.py_utils.DefinedFunction">
<em class="property">class </em><code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">DefinedFunction</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">fwd</span></em>, <em class="sig-param"><span class="n">fwd_sig</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">bak</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">bak_as_function</span><span class="o">=</span><span class="default_value">False</span></em>, <em class="sig-param"><span class="n">device</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">use_tf_function</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#DefinedFunction"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.DefinedFunction" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference external" href="https://docs.python.org/3.7/library/functions.html#object" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></a></p>
<p>Encapsulates a TensorFlow graph function and its properties.</p>
<dl class="py method">
<dt id="lingvo.core.py_utils.DefinedFunction.func">
<em class="property">property </em><code class="sig-name descname">func</code><a class="headerlink" href="#lingvo.core.py_utils.DefinedFunction.func" title="Permalink to this definition">¶</a></dt>
<dd><p>The underlying TensorFlow graph function that this object encapsulates.</p>
<p>The returned graph function is created by tracing <code class="xref py py-obj docutils literal notranslate"><span class="pre">fwd</span></code> during construction.
If not None, it will be a _DefinedFunction or ConcreteFunction that takes
flat inputs and returns flat outputs, and can be used by routines that
require a TensorFlow function object (e.g. tf.If, tf.While, etc).</p>
<p>If no backprop function is provided during construction, the result is
always not None.</p>
</dd></dl>

<dl class="py method">
<dt id="lingvo.core.py_utils.DefinedFunction.AddFrameworkInputs">
<code class="sig-name descname">AddFrameworkInputs</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">inputs</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#DefinedFunction.AddFrameworkInputs"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.DefinedFunction.AddFrameworkInputs" title="Permalink to this definition">¶</a></dt>
<dd><p>Add framework tensors like step_seed and global_step to inputs.</p>
<p>This is only necessary when using <a class="reference internal" href="#lingvo.core.py_utils.DefinedFunction.func" title="lingvo.core.py_utils.DefinedFunction.func"><code class="xref py py-obj docutils literal notranslate"><span class="pre">func</span></code></a>, as wrapping is handled
automatically in __call__.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>inputs</strong> – inputs to the function.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>Inputs wrapped with framework tensors suitable for use with <a class="reference internal" href="#lingvo.core.py_utils.DefinedFunction.func" title="lingvo.core.py_utils.DefinedFunction.func"><code class="xref py py-obj docutils literal notranslate"><span class="pre">func</span></code></a>.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="lingvo.core.py_utils.DefinedFunction.output_dtypes">
<em class="property">property </em><code class="sig-name descname">output_dtypes</code><a class="headerlink" href="#lingvo.core.py_utils.DefinedFunction.output_dtypes" title="Permalink to this definition">¶</a></dt>
<dd><p>Output dtypes of the graph function.</p>
<p>The result will have the same structure as the outputs of <code class="xref py py-obj docutils literal notranslate"><span class="pre">fwd</span></code> but contain
the corresponding output dtypes.</p>
</dd></dl>

<dl class="py method">
<dt id="lingvo.core.py_utils.DefinedFunction.stateful_ops">
<em class="property">property </em><code class="sig-name descname">stateful_ops</code><a class="headerlink" href="#lingvo.core.py_utils.DefinedFunction.stateful_ops" title="Permalink to this definition">¶</a></dt>
<dd><p>Stateful ops used by <code class="xref py py-obj docutils literal notranslate"><span class="pre">fwd</span></code>, as a list of (op_name, op_type) tuples.</p>
</dd></dl>

<dl class="py method">
<dt id="lingvo.core.py_utils.DefinedFunction.captured_inputs">
<em class="property">property </em><code class="sig-name descname">captured_inputs</code><a class="headerlink" href="#lingvo.core.py_utils.DefinedFunction.captured_inputs" title="Permalink to this definition">¶</a></dt>
<dd><p>Implicit input tensors captured by <code class="xref py py-obj docutils literal notranslate"><span class="pre">fwd</span></code>.</p>
</dd></dl>

</dd></dl>

<dl class="py function">
<dt id="lingvo.core.py_utils.CallDefun">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">CallDefun</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">fwd</span></em>, <em class="sig-param"><span class="n">args</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">bak</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">bak_as_function</span><span class="o">=</span><span class="default_value">False</span></em>, <em class="sig-param"><span class="n">device</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#CallDefun"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.CallDefun" title="Permalink to this definition">¶</a></dt>
<dd><p>Wraps fwd in a defun with custom gradient bak and calls it with args.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>fwd</strong> – A callable xs: Nested Structure -&gt; ys: Nested Structure.</p></li>
<li><p><strong>args</strong> – A Nested Structure of tf.Tensor or None.</p></li>
<li><p><strong>bak</strong> – A callable xs, ys, dys: Nested Structure -&gt; dxs[, dcapture]: Nested
Structure. The custom backprop function for fwd. bak needs to return
dcapture if fwd uses any implicitly captured tensors, whose gradients are
dcapture.</p></li>
<li><p><strong>bak_as_function</strong> – Whether to create a TF graph function for bak.</p></li>
<li><p><strong>device</strong> – the device on which to run fwd and bak.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A Nested Structure equivalent to what fwd(args) computes.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="lingvo.core.py_utils.If">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">If</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">cond</span></em>, <em class="sig-param"><span class="n">inputs</span></em>, <em class="sig-param"><span class="n">then_branch</span></em>, <em class="sig-param"><span class="n">else_branch</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#If"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.If" title="Permalink to this definition">¶</a></dt>
<dd><p>Helper to construct an if/else statement.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>cond</strong> – A scalar <code class="xref py py-obj docutils literal notranslate"><span class="pre">Tensor</span></code> that can be converted to boolean.</p></li>
<li><p><strong>inputs</strong> – A flattenable representing the input tensors of the if/else
statement. Can be None to represent no inputs.</p></li>
<li><p><strong>then_branch</strong> – A callable ‘inputs’ -&gt; flattenable. The returned value should
be compatible with what ‘else_branch’ returns.</p></li>
<li><p><strong>else_branch</strong> – A callable ‘inputs’ -&gt; flattenable. The returned value should
be compatible with what ‘then_branch’ returns.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>Output returned by the call to either ‘then_branch’ or ‘else_branch’.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="lingvo.core.py_utils._Itype">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">_Itype</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#_Itype"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils._Itype" title="Permalink to this definition">¶</a></dt>
<dd><p>Loop iterator data type.</p>
</dd></dl>

<dl class="py function">
<dt id="lingvo.core.py_utils.WhileLoop">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">WhileLoop</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">cond</span></em>, <em class="sig-param"><span class="n">body</span></em>, <em class="sig-param"><span class="n">loop_state</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#WhileLoop"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.WhileLoop" title="Permalink to this definition">¶</a></dt>
<dd><p>Helper to construct a while loop.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>cond</strong> – A callable NestedMap -&gt; tf.bool.</p></li>
<li><p><strong>body</strong> – A callable NestedMap -&gt; NestedMap.</p></li>
<li><p><strong>loop_state</strong> – A flattenable (NestedMap, list, tuple, etc.) representing the
loop state.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>The final loop state in the same structure as loop_state.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="lingvo.core.py_utils.ForLoop">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">ForLoop</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">body</span></em>, <em class="sig-param"><span class="n">start</span></em>, <em class="sig-param"><span class="n">limit</span></em>, <em class="sig-param"><span class="n">delta</span></em>, <em class="sig-param"><span class="n">loop_state</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#ForLoop"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.ForLoop" title="Permalink to this definition">¶</a></dt>
<dd><p>Helper to construct a for loop.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>body</strong> – A callable (tf.int, NestedMap) -&gt; NestedMap.</p></li>
<li><p><strong>start</strong> – Loop variable’s initial value.</p></li>
<li><p><strong>limit</strong> – Loop variable’s limit value.</p></li>
<li><p><strong>delta</strong> – Loop variable’s change per iteration.</p></li>
<li><p><strong>loop_state</strong> – A flattenable (NestedMap, list, tuple, etc.) representing the
loop state.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>The final loop state in the same structure as loop_state.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="lingvo.core.py_utils.TopK">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">TopK</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">x_in</span></em>, <em class="sig-param"><span class="n">k</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#TopK"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.TopK" title="Permalink to this definition">¶</a></dt>
<dd><p>Equivalent to tf.math.top_k(x_in, k) but more efficient on tpu.</p>
</dd></dl>

<dl class="py function">
<dt id="lingvo.core.py_utils.ReadVariable">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">ReadVariable</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">var_op</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#ReadVariable"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.ReadVariable" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the value of the given variable operation.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>var_op</strong> – the <code class="xref py py-obj docutils literal notranslate"><span class="pre">Operation</span></code> object for a VarHandleOp.</p>
</dd>
<dt class="field-even">Raises</dt>
<dd class="field-even"><p><a class="reference external" href="https://docs.python.org/3.7/library/exceptions.html#TypeError" title="(in Python v3.7)"><strong>TypeError</strong></a> – if var_op is not a VarHandleOp.</p>
</dd>
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>A <code class="xref py py-obj docutils literal notranslate"><span class="pre">Tensor</span></code> containing the value of the variable.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="lingvo.core.py_utils.AddTpuSummaryTensor">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">AddTpuSummaryTensor</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">name</span></em>, <em class="sig-param"><span class="n">value</span></em>, <em class="sig-param"><span class="n">weight</span><span class="o">=</span><span class="default_value">1.0</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#AddTpuSummaryTensor"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.AddTpuSummaryTensor" title="Permalink to this definition">¶</a></dt>
<dd><p>Adds tensor to global collection of summaries.</p>
<p>This needs to be used in situations where tf.summary() could be used but
currently tf.summary is not supported. Use py_utils.AddTpuSummaryTensor() in
low level code to add summary tensors to global collection of summaries.
Then recover all summary tensors from global collection by calling
py_utils.GetTpuSummaryTensors() from top level code (for example from
ComputeLoss method of BaseTask).</p>
<p>In addition to ‘name’ argument, current tensorflow name scope is also
captured and added to the metric name. This way for example summaries from
a repeated layer will appear as separate graphs in the tensorboard.</p>
<p>Weight argument is optional and defaults to 1.0. See BaseTask.ComputeLoss for
the exact definition of weight for eval metrics.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>name</strong> – metric name</p></li>
<li><p><strong>value</strong> – metric value tensor</p></li>
<li><p><strong>weight</strong> – weight tensor for weighted metrics</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="lingvo.core.py_utils.GetTpuSummaryTensors">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">GetTpuSummaryTensors</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#GetTpuSummaryTensors"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.GetTpuSummaryTensors" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns summary tensors from global collection.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>A dict containing str keys and (metric, weight) pairs as values</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="lingvo.core.py_utils.ClearTpuSummaryTensors">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">ClearTpuSummaryTensors</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#ClearTpuSummaryTensors"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.ClearTpuSummaryTensors" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt id="lingvo.core.py_utils.ComputationShape">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">ComputationShape</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">split_size</span></em>, <em class="sig-param"><span class="n">topology</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#ComputationShape"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.ComputationShape" title="Permalink to this definition">¶</a></dt>
<dd><p>Decides the computation shape based on the split_size.</p>
</dd></dl>

<dl class="py function">
<dt id="lingvo.core.py_utils.GetExtraVars">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">GetExtraVars</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#GetExtraVars"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.GetExtraVars" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the captured variables by the function.</p>
</dd></dl>

<dl class="py function">
<dt id="lingvo.core.py_utils.GetExtraInputs">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">GetExtraInputs</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#GetExtraInputs"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.GetExtraInputs" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the captured input tensors by the function.</p>
</dd></dl>

<dl class="py function">
<dt id="lingvo.core.py_utils.GetExtraArgs">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">GetExtraArgs</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#GetExtraArgs"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.GetExtraArgs" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the corresponding function arguments for the captured inputs.</p>
</dd></dl>

<dl class="py function">
<dt id="lingvo.core.py_utils.ShardedFilePatternToGlob">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">ShardedFilePatternToGlob</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">file_pattern</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#ShardedFilePatternToGlob"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.ShardedFilePatternToGlob" title="Permalink to this definition">¶</a></dt>
<dd><p>Converts a file pattern <a class="reference external" href="mailto:path&#37;&#52;&#48;shards">path<span>&#64;</span>shards</a> to path-?????-of-shards.</p>
</dd></dl>

<dl class="py function">
<dt id="lingvo.core.py_utils.ComputeNceAndAuc">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">ComputeNceAndAuc</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">probs</span></em>, <em class="sig-param"><span class="n">targets</span></em>, <em class="sig-param"><span class="n">mask</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#ComputeNceAndAuc"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.ComputeNceAndAuc" title="Permalink to this definition">¶</a></dt>
<dd><p>Compute normalized cross entropy and AUC of the PR curve for a batch.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>probs</strong> – a tensor of shape [batch, time].</p></li>
<li><p><strong>targets</strong> – a tensor of shape [batch, time], where each element is either 0 or
1 indicating wrong or correct.</p></li>
<li><p><strong>mask</strong> – a tensor of shape [batch, time], a mask for hyp sequence.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>a tensor of shape [1], the normalized cross entropy value.
auc: a tensor of shape [1], the AUC value.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>nce</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="lingvo.core.py_utils.GatherTensorValuesBySeqIndices">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">GatherTensorValuesBySeqIndices</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">tensor</span></em>, <em class="sig-param"><span class="n">class_indices</span></em>, <em class="sig-param"><span class="n">keepdims</span><span class="o">=</span><span class="default_value">False</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#GatherTensorValuesBySeqIndices"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.GatherTensorValuesBySeqIndices" title="Permalink to this definition">¶</a></dt>
<dd><p>Gather values from a 3d tensor according to sequences of indices.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>tensor</strong> – a 3d tensor of [dim0, dim1, num_class], e.g. output from softmax.</p></li>
<li><p><strong>class_indices</strong> – a 2d tensor of [dim0, dim1], where the second dim is a
sequence of class indices between 0 to num_class - 1, inclusive.</p></li>
<li><p><strong>keepdims</strong> – bool, expand the last dimension of the returned tensor if True.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><dl class="simple">
<dt>A tensor ret of [dim0, dim1], where</dt><dd><p>ret[b, t] = tensor[b, t, indices[b, t]].
If keepdims is True, then ret has shape [dim0, dim1, 1].</p>
</dd>
</dl>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="lingvo.core.py_utils.GetSoftmaxProbsBySeqIndices">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">GetSoftmaxProbsBySeqIndices</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">logits</span></em>, <em class="sig-param"><span class="n">indices</span></em>, <em class="sig-param"><span class="n">keepdims</span><span class="o">=</span><span class="default_value">False</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#GetSoftmaxProbsBySeqIndices"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.GetSoftmaxProbsBySeqIndices" title="Permalink to this definition">¶</a></dt>
<dd><p>Get softmax probabilities from index sequences given logits sequences.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>logits</strong> – a tensor of [batch, time, num_class] or [time, batch, num_class].</p></li>
<li><p><strong>indices</strong> – a tensor of [batch, time] or [time, batch].</p></li>
<li><p><strong>keepdims</strong> – bool, expand the last dimension of the returned tensor if True.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><dl class="simple">
<dt>a tensor of [batch, time] or [time, batch] for the corresponding softmax</dt><dd><p>probabilities. If keepdims is True, returned tensor has a third dimension
of size 1.</p>
</dd>
</dl>
</p>
</dd>
</dl>
</dd></dl>

</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="lingvo.core.py_utils_flags.html" class="btn btn-neutral float-right" title="lingvo.core.py_utils_flags module" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="lingvo.core.pruning_utils.html" class="btn btn-neutral float-left" title="lingvo.core.pruning_utils module" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2018

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>