

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>lingvo.core.tpu_embedding_layers module &mdash; Lingvo  documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="lingvo.core.tpu_summary module" href="lingvo.core.tpu_summary.html" />
    <link rel="prev" title="lingvo.core.tokenizers module" href="lingvo.core.tokenizers.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> Lingvo
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="lingvo.html">lingvo package</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="lingvo.html#subpackages">Subpackages</a><ul class="current">
<li class="toctree-l3 current"><a class="reference internal" href="lingvo.core.html">lingvo.core package</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="lingvo.core.html#subpackages">Subpackages</a></li>
<li class="toctree-l4 current"><a class="reference internal" href="lingvo.core.html#submodules">Submodules</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="lingvo.tasks.html">lingvo.tasks package</a></li>
<li class="toctree-l3"><a class="reference internal" href="lingvo.tools.html">lingvo.tools package</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="lingvo.html#submodules">Submodules</a></li>
</ul>
</li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Lingvo</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="lingvo.html">lingvo package</a> &raquo;</li>
        
          <li><a href="lingvo.core.html">lingvo.core package</a> &raquo;</li>
        
      <li>lingvo.core.tpu_embedding_layers module</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/lingvo.core.tpu_embedding_layers.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="module-lingvo.core.tpu_embedding_layers">
<span id="lingvo-core-tpu-embedding-layers-module"></span><h1>lingvo.core.tpu_embedding_layers module<a class="headerlink" href="#module-lingvo.core.tpu_embedding_layers" title="Permalink to this headline">¶</a></h1>
<p>TPU embedding layers.</p>
<dl class="py function">
<dt class="sig sig-object py" id="lingvo.core.tpu_embedding_layers._ShouldUseTpu">
<span class="sig-prename descclassname"><span class="pre">lingvo.core.tpu_embedding_layers.</span></span><span class="sig-name descname"><span class="pre">_ShouldUseTpu</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">p</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/tpu_embedding_layers.html#_ShouldUseTpu"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.core.tpu_embedding_layers._ShouldUseTpu" title="Permalink to this definition">¶</a></dt>
<dd><p>Whether we should create embedding tables and run lookup on tpu.</p>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="lingvo.core.tpu_embedding_layers.TpuEmbeddingCollection">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">lingvo.core.tpu_embedding_layers.</span></span><span class="sig-name descname"><span class="pre">TpuEmbeddingCollection</span></span><a class="reference internal" href="_modules/lingvo/core/tpu_embedding_layers.html#TpuEmbeddingCollection"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.core.tpu_embedding_layers.TpuEmbeddingCollection" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference external" href="https://docs.python.org/3.7/library/functions.html#object" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></a></p>
<p>Manage various TPU embedding related ops and tensors.</p>
<dl class="py attribute">
<dt class="sig sig-object py" id="lingvo.core.tpu_embedding_layers.TpuEmbeddingCollection.GRAPH_COLLECTION_NAME">
<span class="sig-name descname"><span class="pre">GRAPH_COLLECTION_NAME</span></span><em class="property"> <span class="pre">=</span> <span class="pre">'__tpu_embedding_collection'</span></em><a class="headerlink" href="#lingvo.core.tpu_embedding_layers.TpuEmbeddingCollection.GRAPH_COLLECTION_NAME" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="lingvo.core.tpu_embedding_layers.TpuEmbeddingCollection.Get">
<em class="property"><span class="pre">classmethod</span> </em><span class="sig-name descname"><span class="pre">Get</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/tpu_embedding_layers.html#TpuEmbeddingCollection.Get"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.core.tpu_embedding_layers.TpuEmbeddingCollection.Get" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the TpuEmbeddingCollection associated with the current graph.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="lingvo.core.tpu_embedding_layers.TpuEmbeddingCollection.AddTableVariables">
<span class="sig-name descname"><span class="pre">AddTableVariables</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">table_name</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">var_list</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/tpu_embedding_layers.html#TpuEmbeddingCollection.AddTableVariables"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.core.tpu_embedding_layers.TpuEmbeddingCollection.AddTableVariables" title="Permalink to this definition">¶</a></dt>
<dd><p>Add TPU embedding table variable list to the collection.</p>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="lingvo.core.tpu_embedding_layers.TpuEmbeddingCollection.table_variables">
<em class="property"><span class="pre">property</span> </em><span class="sig-name descname"><span class="pre">table_variables</span></span><a class="headerlink" href="#lingvo.core.tpu_embedding_layers.TpuEmbeddingCollection.table_variables" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a NestedMap mapping table names to variables.</p>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="lingvo.core.tpu_embedding_layers.TpuEmbeddingCollection.tpu_embedding">
<em class="property"><span class="pre">property</span> </em><span class="sig-name descname"><span class="pre">tpu_embedding</span></span><a class="headerlink" href="#lingvo.core.tpu_embedding_layers.TpuEmbeddingCollection.tpu_embedding" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="lingvo.core.tpu_embedding_layers.TpuEmbeddingCollection.AddLoadOps">
<span class="sig-name descname"><span class="pre">AddLoadOps</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">load_ops</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/tpu_embedding_layers.html#TpuEmbeddingCollection.AddLoadOps"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.core.tpu_embedding_layers.TpuEmbeddingCollection.AddLoadOps" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="lingvo.core.tpu_embedding_layers.TpuEmbeddingCollection.load_ops">
<em class="property"><span class="pre">property</span> </em><span class="sig-name descname"><span class="pre">load_ops</span></span><a class="headerlink" href="#lingvo.core.tpu_embedding_layers.TpuEmbeddingCollection.load_ops" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="lingvo.core.tpu_embedding_layers.TpuEmbeddingCollection.AddRetrieveOps">
<span class="sig-name descname"><span class="pre">AddRetrieveOps</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">retrieve_ops</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/tpu_embedding_layers.html#TpuEmbeddingCollection.AddRetrieveOps"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.core.tpu_embedding_layers.TpuEmbeddingCollection.AddRetrieveOps" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="lingvo.core.tpu_embedding_layers.TpuEmbeddingCollection.retrieve_ops">
<em class="property"><span class="pre">property</span> </em><span class="sig-name descname"><span class="pre">retrieve_ops</span></span><a class="headerlink" href="#lingvo.core.tpu_embedding_layers.TpuEmbeddingCollection.retrieve_ops" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="lingvo.core.tpu_embedding_layers.TpuEmbeddingCollection.AddActivations">
<span class="sig-name descname"><span class="pre">AddActivations</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">task</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">activations</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/tpu_embedding_layers.html#TpuEmbeddingCollection.AddActivations"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.core.tpu_embedding_layers.TpuEmbeddingCollection.AddActivations" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="lingvo.core.tpu_embedding_layers.TpuEmbeddingCollection.activations_by_task">
<em class="property"><span class="pre">property</span> </em><span class="sig-name descname"><span class="pre">activations_by_task</span></span><a class="headerlink" href="#lingvo.core.tpu_embedding_layers.TpuEmbeddingCollection.activations_by_task" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="lingvo.core.tpu_embedding_layers.TpuEmbeddingCollection.AddSummaryTensor">
<span class="sig-name descname"><span class="pre">AddSummaryTensor</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">name</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">value</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">weight</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1.0</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/tpu_embedding_layers.html#TpuEmbeddingCollection.AddSummaryTensor"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.core.tpu_embedding_layers.TpuEmbeddingCollection.AddSummaryTensor" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="lingvo.core.tpu_embedding_layers.TpuEmbeddingCollection.summary_tensors">
<em class="property"><span class="pre">property</span> </em><span class="sig-name descname"><span class="pre">summary_tensors</span></span><a class="headerlink" href="#lingvo.core.tpu_embedding_layers.TpuEmbeddingCollection.summary_tensors" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="lingvo.core.tpu_embedding_layers.TpuEmbeddingCollection.feature_names">
<em class="property"><span class="pre">property</span> </em><span class="sig-name descname"><span class="pre">feature_names</span></span><a class="headerlink" href="#lingvo.core.tpu_embedding_layers.TpuEmbeddingCollection.feature_names" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="lingvo.core.tpu_embedding_layers.TpuEmbeddingCollection.gradient_multiplier_schedule">
<em class="property"><span class="pre">property</span> </em><span class="sig-name descname"><span class="pre">gradient_multiplier_schedule</span></span><a class="headerlink" href="#lingvo.core.tpu_embedding_layers.TpuEmbeddingCollection.gradient_multiplier_schedule" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="lingvo.core.tpu_embedding_layers._TPUEmbeddingOptimizer">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">lingvo.core.tpu_embedding_layers.</span></span><span class="sig-name descname"><span class="pre">_TPUEmbeddingOptimizer</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/tpu_embedding_layers.html#_TPUEmbeddingOptimizer"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.core.tpu_embedding_layers._TPUEmbeddingOptimizer" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="lingvo.core.base_layer.html#lingvo.core.base_layer.BaseLayer" title="lingvo.core.base_layer.BaseLayer"><code class="xref py py-class docutils literal notranslate"><span class="pre">lingvo.core.base_layer.BaseLayer</span></code></a></p>
<p>Base class for TPUEmbeddingLayer, TPUEmbeddingTable optimizers.</p>
<dl class="py method">
<dt class="sig sig-object py" id="lingvo.core.tpu_embedding_layers._TPUEmbeddingOptimizer.Params">
<em class="property"><span class="pre">classmethod</span> </em><span class="sig-name descname"><span class="pre">Params</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/tpu_embedding_layers.html#_TPUEmbeddingOptimizer.Params"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.core.tpu_embedding_layers._TPUEmbeddingOptimizer.Params" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the layer params.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="lingvo.core.tpu_embedding_layers._TPUEmbeddingOptimizer.CreateOptimizerParameters">
<span class="sig-name descname"><span class="pre">CreateOptimizerParameters</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">learning_rate</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/tpu_embedding_layers.html#_TPUEmbeddingOptimizer.CreateOptimizerParameters"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.core.tpu_embedding_layers._TPUEmbeddingOptimizer.CreateOptimizerParameters" title="Permalink to this definition">¶</a></dt>
<dd><p>Create TPUEmbedding API optimzier parameters.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="lingvo.core.tpu_embedding_layers._TPUEmbeddingOptimizer.CreateSlotVariablesAndOps">
<span class="sig-name descname"><span class="pre">CreateSlotVariablesAndOps</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">table_vars</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tpu_embedding_table</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/tpu_embedding_layers.html#_TPUEmbeddingOptimizer.CreateSlotVariablesAndOps"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.core.tpu_embedding_layers._TPUEmbeddingOptimizer.CreateSlotVariablesAndOps" title="Permalink to this definition">¶</a></dt>
<dd><p>Create slot variables and infeed/retrieval ops.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>table_vars</strong> – A list of all embedding table shard variables.</p></li>
<li><p><strong>tpu_embedding_table</strong> – Parent TPUEmbeddingTable layer.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>List of load ops
List of retrieve ops</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="lingvo.core.tpu_embedding_layers.TPUEmbeddingSGDOptimizer">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">lingvo.core.tpu_embedding_layers.</span></span><span class="sig-name descname"><span class="pre">TPUEmbeddingSGDOptimizer</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/tpu_embedding_layers.html#TPUEmbeddingSGDOptimizer"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.core.tpu_embedding_layers.TPUEmbeddingSGDOptimizer" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#lingvo.core.tpu_embedding_layers._TPUEmbeddingOptimizer" title="lingvo.core.tpu_embedding_layers._TPUEmbeddingOptimizer"><code class="xref py py-class docutils literal notranslate"><span class="pre">lingvo.core.tpu_embedding_layers._TPUEmbeddingOptimizer</span></code></a></p>
<p>SGD optimizer for TPUEmbeddingLayer, TPUEmbeddingTable.</p>
<dl class="py method">
<dt class="sig sig-object py" id="lingvo.core.tpu_embedding_layers.TPUEmbeddingSGDOptimizer.CreateOptimizerParameters">
<span class="sig-name descname"><span class="pre">CreateOptimizerParameters</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">learning_rate</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/tpu_embedding_layers.html#TPUEmbeddingSGDOptimizer.CreateOptimizerParameters"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.core.tpu_embedding_layers.TPUEmbeddingSGDOptimizer.CreateOptimizerParameters" title="Permalink to this definition">¶</a></dt>
<dd><p>Create TPUEmbedding API optimzier parameters.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="lingvo.core.tpu_embedding_layers.TPUEmbeddingSGDOptimizer.CreateSlotVariablesAndOps">
<span class="sig-name descname"><span class="pre">CreateSlotVariablesAndOps</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">table_vars</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tpu_embedding_table</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/tpu_embedding_layers.html#TPUEmbeddingSGDOptimizer.CreateSlotVariablesAndOps"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.core.tpu_embedding_layers.TPUEmbeddingSGDOptimizer.CreateSlotVariablesAndOps" title="Permalink to this definition">¶</a></dt>
<dd><p>Create slot variables and infeed/retrieval ops.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>table_vars</strong> – A list of all embedding table shard variables.</p></li>
<li><p><strong>tpu_embedding_table</strong> – Parent TPUEmbeddingTable layer.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>List of load ops
List of retrieve ops</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="lingvo.core.tpu_embedding_layers.TPUEmbeddingAdagradOptimizer">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">lingvo.core.tpu_embedding_layers.</span></span><span class="sig-name descname"><span class="pre">TPUEmbeddingAdagradOptimizer</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/tpu_embedding_layers.html#TPUEmbeddingAdagradOptimizer"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.core.tpu_embedding_layers.TPUEmbeddingAdagradOptimizer" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#lingvo.core.tpu_embedding_layers._TPUEmbeddingOptimizer" title="lingvo.core.tpu_embedding_layers._TPUEmbeddingOptimizer"><code class="xref py py-class docutils literal notranslate"><span class="pre">lingvo.core.tpu_embedding_layers._TPUEmbeddingOptimizer</span></code></a></p>
<p>Adagrad optimizer for TPUEmbeddingLayer, TPUEmbeddingTable.</p>
<dl class="py method">
<dt class="sig sig-object py" id="lingvo.core.tpu_embedding_layers.TPUEmbeddingAdagradOptimizer.Params">
<em class="property"><span class="pre">classmethod</span> </em><span class="sig-name descname"><span class="pre">Params</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/tpu_embedding_layers.html#TPUEmbeddingAdagradOptimizer.Params"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.core.tpu_embedding_layers.TPUEmbeddingAdagradOptimizer.Params" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the layer params.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="lingvo.core.tpu_embedding_layers.TPUEmbeddingAdagradOptimizer.CreateOptimizerParameters">
<span class="sig-name descname"><span class="pre">CreateOptimizerParameters</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">learning_rate</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/tpu_embedding_layers.html#TPUEmbeddingAdagradOptimizer.CreateOptimizerParameters"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.core.tpu_embedding_layers.TPUEmbeddingAdagradOptimizer.CreateOptimizerParameters" title="Permalink to this definition">¶</a></dt>
<dd><p>Create TPUEmbedding API optimzier parameters.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="lingvo.core.tpu_embedding_layers.TPUEmbeddingAdagradOptimizer.CreateSlotVariablesAndOps">
<span class="sig-name descname"><span class="pre">CreateSlotVariablesAndOps</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">table_vars</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tpu_embedding_table</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/tpu_embedding_layers.html#TPUEmbeddingAdagradOptimizer.CreateSlotVariablesAndOps"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.core.tpu_embedding_layers.TPUEmbeddingAdagradOptimizer.CreateSlotVariablesAndOps" title="Permalink to this definition">¶</a></dt>
<dd><p>Create slot variables and infeed/retrieval ops.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>table_vars</strong> – A list of all embedding table shard variables.</p></li>
<li><p><strong>tpu_embedding_table</strong> – Parent TPUEmbeddingTable layer.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>List of load ops
List of retrieve ops</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="lingvo.core.tpu_embedding_layers.TPUEmbeddingTable">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">lingvo.core.tpu_embedding_layers.</span></span><span class="sig-name descname"><span class="pre">TPUEmbeddingTable</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/tpu_embedding_layers.html#TPUEmbeddingTable"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.core.tpu_embedding_layers.TPUEmbeddingTable" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="lingvo.core.base_layer.html#lingvo.core.base_layer.BaseLayer" title="lingvo.core.base_layer.BaseLayer"><code class="xref py py-class docutils literal notranslate"><span class="pre">lingvo.core.base_layer.BaseLayer</span></code></a></p>
<p>An embedding table controlled by TPUEmbeddingLayer.</p>
<p>Note that all input_keys needs to be declared upfront.</p>
<dl class="py method">
<dt class="sig sig-object py" id="lingvo.core.tpu_embedding_layers.TPUEmbeddingTable.Params">
<em class="property"><span class="pre">classmethod</span> </em><span class="sig-name descname"><span class="pre">Params</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/tpu_embedding_layers.html#TPUEmbeddingTable.Params"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.core.tpu_embedding_layers.TPUEmbeddingTable.Params" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the layer params.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="lingvo.core.tpu_embedding_layers.TPUEmbeddingTable._CreateLayerVariables">
<span class="sig-name descname"><span class="pre">_CreateLayerVariables</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/tpu_embedding_layers.html#TPUEmbeddingTable._CreateLayerVariables"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.core.tpu_embedding_layers.TPUEmbeddingTable._CreateLayerVariables" title="Permalink to this definition">¶</a></dt>
<dd><p>Actually create variables for this layer.</p>
<p>Subclasses should override this function.</p>
<p>Variables are created inside of tf.variable_scope(self.params.name).</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="lingvo.core.tpu_embedding_layers.TPUEmbeddingTable.GetDeviceName">
<span class="sig-name descname"><span class="pre">GetDeviceName</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">host_id</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/tpu_embedding_layers.html#TPUEmbeddingTable.GetDeviceName"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.core.tpu_embedding_layers.TPUEmbeddingTable.GetDeviceName" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="lingvo.core.tpu_embedding_layers.TPUEmbeddingTable.GetVariableName">
<span class="sig-name descname"><span class="pre">GetVariableName</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">host_id</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/tpu_embedding_layers.html#TPUEmbeddingTable.GetVariableName"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.core.tpu_embedding_layers.TPUEmbeddingTable.GetVariableName" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="lingvo.core.tpu_embedding_layers.TPUEmbeddingTable.table_config">
<em class="property"><span class="pre">property</span> </em><span class="sig-name descname"><span class="pre">table_config</span></span><a class="headerlink" href="#lingvo.core.tpu_embedding_layers.TPUEmbeddingTable.table_config" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="lingvo.core.tpu_embedding_layers.TPUEmbeddingTable.table_name">
<em class="property"><span class="pre">property</span> </em><span class="sig-name descname"><span class="pre">table_name</span></span><a class="headerlink" href="#lingvo.core.tpu_embedding_layers.TPUEmbeddingTable.table_name" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="lingvo.core.tpu_embedding_layers.TPUEmbeddingTable.retrieve_op_list">
<em class="property"><span class="pre">property</span> </em><span class="sig-name descname"><span class="pre">retrieve_op_list</span></span><a class="headerlink" href="#lingvo.core.tpu_embedding_layers.TPUEmbeddingTable.retrieve_op_list" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="lingvo.core.tpu_embedding_layers.TPUEmbeddingTable.load_op_list">
<em class="property"><span class="pre">property</span> </em><span class="sig-name descname"><span class="pre">load_op_list</span></span><a class="headerlink" href="#lingvo.core.tpu_embedding_layers.TPUEmbeddingTable.load_op_list" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="lingvo.core.tpu_embedding_layers.TPUEmbeddingTable.input_keys">
<em class="property"><span class="pre">property</span> </em><span class="sig-name descname"><span class="pre">input_keys</span></span><a class="headerlink" href="#lingvo.core.tpu_embedding_layers.TPUEmbeddingTable.input_keys" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="lingvo.core.tpu_embedding_layers.TPUEmbeddingTable.max_sequence_length">
<em class="property"><span class="pre">property</span> </em><span class="sig-name descname"><span class="pre">max_sequence_length</span></span><a class="headerlink" href="#lingvo.core.tpu_embedding_layers.TPUEmbeddingTable.max_sequence_length" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="lingvo.core.tpu_embedding_layers.TPUEmbeddingTable._SequenceEmbLookup">
<span class="sig-name descname"><span class="pre">_SequenceEmbLookup</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">dense_ids</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">tensorflow.python.framework.ops.Tensor</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">partition_strategy</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><a class="reference external" href="https://docs.python.org/3.7/library/stdtypes.html#str" title="(in Python v3.7)"><span class="pre">str</span></a></span></em><span class="sig-paren">)</span> &#x2192; <span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://docs.python.org/3.7/library/stdtypes.html#str" title="(in Python v3.7)"><span class="pre">str</span></a><span class="p"><span class="pre">,</span> </span><span class="pre">tensorflow.python.framework.ops.Tensor</span><span class="p"><span class="pre">]</span></span><a class="reference internal" href="_modules/lingvo/core/tpu_embedding_layers.html#TPUEmbeddingTable._SequenceEmbLookup"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.core.tpu_embedding_layers.TPUEmbeddingTable._SequenceEmbLookup" title="Permalink to this definition">¶</a></dt>
<dd><p>Sequence embedding lookup.</p>
<p>Note that we do not support padding ids in sequence embeddings.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>dense_ids</strong> – A dict of <code class="xref py py-obj docutils literal notranslate"><span class="pre">input_key</span></code> string -&gt; [batch, sequence] int32 Tensor.</p></li>
<li><p><strong>partition_strategy</strong> – See TPUEmbeddingLayer partition_strategy param.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>An activations dict of string -&gt; float32 Tensor of dimension [batch,
max_sequence_length, embedding_dim]</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="lingvo.core.tpu_embedding_layers.TPUEmbeddingTable._CombinerEmbLookup">
<span class="sig-name descname"><span class="pre">_CombinerEmbLookup</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">sparse_ids</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">tensorflow.python.framework.sparse_tensor.SparseTensor</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">partition_strategy</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><a class="reference external" href="https://docs.python.org/3.7/library/stdtypes.html#str" title="(in Python v3.7)"><span class="pre">str</span></a></span></em><span class="sig-paren">)</span> &#x2192; <span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://docs.python.org/3.7/library/stdtypes.html#str" title="(in Python v3.7)"><span class="pre">str</span></a><span class="p"><span class="pre">,</span> </span><span class="pre">tensorflow.python.framework.ops.Tensor</span><span class="p"><span class="pre">]</span></span><a class="reference internal" href="_modules/lingvo/core/tpu_embedding_layers.html#TPUEmbeddingTable._CombinerEmbLookup"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.core.tpu_embedding_layers.TPUEmbeddingTable._CombinerEmbLookup" title="Permalink to this definition">¶</a></dt>
<dd><p>Combiner embedding lookup.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>sparse_ids</strong> – A dict of <code class="xref py py-obj docutils literal notranslate"><span class="pre">input_key</span></code> string -&gt; [batch, …] int32
SparseTensor.</p></li>
<li><p><strong>partition_strategy</strong> – See TPUEmbeddingLayer partition_strategy param.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>An activations dict of string -&gt; float32 Tensor of dimension [batch, 1,
embedding_dim]</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="lingvo.core.tpu_embedding_layers.TPUEmbeddingTable.CpuEmbLookup">
<span class="sig-name descname"><span class="pre">CpuEmbLookup</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ids_map</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://docs.python.org/3.7/library/stdtypes.html#str" title="(in Python v3.7)"><span class="pre">str</span></a><span class="p"><span class="pre">,</span> </span><span class="pre">tensorflow.python.framework.ops.Tensor</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">partition_strategy</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><a class="reference external" href="https://docs.python.org/3.7/library/stdtypes.html#str" title="(in Python v3.7)"><span class="pre">str</span></a></span></em><span class="sig-paren">)</span> &#x2192; <span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://docs.python.org/3.7/library/stdtypes.html#str" title="(in Python v3.7)"><span class="pre">str</span></a><span class="p"><span class="pre">,</span> </span><span class="pre">tensorflow.python.framework.ops.Tensor</span><span class="p"><span class="pre">]</span></span><a class="reference internal" href="_modules/lingvo/core/tpu_embedding_layers.html#TPUEmbeddingTable.CpuEmbLookup"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.core.tpu_embedding_layers.TPUEmbeddingTable.CpuEmbLookup" title="Permalink to this definition">¶</a></dt>
<dd><p>CPU evaluation embedding lookup for dense tensors.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ids_map</strong> – A dict of <code class="xref py py-obj docutils literal notranslate"><span class="pre">input_key</span></code> string -&gt; [batch, sequence] int32 Tensor.
For sequence embeddings, -1 is used as a padding id. Non-sequence
embeddings do not support padded ids.</p></li>
<li><p><strong>partition_strategy</strong> – See TPUEmbeddingLayer partition_strategy param.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>An activations dict of string -&gt; float32 Tensor.
For non-sequence embeddings: [batch, 1, embedding_dim]
For sequence embeddings: [batch, max_sequence_length, embedding_dim]</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="lingvo.core.tpu_embedding_layers.TPUEmbeddingTable.CpuEmbLookupSparse">
<span class="sig-name descname"><span class="pre">CpuEmbLookupSparse</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ids_map</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://docs.python.org/3.7/library/stdtypes.html#str" title="(in Python v3.7)"><span class="pre">str</span></a><span class="p"><span class="pre">,</span> </span><span class="pre">tensorflow.python.framework.sparse_tensor.SparseTensor</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">partition_strategy</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><a class="reference external" href="https://docs.python.org/3.7/library/stdtypes.html#str" title="(in Python v3.7)"><span class="pre">str</span></a></span></em><span class="sig-paren">)</span> &#x2192; <span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://docs.python.org/3.7/library/stdtypes.html#str" title="(in Python v3.7)"><span class="pre">str</span></a><span class="p"><span class="pre">,</span> </span><span class="pre">tensorflow.python.framework.ops.Tensor</span><span class="p"><span class="pre">]</span></span><a class="reference internal" href="_modules/lingvo/core/tpu_embedding_layers.html#TPUEmbeddingTable.CpuEmbLookupSparse"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.core.tpu_embedding_layers.TPUEmbeddingTable.CpuEmbLookupSparse" title="Permalink to this definition">¶</a></dt>
<dd><p>CPU evaluation embedding lookup for SparseTensors.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ids_map</strong> – A dict of <code class="xref py py-obj docutils literal notranslate"><span class="pre">input_key</span></code> string -&gt; [batch, …] int32 SparseTensor.</p></li>
<li><p><strong>partition_strategy</strong> – See TPUEmbeddingLayer partition_strategy param.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>An activations dict of string -&gt; float32 Tensor.
For non-sequence embeddings: [batch, 1, embedding_dim]
For sequence embeddings: [batch, max_sequence_length, embedding_dim]</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="lingvo.core.tpu_embedding_layers.TPUEmbeddingLayer">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">lingvo.core.tpu_embedding_layers.</span></span><span class="sig-name descname"><span class="pre">TPUEmbeddingLayer</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/tpu_embedding_layers.html#TPUEmbeddingLayer"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.core.tpu_embedding_layers.TPUEmbeddingLayer" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="lingvo.core.base_layer.html#lingvo.core.base_layer.BaseLayer" title="lingvo.core.base_layer.BaseLayer"><code class="xref py py-class docutils literal notranslate"><span class="pre">lingvo.core.base_layer.BaseLayer</span></code></a></p>
<p>Monolithic interface to TPU embedding.</p>
<p>This layer has some important caveats, due to the interface of the
TPU embedding hardware. Its behavior most closely mimics that of
tf.nn.embedding_lookup_sparse.</p>
<p>Supports multiple tables and multiple input_keys per table.
Requires its own optimizer parameters.</p>
<dl class="py method">
<dt class="sig sig-object py" id="lingvo.core.tpu_embedding_layers.TPUEmbeddingLayer.Params">
<em class="property"><span class="pre">classmethod</span> </em><span class="sig-name descname"><span class="pre">Params</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/tpu_embedding_layers.html#TPUEmbeddingLayer.Params"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.core.tpu_embedding_layers.TPUEmbeddingLayer.Params" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the layer params.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="lingvo.core.tpu_embedding_layers.TPUEmbeddingLayer._CreateChildrenVariables">
<span class="sig-name descname"><span class="pre">_CreateChildrenVariables</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/tpu_embedding_layers.html#TPUEmbeddingLayer._CreateChildrenVariables"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.core.tpu_embedding_layers.TPUEmbeddingLayer._CreateChildrenVariables" title="Permalink to this definition">¶</a></dt>
<dd><p>Create variables for child layers.</p>
<p>Should be rarely overridden, only in cases when control over the context of
children InstantiateVariables calls are needed. eg, if children variables
need to be created inside of a specific context manager.</p>
<p>There are a few cases of this in the codebase marked as for backwards
compability. This is only to ensure that variable scopes remain compatible
through the code migration. New layers should not copy that pattern, and
instead follow the standard pattern of self.CreateChild() in __init__() and
self.CreateVariable() in _CreateLayerVariables(). If you are okay with
breaking old checkpoints, you can go ahead and delete those functions.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="lingvo.core.tpu_embedding_layers.TPUEmbeddingLayer._CheckTPUEmbeddingConfig">
<span class="sig-name descname"><span class="pre">_CheckTPUEmbeddingConfig</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">tpu_embedding</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">table_to_config_dict</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">feature_to_config_dict</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">global_batch_size</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/tpu_embedding_layers.html#TPUEmbeddingLayer._CheckTPUEmbeddingConfig"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.core.tpu_embedding_layers.TPUEmbeddingLayer._CheckTPUEmbeddingConfig" title="Permalink to this definition">¶</a></dt>
<dd><p>Check that the existing tpu_embedding config matches the given ones.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="lingvo.core.tpu_embedding_layers.TPUEmbeddingLayer._CreateLayerVariables">
<span class="sig-name descname"><span class="pre">_CreateLayerVariables</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/tpu_embedding_layers.html#TPUEmbeddingLayer._CreateLayerVariables"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.core.tpu_embedding_layers.TPUEmbeddingLayer._CreateLayerVariables" title="Permalink to this definition">¶</a></dt>
<dd><p>Actually create variables for this layer.</p>
<p>Subclasses should override this function.</p>
<p>Variables are created inside of tf.variable_scope(self.params.name).</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="lingvo.core.tpu_embedding_layers.TPUEmbeddingLayer._TpuEmbLookup">
<span class="sig-name descname"><span class="pre">_TpuEmbLookup</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> &#x2192; <span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://docs.python.org/3.7/library/stdtypes.html#str" title="(in Python v3.7)"><span class="pre">str</span></a><span class="p"><span class="pre">,</span> </span><span class="pre">tensorflow.python.framework.ops.Tensor</span><span class="p"><span class="pre">]</span></span><a class="reference internal" href="_modules/lingvo/core/tpu_embedding_layers.html#TPUEmbeddingLayer._TpuEmbLookup"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.core.tpu_embedding_layers.TPUEmbeddingLayer._TpuEmbLookup" title="Permalink to this definition">¶</a></dt>
<dd><p>TPU Embedding lookup.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="lingvo.core.tpu_embedding_layers.TPUEmbeddingLayer.EmbLookup">
<span class="sig-name descname"><span class="pre">EmbLookup</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ids_map</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://docs.python.org/3.7/library/stdtypes.html#str" title="(in Python v3.7)"><span class="pre">str</span></a><span class="p"><span class="pre">,</span> </span><span class="pre">tensorflow.python.framework.ops.Tensor</span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span> &#x2192; <span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://docs.python.org/3.7/library/stdtypes.html#str" title="(in Python v3.7)"><span class="pre">str</span></a><span class="p"><span class="pre">,</span> </span><span class="pre">tensorflow.python.framework.ops.Tensor</span><span class="p"><span class="pre">]</span></span><a class="reference internal" href="_modules/lingvo/core/tpu_embedding_layers.html#TPUEmbeddingLayer.EmbLookup"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.core.tpu_embedding_layers.TPUEmbeddingLayer.EmbLookup" title="Permalink to this definition">¶</a></dt>
<dd><p>Looks up embedding vectors for each entry in dense Tensor ids_map.</p>
<p>Since the TPUEmbedding is monolothic, and consulted once per
FProp/BProp, we must centralize the lookup. Thus, for multiple
features, we contain them into a single-lookup rather than allowing
the caller to call Lookup multiple times.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>ids_map</strong> – A dict of <code class="xref py py-obj docutils literal notranslate"><span class="pre">input_key</span></code> string -&gt; [batch, sequence] int32 Tensor.
For sequence embeddings, -1 is used as a padding id. Non-sequence
embeddings do not support padded ids.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>Activations dict of string -&gt;
For non-sequence embeddings:  [batch, 1, embedding_dim],
For sequence embeddings: [batch, max_sequence_length, embedding_dim]
float32 Tensor.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="lingvo.core.tpu_embedding_layers.TPUEmbeddingLayer.EmbLookupSparse">
<span class="sig-name descname"><span class="pre">EmbLookupSparse</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ids_map</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://docs.python.org/3.7/library/stdtypes.html#str" title="(in Python v3.7)"><span class="pre">str</span></a><span class="p"><span class="pre">,</span> </span><span class="pre">tensorflow.python.framework.sparse_tensor.SparseTensor</span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span> &#x2192; <span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://docs.python.org/3.7/library/stdtypes.html#str" title="(in Python v3.7)"><span class="pre">str</span></a><span class="p"><span class="pre">,</span> </span><span class="pre">tensorflow.python.framework.ops.Tensor</span><span class="p"><span class="pre">]</span></span><a class="reference internal" href="_modules/lingvo/core/tpu_embedding_layers.html#TPUEmbeddingLayer.EmbLookupSparse"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.core.tpu_embedding_layers.TPUEmbeddingLayer.EmbLookupSparse" title="Permalink to this definition">¶</a></dt>
<dd><p>Looks up embedding vectors for each entry in SparseTensor ids_map.</p>
<p>Since the TPUEmbedding is monolothic, and consulted once per
FProp/BProp, we must centralize the lookup. Thus, for multiple
features, we contain them into a single-lookup rather than allowing
the caller to call Lookup multiple times.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>ids_map</strong> – A dict of <code class="xref py py-obj docutils literal notranslate"><span class="pre">input_key</span></code> string -&gt; [batch, …] int32 SparseTensor.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>Activations dict of string -&gt;
For non-sequence embeddings:  [batch, 1, embedding_dim],
For sequence embeddings: [batch, max_sequence_length, embedding_dim]
float32 Tensor.</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="lingvo.core.tpu_summary.html" class="btn btn-neutral float-right" title="lingvo.core.tpu_summary module" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="lingvo.core.tokenizers.html" class="btn btn-neutral float-left" title="lingvo.core.tokenizers module" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2018.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>