

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>lingvo.core.tpu_embedding_layers module &mdash; Lingvo  documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="lingvo.core.tpu_summary module" href="lingvo.core.tpu_summary.html" />
    <link rel="prev" title="lingvo.core.tokenizers module" href="lingvo.core.tokenizers.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> Lingvo
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="lingvo.html">lingvo package</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="lingvo.html#subpackages">Subpackages</a><ul class="current">
<li class="toctree-l3 current"><a class="reference internal" href="lingvo.core.html">lingvo.core package</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="lingvo.core.html#subpackages">Subpackages</a></li>
<li class="toctree-l4 current"><a class="reference internal" href="lingvo.core.html#submodules">Submodules</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="lingvo.tasks.html">lingvo.tasks package</a></li>
<li class="toctree-l3"><a class="reference internal" href="lingvo.tools.html">lingvo.tools package</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="lingvo.html#submodules">Submodules</a></li>
</ul>
</li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Lingvo</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="lingvo.html">lingvo package</a> &raquo;</li>
        
          <li><a href="lingvo.core.html">lingvo.core package</a> &raquo;</li>
        
      <li>lingvo.core.tpu_embedding_layers module</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/lingvo.core.tpu_embedding_layers.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="module-lingvo.core.tpu_embedding_layers">
<span id="lingvo-core-tpu-embedding-layers-module"></span><h1>lingvo.core.tpu_embedding_layers module<a class="headerlink" href="#module-lingvo.core.tpu_embedding_layers" title="Permalink to this headline">¶</a></h1>
<p>TPU embedding layers.</p>
<dl class="py function">
<dt id="lingvo.core.tpu_embedding_layers._AddTpuEmbeddingSummaryTensor">
<code class="sig-prename descclassname">lingvo.core.tpu_embedding_layers.</code><code class="sig-name descname">_AddTpuEmbeddingSummaryTensor</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">name</span></em>, <em class="sig-param"><span class="n">value</span></em>, <em class="sig-param"><span class="n">weight</span><span class="o">=</span><span class="default_value">1.0</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/tpu_embedding_layers.html#_AddTpuEmbeddingSummaryTensor"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.tpu_embedding_layers._AddTpuEmbeddingSummaryTensor" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py class">
<dt id="lingvo.core.tpu_embedding_layers._TPUEmbeddingOptimizer">
<em class="property">class </em><code class="sig-prename descclassname">lingvo.core.tpu_embedding_layers.</code><code class="sig-name descname">_TPUEmbeddingOptimizer</code><span class="sig-paren">(</span><em class="sig-param"><span class="o">*</span><span class="n">args</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/tpu_embedding_layers.html#_TPUEmbeddingOptimizer"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.tpu_embedding_layers._TPUEmbeddingOptimizer" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="lingvo.core.base_layer.html#lingvo.core.base_layer.BaseLayer" title="lingvo.core.base_layer.BaseLayer"><code class="xref py py-class docutils literal notranslate"><span class="pre">lingvo.core.base_layer.BaseLayer</span></code></a></p>
<p>Base class for TPUEmbeddingLayer, TPUEmbeddingTable optimizers.</p>
<dl class="py method">
<dt id="lingvo.core.tpu_embedding_layers._TPUEmbeddingOptimizer.Params">
<em class="property">classmethod </em><code class="sig-name descname">Params</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/tpu_embedding_layers.html#_TPUEmbeddingOptimizer.Params"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.tpu_embedding_layers._TPUEmbeddingOptimizer.Params" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the layer params.</p>
</dd></dl>

<dl class="py method">
<dt id="lingvo.core.tpu_embedding_layers._TPUEmbeddingOptimizer.CreateOptimizerParameters">
<code class="sig-name descname">CreateOptimizerParameters</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">learning_rate</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/tpu_embedding_layers.html#_TPUEmbeddingOptimizer.CreateOptimizerParameters"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.tpu_embedding_layers._TPUEmbeddingOptimizer.CreateOptimizerParameters" title="Permalink to this definition">¶</a></dt>
<dd><p>Create TPUEmbedding API optimzier parameters.</p>
</dd></dl>

<dl class="py method">
<dt id="lingvo.core.tpu_embedding_layers._TPUEmbeddingOptimizer.CreateSlotVariablesAndOps">
<code class="sig-name descname">CreateSlotVariablesAndOps</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">table_vars</span></em>, <em class="sig-param"><span class="n">tpu_embedding_table</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/tpu_embedding_layers.html#_TPUEmbeddingOptimizer.CreateSlotVariablesAndOps"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.tpu_embedding_layers._TPUEmbeddingOptimizer.CreateSlotVariablesAndOps" title="Permalink to this definition">¶</a></dt>
<dd><p>Create slot variables and infeed/retrieval ops.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>table_vars</strong> – A list of all embedding table shard variables.</p></li>
<li><p><strong>tpu_embedding_table</strong> – Parent TPUEmbeddingTable layer.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>List of load ops
List of retrieve ops</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt id="lingvo.core.tpu_embedding_layers.TPUEmbeddingSGDOptimizer">
<em class="property">class </em><code class="sig-prename descclassname">lingvo.core.tpu_embedding_layers.</code><code class="sig-name descname">TPUEmbeddingSGDOptimizer</code><span class="sig-paren">(</span><em class="sig-param"><span class="o">*</span><span class="n">args</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/tpu_embedding_layers.html#TPUEmbeddingSGDOptimizer"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.tpu_embedding_layers.TPUEmbeddingSGDOptimizer" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#lingvo.core.tpu_embedding_layers._TPUEmbeddingOptimizer" title="lingvo.core.tpu_embedding_layers._TPUEmbeddingOptimizer"><code class="xref py py-class docutils literal notranslate"><span class="pre">lingvo.core.tpu_embedding_layers._TPUEmbeddingOptimizer</span></code></a></p>
<p>SGD optimizer for TPUEmbeddingLayer, TPUEmbeddingTable.</p>
<dl class="py method">
<dt id="lingvo.core.tpu_embedding_layers.TPUEmbeddingSGDOptimizer.CreateOptimizerParameters">
<code class="sig-name descname">CreateOptimizerParameters</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">learning_rate</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/tpu_embedding_layers.html#TPUEmbeddingSGDOptimizer.CreateOptimizerParameters"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.tpu_embedding_layers.TPUEmbeddingSGDOptimizer.CreateOptimizerParameters" title="Permalink to this definition">¶</a></dt>
<dd><p>Create TPUEmbedding API optimzier parameters.</p>
</dd></dl>

<dl class="py method">
<dt id="lingvo.core.tpu_embedding_layers.TPUEmbeddingSGDOptimizer.CreateSlotVariablesAndOps">
<code class="sig-name descname">CreateSlotVariablesAndOps</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">table_vars</span></em>, <em class="sig-param"><span class="n">tpu_embedding_table</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/tpu_embedding_layers.html#TPUEmbeddingSGDOptimizer.CreateSlotVariablesAndOps"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.tpu_embedding_layers.TPUEmbeddingSGDOptimizer.CreateSlotVariablesAndOps" title="Permalink to this definition">¶</a></dt>
<dd><p>Create slot variables and infeed/retrieval ops.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>table_vars</strong> – A list of all embedding table shard variables.</p></li>
<li><p><strong>tpu_embedding_table</strong> – Parent TPUEmbeddingTable layer.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>List of load ops
List of retrieve ops</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt id="lingvo.core.tpu_embedding_layers.TPUEmbeddingAdagradOptimizer">
<em class="property">class </em><code class="sig-prename descclassname">lingvo.core.tpu_embedding_layers.</code><code class="sig-name descname">TPUEmbeddingAdagradOptimizer</code><span class="sig-paren">(</span><em class="sig-param"><span class="o">*</span><span class="n">args</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/tpu_embedding_layers.html#TPUEmbeddingAdagradOptimizer"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.tpu_embedding_layers.TPUEmbeddingAdagradOptimizer" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#lingvo.core.tpu_embedding_layers._TPUEmbeddingOptimizer" title="lingvo.core.tpu_embedding_layers._TPUEmbeddingOptimizer"><code class="xref py py-class docutils literal notranslate"><span class="pre">lingvo.core.tpu_embedding_layers._TPUEmbeddingOptimizer</span></code></a></p>
<p>Adagrad optimizer for TPUEmbeddingLayer, TPUEmbeddingTable.</p>
<dl class="py method">
<dt id="lingvo.core.tpu_embedding_layers.TPUEmbeddingAdagradOptimizer.Params">
<em class="property">classmethod </em><code class="sig-name descname">Params</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/tpu_embedding_layers.html#TPUEmbeddingAdagradOptimizer.Params"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.tpu_embedding_layers.TPUEmbeddingAdagradOptimizer.Params" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the layer params.</p>
</dd></dl>

<dl class="py method">
<dt id="lingvo.core.tpu_embedding_layers.TPUEmbeddingAdagradOptimizer.CreateOptimizerParameters">
<code class="sig-name descname">CreateOptimizerParameters</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">learning_rate</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/tpu_embedding_layers.html#TPUEmbeddingAdagradOptimizer.CreateOptimizerParameters"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.tpu_embedding_layers.TPUEmbeddingAdagradOptimizer.CreateOptimizerParameters" title="Permalink to this definition">¶</a></dt>
<dd><p>Create TPUEmbedding API optimzier parameters.</p>
</dd></dl>

<dl class="py method">
<dt id="lingvo.core.tpu_embedding_layers.TPUEmbeddingAdagradOptimizer.CreateSlotVariablesAndOps">
<code class="sig-name descname">CreateSlotVariablesAndOps</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">table_vars</span></em>, <em class="sig-param"><span class="n">tpu_embedding_table</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/tpu_embedding_layers.html#TPUEmbeddingAdagradOptimizer.CreateSlotVariablesAndOps"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.tpu_embedding_layers.TPUEmbeddingAdagradOptimizer.CreateSlotVariablesAndOps" title="Permalink to this definition">¶</a></dt>
<dd><p>Create slot variables and infeed/retrieval ops.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>table_vars</strong> – A list of all embedding table shard variables.</p></li>
<li><p><strong>tpu_embedding_table</strong> – Parent TPUEmbeddingTable layer.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>List of load ops
List of retrieve ops</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt id="lingvo.core.tpu_embedding_layers.TPUEmbeddingTable">
<em class="property">class </em><code class="sig-prename descclassname">lingvo.core.tpu_embedding_layers.</code><code class="sig-name descname">TPUEmbeddingTable</code><span class="sig-paren">(</span><em class="sig-param"><span class="o">*</span><span class="n">args</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/tpu_embedding_layers.html#TPUEmbeddingTable"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.tpu_embedding_layers.TPUEmbeddingTable" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="lingvo.core.base_layer.html#lingvo.core.base_layer.BaseLayer" title="lingvo.core.base_layer.BaseLayer"><code class="xref py py-class docutils literal notranslate"><span class="pre">lingvo.core.base_layer.BaseLayer</span></code></a></p>
<p>An embedding table controlled by TPUEmbeddingLayer.</p>
<p>Note that all input_keys needs to be declared upfront.</p>
<dl class="py method">
<dt id="lingvo.core.tpu_embedding_layers.TPUEmbeddingTable.Params">
<em class="property">classmethod </em><code class="sig-name descname">Params</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/tpu_embedding_layers.html#TPUEmbeddingTable.Params"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.tpu_embedding_layers.TPUEmbeddingTable.Params" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the layer params.</p>
</dd></dl>

<dl class="py method">
<dt id="lingvo.core.tpu_embedding_layers.TPUEmbeddingTable._CreateLayerVariables">
<code class="sig-name descname">_CreateLayerVariables</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/tpu_embedding_layers.html#TPUEmbeddingTable._CreateLayerVariables"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.tpu_embedding_layers.TPUEmbeddingTable._CreateLayerVariables" title="Permalink to this definition">¶</a></dt>
<dd><p>Actually create variables for this layer.</p>
<p>Subclasses should override this function.</p>
<p>Variables are created inside of tf.variable_scope(self.params.name).</p>
</dd></dl>

<dl class="py method">
<dt id="lingvo.core.tpu_embedding_layers.TPUEmbeddingTable.GetDeviceName">
<code class="sig-name descname">GetDeviceName</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">host_id</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/tpu_embedding_layers.html#TPUEmbeddingTable.GetDeviceName"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.tpu_embedding_layers.TPUEmbeddingTable.GetDeviceName" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt id="lingvo.core.tpu_embedding_layers.TPUEmbeddingTable.GetVariableName">
<code class="sig-name descname">GetVariableName</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">host_id</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/tpu_embedding_layers.html#TPUEmbeddingTable.GetVariableName"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.tpu_embedding_layers.TPUEmbeddingTable.GetVariableName" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt id="lingvo.core.tpu_embedding_layers.TPUEmbeddingTable.table_config">
<em class="property">property </em><code class="sig-name descname">table_config</code><a class="headerlink" href="#lingvo.core.tpu_embedding_layers.TPUEmbeddingTable.table_config" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt id="lingvo.core.tpu_embedding_layers.TPUEmbeddingTable.table_name">
<em class="property">property </em><code class="sig-name descname">table_name</code><a class="headerlink" href="#lingvo.core.tpu_embedding_layers.TPUEmbeddingTable.table_name" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt id="lingvo.core.tpu_embedding_layers.TPUEmbeddingTable.retrieve_op_list">
<em class="property">property </em><code class="sig-name descname">retrieve_op_list</code><a class="headerlink" href="#lingvo.core.tpu_embedding_layers.TPUEmbeddingTable.retrieve_op_list" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt id="lingvo.core.tpu_embedding_layers.TPUEmbeddingTable.load_op_list">
<em class="property">property </em><code class="sig-name descname">load_op_list</code><a class="headerlink" href="#lingvo.core.tpu_embedding_layers.TPUEmbeddingTable.load_op_list" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt id="lingvo.core.tpu_embedding_layers.TPUEmbeddingTable.input_keys">
<em class="property">property </em><code class="sig-name descname">input_keys</code><a class="headerlink" href="#lingvo.core.tpu_embedding_layers.TPUEmbeddingTable.input_keys" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt id="lingvo.core.tpu_embedding_layers.TPUEmbeddingTable.max_sequence_length">
<em class="property">property </em><code class="sig-name descname">max_sequence_length</code><a class="headerlink" href="#lingvo.core.tpu_embedding_layers.TPUEmbeddingTable.max_sequence_length" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt id="lingvo.core.tpu_embedding_layers.TPUEmbeddingTable._SequenceEmbLookup">
<code class="sig-name descname">_SequenceEmbLookup</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">dense_ids</span><span class="p">:</span> <span class="n">tensorflow.python.framework.ops.Tensor</span></em>, <em class="sig-param"><span class="n">partition_strategy</span><span class="p">:</span> <span class="n"><a class="reference external" href="https://docs.python.org/3.7/library/stdtypes.html#str" title="(in Python v3.7)">str</a></span></em><span class="sig-paren">)</span> &#x2192; Dict<span class="p">[</span><a class="reference external" href="https://docs.python.org/3.7/library/stdtypes.html#str" title="(in Python v3.7)">str</a><span class="p">, </span>tensorflow.python.framework.ops.Tensor<span class="p">]</span><a class="reference internal" href="_modules/lingvo/core/tpu_embedding_layers.html#TPUEmbeddingTable._SequenceEmbLookup"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.tpu_embedding_layers.TPUEmbeddingTable._SequenceEmbLookup" title="Permalink to this definition">¶</a></dt>
<dd><p>Sequence embedding lookup.</p>
<p>Note that we do not support padding ids in sequence embeddings.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>dense_ids</strong> – A dict of <code class="xref py py-obj docutils literal notranslate"><span class="pre">input_key</span></code> string -&gt; [batch, sequence] int32 Tensor.</p></li>
<li><p><strong>partition_strategy</strong> – See TPUEmbeddingLayer partition_strategy param.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>An activations dict of string -&gt; float32 Tensor of dimension [batch,
max_sequence_length, embedding_dim]</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="lingvo.core.tpu_embedding_layers.TPUEmbeddingTable._CombinerEmbLookup">
<code class="sig-name descname">_CombinerEmbLookup</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">sparse_ids</span><span class="p">:</span> <span class="n">tensorflow.python.framework.sparse_tensor.SparseTensor</span></em>, <em class="sig-param"><span class="n">partition_strategy</span><span class="p">:</span> <span class="n"><a class="reference external" href="https://docs.python.org/3.7/library/stdtypes.html#str" title="(in Python v3.7)">str</a></span></em><span class="sig-paren">)</span> &#x2192; Dict<span class="p">[</span><a class="reference external" href="https://docs.python.org/3.7/library/stdtypes.html#str" title="(in Python v3.7)">str</a><span class="p">, </span>tensorflow.python.framework.ops.Tensor<span class="p">]</span><a class="reference internal" href="_modules/lingvo/core/tpu_embedding_layers.html#TPUEmbeddingTable._CombinerEmbLookup"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.tpu_embedding_layers.TPUEmbeddingTable._CombinerEmbLookup" title="Permalink to this definition">¶</a></dt>
<dd><p>Combiner embedding lookup.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>sparse_ids</strong> – A dict of <code class="xref py py-obj docutils literal notranslate"><span class="pre">input_key</span></code> string -&gt; [batch, …] int32
SparseTensor.</p></li>
<li><p><strong>partition_strategy</strong> – See TPUEmbeddingLayer partition_strategy param.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>An activations dict of string -&gt; float32 Tensor of dimension [batch, 1,
embedding_dim]</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="lingvo.core.tpu_embedding_layers.TPUEmbeddingTable.CpuEmbLookup">
<code class="sig-name descname">CpuEmbLookup</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">ids_map</span><span class="p">:</span> <span class="n">Dict<span class="p">[</span><a class="reference external" href="https://docs.python.org/3.7/library/stdtypes.html#str" title="(in Python v3.7)">str</a><span class="p">, </span>tensorflow.python.framework.ops.Tensor<span class="p">]</span></span></em>, <em class="sig-param"><span class="n">partition_strategy</span><span class="p">:</span> <span class="n"><a class="reference external" href="https://docs.python.org/3.7/library/stdtypes.html#str" title="(in Python v3.7)">str</a></span></em><span class="sig-paren">)</span> &#x2192; Dict<span class="p">[</span><a class="reference external" href="https://docs.python.org/3.7/library/stdtypes.html#str" title="(in Python v3.7)">str</a><span class="p">, </span>tensorflow.python.framework.ops.Tensor<span class="p">]</span><a class="reference internal" href="_modules/lingvo/core/tpu_embedding_layers.html#TPUEmbeddingTable.CpuEmbLookup"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.tpu_embedding_layers.TPUEmbeddingTable.CpuEmbLookup" title="Permalink to this definition">¶</a></dt>
<dd><p>CPU evaluation embedding lookup for dense tensors.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ids_map</strong> – A dict of <code class="xref py py-obj docutils literal notranslate"><span class="pre">input_key</span></code> string -&gt; [batch, sequence] int32 Tensor.
For sequence embeddings, -1 is used as a padding id. Non-sequence
embeddings do not support padded ids.</p></li>
<li><p><strong>partition_strategy</strong> – See TPUEmbeddingLayer partition_strategy param.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>An activations dict of string -&gt; float32 Tensor.
For non-sequence embeddings: [batch, 1, embedding_dim]
For sequence embeddings: [batch, max_sequence_length, embedding_dim]</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="lingvo.core.tpu_embedding_layers.TPUEmbeddingTable.CpuEmbLookupSparse">
<code class="sig-name descname">CpuEmbLookupSparse</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">ids_map</span><span class="p">:</span> <span class="n">Dict<span class="p">[</span><a class="reference external" href="https://docs.python.org/3.7/library/stdtypes.html#str" title="(in Python v3.7)">str</a><span class="p">, </span>tensorflow.python.framework.sparse_tensor.SparseTensor<span class="p">]</span></span></em>, <em class="sig-param"><span class="n">partition_strategy</span><span class="p">:</span> <span class="n"><a class="reference external" href="https://docs.python.org/3.7/library/stdtypes.html#str" title="(in Python v3.7)">str</a></span></em><span class="sig-paren">)</span> &#x2192; Dict<span class="p">[</span><a class="reference external" href="https://docs.python.org/3.7/library/stdtypes.html#str" title="(in Python v3.7)">str</a><span class="p">, </span>tensorflow.python.framework.ops.Tensor<span class="p">]</span><a class="reference internal" href="_modules/lingvo/core/tpu_embedding_layers.html#TPUEmbeddingTable.CpuEmbLookupSparse"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.tpu_embedding_layers.TPUEmbeddingTable.CpuEmbLookupSparse" title="Permalink to this definition">¶</a></dt>
<dd><p>CPU evaluation embedding lookup for SparseTensors.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ids_map</strong> – A dict of <code class="xref py py-obj docutils literal notranslate"><span class="pre">input_key</span></code> string -&gt; [batch, …] int32 SparseTensor.</p></li>
<li><p><strong>partition_strategy</strong> – See TPUEmbeddingLayer partition_strategy param.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>An activations dict of string -&gt; float32 Tensor.
For non-sequence embeddings: [batch, 1, embedding_dim]
For sequence embeddings: [batch, max_sequence_length, embedding_dim]</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt id="lingvo.core.tpu_embedding_layers.TPUEmbeddingLayer">
<em class="property">class </em><code class="sig-prename descclassname">lingvo.core.tpu_embedding_layers.</code><code class="sig-name descname">TPUEmbeddingLayer</code><span class="sig-paren">(</span><em class="sig-param"><span class="o">*</span><span class="n">args</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/tpu_embedding_layers.html#TPUEmbeddingLayer"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.tpu_embedding_layers.TPUEmbeddingLayer" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="lingvo.core.base_layer.html#lingvo.core.base_layer.BaseLayer" title="lingvo.core.base_layer.BaseLayer"><code class="xref py py-class docutils literal notranslate"><span class="pre">lingvo.core.base_layer.BaseLayer</span></code></a></p>
<p>Monolithic interface to TPU embedding.</p>
<p>This layer has some important caveats, due to the interface of the
TPU embedding hardware. Its behavior most closely mimics that of
tf.nn.embedding_lookup_sparse.</p>
<p>Supports multiple tables and multiple input_keys per table.
Requires its own optimizer parameters.</p>
<dl class="py method">
<dt id="lingvo.core.tpu_embedding_layers.TPUEmbeddingLayer.Params">
<em class="property">classmethod </em><code class="sig-name descname">Params</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/tpu_embedding_layers.html#TPUEmbeddingLayer.Params"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.tpu_embedding_layers.TPUEmbeddingLayer.Params" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the layer params.</p>
</dd></dl>

<dl class="py method">
<dt id="lingvo.core.tpu_embedding_layers.TPUEmbeddingLayer._CreateChildrenVariables">
<code class="sig-name descname">_CreateChildrenVariables</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/tpu_embedding_layers.html#TPUEmbeddingLayer._CreateChildrenVariables"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.tpu_embedding_layers.TPUEmbeddingLayer._CreateChildrenVariables" title="Permalink to this definition">¶</a></dt>
<dd><p>Create variables for child layers.</p>
<p>Should be rarely overridden, only in cases when control over the context of
children InstantiateVariables calls are needed. eg, if children variables
need to be created inside of a specific context manager.</p>
<p>There are a few cases of this in the codebase marked as for backwards
compability. This is only to ensure that variable scopes remain compatible
through the code migration. New layers should not copy that pattern, and
instead follow the standard pattern of self.CreateChild() in __init__() and
self.CreateVariable() in _CreateLayerVariables(). If you are okay with
breaking old checkpoints, you can go ahead and delete those functions.</p>
</dd></dl>

<dl class="py method">
<dt id="lingvo.core.tpu_embedding_layers.TPUEmbeddingLayer._CreateLayerVariables">
<code class="sig-name descname">_CreateLayerVariables</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/tpu_embedding_layers.html#TPUEmbeddingLayer._CreateLayerVariables"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.tpu_embedding_layers.TPUEmbeddingLayer._CreateLayerVariables" title="Permalink to this definition">¶</a></dt>
<dd><p>Actually create variables for this layer.</p>
<p>Subclasses should override this function.</p>
<p>Variables are created inside of tf.variable_scope(self.params.name).</p>
</dd></dl>

<dl class="py method">
<dt id="lingvo.core.tpu_embedding_layers.TPUEmbeddingLayer._TpuEmbLookup">
<code class="sig-name descname">_TpuEmbLookup</code><span class="sig-paren">(</span><span class="sig-paren">)</span> &#x2192; Dict<span class="p">[</span><a class="reference external" href="https://docs.python.org/3.7/library/stdtypes.html#str" title="(in Python v3.7)">str</a><span class="p">, </span>tensorflow.python.framework.ops.Tensor<span class="p">]</span><a class="reference internal" href="_modules/lingvo/core/tpu_embedding_layers.html#TPUEmbeddingLayer._TpuEmbLookup"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.tpu_embedding_layers.TPUEmbeddingLayer._TpuEmbLookup" title="Permalink to this definition">¶</a></dt>
<dd><p>TPU Embedding lookup.</p>
</dd></dl>

<dl class="py method">
<dt id="lingvo.core.tpu_embedding_layers.TPUEmbeddingLayer.EmbLookup">
<code class="sig-name descname">EmbLookup</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">ids_map</span><span class="p">:</span> <span class="n">Dict<span class="p">[</span><a class="reference external" href="https://docs.python.org/3.7/library/stdtypes.html#str" title="(in Python v3.7)">str</a><span class="p">, </span>tensorflow.python.framework.ops.Tensor<span class="p">]</span></span></em><span class="sig-paren">)</span> &#x2192; Dict<span class="p">[</span><a class="reference external" href="https://docs.python.org/3.7/library/stdtypes.html#str" title="(in Python v3.7)">str</a><span class="p">, </span>tensorflow.python.framework.ops.Tensor<span class="p">]</span><a class="reference internal" href="_modules/lingvo/core/tpu_embedding_layers.html#TPUEmbeddingLayer.EmbLookup"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.tpu_embedding_layers.TPUEmbeddingLayer.EmbLookup" title="Permalink to this definition">¶</a></dt>
<dd><p>Looks up embedding vectors for each entry in dense Tensor ids_map.</p>
<p>Since the TPUEmbedding is monolothic, and consulted once per
FProp/BProp, we must centralize the lookup. Thus, for multiple
features, we contain them into a single-lookup rather than allowing
the caller to call Lookup multiple times.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>ids_map</strong> – A dict of <code class="xref py py-obj docutils literal notranslate"><span class="pre">input_key</span></code> string -&gt; [batch, sequence] int32 Tensor.
For sequence embeddings, -1 is used as a padding id. Non-sequence
embeddings do not support padded ids.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>Activations dict of string -&gt;
For non-sequence embeddings:  [batch, 1, embedding_dim],
For sequence embeddings: [batch, max_sequence_length, embedding_dim]
float32 Tensor.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="lingvo.core.tpu_embedding_layers.TPUEmbeddingLayer.EmbLookupSparse">
<code class="sig-name descname">EmbLookupSparse</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">ids_map</span><span class="p">:</span> <span class="n">Dict<span class="p">[</span><a class="reference external" href="https://docs.python.org/3.7/library/stdtypes.html#str" title="(in Python v3.7)">str</a><span class="p">, </span>tensorflow.python.framework.sparse_tensor.SparseTensor<span class="p">]</span></span></em><span class="sig-paren">)</span> &#x2192; Dict<span class="p">[</span><a class="reference external" href="https://docs.python.org/3.7/library/stdtypes.html#str" title="(in Python v3.7)">str</a><span class="p">, </span>tensorflow.python.framework.ops.Tensor<span class="p">]</span><a class="reference internal" href="_modules/lingvo/core/tpu_embedding_layers.html#TPUEmbeddingLayer.EmbLookupSparse"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.tpu_embedding_layers.TPUEmbeddingLayer.EmbLookupSparse" title="Permalink to this definition">¶</a></dt>
<dd><p>Looks up embedding vectors for each entry in SparseTensor ids_map.</p>
<p>Since the TPUEmbedding is monolothic, and consulted once per
FProp/BProp, we must centralize the lookup. Thus, for multiple
features, we contain them into a single-lookup rather than allowing
the caller to call Lookup multiple times.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>ids_map</strong> – A dict of <code class="xref py py-obj docutils literal notranslate"><span class="pre">input_key</span></code> string -&gt; [batch, …] int32 SparseTensor.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>Activations dict of string -&gt;
For non-sequence embeddings:  [batch, 1, embedding_dim],
For sequence embeddings: [batch, max_sequence_length, embedding_dim]
float32 Tensor.</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="lingvo.core.tpu_summary.html" class="btn btn-neutral float-right" title="lingvo.core.tpu_summary module" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="lingvo.core.tokenizers.html" class="btn btn-neutral float-left" title="lingvo.core.tokenizers module" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2018.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>