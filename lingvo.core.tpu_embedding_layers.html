<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>lingvo.core.tpu_embedding_layers module &mdash; Lingvo  documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="lingvo.core.tpu_summary module" href="lingvo.core.tpu_summary.html" />
    <link rel="prev" title="lingvo.core.tokenizers module" href="lingvo.core.tokenizers.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html" class="icon icon-home"> Lingvo
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="lingvo.html">lingvo package</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="lingvo.html#subpackages">Subpackages</a><ul class="current">
<li class="toctree-l3 current"><a class="reference internal" href="lingvo.core.html">lingvo.core package</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="lingvo.core.html#subpackages">Subpackages</a></li>
<li class="toctree-l4 current"><a class="reference internal" href="lingvo.core.html#submodules">Submodules</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="lingvo.tasks.html">lingvo.tasks package</a></li>
<li class="toctree-l3"><a class="reference internal" href="lingvo.tools.html">lingvo.tools package</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="lingvo.html#submodules">Submodules</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Lingvo</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="lingvo.html">lingvo package</a> &raquo;</li>
          <li><a href="lingvo.core.html">lingvo.core package</a> &raquo;</li>
      <li>lingvo.core.tpu_embedding_layers module</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/lingvo.core.tpu_embedding_layers.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="module-lingvo.core.tpu_embedding_layers">
<span id="lingvo-core-tpu-embedding-layers-module"></span><h1>lingvo.core.tpu_embedding_layers module<a class="headerlink" href="#module-lingvo.core.tpu_embedding_layers" title="Permalink to this headline"></a></h1>
<p>TPU embedding layers.</p>
<dl class="py function">
<dt class="sig sig-object py" id="lingvo.core.tpu_embedding_layers._IsTpuTraining">
<span class="sig-prename descclassname"><span class="pre">lingvo.core.tpu_embedding_layers.</span></span><span class="sig-name descname"><span class="pre">_IsTpuTraining</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">p</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/tpu_embedding_layers.html#_IsTpuTraining"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.core.tpu_embedding_layers._IsTpuTraining" title="Permalink to this definition"></a></dt>
<dd><p>Whether we should create embedding tables and run lookup on tpu.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="lingvo.core.tpu_embedding_layers._RemovePrivateVar">
<span class="sig-prename descclassname"><span class="pre">lingvo.core.tpu_embedding_layers.</span></span><span class="sig-name descname"><span class="pre">_RemovePrivateVar</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">layer</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">var_name</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/tpu_embedding_layers.html#_RemovePrivateVar"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.core.tpu_embedding_layers._RemovePrivateVar" title="Permalink to this definition"></a></dt>
<dd><p>Remove a variable by name from <code class="xref py py-obj docutils literal notranslate"><span class="pre">layer</span></code>.</p>
<p>This is usually used to avoid copying the variable to TPU, for example, by the
tf.cast when accessing layer.theta.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>layer</strong> – The layer to remove the variable from.</p></li>
<li><p><strong>var_name</strong> – The name of the variable to remove.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="lingvo.core.tpu_embedding_layers.TpuEmbeddingCollection">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">lingvo.core.tpu_embedding_layers.</span></span><span class="sig-name descname"><span class="pre">TpuEmbeddingCollection</span></span><a class="reference internal" href="_modules/lingvo/core/tpu_embedding_layers.html#TpuEmbeddingCollection"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.core.tpu_embedding_layers.TpuEmbeddingCollection" title="Permalink to this definition"></a></dt>
<dd><p>Bases: <a class="reference external" href="https://docs.python.org/3.7/library/functions.html#object" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></a></p>
<p>Manage various TPU embedding related ops and tensors.</p>
<dl class="py method">
<dt class="sig sig-object py" id="lingvo.core.tpu_embedding_layers.TpuEmbeddingCollection.Get">
<em class="property"><span class="pre">classmethod</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">Get</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/tpu_embedding_layers.html#TpuEmbeddingCollection.Get"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.core.tpu_embedding_layers.TpuEmbeddingCollection.Get" title="Permalink to this definition"></a></dt>
<dd><p>Returns the TpuEmbeddingCollection associated with the current graph.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="lingvo.core.tpu_embedding_layers.TpuEmbeddingCollection.AddTableVariables">
<span class="sig-name descname"><span class="pre">AddTableVariables</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">table_name</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">var_list</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">is_inference_with_bfloat16</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/tpu_embedding_layers.html#TpuEmbeddingCollection.AddTableVariables"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.core.tpu_embedding_layers.TpuEmbeddingCollection.AddTableVariables" title="Permalink to this definition"></a></dt>
<dd><p>Add TPU embedding table variable list to the collection.</p>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="lingvo.core.tpu_embedding_layers.TpuEmbeddingCollection.table_variables">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">table_variables</span></span><a class="headerlink" href="#lingvo.core.tpu_embedding_layers.TpuEmbeddingCollection.table_variables" title="Permalink to this definition"></a></dt>
<dd><p>Returns a list of table variables.</p>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="lingvo.core.tpu_embedding_layers.TpuEmbeddingCollection.inference_with_bfloat16_var_names">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">inference_with_bfloat16_var_names</span></span><a class="headerlink" href="#lingvo.core.tpu_embedding_layers.TpuEmbeddingCollection.inference_with_bfloat16_var_names" title="Permalink to this definition"></a></dt>
<dd><p>Returns a list of names of table variables that do bfloat16 inference.</p>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="lingvo.core.tpu_embedding_layers.TpuEmbeddingCollection.tpu_embedding">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">tpu_embedding</span></span><a class="headerlink" href="#lingvo.core.tpu_embedding_layers.TpuEmbeddingCollection.tpu_embedding" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="lingvo.core.tpu_embedding_layers.TpuEmbeddingCollection.AddLoadRetrieveOps">
<span class="sig-name descname"><span class="pre">AddLoadRetrieveOps</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">table_name</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">load_ops</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">retrieve_ops</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/tpu_embedding_layers.html#TpuEmbeddingCollection.AddLoadRetrieveOps"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.core.tpu_embedding_layers.TpuEmbeddingCollection.AddLoadRetrieveOps" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="lingvo.core.tpu_embedding_layers.TpuEmbeddingCollection.load_ops">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">load_ops</span></span><a class="headerlink" href="#lingvo.core.tpu_embedding_layers.TpuEmbeddingCollection.load_ops" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="lingvo.core.tpu_embedding_layers.TpuEmbeddingCollection.retrieve_ops">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">retrieve_ops</span></span><a class="headerlink" href="#lingvo.core.tpu_embedding_layers.TpuEmbeddingCollection.retrieve_ops" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="lingvo.core.tpu_embedding_layers.TpuEmbeddingCollection._ValidateTaskScope">
<span class="sig-name descname"><span class="pre">_ValidateTaskScope</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">task_call_scope</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/tpu_embedding_layers.html#TpuEmbeddingCollection._ValidateTaskScope"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.core.tpu_embedding_layers.TpuEmbeddingCollection._ValidateTaskScope" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="lingvo.core.tpu_embedding_layers.TpuEmbeddingCollection.AddActivations">
<span class="sig-name descname"><span class="pre">AddActivations</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">task_call_scope</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/tpu_embedding_layers.html#TpuEmbeddingCollection.AddActivations"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.core.tpu_embedding_layers.TpuEmbeddingCollection.AddActivations" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="lingvo.core.tpu_embedding_layers.TpuEmbeddingCollection.GetActivations">
<span class="sig-name descname"><span class="pre">GetActivations</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">task_call_scope</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/tpu_embedding_layers.html#TpuEmbeddingCollection.GetActivations"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.core.tpu_embedding_layers.TpuEmbeddingCollection.GetActivations" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="lingvo.core.tpu_embedding_layers.TpuEmbeddingCollection.AddSummaryTensor">
<span class="sig-name descname"><span class="pre">AddSummaryTensor</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">name</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">value</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">weight</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1.0</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/tpu_embedding_layers.html#TpuEmbeddingCollection.AddSummaryTensor"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.core.tpu_embedding_layers.TpuEmbeddingCollection.AddSummaryTensor" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="lingvo.core.tpu_embedding_layers.TpuEmbeddingCollection.summary_tensors">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">summary_tensors</span></span><a class="headerlink" href="#lingvo.core.tpu_embedding_layers.TpuEmbeddingCollection.summary_tensors" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="lingvo.core.tpu_embedding_layers.TpuEmbeddingCollection.feature_names">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">feature_names</span></span><a class="headerlink" href="#lingvo.core.tpu_embedding_layers.TpuEmbeddingCollection.feature_names" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="lingvo.core.tpu_embedding_layers.TpuEmbeddingCollection.SetGradientMultiplierSchedule">
<span class="sig-name descname"><span class="pre">SetGradientMultiplierSchedule</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">multiplier_schedule</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/tpu_embedding_layers.html#TpuEmbeddingCollection.SetGradientMultiplierSchedule"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.core.tpu_embedding_layers.TpuEmbeddingCollection.SetGradientMultiplierSchedule" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="lingvo.core.tpu_embedding_layers.TpuEmbeddingCollection.SetTaskMode">
<span class="sig-name descname"><span class="pre">SetTaskMode</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">task_call_scope</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mode</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/tpu_embedding_layers.html#TpuEmbeddingCollection.SetTaskMode"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.core.tpu_embedding_layers.TpuEmbeddingCollection.SetTaskMode" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="lingvo.core.tpu_embedding_layers.TpuEmbeddingCollection.ShouldStopGradient">
<span class="sig-name descname"><span class="pre">ShouldStopGradient</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">task_call_scope</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/tpu_embedding_layers.html#TpuEmbeddingCollection.ShouldStopGradient"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.core.tpu_embedding_layers.TpuEmbeddingCollection.ShouldStopGradient" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="lingvo.core.tpu_embedding_layers.TpuEmbeddingCollection.ApplyGradients">
<span class="sig-name descname"><span class="pre">ApplyGradients</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">task_call_scope</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">feature_to_gradient_dict</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/tpu_embedding_layers.html#TpuEmbeddingCollection.ApplyGradients"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.core.tpu_embedding_layers.TpuEmbeddingCollection.ApplyGradients" title="Permalink to this definition"></a></dt>
<dd><p>Apply tpu embedding gradient updates.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>task_call_scope</strong> – The current task call scope name.</p></li>
<li><p><strong>feature_to_gradient_dict</strong> – A <code class="xref py py-obj docutils literal notranslate"><span class="pre">py_utils.NestedMap</span></code> of: tpu embedding feature
name -&gt; gradient tensor for the embedding feature.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>The gradient update op and a dict of eval metrics.</p>
</dd>
<dt class="field-odd">Raises</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3.7/library/exceptions.html#ValueError" title="(in Python v3.7)"><strong>ValueError</strong></a> – if gradients have been applied before for the current task.</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="lingvo.core.tpu_embedding_layers._TPUEmbeddingOptimizer">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">lingvo.core.tpu_embedding_layers.</span></span><span class="sig-name descname"><span class="pre">_TPUEmbeddingOptimizer</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/tpu_embedding_layers.html#_TPUEmbeddingOptimizer"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.core.tpu_embedding_layers._TPUEmbeddingOptimizer" title="Permalink to this definition"></a></dt>
<dd><p>Bases: <a class="reference internal" href="lingvo.core.base_layer.html#lingvo.core.base_layer.BaseLayer" title="lingvo.core.base_layer.BaseLayer"><code class="xref py py-class docutils literal notranslate"><span class="pre">lingvo.core.base_layer.BaseLayer</span></code></a></p>
<p>Base class for TPUEmbeddingLayer, TPUEmbeddingTable optimizers.</p>
<dl class="py method">
<dt class="sig sig-object py" id="lingvo.core.tpu_embedding_layers._TPUEmbeddingOptimizer.Params">
<em class="property"><span class="pre">classmethod</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">Params</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/tpu_embedding_layers.html#_TPUEmbeddingOptimizer.Params"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.core.tpu_embedding_layers._TPUEmbeddingOptimizer.Params" title="Permalink to this definition"></a></dt>
<dd><p>Returns the layer params.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="lingvo.core.tpu_embedding_layers._TPUEmbeddingOptimizer.CreateOptimizerParameters">
<span class="sig-name descname"><span class="pre">CreateOptimizerParameters</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">learning_rate</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/tpu_embedding_layers.html#_TPUEmbeddingOptimizer.CreateOptimizerParameters"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.core.tpu_embedding_layers._TPUEmbeddingOptimizer.CreateOptimizerParameters" title="Permalink to this definition"></a></dt>
<dd><p>Create TPUEmbedding API optimzier parameters.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="lingvo.core.tpu_embedding_layers._TPUEmbeddingOptimizer.CreateSlotVariablesAndOps">
<span class="sig-name descname"><span class="pre">CreateSlotVariablesAndOps</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">table_vars</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tpu_embedding_table</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/tpu_embedding_layers.html#_TPUEmbeddingOptimizer.CreateSlotVariablesAndOps"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.core.tpu_embedding_layers._TPUEmbeddingOptimizer.CreateSlotVariablesAndOps" title="Permalink to this definition"></a></dt>
<dd><p>Create slot variables and load/retrieve ops.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>table_vars</strong> – A list of all embedding table shard variables.</p></li>
<li><p><strong>tpu_embedding_table</strong> – Parent TPUEmbeddingTable layer.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>List of load ops
List of retrieve ops</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="lingvo.core.tpu_embedding_layers.TPUEmbeddingSGDOptimizer">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">lingvo.core.tpu_embedding_layers.</span></span><span class="sig-name descname"><span class="pre">TPUEmbeddingSGDOptimizer</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/tpu_embedding_layers.html#TPUEmbeddingSGDOptimizer"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.core.tpu_embedding_layers.TPUEmbeddingSGDOptimizer" title="Permalink to this definition"></a></dt>
<dd><p>Bases: <a class="reference internal" href="#lingvo.core.tpu_embedding_layers._TPUEmbeddingOptimizer" title="lingvo.core.tpu_embedding_layers._TPUEmbeddingOptimizer"><code class="xref py py-class docutils literal notranslate"><span class="pre">lingvo.core.tpu_embedding_layers._TPUEmbeddingOptimizer</span></code></a></p>
<p>SGD optimizer for TPUEmbeddingLayer, TPUEmbeddingTable.</p>
<dl class="py method">
<dt class="sig sig-object py" id="lingvo.core.tpu_embedding_layers.TPUEmbeddingSGDOptimizer.CreateOptimizerParameters">
<span class="sig-name descname"><span class="pre">CreateOptimizerParameters</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">learning_rate</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/tpu_embedding_layers.html#TPUEmbeddingSGDOptimizer.CreateOptimizerParameters"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.core.tpu_embedding_layers.TPUEmbeddingSGDOptimizer.CreateOptimizerParameters" title="Permalink to this definition"></a></dt>
<dd><p>Create TPUEmbedding API optimzier parameters.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="lingvo.core.tpu_embedding_layers.TPUEmbeddingSGDOptimizer.CreateSlotVariablesAndOps">
<span class="sig-name descname"><span class="pre">CreateSlotVariablesAndOps</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">table_vars</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tpu_embedding_table</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/tpu_embedding_layers.html#TPUEmbeddingSGDOptimizer.CreateSlotVariablesAndOps"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.core.tpu_embedding_layers.TPUEmbeddingSGDOptimizer.CreateSlotVariablesAndOps" title="Permalink to this definition"></a></dt>
<dd><p>Create slot variables and load/retrieve ops.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>table_vars</strong> – A list of all embedding table shard variables.</p></li>
<li><p><strong>tpu_embedding_table</strong> – Parent TPUEmbeddingTable layer.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>List of load ops
List of retrieve ops</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="lingvo.core.tpu_embedding_layers.TPUEmbeddingAdagradOptimizer">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">lingvo.core.tpu_embedding_layers.</span></span><span class="sig-name descname"><span class="pre">TPUEmbeddingAdagradOptimizer</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/tpu_embedding_layers.html#TPUEmbeddingAdagradOptimizer"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.core.tpu_embedding_layers.TPUEmbeddingAdagradOptimizer" title="Permalink to this definition"></a></dt>
<dd><p>Bases: <a class="reference internal" href="#lingvo.core.tpu_embedding_layers._TPUEmbeddingOptimizer" title="lingvo.core.tpu_embedding_layers._TPUEmbeddingOptimizer"><code class="xref py py-class docutils literal notranslate"><span class="pre">lingvo.core.tpu_embedding_layers._TPUEmbeddingOptimizer</span></code></a></p>
<p>Adagrad optimizer for TPUEmbeddingLayer, TPUEmbeddingTable.</p>
<dl class="py method">
<dt class="sig sig-object py" id="lingvo.core.tpu_embedding_layers.TPUEmbeddingAdagradOptimizer.Params">
<em class="property"><span class="pre">classmethod</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">Params</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/tpu_embedding_layers.html#TPUEmbeddingAdagradOptimizer.Params"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.core.tpu_embedding_layers.TPUEmbeddingAdagradOptimizer.Params" title="Permalink to this definition"></a></dt>
<dd><p>Returns the layer params.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="lingvo.core.tpu_embedding_layers.TPUEmbeddingAdagradOptimizer.CreateOptimizerParameters">
<span class="sig-name descname"><span class="pre">CreateOptimizerParameters</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">learning_rate</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/tpu_embedding_layers.html#TPUEmbeddingAdagradOptimizer.CreateOptimizerParameters"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.core.tpu_embedding_layers.TPUEmbeddingAdagradOptimizer.CreateOptimizerParameters" title="Permalink to this definition"></a></dt>
<dd><p>Create TPUEmbedding API optimzier parameters.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="lingvo.core.tpu_embedding_layers.TPUEmbeddingAdagradOptimizer.CreateSlotVariablesAndOps">
<span class="sig-name descname"><span class="pre">CreateSlotVariablesAndOps</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">table_vars</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tpu_embedding_table</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/tpu_embedding_layers.html#TPUEmbeddingAdagradOptimizer.CreateSlotVariablesAndOps"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.core.tpu_embedding_layers.TPUEmbeddingAdagradOptimizer.CreateSlotVariablesAndOps" title="Permalink to this definition"></a></dt>
<dd><p>Create slot variables and load/retrieve ops.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>table_vars</strong> – A list of all embedding table shard variables.</p></li>
<li><p><strong>tpu_embedding_table</strong> – Parent TPUEmbeddingTable layer.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>List of load ops
List of retrieve ops</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="lingvo.core.tpu_embedding_layers.TPUEmbeddingAdamOptimizer">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">lingvo.core.tpu_embedding_layers.</span></span><span class="sig-name descname"><span class="pre">TPUEmbeddingAdamOptimizer</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/tpu_embedding_layers.html#TPUEmbeddingAdamOptimizer"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.core.tpu_embedding_layers.TPUEmbeddingAdamOptimizer" title="Permalink to this definition"></a></dt>
<dd><p>Bases: <a class="reference internal" href="#lingvo.core.tpu_embedding_layers._TPUEmbeddingOptimizer" title="lingvo.core.tpu_embedding_layers._TPUEmbeddingOptimizer"><code class="xref py py-class docutils literal notranslate"><span class="pre">lingvo.core.tpu_embedding_layers._TPUEmbeddingOptimizer</span></code></a></p>
<p>Adam optimizer for TPUEmbeddingLayer, TPUEmbeddingTable.</p>
<dl class="py method">
<dt class="sig sig-object py" id="lingvo.core.tpu_embedding_layers.TPUEmbeddingAdamOptimizer.Params">
<em class="property"><span class="pre">classmethod</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">Params</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/tpu_embedding_layers.html#TPUEmbeddingAdamOptimizer.Params"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.core.tpu_embedding_layers.TPUEmbeddingAdamOptimizer.Params" title="Permalink to this definition"></a></dt>
<dd><p>Returns the layer params.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="lingvo.core.tpu_embedding_layers.TPUEmbeddingAdamOptimizer.CreateOptimizerParameters">
<span class="sig-name descname"><span class="pre">CreateOptimizerParameters</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">learning_rate</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/tpu_embedding_layers.html#TPUEmbeddingAdamOptimizer.CreateOptimizerParameters"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.core.tpu_embedding_layers.TPUEmbeddingAdamOptimizer.CreateOptimizerParameters" title="Permalink to this definition"></a></dt>
<dd><p>Create TPUEmbedding API optimzier parameters.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="lingvo.core.tpu_embedding_layers.TPUEmbeddingAdamOptimizer.CreateSlotVariablesAndOps">
<span class="sig-name descname"><span class="pre">CreateSlotVariablesAndOps</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">table_vars</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tpu_embedding_table</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/tpu_embedding_layers.html#TPUEmbeddingAdamOptimizer.CreateSlotVariablesAndOps"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.core.tpu_embedding_layers.TPUEmbeddingAdamOptimizer.CreateSlotVariablesAndOps" title="Permalink to this definition"></a></dt>
<dd><p>Create slot variables and load/retrieve ops.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>table_vars</strong> – A list of all embedding table shard variables.</p></li>
<li><p><strong>tpu_embedding_table</strong> – Parent TPUEmbeddingTable layer.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>List of load ops
List of retrieve ops</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="lingvo.core.tpu_embedding_layers.TPUEmbeddingFTRLOptimizer">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">lingvo.core.tpu_embedding_layers.</span></span><span class="sig-name descname"><span class="pre">TPUEmbeddingFTRLOptimizer</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/tpu_embedding_layers.html#TPUEmbeddingFTRLOptimizer"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.core.tpu_embedding_layers.TPUEmbeddingFTRLOptimizer" title="Permalink to this definition"></a></dt>
<dd><p>Bases: <a class="reference internal" href="#lingvo.core.tpu_embedding_layers._TPUEmbeddingOptimizer" title="lingvo.core.tpu_embedding_layers._TPUEmbeddingOptimizer"><code class="xref py py-class docutils literal notranslate"><span class="pre">lingvo.core.tpu_embedding_layers._TPUEmbeddingOptimizer</span></code></a></p>
<p>FTRL optimizer for TPUEmbeddingLayer, TPUEmbeddingTable.</p>
<dl class="py method">
<dt class="sig sig-object py" id="lingvo.core.tpu_embedding_layers.TPUEmbeddingFTRLOptimizer.Params">
<em class="property"><span class="pre">classmethod</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">Params</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/tpu_embedding_layers.html#TPUEmbeddingFTRLOptimizer.Params"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.core.tpu_embedding_layers.TPUEmbeddingFTRLOptimizer.Params" title="Permalink to this definition"></a></dt>
<dd><p>Returns the layer params.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="lingvo.core.tpu_embedding_layers.TPUEmbeddingFTRLOptimizer.CreateOptimizerParameters">
<span class="sig-name descname"><span class="pre">CreateOptimizerParameters</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">learning_rate</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/tpu_embedding_layers.html#TPUEmbeddingFTRLOptimizer.CreateOptimizerParameters"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.core.tpu_embedding_layers.TPUEmbeddingFTRLOptimizer.CreateOptimizerParameters" title="Permalink to this definition"></a></dt>
<dd><p>Create TPUEmbedding API optimzier parameters.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="lingvo.core.tpu_embedding_layers.TPUEmbeddingFTRLOptimizer.CreateSlotVariablesAndOps">
<span class="sig-name descname"><span class="pre">CreateSlotVariablesAndOps</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">table_vars</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tpu_embedding_table</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/tpu_embedding_layers.html#TPUEmbeddingFTRLOptimizer.CreateSlotVariablesAndOps"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.core.tpu_embedding_layers.TPUEmbeddingFTRLOptimizer.CreateSlotVariablesAndOps" title="Permalink to this definition"></a></dt>
<dd><p>Create slot variables and load/retrieve ops.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>table_vars</strong> – A list of all embedding table shard variables.</p></li>
<li><p><strong>tpu_embedding_table</strong> – Parent TPUEmbeddingTable layer.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>List of load ops
List of retrieve ops</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="lingvo.core.tpu_embedding_layers.TPUEmbeddingTable">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">lingvo.core.tpu_embedding_layers.</span></span><span class="sig-name descname"><span class="pre">TPUEmbeddingTable</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/tpu_embedding_layers.html#TPUEmbeddingTable"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.core.tpu_embedding_layers.TPUEmbeddingTable" title="Permalink to this definition"></a></dt>
<dd><p>Bases: <a class="reference internal" href="lingvo.core.base_layer.html#lingvo.core.base_layer.BaseLayer" title="lingvo.core.base_layer.BaseLayer"><code class="xref py py-class docutils literal notranslate"><span class="pre">lingvo.core.base_layer.BaseLayer</span></code></a></p>
<p>An embedding table controlled by TPUEmbeddingLayer.</p>
<p>Note that all input_keys needs to be declared upfront.</p>
<dl class="py method">
<dt class="sig sig-object py" id="lingvo.core.tpu_embedding_layers.TPUEmbeddingTable.Params">
<em class="property"><span class="pre">classmethod</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">Params</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/tpu_embedding_layers.html#TPUEmbeddingTable.Params"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.core.tpu_embedding_layers.TPUEmbeddingTable.Params" title="Permalink to this definition"></a></dt>
<dd><p>Returns the layer params.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="lingvo.core.tpu_embedding_layers.TPUEmbeddingTable._CreateLayerVariables">
<span class="sig-name descname"><span class="pre">_CreateLayerVariables</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/tpu_embedding_layers.html#TPUEmbeddingTable._CreateLayerVariables"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.core.tpu_embedding_layers.TPUEmbeddingTable._CreateLayerVariables" title="Permalink to this definition"></a></dt>
<dd><p>Actually create variables for this layer.</p>
<p>Subclasses should override this function.</p>
<p>Variables are created inside of tf.variable_scope(self.params.name).</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="lingvo.core.tpu_embedding_layers.TPUEmbeddingTable.GetDeviceName">
<span class="sig-name descname"><span class="pre">GetDeviceName</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">host_id</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/tpu_embedding_layers.html#TPUEmbeddingTable.GetDeviceName"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.core.tpu_embedding_layers.TPUEmbeddingTable.GetDeviceName" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="lingvo.core.tpu_embedding_layers.TPUEmbeddingTable.GetVariableName">
<span class="sig-name descname"><span class="pre">GetVariableName</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">host_id</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/tpu_embedding_layers.html#TPUEmbeddingTable.GetVariableName"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.core.tpu_embedding_layers.TPUEmbeddingTable.GetVariableName" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="lingvo.core.tpu_embedding_layers.TPUEmbeddingTable.table_config">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">table_config</span></span><a class="headerlink" href="#lingvo.core.tpu_embedding_layers.TPUEmbeddingTable.table_config" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="lingvo.core.tpu_embedding_layers.TPUEmbeddingTable.table_name">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">table_name</span></span><a class="headerlink" href="#lingvo.core.tpu_embedding_layers.TPUEmbeddingTable.table_name" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="lingvo.core.tpu_embedding_layers.TPUEmbeddingTable.input_keys">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">input_keys</span></span><a class="headerlink" href="#lingvo.core.tpu_embedding_layers.TPUEmbeddingTable.input_keys" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="lingvo.core.tpu_embedding_layers.TPUEmbeddingTable.max_sequence_length">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">max_sequence_length</span></span><a class="headerlink" href="#lingvo.core.tpu_embedding_layers.TPUEmbeddingTable.max_sequence_length" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="lingvo.core.tpu_embedding_layers.TPUEmbeddingTable._SequenceEmbLookup">
<span class="sig-name descname"><span class="pre">_SequenceEmbLookup</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">dense_ids</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">tensorflow.python.framework.ops.Tensor</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">partition_strategy</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3.7/library/stdtypes.html#str" title="(in Python v3.7)"><span class="pre">str</span></a></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">tensorflow.python.framework.ops.Tensor</span></span></span><a class="reference internal" href="_modules/lingvo/core/tpu_embedding_layers.html#TPUEmbeddingTable._SequenceEmbLookup"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.core.tpu_embedding_layers.TPUEmbeddingTable._SequenceEmbLookup" title="Permalink to this definition"></a></dt>
<dd><p>Sequence embedding lookup.</p>
<p>Note that we do not support padding ids in sequence embeddings.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>dense_ids</strong> – An int Tensor of shape [batch, sequence].</p></li>
<li><p><strong>partition_strategy</strong> – See TPUEmbeddingLayer partition_strategy param.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A float32 activations Tensor of shape
[batch, max_sequence_length, embedding_dim].</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="lingvo.core.tpu_embedding_layers.TPUEmbeddingTable._CombinerEmbLookup">
<span class="sig-name descname"><span class="pre">_CombinerEmbLookup</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">sparse_ids</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">tensorflow.python.framework.sparse_tensor.SparseTensor</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">partition_strategy</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3.7/library/stdtypes.html#str" title="(in Python v3.7)"><span class="pre">str</span></a></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">tensorflow.python.framework.ops.Tensor</span></span></span><a class="reference internal" href="_modules/lingvo/core/tpu_embedding_layers.html#TPUEmbeddingTable._CombinerEmbLookup"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.core.tpu_embedding_layers.TPUEmbeddingTable._CombinerEmbLookup" title="Permalink to this definition"></a></dt>
<dd><p>Combiner embedding lookup.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>sparse_ids</strong> – An int SparseTensor of shape [batch, …].</p></li>
<li><p><strong>partition_strategy</strong> – See TPUEmbeddingLayer partition_strategy param.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A float32 activations Tensor of shape [batch, 1, embedding_dim].</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="lingvo.core.tpu_embedding_layers.TPUEmbeddingTable.CpuEmbLookup">
<span class="sig-name descname"><span class="pre">CpuEmbLookup</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ids_map</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="lingvo.core.nested_map.html#lingvo.core.nested_map.NestedMap" title="lingvo.core.nested_map.NestedMap"><span class="pre">lingvo.core.nested_map.NestedMap</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">partition_strategy</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3.7/library/stdtypes.html#str" title="(in Python v3.7)"><span class="pre">str</span></a></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="lingvo.core.nested_map.html#lingvo.core.nested_map.NestedMap" title="lingvo.core.nested_map.NestedMap"><span class="pre">lingvo.core.nested_map.NestedMap</span></a></span></span><a class="reference internal" href="_modules/lingvo/core/tpu_embedding_layers.html#TPUEmbeddingTable.CpuEmbLookup"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.core.tpu_embedding_layers.TPUEmbeddingTable.CpuEmbLookup" title="Permalink to this definition"></a></dt>
<dd><p>CPU evaluation embedding lookup for dense tensors.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ids_map</strong> – A NestedMap of nested <code class="xref py py-obj docutils literal notranslate"><span class="pre">input_key</span></code> string -&gt; [batch, sequence]
int Tensor. For sequence embeddings, -1 is used as a padding id.
Non-sequence embeddings do not support padded ids.</p></li>
<li><p><strong>partition_strategy</strong> – See TPUEmbeddingLayer partition_strategy param.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>An activations NestedMap of nested string -&gt; float32 Tensor.
For non-sequence embeddings: [batch, 1, embedding_dim]
For sequence embeddings: [batch, max_sequence_length, embedding_dim]</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="lingvo.core.tpu_embedding_layers.TPUEmbeddingTable.CpuEmbLookupSparse">
<span class="sig-name descname"><span class="pre">CpuEmbLookupSparse</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ids_map</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="lingvo.core.nested_map.html#lingvo.core.nested_map.NestedMap" title="lingvo.core.nested_map.NestedMap"><span class="pre">lingvo.core.nested_map.NestedMap</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">partition_strategy</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3.7/library/stdtypes.html#str" title="(in Python v3.7)"><span class="pre">str</span></a></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="lingvo.core.nested_map.html#lingvo.core.nested_map.NestedMap" title="lingvo.core.nested_map.NestedMap"><span class="pre">lingvo.core.nested_map.NestedMap</span></a></span></span><a class="reference internal" href="_modules/lingvo/core/tpu_embedding_layers.html#TPUEmbeddingTable.CpuEmbLookupSparse"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.core.tpu_embedding_layers.TPUEmbeddingTable.CpuEmbLookupSparse" title="Permalink to this definition"></a></dt>
<dd><p>CPU evaluation embedding lookup for SparseTensors.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ids_map</strong> – A NestedMap of nested <code class="xref py py-obj docutils literal notranslate"><span class="pre">input_key</span></code> string -&gt; [batch, …] int
SparseTensor.</p></li>
<li><p><strong>partition_strategy</strong> – See TPUEmbeddingLayer partition_strategy param.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>An activations NestedMap of nested string -&gt; float32 Tensor.
For non-sequence embeddings: [batch, 1, embedding_dim]
For sequence embeddings: [batch, max_sequence_length, embedding_dim]</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="lingvo.core.tpu_embedding_layers.TPUEmbeddingLayer">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">lingvo.core.tpu_embedding_layers.</span></span><span class="sig-name descname"><span class="pre">TPUEmbeddingLayer</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/tpu_embedding_layers.html#TPUEmbeddingLayer"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.core.tpu_embedding_layers.TPUEmbeddingLayer" title="Permalink to this definition"></a></dt>
<dd><p>Bases: <a class="reference internal" href="lingvo.core.base_layer.html#lingvo.core.base_layer.BaseLayer" title="lingvo.core.base_layer.BaseLayer"><code class="xref py py-class docutils literal notranslate"><span class="pre">lingvo.core.base_layer.BaseLayer</span></code></a></p>
<p>Monolithic interface to TPU embedding.</p>
<p>This layer has some important caveats, due to the interface of the
TPU embedding hardware. Its behavior most closely mimics that of
tf.nn.embedding_lookup_sparse.</p>
<p>Supports multiple tables and multiple input_keys per table.
Requires its own optimizer parameters.</p>
<dl class="py method">
<dt class="sig sig-object py" id="lingvo.core.tpu_embedding_layers.TPUEmbeddingLayer.Params">
<em class="property"><span class="pre">classmethod</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">Params</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/tpu_embedding_layers.html#TPUEmbeddingLayer.Params"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.core.tpu_embedding_layers.TPUEmbeddingLayer.Params" title="Permalink to this definition"></a></dt>
<dd><p>Returns the layer params.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="lingvo.core.tpu_embedding_layers.TPUEmbeddingLayer._CreateChildrenVariables">
<span class="sig-name descname"><span class="pre">_CreateChildrenVariables</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/tpu_embedding_layers.html#TPUEmbeddingLayer._CreateChildrenVariables"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.core.tpu_embedding_layers.TPUEmbeddingLayer._CreateChildrenVariables" title="Permalink to this definition"></a></dt>
<dd><p>Create variables for child layers.</p>
<p>Should be rarely overridden, only in cases when control over the context of
children InstantiateVariables calls are needed. eg, if children variables
need to be created inside of a specific context manager.</p>
<p>There are a few cases of this in the codebase marked as for backwards
compatibility. This is only to ensure that variable scopes remain compatible
through the code migration. New layers should not copy that pattern, and
instead follow the standard pattern of self.CreateChild() in __init__() and
self.CreateVariable() in _CreateLayerVariables(). If you are okay with
breaking old checkpoints, you can go ahead and delete those functions.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="lingvo.core.tpu_embedding_layers.TPUEmbeddingLayer._CheckTPUEmbeddingConfig">
<span class="sig-name descname"><span class="pre">_CheckTPUEmbeddingConfig</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">tpu_embedding</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">table_to_config_dict</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">feature_to_config_dict</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">global_batch_size</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/tpu_embedding_layers.html#TPUEmbeddingLayer._CheckTPUEmbeddingConfig"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.core.tpu_embedding_layers.TPUEmbeddingLayer._CheckTPUEmbeddingConfig" title="Permalink to this definition"></a></dt>
<dd><p>Check that the existing tpu_embedding config matches the given ones.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="lingvo.core.tpu_embedding_layers.TPUEmbeddingLayer._CreateLayerVariables">
<span class="sig-name descname"><span class="pre">_CreateLayerVariables</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/tpu_embedding_layers.html#TPUEmbeddingLayer._CreateLayerVariables"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.core.tpu_embedding_layers.TPUEmbeddingLayer._CreateLayerVariables" title="Permalink to this definition"></a></dt>
<dd><p>Actually create variables for this layer.</p>
<p>Subclasses should override this function.</p>
<p>Variables are created inside of tf.variable_scope(self.params.name).</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="lingvo.core.tpu_embedding_layers.TPUEmbeddingLayer._TpuEmbLookup">
<span class="sig-name descname"><span class="pre">_TpuEmbLookup</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ids_map</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="lingvo.core.nested_map.html#lingvo.core.nested_map.NestedMap" title="lingvo.core.nested_map.NestedMap"><span class="pre">lingvo.core.nested_map.NestedMap</span></a></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="lingvo.core.nested_map.html#lingvo.core.nested_map.NestedMap" title="lingvo.core.nested_map.NestedMap"><span class="pre">lingvo.core.nested_map.NestedMap</span></a></span></span><a class="reference internal" href="_modules/lingvo/core/tpu_embedding_layers.html#TPUEmbeddingLayer._TpuEmbLookup"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.core.tpu_embedding_layers.TPUEmbeddingLayer._TpuEmbLookup" title="Permalink to this definition"></a></dt>
<dd><p>TPU Embedding lookup.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="lingvo.core.tpu_embedding_layers.TPUEmbeddingLayer.EmbLookup">
<span class="sig-name descname"><span class="pre">EmbLookup</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ids_map</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="lingvo.core.nested_map.html#lingvo.core.nested_map.NestedMap" title="lingvo.core.nested_map.NestedMap"><span class="pre">lingvo.core.nested_map.NestedMap</span></a></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="lingvo.core.nested_map.html#lingvo.core.nested_map.NestedMap" title="lingvo.core.nested_map.NestedMap"><span class="pre">lingvo.core.nested_map.NestedMap</span></a></span></span><a class="reference internal" href="_modules/lingvo/core/tpu_embedding_layers.html#TPUEmbeddingLayer.EmbLookup"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.core.tpu_embedding_layers.TPUEmbeddingLayer.EmbLookup" title="Permalink to this definition"></a></dt>
<dd><p>Looks up embedding vectors for each entry in dense Tensor ids_map.</p>
<p>Since the TPUEmbedding is monolothic, and consulted once per
FProp/BProp, we must centralize the lookup. Thus, for multiple
features, we contain them into a single-lookup rather than allowing
the caller to call Lookup multiple times.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>ids_map</strong> – A NestedMap of nested <code class="xref py py-obj docutils literal notranslate"><span class="pre">input_key</span></code> string -&gt; [batch, sequence] int
Tensor.
For sequence embeddings, -1 is used as a padding id. Non-sequence
embeddings do not support padded ids.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>Activations NestedMap of nested string -&gt;
For non-sequence embeddings:  [batch, 1, embedding_dim],
For sequence embeddings: [batch, max_sequence_length, embedding_dim]
float32 Tensor.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="lingvo.core.tpu_embedding_layers.TPUEmbeddingLayer.EmbLookupSparse">
<span class="sig-name descname"><span class="pre">EmbLookupSparse</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ids_map</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="lingvo.core.nested_map.html#lingvo.core.nested_map.NestedMap" title="lingvo.core.nested_map.NestedMap"><span class="pre">lingvo.core.nested_map.NestedMap</span></a></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="lingvo.core.nested_map.html#lingvo.core.nested_map.NestedMap" title="lingvo.core.nested_map.NestedMap"><span class="pre">lingvo.core.nested_map.NestedMap</span></a></span></span><a class="reference internal" href="_modules/lingvo/core/tpu_embedding_layers.html#TPUEmbeddingLayer.EmbLookupSparse"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.core.tpu_embedding_layers.TPUEmbeddingLayer.EmbLookupSparse" title="Permalink to this definition"></a></dt>
<dd><p>Looks up embedding vectors for each entry in SparseTensor ids_map.</p>
<p>Since the TPUEmbedding is monolothic, and consulted once per
FProp/BProp, we must centralize the lookup. Thus, for multiple
features, we contain them into a single-lookup rather than allowing
the caller to call Lookup multiple times.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ids_map</strong> – A NestedMap of nested <code class="xref py py-obj docutils literal notranslate"><span class="pre">input_key</span></code> string -&gt; [batch, …] int</p></li>
<li><p><strong>SparseTensor.</strong> – </p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>Activations NestedMap of nested string -&gt;
For non-sequence embeddings:  [batch, 1, embedding_dim],
For sequence embeddings: [batch, max_sequence_length, embedding_dim]
float32 Tensor.</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="lingvo.core.tokenizers.html" class="btn btn-neutral float-left" title="lingvo.core.tokenizers module" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="lingvo.core.tpu_summary.html" class="btn btn-neutral float-right" title="lingvo.core.tpu_summary module" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2018.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>