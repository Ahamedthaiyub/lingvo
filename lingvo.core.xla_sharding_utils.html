

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>lingvo.core.xla_sharding_utils module &mdash; Lingvo  documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="lingvo.tasks package" href="lingvo.tasks.html" />
    <link rel="prev" title="lingvo.core.wpm_encoder module" href="lingvo.core.wpm_encoder.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home" alt="Documentation Home"> Lingvo
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="lingvo.html">lingvo package</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="lingvo.html#subpackages">Subpackages</a><ul class="current">
<li class="toctree-l3 current"><a class="reference internal" href="lingvo.core.html">lingvo.core package</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="lingvo.core.html#subpackages">Subpackages</a></li>
<li class="toctree-l4 current"><a class="reference internal" href="lingvo.core.html#submodules">Submodules</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="lingvo.tasks.html">lingvo.tasks package</a></li>
<li class="toctree-l3"><a class="reference internal" href="lingvo.tools.html">lingvo.tools package</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="lingvo.html#submodules">Submodules</a></li>
</ul>
</li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Lingvo</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="lingvo.html">lingvo package</a> &raquo;</li>
        
          <li><a href="lingvo.core.html">lingvo.core package</a> &raquo;</li>
        
      <li>lingvo.core.xla_sharding_utils module</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/lingvo.core.xla_sharding_utils.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="module-lingvo.core.xla_sharding_utils">
<span id="lingvo-core-xla-sharding-utils-module"></span><h1>lingvo.core.xla_sharding_utils module<a class="headerlink" href="#module-lingvo.core.xla_sharding_utils" title="Permalink to this headline">¶</a></h1>
<p>Utilities for applying xla-sharding to a model.</p>
<dl class="py function">
<dt id="lingvo.core.xla_sharding_utils.Split">
<code class="sig-prename descclassname">lingvo.core.xla_sharding_utils.</code><code class="sig-name descname">Split</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">x</span></em>, <em class="sig-param"><span class="n">split_dimension</span></em>, <em class="sig-param"><span class="n">num_devices</span></em>, <em class="sig-param"><span class="n">use_sharding_op</span><span class="o">=</span><span class="default_value">True</span></em>, <em class="sig-param"><span class="n">input_shape</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/xla_sharding_utils.html#Split"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.xla_sharding_utils.Split" title="Permalink to this definition">¶</a></dt>
<dd><p>Wrapper for xla_sharding.split.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>x</strong> – Tensor to annotate.</p></li>
<li><p><strong>split_dimension</strong> – xla_sharding.split arg.</p></li>
<li><p><strong>num_devices</strong> – xla_sharding.split arg.</p></li>
<li><p><strong>use_sharding_op</strong> – <p>If true, adds a sharding op to set the sharding:
tensor = gen_xla_ops.xla_sharding(tensor)</p>
<dl>
<dt>hyouklee&#64;: use_sharding_op=False</dt><dd><p>”It adds the sharding attribute to the op itself. The outcome is that,
that information could be lost by TF graph transformations. Also,
directly attaching the sharding annotation to the op caused some
compilation failures in the past (due to incompatible shardings), so the
plan is to make use_sharding_op to be the default.”</p>
<p>”The only case I would set it to False today is when annotating weights.
Weight annotation does some special handling, so there may be some
changes needed in that logic if we add separate sharding op.”</p>
</dd>
</dl>
</p></li>
<li><p><strong>input_shape</strong> – The shape of the original tensor.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>Tensor conditionally annotated with sharding.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="lingvo.core.xla_sharding_utils.MeshSplit">
<code class="sig-prename descclassname">lingvo.core.xla_sharding_utils.</code><code class="sig-name descname">MeshSplit</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">x</span></em>, <em class="sig-param"><span class="n">device_mesh</span></em>, <em class="sig-param"><span class="n">tensor_split_dims_mapping</span></em>, <em class="sig-param"><span class="n">use_sharding_op</span><span class="o">=</span><span class="default_value">True</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/xla_sharding_utils.html#MeshSplit"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.xla_sharding_utils.MeshSplit" title="Permalink to this definition">¶</a></dt>
<dd><p>Wrapper of xla_sharding.mesh_split().</p>
</dd></dl>

<dl class="py function">
<dt id="lingvo.core.xla_sharding_utils.ZigzagOrderOnDeviceMesh">
<code class="sig-prename descclassname">lingvo.core.xla_sharding_utils.</code><code class="sig-name descname">ZigzagOrderOnDeviceMesh</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">device_mesh</span></em>, <em class="sig-param"><span class="n">zigzag_mesh_dim</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/xla_sharding_utils.html#ZigzagOrderOnDeviceMesh"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.xla_sharding_utils.ZigzagOrderOnDeviceMesh" title="Permalink to this definition">¶</a></dt>
<dd><p>Permutes device_mesh to form zigzag order along zigzag_mesh_dim.</p>
</dd></dl>

<dl class="py function">
<dt id="lingvo.core.xla_sharding_utils.GetNonPod2dMesh">
<code class="sig-prename descclassname">lingvo.core.xla_sharding_utils.</code><code class="sig-name descname">GetNonPod2dMesh</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">device_mesh_shape</span></em>, <em class="sig-param"><span class="n">physical_mesh_shape</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/xla_sharding_utils.html#GetNonPod2dMesh"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.xla_sharding_utils.GetNonPod2dMesh" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a 2D device mesh on slices smaller than a pod.</p>
</dd></dl>

</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="lingvo.tasks.html" class="btn btn-neutral float-right" title="lingvo.tasks package" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="lingvo.core.wpm_encoder.html" class="btn btn-neutral float-left" title="lingvo.core.wpm_encoder module" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2018

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>