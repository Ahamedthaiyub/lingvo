

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>lingvo.tasks.mt.encoder module &mdash; Lingvo  documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="lingvo.tasks.mt.input_generator module" href="lingvo.tasks.mt.input_generator.html" />
    <link rel="prev" title="lingvo.tasks.mt.decoder module" href="lingvo.tasks.mt.decoder.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home" alt="Documentation Home"> Lingvo
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="lingvo.html">lingvo package</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="lingvo.html#subpackages">Subpackages</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="lingvo.core.html">lingvo.core package</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="lingvo.tasks.html">lingvo.tasks package</a><ul class="current">
<li class="toctree-l4 current"><a class="reference internal" href="lingvo.tasks.html#subpackages">Subpackages</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="lingvo.tools.html">lingvo.tools package</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="lingvo.html#submodules">Submodules</a></li>
</ul>
</li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Lingvo</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="lingvo.html">lingvo package</a> &raquo;</li>
        
          <li><a href="lingvo.tasks.html">lingvo.tasks package</a> &raquo;</li>
        
          <li><a href="lingvo.tasks.mt.html">lingvo.tasks.mt package</a> &raquo;</li>
        
      <li>lingvo.tasks.mt.encoder module</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/lingvo.tasks.mt.encoder.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="module-lingvo.tasks.mt.encoder">
<span id="lingvo-tasks-mt-encoder-module"></span><h1>lingvo.tasks.mt.encoder module<a class="headerlink" href="#module-lingvo.tasks.mt.encoder" title="Permalink to this headline">¶</a></h1>
<p>Encoders for the machine translation model.</p>
<dl class="py class">
<dt id="lingvo.tasks.mt.encoder.MTEncoderV1">
<em class="property">class </em><code class="sig-prename descclassname">lingvo.tasks.mt.encoder.</code><code class="sig-name descname">MTEncoderV1</code><span class="sig-paren">(</span><em class="sig-param"><span class="o">*</span><span class="n">args</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/tasks/mt/encoder.html#MTEncoderV1"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.tasks.mt.encoder.MTEncoderV1" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="lingvo.core.base_layer.html#lingvo.core.base_layer.BaseLayer" title="lingvo.core.base_layer.BaseLayer"><code class="xref py py-class docutils literal notranslate"><span class="pre">lingvo.core.base_layer.BaseLayer</span></code></a></p>
<p>Machine translation encoder version 1.</p>
<dl class="py method">
<dt id="lingvo.tasks.mt.encoder.MTEncoderV1.Params">
<em class="property">classmethod </em><code class="sig-name descname">Params</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/tasks/mt/encoder.html#MTEncoderV1.Params"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.tasks.mt.encoder.MTEncoderV1.Params" title="Permalink to this definition">¶</a></dt>
<dd><p>Configs for <a class="reference internal" href="#lingvo.tasks.mt.encoder.MTEncoderV1" title="lingvo.tasks.mt.encoder.MTEncoderV1"><code class="xref py py-obj docutils literal notranslate"><span class="pre">MTEncoderV1</span></code></a>.</p>
</dd></dl>

<dl class="py method">
<dt id="lingvo.tasks.mt.encoder.MTEncoderV1.ApplyClipping">
<code class="sig-name descname">ApplyClipping</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">theta</span></em>, <em class="sig-param"><span class="n">x</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/tasks/mt/encoder.html#MTEncoderV1.ApplyClipping"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.tasks.mt.encoder.MTEncoderV1.ApplyClipping" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt id="lingvo.tasks.mt.encoder.MTEncoderV1.FProp">
<code class="sig-name descname">FProp</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">theta</span></em>, <em class="sig-param"><span class="n">input_batch</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/tasks/mt/encoder.html#MTEncoderV1.FProp"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.tasks.mt.encoder.MTEncoderV1.FProp" title="Permalink to this definition">¶</a></dt>
<dd><p>Encodes source as represented by <code class="xref py py-obj docutils literal notranslate"><span class="pre">inputs</span></code> and <code class="xref py py-obj docutils literal notranslate"><span class="pre">paddings</span></code>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>theta</strong> – A <a class="reference internal" href="lingvo.core.py_utils.html#lingvo.core.py_utils.NestedMap" title="lingvo.core.py_utils.NestedMap"><code class="xref py py-obj docutils literal notranslate"><span class="pre">NestedMap</span></code></a> object containing weights’ values of this layer and
its children layers.</p></li>
<li><p><strong>input_batch</strong> – A <a class="reference internal" href="lingvo.core.py_utils.html#lingvo.core.py_utils.NestedMap" title="lingvo.core.py_utils.NestedMap"><code class="xref py py-obj docutils literal notranslate"><span class="pre">NestedMap</span></code></a> with fields:
- ids: The inputs tensor. It is expected to be of shape [batch, time].
- paddings: The paddings tensor. Expected shape [batch, time].</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><ul class="simple">
<li><p>encoded: The encoded features, a tensor of shape [time, batch, depth]</p></li>
<li><p>padding: of shape [time, batch]</p></li>
<li><p>segment_id: [time, batch] if packed inputs are supported by the model
(and all layers), or None otherwise.</p></li>
</ul>
</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>A NestedMap containing</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt id="lingvo.tasks.mt.encoder.MTEncoderUniRNN">
<em class="property">class </em><code class="sig-prename descclassname">lingvo.tasks.mt.encoder.</code><code class="sig-name descname">MTEncoderUniRNN</code><span class="sig-paren">(</span><em class="sig-param"><span class="o">*</span><span class="n">args</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/tasks/mt/encoder.html#MTEncoderUniRNN"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.tasks.mt.encoder.MTEncoderUniRNN" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="lingvo.core.base_layer.html#lingvo.core.base_layer.BaseLayer" title="lingvo.core.base_layer.BaseLayer"><code class="xref py py-class docutils literal notranslate"><span class="pre">lingvo.core.base_layer.BaseLayer</span></code></a></p>
<p>MT encoder that consists of a stack of uni-directional RNN layers.</p>
<dl class="py method">
<dt id="lingvo.tasks.mt.encoder.MTEncoderUniRNN.Params">
<em class="property">classmethod </em><code class="sig-name descname">Params</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/tasks/mt/encoder.html#MTEncoderUniRNN.Params"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.tasks.mt.encoder.MTEncoderUniRNN.Params" title="Permalink to this definition">¶</a></dt>
<dd><p>Configs for <a class="reference internal" href="#lingvo.tasks.mt.encoder.MTEncoderUniRNN" title="lingvo.tasks.mt.encoder.MTEncoderUniRNN"><code class="xref py py-obj docutils literal notranslate"><span class="pre">MTEncoderUniRNN</span></code></a>.</p>
</dd></dl>

<dl class="py method">
<dt id="lingvo.tasks.mt.encoder.MTEncoderUniRNN.ApplyClipping">
<code class="sig-name descname">ApplyClipping</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">theta</span></em>, <em class="sig-param"><span class="n">x</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/tasks/mt/encoder.html#MTEncoderUniRNN.ApplyClipping"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.tasks.mt.encoder.MTEncoderUniRNN.ApplyClipping" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt id="lingvo.tasks.mt.encoder.MTEncoderUniRNN.zero_state">
<code class="sig-name descname">zero_state</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">theta</span></em>, <em class="sig-param"><span class="n">batch_size</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/tasks/mt/encoder.html#MTEncoderUniRNN.zero_state"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.tasks.mt.encoder.MTEncoderUniRNN.zero_state" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt id="lingvo.tasks.mt.encoder.MTEncoderUniRNN.FProp">
<code class="sig-name descname">FProp</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">theta</span></em>, <em class="sig-param"><span class="n">input_batch</span></em>, <em class="sig-param"><span class="n">state0</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/tasks/mt/encoder.html#MTEncoderUniRNN.FProp"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.tasks.mt.encoder.MTEncoderUniRNN.FProp" title="Permalink to this definition">¶</a></dt>
<dd><p>Forward propagation.</p>
<p>The central interface that subclasses should implement. The caller
calls <a class="reference internal" href="#lingvo.tasks.mt.encoder.MTEncoderUniRNN.FProp" title="lingvo.tasks.mt.encoder.MTEncoderUniRNN.FProp"><code class="xref py py-obj docutils literal notranslate"><span class="pre">FProp</span></code></a> with a <code class="xref py py-obj docutils literal notranslate"><span class="pre">theta</span></code> dictionary. E.g.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">foo</span> <span class="o">=</span> <span class="n">InstanceOfASubClassOfFoo</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">foo</span><span class="o">.</span><span class="n">FProp</span><span class="p">(</span><span class="n">foo</span><span class="o">.</span><span class="n">theta</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
</pre></div>
</div>
<p>The implementation of <a class="reference internal" href="#lingvo.tasks.mt.encoder.MTEncoderUniRNN.FProp" title="lingvo.tasks.mt.encoder.MTEncoderUniRNN.FProp"><code class="xref py py-obj docutils literal notranslate"><span class="pre">FProp()</span></code></a> computes a function given
the theta and the inputs. E.g.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">subs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">children</span>
<span class="n">inputs</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">a0</span> <span class="o">=</span> <span class="n">subs</span><span class="o">.</span><span class="n">linear</span><span class="o">.</span><span class="n">FProp</span><span class="p">(</span><span class="n">theta</span><span class="o">.</span><span class="n">linear</span><span class="p">,</span> <span class="n">inputs</span><span class="p">)</span>
<span class="n">a1</span> <span class="o">=</span> <span class="n">subs</span><span class="o">.</span><span class="n">softmax</span><span class="o">.</span><span class="n">FProp</span><span class="p">(</span><span class="n">theta</span><span class="o">.</span><span class="n">softmax</span><span class="p">,</span> <span class="n">a0</span><span class="p">)</span>
<span class="c1"># The same layer applied twice.</span>
<span class="n">a2</span> <span class="o">=</span> <span class="n">subs</span><span class="o">.</span><span class="n">linear</span><span class="o">.</span><span class="n">FProp</span><span class="p">(</span><span class="n">theta</span><span class="o">.</span><span class="n">linear</span><span class="p">,</span> <span class="n">a1</span><span class="p">)</span>
<span class="k">return</span> <span class="n">a2</span>
</pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>theta</strong> – A <a class="reference internal" href="lingvo.core.py_utils.html#lingvo.core.py_utils.NestedMap" title="lingvo.core.py_utils.NestedMap"><code class="xref py py-obj docutils literal notranslate"><span class="pre">NestedMap</span></code></a> object containing weights’ values of this
layer and its children layers.</p></li>
<li><p><strong>*args</strong> – List args.</p></li>
<li><p><strong>**kwargs</strong> – Keyward args.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt id="lingvo.tasks.mt.encoder.MTEncoderBiRNN">
<em class="property">class </em><code class="sig-prename descclassname">lingvo.tasks.mt.encoder.</code><code class="sig-name descname">MTEncoderBiRNN</code><span class="sig-paren">(</span><em class="sig-param"><span class="o">*</span><span class="n">args</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/tasks/mt/encoder.html#MTEncoderBiRNN"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.tasks.mt.encoder.MTEncoderBiRNN" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="lingvo.core.base_layer.html#lingvo.core.base_layer.BaseLayer" title="lingvo.core.base_layer.BaseLayer"><code class="xref py py-class docutils literal notranslate"><span class="pre">lingvo.core.base_layer.BaseLayer</span></code></a></p>
<p>MT encoder that consists of a stack of bi-directional RNN layers.</p>
<dl class="py method">
<dt id="lingvo.tasks.mt.encoder.MTEncoderBiRNN.Params">
<em class="property">classmethod </em><code class="sig-name descname">Params</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/tasks/mt/encoder.html#MTEncoderBiRNN.Params"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.tasks.mt.encoder.MTEncoderBiRNN.Params" title="Permalink to this definition">¶</a></dt>
<dd><p>Configs for <a class="reference internal" href="#lingvo.tasks.mt.encoder.MTEncoderBiRNN" title="lingvo.tasks.mt.encoder.MTEncoderBiRNN"><code class="xref py py-obj docutils literal notranslate"><span class="pre">MTEncoderBiRNN</span></code></a>.</p>
</dd></dl>

<dl class="py method">
<dt id="lingvo.tasks.mt.encoder.MTEncoderBiRNN.ApplyClipping">
<code class="sig-name descname">ApplyClipping</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">theta</span></em>, <em class="sig-param"><span class="n">x</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/tasks/mt/encoder.html#MTEncoderBiRNN.ApplyClipping"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.tasks.mt.encoder.MTEncoderBiRNN.ApplyClipping" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt id="lingvo.tasks.mt.encoder.MTEncoderBiRNN._ComputeInputs">
<code class="sig-name descname">_ComputeInputs</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">theta</span></em>, <em class="sig-param"><span class="n">xs</span></em>, <em class="sig-param"><span class="n">input_batch</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/tasks/mt/encoder.html#MTEncoderBiRNN._ComputeInputs"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.tasks.mt.encoder.MTEncoderBiRNN._ComputeInputs" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt id="lingvo.tasks.mt.encoder.MTEncoderBiRNN.FProp">
<code class="sig-name descname">FProp</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">theta</span></em>, <em class="sig-param"><span class="n">input_batch</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/tasks/mt/encoder.html#MTEncoderBiRNN.FProp"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.tasks.mt.encoder.MTEncoderBiRNN.FProp" title="Permalink to this definition">¶</a></dt>
<dd><p>Forward propagation.</p>
<p>The central interface that subclasses should implement. The caller
calls <a class="reference internal" href="#lingvo.tasks.mt.encoder.MTEncoderBiRNN.FProp" title="lingvo.tasks.mt.encoder.MTEncoderBiRNN.FProp"><code class="xref py py-obj docutils literal notranslate"><span class="pre">FProp</span></code></a> with a <code class="xref py py-obj docutils literal notranslate"><span class="pre">theta</span></code> dictionary. E.g.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">foo</span> <span class="o">=</span> <span class="n">InstanceOfASubClassOfFoo</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">foo</span><span class="o">.</span><span class="n">FProp</span><span class="p">(</span><span class="n">foo</span><span class="o">.</span><span class="n">theta</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
</pre></div>
</div>
<p>The implementation of <a class="reference internal" href="#lingvo.tasks.mt.encoder.MTEncoderBiRNN.FProp" title="lingvo.tasks.mt.encoder.MTEncoderBiRNN.FProp"><code class="xref py py-obj docutils literal notranslate"><span class="pre">FProp()</span></code></a> computes a function given
the theta and the inputs. E.g.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">subs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">children</span>
<span class="n">inputs</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">a0</span> <span class="o">=</span> <span class="n">subs</span><span class="o">.</span><span class="n">linear</span><span class="o">.</span><span class="n">FProp</span><span class="p">(</span><span class="n">theta</span><span class="o">.</span><span class="n">linear</span><span class="p">,</span> <span class="n">inputs</span><span class="p">)</span>
<span class="n">a1</span> <span class="o">=</span> <span class="n">subs</span><span class="o">.</span><span class="n">softmax</span><span class="o">.</span><span class="n">FProp</span><span class="p">(</span><span class="n">theta</span><span class="o">.</span><span class="n">softmax</span><span class="p">,</span> <span class="n">a0</span><span class="p">)</span>
<span class="c1"># The same layer applied twice.</span>
<span class="n">a2</span> <span class="o">=</span> <span class="n">subs</span><span class="o">.</span><span class="n">linear</span><span class="o">.</span><span class="n">FProp</span><span class="p">(</span><span class="n">theta</span><span class="o">.</span><span class="n">linear</span><span class="p">,</span> <span class="n">a1</span><span class="p">)</span>
<span class="k">return</span> <span class="n">a2</span>
</pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>theta</strong> – A <a class="reference internal" href="lingvo.core.py_utils.html#lingvo.core.py_utils.NestedMap" title="lingvo.core.py_utils.NestedMap"><code class="xref py py-obj docutils literal notranslate"><span class="pre">NestedMap</span></code></a> object containing weights’ values of this
layer and its children layers.</p></li>
<li><p><strong>*args</strong> – List args.</p></li>
<li><p><strong>**kwargs</strong> – Keyward args.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt id="lingvo.tasks.mt.encoder.MTEncoderBiRNNPrecomputedEmbedding">
<em class="property">class </em><code class="sig-prename descclassname">lingvo.tasks.mt.encoder.</code><code class="sig-name descname">MTEncoderBiRNNPrecomputedEmbedding</code><span class="sig-paren">(</span><em class="sig-param"><span class="o">*</span><span class="n">args</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/tasks/mt/encoder.html#MTEncoderBiRNNPrecomputedEmbedding"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.tasks.mt.encoder.MTEncoderBiRNNPrecomputedEmbedding" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#lingvo.tasks.mt.encoder.MTEncoderBiRNN" title="lingvo.tasks.mt.encoder.MTEncoderBiRNN"><code class="xref py py-class docutils literal notranslate"><span class="pre">lingvo.tasks.mt.encoder.MTEncoderBiRNN</span></code></a></p>
<p>A variant of MTEncoderBiRNN where the RNN input is consumed directly…</p>
<p>instead of looked up in an embedding layer from one-hot vectors.</p>
<dl class="py method">
<dt id="lingvo.tasks.mt.encoder.MTEncoderBiRNNPrecomputedEmbedding._ComputeInputs">
<code class="sig-name descname">_ComputeInputs</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">theta</span></em>, <em class="sig-param"><span class="n">xs</span></em>, <em class="sig-param"><span class="n">input_batch</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/tasks/mt/encoder.html#MTEncoderBiRNNPrecomputedEmbedding._ComputeInputs"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.tasks.mt.encoder.MTEncoderBiRNNPrecomputedEmbedding._ComputeInputs" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py class">
<dt id="lingvo.tasks.mt.encoder.TransformerEncoder">
<em class="property">class </em><code class="sig-prename descclassname">lingvo.tasks.mt.encoder.</code><code class="sig-name descname">TransformerEncoder</code><span class="sig-paren">(</span><em class="sig-param"><span class="o">*</span><span class="n">args</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/tasks/mt/encoder.html#TransformerEncoder"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.tasks.mt.encoder.TransformerEncoder" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="lingvo.core.base_layer.html#lingvo.core.base_layer.BaseLayer" title="lingvo.core.base_layer.BaseLayer"><code class="xref py py-class docutils literal notranslate"><span class="pre">lingvo.core.base_layer.BaseLayer</span></code></a></p>
<p>Transformer stack with sinusoidal positional embeddings and attention.</p>
<p>Implements the encoder of ‘Attention is All You Need’:
<a class="reference external" href="https://arxiv.org/abs/1706.03762">https://arxiv.org/abs/1706.03762</a>.</p>
<dl class="py method">
<dt id="lingvo.tasks.mt.encoder.TransformerEncoder.Params">
<em class="property">classmethod </em><code class="sig-name descname">Params</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/tasks/mt/encoder.html#TransformerEncoder.Params"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.tasks.mt.encoder.TransformerEncoder.Params" title="Permalink to this definition">¶</a></dt>
<dd><p>Configs for <a class="reference internal" href="#lingvo.tasks.mt.encoder.TransformerEncoder" title="lingvo.tasks.mt.encoder.TransformerEncoder"><code class="xref py py-obj docutils literal notranslate"><span class="pre">TransformerEncoder</span></code></a>.</p>
</dd></dl>

<dl class="py method">
<dt id="lingvo.tasks.mt.encoder.TransformerEncoder._CreateChildrenVariables">
<code class="sig-name descname">_CreateChildrenVariables</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/tasks/mt/encoder.html#TransformerEncoder._CreateChildrenVariables"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.tasks.mt.encoder.TransformerEncoder._CreateChildrenVariables" title="Permalink to this definition">¶</a></dt>
<dd><p>Create variables for child layers.</p>
<p>Should be rarely overridden, only in cases when control over the context of
children InstantiateVariables calls are needed. eg, if children variables
need to be created inside of a specific context manager.</p>
<p>There are a few cases of this in the codebase marked as for backwards
compability. This is only to ensure that variable scopes remain compatible
through the code migration. New layers should not copy that pattern, and
instead follow the standard pattern of self.CreateChild() in __init__() and
self.CreateVariable() in _CreateLayerVariables(). If you are okay with
breaking old checkpoints, you can go ahead and delete those functions.</p>
</dd></dl>

<dl class="py method">
<dt id="lingvo.tasks.mt.encoder.TransformerEncoder.FProp">
<code class="sig-name descname">FProp</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">theta</span></em>, <em class="sig-param"><span class="n">input_batch</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/tasks/mt/encoder.html#TransformerEncoder.FProp"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.tasks.mt.encoder.TransformerEncoder.FProp" title="Permalink to this definition">¶</a></dt>
<dd><p>Embeds source ids and transforms with TransformerStack.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>theta</strong> – A <a class="reference internal" href="lingvo.core.py_utils.html#lingvo.core.py_utils.NestedMap" title="lingvo.core.py_utils.NestedMap"><code class="xref py py-obj docutils literal notranslate"><span class="pre">NestedMap</span></code></a> object containing weights’ values of this
layer and its children layers.</p></li>
<li><p><strong>input_batch</strong> – <p>A <a class="reference internal" href="lingvo.core.py_utils.html#lingvo.core.py_utils.NestedMap" title="lingvo.core.py_utils.NestedMap"><code class="xref py py-obj docutils literal notranslate"><span class="pre">NestedMap</span></code></a> with fields:</p>
<ul>
<li><p>ids: The inputs tensor. It is expected to be of shape [batch, time].</p></li>
<li><p>paddings: The paddings tensor. Expected shape [batch, time].</p></li>
<li><dl class="simple">
<dt>task_ids: If p.task_emb is provided, must contain per-token task</dt><dd><p>ids of shape [batch, time].</p>
</dd>
</dl>
</li>
</ul>
</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><p>A NestedMap containing</p>
<ul class="simple">
<li><p>encoded: The encoded features, either a tensor of shape
[time, batch, depth], or a list of tensors if is_transparent is set in
transformer_stack.</p></li>
<li><p>padding: of shape [time, batch]</p></li>
<li><p>segment_id: [time, batch] if packed inputs are supported by the model
(and all layers), or None otherwise.</p></li>
<li><p>embedded_inputs: [time, batch, depth] embedded inputs tokens without
positional encodings.</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="lingvo.tasks.mt.encoder.TransformerEncoder.FPropFullSequence">
<code class="sig-name descname">FPropFullSequence</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">theta</span></em>, <em class="sig-param"><span class="n">ids</span></em>, <em class="sig-param"><span class="n">paddings</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/tasks/mt/encoder.html#TransformerEncoder.FPropFullSequence"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.tasks.mt.encoder.TransformerEncoder.FPropFullSequence" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py class">
<dt id="lingvo.tasks.mt.encoder.TransformerBatchMajorEncoder">
<em class="property">class </em><code class="sig-prename descclassname">lingvo.tasks.mt.encoder.</code><code class="sig-name descname">TransformerBatchMajorEncoder</code><span class="sig-paren">(</span><em class="sig-param"><span class="o">*</span><span class="n">args</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/tasks/mt/encoder.html#TransformerBatchMajorEncoder"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.tasks.mt.encoder.TransformerBatchMajorEncoder" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="lingvo.core.base_layer.html#lingvo.core.base_layer.BaseLayer" title="lingvo.core.base_layer.BaseLayer"><code class="xref py py-class docutils literal notranslate"><span class="pre">lingvo.core.base_layer.BaseLayer</span></code></a></p>
<p>Transformer encoder with batch major implementation.</p>
<p>This encoder first applies dropout to the input embeddings,
then returns encoded output produced by p.transformer_stack using
self_attention_layer builder.</p>
<p>Example definition for a stack of 6 transformer layers:</p>
<dl class="simple">
<dt>builder_params = self_attention_layer.Builder.Params().Set(</dt><dd><p>model_dim=model_dim,
ff_hidden_dim=ff_hidden_dim,
num_heads=num_heads,
selfatten_add_unnormalized_input=False,
selfatten_enable_value_proj=True)</p>
</dd>
<dt>p.transformer_stack = builder_params.Instantiate().TransformerStack(</dt><dd><p>‘transformer_stack’, 6)</p>
</dd>
</dl>
<p>Implements the encoder of ‘Attention is All You Need’:
<a class="reference external" href="https://arxiv.org/abs/1706.03762">https://arxiv.org/abs/1706.03762</a>.</p>
<dl class="py method">
<dt id="lingvo.tasks.mt.encoder.TransformerBatchMajorEncoder.Params">
<em class="property">classmethod </em><code class="sig-name descname">Params</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/tasks/mt/encoder.html#TransformerBatchMajorEncoder.Params"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.tasks.mt.encoder.TransformerBatchMajorEncoder.Params" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the layer params.</p>
</dd></dl>

<dl class="py method">
<dt id="lingvo.tasks.mt.encoder.TransformerBatchMajorEncoder._CreateChildrenVariables">
<code class="sig-name descname">_CreateChildrenVariables</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/tasks/mt/encoder.html#TransformerBatchMajorEncoder._CreateChildrenVariables"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.tasks.mt.encoder.TransformerBatchMajorEncoder._CreateChildrenVariables" title="Permalink to this definition">¶</a></dt>
<dd><p>Create variables for child layers.</p>
<p>Should be rarely overridden, only in cases when control over the context of
children InstantiateVariables calls are needed. eg, if children variables
need to be created inside of a specific context manager.</p>
<p>There are a few cases of this in the codebase marked as for backwards
compability. This is only to ensure that variable scopes remain compatible
through the code migration. New layers should not copy that pattern, and
instead follow the standard pattern of self.CreateChild() in __init__() and
self.CreateVariable() in _CreateLayerVariables(). If you are okay with
breaking old checkpoints, you can go ahead and delete those functions.</p>
</dd></dl>

<dl class="py method">
<dt id="lingvo.tasks.mt.encoder.TransformerBatchMajorEncoder.FProp">
<code class="sig-name descname">FProp</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">theta</span></em>, <em class="sig-param"><span class="n">input_batch</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/tasks/mt/encoder.html#TransformerBatchMajorEncoder.FProp"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.tasks.mt.encoder.TransformerBatchMajorEncoder.FProp" title="Permalink to this definition">¶</a></dt>
<dd><p>Embeds source ids and transforms with TransformerStack.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>theta</strong> – A <a class="reference internal" href="lingvo.core.py_utils.html#lingvo.core.py_utils.NestedMap" title="lingvo.core.py_utils.NestedMap"><code class="xref py py-obj docutils literal notranslate"><span class="pre">NestedMap</span></code></a> object containing weights’ values of this layer and
its children layers.</p></li>
<li><p><strong>input_batch</strong> – A <a class="reference internal" href="lingvo.core.py_utils.html#lingvo.core.py_utils.NestedMap" title="lingvo.core.py_utils.NestedMap"><code class="xref py py-obj docutils literal notranslate"><span class="pre">NestedMap</span></code></a> object containing: ids - The inputs tensor of
shape [batch, time]. paddings - The ids’ paddings of shape [batch,
time].</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><dl class="simple">
<dt>encoded - The encoded features of shape [time, batch, dim] or [batch,</dt><dd><p>time, dim], depending p.output_data_format.</p>
</dd>
<dt>padding - The encoded features’ padding of shape [time, batch] or</dt><dd><p>[batch, time].</p>
</dd>
<dt>segment_id - The segmentation of packed inputs of shape [time, batch] or</dt><dd><p>[batch, time] if it is supported by the model, or None otherwise.</p>
</dd>
<dt>embedded_inputs - The embedded inputs tokens without positional</dt><dd><p>encodings of shape [time, batch, dim] or [batch, time, dim].</p>
</dd>
</dl>
</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>A ‘.NestedMap’ object containing</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="lingvo.tasks.mt.input_generator.html" class="btn btn-neutral float-right" title="lingvo.tasks.mt.input_generator module" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="lingvo.tasks.mt.decoder.html" class="btn btn-neutral float-left" title="lingvo.tasks.mt.decoder module" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2018

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>